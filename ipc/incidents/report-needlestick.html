<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
ย <meta charset="UTF-8" />
ย <meta name="viewport" content="width=device-width, initial-scale=1.0" />
ย <title>ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุงูุชุนุฑุถ ุงููููู โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</title>
ย ย <script src="https://cdn.tailwindcss.com"></script>
ย <style>
ย ย :root {
ย ย ย --maroon: #7B1E24;
ย ย ย --gold: #E9C46A;
ย ย ย --sand: #FDF8F5;
ย ย }
ย ย body {
ย ย ย font-family: 'Tajawal', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
ย ย ย background: var(--sand);
ย ย ย background-image: radial-gradient(circle at top left, #fff 20%, #fdf6f4 70%);
ย ย }
ย ย .header {
ย ย ย background: linear-gradient(to right, var(--maroon), #9e2b2b);
ย ย ย color: white;
ย ย ย border-bottom: 6px solid var(--gold);
ย ย }
ย ย .card {
ย ย ย background: white;
ย ย ย border-radius: 16px;
ย ย ย box-shadow: 0 4px 10px rgba(0,0,0,0.1);
ย ย }
ย ย .label { color: var(--maroon); font-weight: 600; }
ย ย .btn {
ย ย ย background-color: var(--maroon);
ย ย ย color: white;
ย ย ย padding: 12px 28px;
ย ย ย border-radius: 10px;
ย ย ย font-weight: 700;
ย ย ย transition: all 0.2s ease;
ย ย }
ย ย .btn:hover { background-color: var(--gold); color: #3b2f2f; }
ย ย .hidden { display: none; }
ย </style>
</head>
<body class="p-4">

ย ย <header class="header py-6 text-center rounded-b-xl shadow">
ย ย <h1 class="text-3xl font-bold">๐ฉบ ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุงูุชุนุฑุถ ุงููููู</h1>
ย ย <p class="text-lg mt-2" style="color: var(--gold)">(ูุฎุฒู โ ุฏููู โ ุฑุฐุงุฐ ูุฎุงุทู)</p>
ย ย <p class="text-sm text-gray-100 mt-1">ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</p>
ย </header>

ย ย <section class="max-w-4xl mx-auto mt-8 card p-8 space-y-6">
ย ย <form id="exposureForm" class="space-y-4" autocomplete="off" novalidate>
ย ย ย <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2">ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h2>
ย ย ย <div class="grid md:grid-cols-2 gap-4">
ย ย ย ย <div>
ย ย ย ย ย <label class="label" for="fullname">ุงูุงุณู ุงููุงูู</label>
ย ย ย ย ย <input id="fullname" name="fullname" class="w-full border p-2 rounded" required>
ย ย ย ย </div>
ย ย ย ย <div>
ย ย ย ย ย <label class="label" for="department">ุงููุณู / ุงููุญุฏุฉ</label>
ย ย ย ย ย <input id="department" name="department" class="w-full border p-2 rounded" required>
ย ย ย ย </div>
ย ย ย ย <div>
ย ย ย ย ย <label class="label" for="position">ุงููุธููุฉ</label>
ย ย ย ย ย <input id="position" name="position" class="w-full border p-2 rounded">
ย ย ย ย </div>
ย ย ย ย <div>
ย ย ย ย ย <label class="label" for="date">ุชุงุฑูุฎ ุงูุญุงุฏุซ</label>
ย ย ย ย ย <input id="date" type="date" name="date" class="w-full border p-2 rounded" required>
ย ย ย ย </div>
ย ย ย ย <div>
ย ย ย ย ย <label class="label" for="time">ุงูููุช</label>
ย ย ย ย ย <input id="time" type="time" name="time" class="w-full border p-2 rounded" required>
ย ย ย ย </div>
ย ย ย </div>

ย ย ย <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2">ููุน ุงูุชุนุฑุถ</h2>
ย ย ย <select id="exposureType" name="exposure_type" class="w-full border p-2 rounded" required>
ย ย ย ย <option value="">ุงุฎุชุฑ ููุน ุงูุชุนุฑุถ</option>
ย ย ย ย <option value="needle">ุชุนุฑุถ ูุฎุฒู (ุฅุจุฑุฉ ุฃู ุฃุฏุงุฉ ุญุงุฏุฉ)</option>
ย ย ย ย <option value="blood">ุชุนุฑุถ ุฏููู / ุณูุงุฆู ุฌุณุฏูุฉ</option>
ย ย ย ย <option value="mucosal">ุชูุงูุณ ุงูุฃุบุดูุฉ ุงููุฎุงุทูุฉ (ุงูุนููุ ุงูุฃููุ ุงููู)</option>
ย ย ย </select>

ย ย ย ย ย ย <div id="needleSection" class="hidden space-y-2 mt-2">
ย ย ย ย <label class="label" for="instrument">ููุน ุงูุฃุฏุงุฉ</label>
ย ย ย ย <select id="instrument" name="instrument" class="w-full border p-2 rounded">
ย ย ย ย ย <option value="">ุงุฎุชุฑ</option>
ย ย ย ย ย <option>ุฅุจุฑุฉ</option><option>ูุดุฑุท</option><option>ุฃุฏุงุฉ ุฃุฎุฑู</option>
ย ย ย ย </select>

ย ย ย ย <label class="label" for="contaminated">ูู ูุงูุช ุงูุฃุฏุงุฉ ูููุซุฉ ุจุฏู/ุณูุงุฆูุ</label>
ย ย ย ย <select id="contaminated" name="contaminated" class="w-full border p-2 rounded">
ย ย ย ย ย <option value="">ุงุฎุชุฑ</option>
ย ย ย ย ย <option value="yes">ูุนู</option>
ย ย ย ย ย <option value="no">ูุง</option>
ย ย ย ย </select>

ย ย ย ย <label class="label" for="injury_site">ููุถุน ุงูุฅุตุงุจุฉ</label>
ย ย ย ย <input id="injury_site" name="injury_site" class="w-full border p-2 rounded" placeholder="ูุซุงู: ุฅุตุจุน ุงููุฏ ุงููููู">
ย ย ย </div>

ย ย ย ย ย ย <div id="bloodSection" class="hidden space-y-2 mt-2">
ย ย ย ย <label class="label" for="contact_area">ููุงู ุงูุชูุงูุณ</label>
ย ย ย ย <input id="contact_area" name="contact_area" class="w-full border p-2 rounded" placeholder="ูุซู: ุฌุฑุญ ููุชูุญ / ุฌูุฏ ูุชุดูู">

ย ย ย ย <label class="label" for="fluid_type">ููุน ุงูุณุงุฆู</label>
ย ย ย ย <input id="fluid_type" name="fluid_type" class="w-full border p-2 rounded" placeholder="ุฏู / ุณูุงุฆู ุฌุณุฏูุฉ">

ย ย ย ย <label class="label" for="fluid_amount">ูููุฉ ุงูุณุงุฆู ุงูุชูุฑูุจูุฉ</label>
ย ย ย ย <input id="fluid_amount" name="fluid_amount" class="w-full border p-2 rounded" placeholder="ููููุฉ / ูุชูุณุทุฉ / ูุซูุฑุฉ">
ย ย ย </div>

ย ย ย <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2 mt-6">ุจูุงูุงุช ุงููุฑูุถ ุงููุตุฏุฑ</h2>
ย ย ย <label class="label" for="patient_id">ุฑูู ุงูููู ุงูุทุจู (ุฅู ูุฌุฏ)</label>
ย ย ย <input id="patient_id" name="patient_id" class="w-full border p-2 rounded" inputmode="numeric" pattern="[0-9A-Za-z-]*">

ย ย ย <label class="label" for="lab_results">ูุชุงุฆุฌ ุงููุญูุต (HBsAg / HCV / HIV)</label>
ย ย ย <textarea id="lab_results" name="lab_results" class="w-full border p-2 rounded" placeholder="HBsAg: ุณูุจู..."></textarea>

ย ย ย <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2 mt-6">ุงูุฅุฌุฑุงุกุงุช ุงูููุฑูุฉ</h2>
ย ย ย <div class="space-y-1">
        ย ย ย ย <label><input type="checkbox" name="washed" value="ูุนู"> ุชู ุบุณู ุงูููุทูุฉ ุจุงููุงุก ูุงูุตุงุจูู</label><br>
ย ย ย ย <label><input type="checkbox" name="reported" value="ูุนู"> ุชู ุงูุฅุจูุงุบ ููุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู</label><br>
ย ย ย ย <label><input type="checkbox" name="medical_eval" value="ูุนู"> ุชู ุชูููู ุงูุญุงูุฉ ูู ูุจู ุงูุทุจูุจ ุงูููุงูุจ</label><br>
ย ย ย ย <label><input type="checkbox" name="pep" value="ูุนู"> ุชู ุงูุจุฏุก ุจุงูุนูุงุฌ ุงูููุงุฆู (PEP)</label>
ย ย ย </div>

ย ย ย <label class="label mt-4 block" for="notes">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
ย ย ย <textarea id="notes" name="notes" class="w-full border p-2 rounded" rows="3" placeholder="ุฃู ุชูุงุตูู ุฅุถุงููุฉ..."></textarea>

ย ย ย <div class="flex items-center justify-center gap-3 mt-6">
ย ย ย ย <button id="submitBtn" type="submit" class="btn">๐ค ุฅุฑุณุงู ุงูุจูุงุบ</button>
ย ย ย ย <span id="statusMsg" class="text-sm text-gray-500"></span>
ย ย ย </div>
ย ย </form>
ย </section>

ย ย <div class="text-center mt-10">
ย ย <button id="openLogBtn" type="button" class="btn bg-[var(--gold)] text-black hover:bg-[#f3cf73]">
ย ย ย ๐ ุนุฑุถ ุณุฌู ุงูุฅุตุงุจุงุช
ย ย </button>
ย </div>

ย <script>
ย ย // ุนูุงุตุฑ DOM
ย ย const exposureType = document.getElementById('exposureType');
ย ย const needleSection = document.getElementById('needleSection');
ย ย const bloodSectionย = document.getElementById('bloodSection');
ย ย const submitBtn = document.getElementById('submitBtn');
ย ย const statusMsg = document.getElementById('statusMsg');
    const form = document.getElementById('exposureForm'); // ุชุนุฑูู ุงููููุฐุฌ

ย ย // ุชุจุฏูู ุงูุญููู ุงููุทููุจุฉ ุญุณุจ ููุน ุงูุชุนุฑุถ
ย ย function setRequired(el, req) { if (el) el.toggleAttribute('required', req); }
ย ย function handleExposureTypeChange() {
ย ย ย needleSection.classList.add('hidden');
ย ย ย bloodSection.classList.add('hidden');
ย ย ยย
ย ย ย ['instrument','contaminated','injury_site','contact_area','fluid_type','fluid_amount'].forEach(id => {
ย ย ย ย const el = document.getElementById(id);
ย ย ย ย setRequired(el, false);
ย ย ย });

ย ย ย if (exposureType.value === 'needle') {
ย ย ย ย needleSection.classList.remove('hidden');
ย ย ย ย setRequired(document.getElementById('instrument'), true);
ย ย ย ย setRequired(document.getElementById('injury_site'), true);
ย ย ย } else if (exposureType.value === 'blood' || exposureType.value === 'mucosal') {
ย ย ย ย bloodSection.classList.remove('hidden');
ย ย ย ย setRequired(document.getElementById('contact_area'), true);
ย ย ย ย setRequired(document.getElementById('fluid_type'), true);
ย ย ย }
ย ย }
ย ย exposureType.addEventListener('change', handleExposureTypeChange);

ย ย // *** ุงูููุฏ ุงููุตุญุญ ูุญู ูุดููุฉ CORS ***
ย ย form.addEventListener('submit', async (e) => {
ย ย ย e.preventDefault();
ย ย ย statusMsg.textContent = "";
ย ย ย submitBtn.disabled = true;
ย ย ย submitBtn.textContent = "ูุชู ุงูุฅุฑุณุงู ...";

      const scriptURL = "https://script.google.com/macros/s/AKfycbyWPna2RXgl_P8xYfnIxG634pS8fVoAtW6X8Ch8-fzM0ASZNz49OIORmYwxjbiVapHEyg/exec";

ย ย ย try {
        // 1. ุงูุชุนุฏูู ุงูุฃุณุงุณู: ุฅุฑุณุงู FormData ูุจุงุดุฑุฉ.
        // 2. ูุง ูุญุฏุฏ Content-Type ูุฏููุงู (ุงููุชุตูุญ ุณููุนู ุฐูู ุชููุงุฆูุงู).
        // 3. ูุง ูุญูู ุงูุจูุงูุงุช ุฅูู JSON.
ย ย ย ย const response = await fetch(scriptURL,
ย ย ย ย ย {
ย ย ย ย ย ย method: "POST",
            // 4. ูุงู ุฌุฏุงู: ุฅุถุงูุฉ redirect: 'follow' ูุถูุงู ุงูุชุนุงูู ุงูุตุญูุญ ูุน ุฅุนุงุฏุฉ ุงูุชูุฌูู ุงูุชู ุชููู ุจูุง Google Apps Script ูุชุฌูุจ ุฃุฎุทุงุก CORS.
            redirect: 'follow',
ย ย ย ย ย ย body: new FormData(form)
ย ย ย ย ย }
ย ย ย ย );

        // ูุฑุงุกุฉ ุงูุฑุฏ ูู ุงูุณูุฑุจุช (ุงูุฐู ูุฌุจ ุฃู ูููู JSON)
ย ย ย ย const result = await response.json();
ย ย ย ยย
ย ย ย ย if (response.ok && result.status === "success") {
ย ย ย ย ย statusMsg.textContent = "โ ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ. ุณุชุชุงุจุน ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู ูุนู.";
ย ย ย ย ย statusMsg.style.color = "green";
ย ย ย ย ย e.target.reset();
ย ย ย ย ย handleExposureTypeChange();
ย ย ย ย ยย
ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย statusMsg.textContent = "";
ย ย ย ย ย }, 5000);
ย ย ย ย } else {
ย ย ย ย ย throw new Error(result.message || "ุฎุทุฃ ุบูุฑ ูุนุฑูู ูู ุงูุฎุงุฏู");
ย ย ย ย }

ย ย ย } catch (error) {
ย ย ย ย console.error('ุฎุทุฃ:', error);
        let errorMessage = error.message;
        // ุงูุชุนุงูู ูุน ุฃุฎุทุงุก ุงูุดุจูุฉ (TypeError) ุฃู ุฃุฎุทุงุก ูุฑุงุกุฉ ุงูุฑุฏ (SyntaxError)
        if (error.name === 'TypeError' || error instanceof SyntaxError) {
             errorMessage = "ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู ุฃู ุงูุดุจูุฉ (ูุฏ ูููู ุจุณุจุจ ูุดููุฉ CORS ุฃู ูุดู ูู ูุนุงูุฌุฉ ุงูุฑุฏ). ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.";
        }
ย ย ย ย statusMsg.textContent = "โ ุญุฏุซ ุฎุทุฃ: " + errorMessage;
ย ย ย ย statusMsg.style.color = "red";
ย ย ย } finally {
ย ย ย ย submitBtn.disabled = false;
ย ย ย ย submitBtn.textContent = "๐ค ุฅุฑุณุงู ุงูุจูุงุบ";
ย ย ย }
ย ย });

ย ย // ุฒุฑ ูุชุญ ุงูุณุฌู ุงููุญูู
ย ย document.getElementById('openLogBtn').addEventListener('click', function () {
ย ย ย const pass = prompt("๐ ุงูุฑุฌุงุก ุฅุฏุฎุงู ูููุฉ ุงูุณุฑ ูููุตูู ุฅูู ุณุฌู ุงูุฅุตุงุจุงุช:");
ย ย ย if (pass === "BostonYYYY2025") {
ย ย ย ย window.open(
ย ย ย ย ย "https://docs.google.com/spreadsheets/d/11ASpiUe6GTW4siaoPGnjqG3xKMeUdCmxPsTSbPTu9xw/edit#gid=0",
ย ย ย ย ย "_blank"
ย ย ย ย );
ย ย ย } else if (pass !== null) {
ย ย ย ย alert("โ ูููุฉ ุงูุณุฑ ุบูุฑ ุตุญูุญุฉ.");
ย ย ย }
ย ย });

ย ย // ุถุจุท ุฃููู
ย ย handleExposureTypeChange();
ย </script>
</body>
</html>
