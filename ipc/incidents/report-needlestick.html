<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุงูุชุนุฑุถ ุงููููู โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</title>
  <!-- Tailwind (ููุงุณุจ ููุณุฎุฉ ุงูููุจุ ูููู ุงุณุชุจุฏุงูู ุจููู ููุฌููุน ููุฅูุชุงุฌ ูุงุญููุง) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --maroon: #7B1E24;
      --gold: #E9C46A;
      --sand: #FDF8F5;
    }
    body {
      font-family: 'Tajawal', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--sand);
      background-image: radial-gradient(circle at top left, #fff 20%, #fdf6f4 70%);
    }
    .header {
      background: linear-gradient(to right, var(--maroon), #9e2b2b);
      color: white;
      border-bottom: 6px solid var(--gold);
    }
    .card {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .label { color: var(--maroon); font-weight: 600; }
    .btn {
      background-color: var(--maroon);
      color: white;
      padding: 12px 28px;
      border-radius: 10px;
      font-weight: 700;
      transition: all 0.2s ease;
    }
    .btn:hover { background-color: var(--gold); color: #3b2f2f; }
    .hidden { display: none; }
  </style>
</head>
<body class="p-4">

  <!-- Header -->
  <header class="header py-6 text-center rounded-b-xl shadow">
    <h1 class="text-3xl font-bold">๐ฉบ ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุงูุชุนุฑุถ ุงููููู</h1>
    <p class="text-lg mt-2" style="color: var(--gold)">(ูุฎุฒู โ ุฏููู โ ุฑุฐุงุฐ ูุฎุงุทู)</p>
    <p class="text-sm text-gray-100 mt-1">ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</p>
  </header>

  <!-- Form -->
  <section class="max-w-4xl mx-auto mt-8 card p-8 space-y-6">
    <form id="exposureForm" class="space-y-4" autocomplete="off" novalidate>
      <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2">ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label class="label" for="fullname">ุงูุงุณู ุงููุงูู</label>
          <input id="fullname" name="fullname" class="w-full border p-2 rounded" required>
        </div>
        <div>
          <label class="label" for="department">ุงููุณู / ุงููุญุฏุฉ</label>
          <input id="department" name="department" class="w-full border p-2 rounded" required>
        </div>
        <div>
          <label class="label" for="position">ุงููุธููุฉ</label>
          <input id="position" name="position" class="w-full border p-2 rounded">
        </div>
        <div>
          <label class="label" for="date">ุชุงุฑูุฎ ุงูุญุงุฏุซ</label>
          <input id="date" type="date" name="date" class="w-full border p-2 rounded" required>
        </div>
        <div>
          <label class="label" for="time">ุงูููุช</label>
          <input id="time" type="time" name="time" class="w-full border p-2 rounded" required>
        </div>
      </div>

      <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2">ููุน ุงูุชุนุฑุถ</h2>
      <select id="exposureType" name="exposure_type" class="w-full border p-2 rounded" required>
        <option value="">ุงุฎุชุฑ ููุน ุงูุชุนุฑุถ</option>
        <option value="needle">ุชุนุฑุถ ูุฎุฒู (ุฅุจุฑุฉ ุฃู ุฃุฏุงุฉ ุญุงุฏุฉ)</option>
        <option value="blood">ุชุนุฑุถ ุฏููู / ุณูุงุฆู ุฌุณุฏูุฉ</option>
        <option value="mucosal">ุชูุงูุณ ุงูุฃุบุดูุฉ ุงููุฎุงุทูุฉ (ุงูุนููุ ุงูุฃููุ ุงููู)</option>
      </select>

      <!-- Needle Injury Section -->
      <div id="needleSection" class="hidden space-y-2 mt-2">
        <label class="label" for="instrument">ููุน ุงูุฃุฏุงุฉ</label>
        <select id="instrument" name="instrument" class="w-full border p-2 rounded">
          <option value="">ุงุฎุชุฑ</option>
          <option>ุฅุจุฑุฉ</option><option>ูุดุฑุท</option><option>ุฃุฏุงุฉ ุฃุฎุฑู</option>
        </select>

        <label class="label" for="contaminated">ูู ูุงูุช ุงูุฃุฏุงุฉ ูููุซุฉ ุจุฏู/ุณูุงุฆูุ</label>
        <select id="contaminated" name="contaminated" class="w-full border p-2 rounded">
          <option value="">ุงุฎุชุฑ</option>
          <option value="yes">ูุนู</option>
          <option value="no">ูุง</option>
        </select>

        <label class="label" for="injury_site">ููุถุน ุงูุฅุตุงุจุฉ</label>
        <input id="injury_site" name="injury_site" class="w-full border p-2 rounded" placeholder="ูุซุงู: ุฅุตุจุน ุงููุฏ ุงููููู">
      </div>

      <!-- Blood/Mucosal Section -->
      <div id="bloodSection" class="hidden space-y-2 mt-2">
        <label class="label" for="contact_area">ููุงู ุงูุชูุงูุณ</label>
        <input id="contact_area" name="contact_area" class="w-full border p-2 rounded" placeholder="ูุซู: ุฌุฑุญ ููุชูุญ / ุฌูุฏ ูุชุดูู">

        <label class="label" for="fluid_type">ููุน ุงูุณุงุฆู</label>
        <input id="fluid_type" name="fluid_type" class="w-full border p-2 rounded" placeholder="ุฏู / ุณูุงุฆู ุฌุณุฏูุฉ">

        <label class="label" for="fluid_amount">ูููุฉ ุงูุณุงุฆู ุงูุชูุฑูุจูุฉ</label>
        <input id="fluid_amount" name="fluid_amount" class="w-full border p-2 rounded" placeholder="ููููุฉ / ูุชูุณุทุฉ / ูุซูุฑุฉ">
      </div>

      <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2 mt-6">ุจูุงูุงุช ุงููุฑูุถ ุงููุตุฏุฑ</h2>
      <label class="label" for="patient_id">ุฑูู ุงูููู ุงูุทุจู (ุฅู ูุฌุฏ)</label>
      <input id="patient_id" name="patient_id" class="w-full border p-2 rounded" inputmode="numeric" pattern="[0-9A-Za-z-]*">

      <label class="label" for="lab_results">ูุชุงุฆุฌ ุงููุญูุต (HBsAg / HCV / HIV)</label>
      <textarea id="lab_results" name="lab_results" class="w-full border p-2 rounded" placeholder="HBsAg: ุณูุจู..."></textarea>

      <h2 class="text-xl font-bold text-[var(--maroon)] border-b-2 border-[var(--gold)] pb-2 mt-6">ุงูุฅุฌุฑุงุกุงุช ุงูููุฑูุฉ</h2>
      <div class="space-y-1">
        <label><input type="checkbox" name="washed" value="yes"> ุชู ุบุณู ุงูููุทูุฉ ุจุงููุงุก ูุงูุตุงุจูู</label><br>
        <label><input type="checkbox" name="reported" value="yes"> ุชู ุงูุฅุจูุงุบ ููุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู</label><br>
        <label><input type="checkbox" name="medical_eval" value="yes"> ุชู ุชูููู ุงูุญุงูุฉ ูู ูุจู ุงูุทุจูุจ ุงูููุงูุจ</label><br>
        <label><input type="checkbox" name="pep" value="yes"> ุชู ุงูุจุฏุก ุจุงูุนูุงุฌ ุงูููุงุฆู (PEP)</label>
      </div>

      <label class="label mt-4 block" for="notes">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
      <textarea id="notes" name="notes" class="w-full border p-2 rounded" rows="3" placeholder="ุฃู ุชูุงุตูู ุฅุถุงููุฉ..."></textarea>

      <div class="flex items-center justify-center gap-3 mt-6">
        <button id="submitBtn" type="submit" class="btn">๐ค ุฅุฑุณุงู ุงูุจูุงุบ</button>
        <span id="statusMsg" class="text-sm text-gray-500"></span>
      </div>
    </form>
  </section>

  <!-- ุฒุฑ ุนุฑุถ ุงูุณุฌู (ุฎุงุฑุฌ ุงูููุฑู ููููู ูุดุท) -->
  <div class="text-center mt-10">
    <button id="openLogBtn" type="button" class="btn bg-[var(--gold)] text-black hover:bg-[#f3cf73]">
      ๐ ุนุฑุถ ุณุฌู ุงูุฅุตุงุจุงุช
    </button>
  </div>
  <script>
  // ุนูุงุตุฑ DOM
  const exposureType = document.getElementById('exposureType');
  const needleSection = document.getElementById('needleSection');
  const bloodSection  = document.getElementById('bloodSection');
  const submitBtn = document.getElementById('submitBtn');
  const statusMsg = document.getElementById('statusMsg');

  // ุชุจุฏูู ุงูุญููู ุงููุทููุจุฉ ุญุณุจ ููุน ุงูุชุนุฑุถ
  function setRequired(el, req) { if (el) el.toggleAttribute('required', req); }
  function handleExposureTypeChange() {
    needleSection.classList.add('hidden');
    bloodSection.classList.add('hidden');
    
    ['instrument','contaminated','injury_site','contact_area','fluid_type','fluid_amount'].forEach(id => {
      const el = document.getElementById(id);
      setRequired(el, false);
    });

    if (exposureType.value === 'needle') {
      needleSection.classList.remove('hidden');
      setRequired(document.getElementById('instrument'), true);
      setRequired(document.getElementById('injury_site'), true);
    } else if (exposureType.value === 'blood' || exposureType.value === 'mucosal') {
      bloodSection.classList.remove('hidden');
      setRequired(document.getElementById('contact_area'), true);
      setRequired(document.getElementById('fluid_type'), true);
    }
  }
  exposureType.addEventListener('change', handleExposureTypeChange);

  // ุฅุฑุณุงู ุงููููุฐุฌ ุฅูู Google Sheets
  document.getElementById('exposureForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    statusMsg.textContent = "";
    submitBtn.disabled = true;
    submitBtn.textContent = "ูุชู ุงูุฅุฑุณุงู ...";

    try {
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());
      
      // ุชูุธูู ุงูุจูุงูุงุช
      Object.keys(data).forEach(key => {
        if (data[key] === '') delete data[key];
      });

      const response = await fetch(
        "https://script.google.com/macros/s/AKfycbwYr9Ox2jZc2MWsGCmTPxe_TKCQ8F9eyp-GXcOzC0BVsDc8iGkGNWXKSdLZYSwgPiV8/exec",
        {
          method: "POST",
          headers: { 
            "Content-Type": "application/json",
            "Accept": "application/json"
          },
          body: JSON.stringify(data)
        }
      );

      const result = await response.json();
      
      if (result.status === "success") {
        statusMsg.textContent = "โ ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ. ุณุชุชุงุจุน ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู ูุนู.";
        statusMsg.style.color = "green";
        e.target.reset();
        handleExposureTypeChange();
      } else {
        throw new Error(result.message || "ุฎุทุฃ ุบูุฑ ูุนุฑูู");
      }

    } catch (error) {
      console.error('ุฎุทุฃ:', error);
      statusMsg.textContent = "โ ุญุฏุซ ุฎุทุฃ: " + error.message;
      statusMsg.style.color = "red";
    } finally {
      submitBtn.disabled = false;
      submitBtn.textContent = "๐ค ุฅุฑุณุงู ุงูุจูุงุบ";
    }
  });

  // ุฒุฑ ูุชุญ ุงูุณุฌู ุงููุญูู
  document.getElementById('openLogBtn').addEventListener('click', function () {
    const pass = prompt("๐ ุงูุฑุฌุงุก ุฅุฏุฎุงู ูููุฉ ุงูุณุฑ ูููุตูู ุฅูู ุณุฌู ุงูุฅุตุงุจุงุช:");
    if (pass === "BostonYYYY2025") {
      window.open(
        "https://docs.google.com/spreadsheets/d/11ASpiUe6GTW4siaoPGnjqG3xKMeUdCmxPsTSbPTu9xw/edit#gid=0",
        "_blank"
      );
    } else if (pass !== null) {
      alert("โ ูููุฉ ุงูุณุฑ ุบูุฑ ุตุญูุญุฉ.");
    }
  });

  // ุถุจุท ุฃููู
  handleExposureTypeChange();
  </script>
</body>
</html>
