داخل كود Emergency.html نفسه:

ما فيه أي كود يشغّل صوت أصلًا
عندك متغيرات sirenInterval وcurrentCommand… لكن ما عندك:

ولا <audio>

ولا AudioContext

ولا دالة startSiren()/stopSiren()
وبالتالي حتى لو صار أمر نشط وتحوّلت الشاشة للطوارئ، لن يُسمع شيء.

وحتى لو أضفت audio.play()… المتصفح غالبًا سيمنع تشغيل الصوت تلقائيًا إلى أن يحصل “تفاعل” مرة واحدة (ضغط/لمس). هذا سلوك طبيعي في Chrome وبقية المتصفحات لمنع الأصوات المفاجئة. 
Chrome for Developers
+1

الحل الجاهز: أضف صفارة + زر “تفعيل الصوت” يظهر فقط إذا المتصفح منع التشغيل
1) أضف CSS (ضعه في <style> عندك في آخره)
/* بوابة تفعيل الصوت عند منع autoplay */
.sound-gate{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(4px);
  z-index: 9999;
}
.sound-gate.hidden{ display:none; }

.sound-card{
  width: min(520px, 92vw);
  background: rgba(0,0,0,0.55);
  border: 2px solid rgba(201,169,98,0.65);
  border-radius: 18px;
  padding: 22px 18px;
  text-align: center;
}
.sound-title{
  font-size: 1.6rem;
  font-weight: 900;
  margin-bottom: 8px;
}
.sound-sub{
  font-size: 1.05rem;
  line-height: 1.6;
  opacity: 0.9;
  margin-bottom: 14px;
}
.sound-btn{
  width: 100%;
  border: 0;
  border-radius: 12px;
  padding: 14px 18px;
  font-size: 1.15rem;
  font-weight: 900;
  cursor: pointer;
  background: #c9a962;
  color: #0f172a;
}

2) أضف HTML (ضعه قبل </body> مباشرة)

غيّر رابط الصوت إلى ملف عندك على موقعك (مثلاً: /assets/siren.mp3).

<!-- بوابة تفعيل الصوت (تظهر فقط إذا المتصفح منع التشغيل) -->
<div id="soundGate" class="sound-gate hidden">
  <div class="sound-card">
    <div class="sound-title">تفعيل صوت الإنذار</div>
    <div class="sound-sub">
      اضغط مرة واحدة للسماح بتشغيل صفارة الطوارئ على هذه الشاشة.
    </div>
    <button id="enableSoundBtn" class="sound-btn">تفعيل الصوت</button>
  </div>
</div>

<!-- ملف الصفارة -->
<audio id="sirenAudio" preload="auto" loop>
  <source src="https://www.m2020m.org/assets/siren.mp3" type="audio/mpeg">
</audio>

3) عدّل JavaScript (أضف هذا داخل <script> عندك بعد تعريف المتغيرات)

ضعه بعد:

let currentCommand = null;
let sirenInterval = null;
let timerInterval = null;
let commandStartTime = null;


وأضف:

const sirenAudio = document.getElementById('sirenAudio');
const soundGate = document.getElementById('soundGate');
const enableSoundBtn = document.getElementById('enableSoundBtn');

let audioUnlocked = false;

function showSoundGate(){ soundGate.classList.remove('hidden'); }
function hideSoundGate(){ soundGate.classList.add('hidden'); }

async function startSiren(){
  if (!sirenAudio) return;
  try{
    sirenAudio.volume = 1.0;
    await sirenAudio.play();   // قد تُرفض إذا لا يوجد تفاعل سابق
  } catch(e){
    // NotAllowedError غالبًا = autoplay blocked
    showSoundGate();
  }
}

function stopSiren(){
  if (!sirenAudio) return;
  try{
    sirenAudio.pause();
    sirenAudio.currentTime = 0;
  } catch(e){}
}

async function unlockSound(){
  try{
    // محاولة تشغيل - لازم تكون داخل click
    await sirenAudio.play();
    audioUnlocked = true;
    hideSoundGate();

    // إذا ما في طوارئ، أوقفه مباشرة
    if (!currentCommand){
      sirenAudio.pause();
      sirenAudio.currentTime = 0;
    }
  } catch(e){
    console.warn('unlockSound failed:', e);
  }
}

enableSoundBtn.addEventListener('click', unlockSound);

4) اربط الصفارة بالطوارئ (تعديل بسيط داخل دوالك)

داخل activateEmergency(command) في آخرها (قبل startTimer(); أو بعدها) أضف:

// أخفِ/أظهر نقطة التجمع بشكل صحيح
if (command.muster || command.musterPoint) {
  document.getElementById('musterSection').style.display = 'block';
  document.getElementById('musterPoint').textContent = command.muster || command.musterPoint;
} else {
  document.getElementById('musterSection').style.display = 'none';
  document.getElementById('musterPoint').textContent = '-';
}

// شغّل الصفارة
startSiren();


وداخل deactivateEmergency() أضف:

stopSiren();
document.getElementById('musterSection').style.display = 'none';
document.getElementById('musterPoint').textContent = '-';
hideSoundGate();
