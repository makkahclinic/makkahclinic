1) المخطط المعماري الشامل MRIS
الفكرة: 5 طبقات + مسار أدلة CBAHI
flowchart TB
  %% ===== Sources / Sensing =====
  subgraph L1["L1 - Sensing (Data Capture)"]
    A1["Staff Roster & Shifts\n(حضور/غياب/مهارة/تغطية)"]
    A2["Workload\n(زيارات/إجراءات/انتظار)"]
    A3["Consumption\n(مواد/أدوات/صرف/إتلاف)"]
    A4["Assets & Availability\n(أجهزة/تعطل/جاهزية)"]
    A5["Safety Signals\n(حوادث/شبه حوادث/عدوى/شكاوى)"]
  end

  %% ===== Integration =====
  subgraph L2["L2 - Integration (Normalization & IDs)"]
    B1["Master Data\n(الأقسام/الغرف/الأدوار/الأصناف)"]
    B2["ID Mapping\nStaffID/DeptID/ItemID/ShiftID"]
    B3["Validation Rules\n(كمال/تكرار/قيم شاذة)"]
  end

  %% ===== Intelligence =====
  subgraph L3["L3 - Intelligence (Metrics & Indices)"]
    C1["Coverage Index\n(Actual vs Required)"]
    C2["Load Index\n(ضغط الخدمة/اختناق)"]
    C3["Consumption Integrity\n(متوقع vs فعلي/هدر)"]
    C4["Fatigue & Safety Risk\n(إرهاق/خطر)"]
    C5["Anomaly Detection\n(شذوذ/ارتفاع مفاجئ)"]
  end

  %% ===== Decision Engine =====
  subgraph L4["L4 - Decision Engine (Recommendations)"]
    D1["What-if Simulator\n(نقل موظف/فتح شفت/تقليل مواعيد)"]
    D2["Playbooks\n(سياسات تشغيل قياسية)"]
    D3["Prioritization\n(Impact/Cost/Risk)"]
    D4["Alerting\n(تنبيهات فورية)"]
  end

  %% ===== Presentation =====
  subgraph L5["L5 - Command Center (UI)"]
    E1["Heatmap (Dept/Room)\nأخضر/أصفر/أحمر"]
    E2["Timeline Slider\nساعة/شفت/يوم/أسبوع"]
    E3["Drill-down\n(من قسم -> موظفين/مواد/أسباب)"]
    E4["Actions Panel\nتطبيق التوصية وتوثيقها"]
    E5["Survey Mode\nعرض أدلة سباهي بضغطة"]
  end

  %% ===== Evidence & Governance =====
  subgraph G["Governance & Evidence (CBAHI-ready)"]
    F1["Policies & SOPs\n(LD, HR, FMS, IC, Med Safety)"]
    F2["Committee Minutes\n(Quality/FMS/IC)"]
    F3["Procurement Decisions\n(RFQ/PO/Delivery)"]
    F4["Audit Trails\n(من عدّل؟ متى؟ لماذا؟)"]
    F5["Auto Evidence Pack\nPDF/Exports"]
  end

  A1-->B2
  A2-->B2
  A3-->B2
  A4-->B2
  A5-->B2

  B1-->B2
  B2-->B3
  B3-->C1
  B3-->C2
  B3-->C3
  B3-->C4
  B3-->C5

  C1-->D1
  C2-->D1
  C3-->D1
  C4-->D3
  C5-->D4

  D1-->E4
  D4-->E1
  D4-->E4
  D3-->E4
  E1-->E3
  E2-->E3
  E3-->E4

  E4-->F4
  E4-->F3
  E5-->F5
  F1-->E5
  F2-->E5
  F3-->E5
  F4-->E5

2) “العُقد” الأساسية التي تجعل النظام سابق زمنه
A) Master Data (هو اللي يمنع الفوضى)

لازم يكون عندك تعريفات ثابتة:

DeptID لكل قسم

RoomID لكل غرفة/وحدة (حتى لو Grid)

StaffID لكل موظف

ItemID لكل صنف/مادة

ShiftID لكل شفت

بدون هذا → أي Heatmap تتحول “ألوان” بلا معنى.

B) Required Staffing ليس رقمًا ثابتًا

نعمل Rules Engine:

Required = Base + (Workload × Weight) + (Complexity × Weight2)

لكل قسم وزن مختلف (أسنان ≠ أشعة ≠ مختبر)

C) Decision-to-Evidence (السلاح ضد أي مقيّم)

كل توصية تُسجَّل تلقائيًا مع:

السبب (المؤشر الذي تسبب)

القرار (Action)

من اعتمد

ارتباط مباشر بالسياسة/المحضر/الشراء

3) خريطة التنفيذ الواقعية (بدون مخاطرة على التشغيل)
المرحلة 0: تشغيل على Google Sheets + Apps Script (الأسرع والأأمن)

Data Capture Sheets

Indices حسابية

Heatmap Grid

Audit Trail (Logs)

المرحلة 1: Web Command Center (Next.js/Express مثل مشاريعك)

API يقرأ/يكتب

صلاحيات Role-based

Heatmap تفاعلية + Drill-down

المرحلة 2: Forecasting & Anomaly AI

توقع ذروة

كشف شذوذ

اقتراحات ذات أولوية

4) مخرجات “سباهي” من نفس النظام

تقرير أسبوعي “Resource Adequacy”

تقرير “High Risk Areas”

تقرير “Procurement Justification”

Evidence Pack تلقائي (PDF/Excel Export)