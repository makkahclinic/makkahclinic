1ï¸âƒ£ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø³Ø±ÙŠØ¹
âœ… Ø£Ø´ÙŠØ§Ø¡ ØµØ­ÙŠØ­Ø© 100%

âœ”ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ email

âœ”ï¸ Owner Ù…Ø£Ø®ÙˆØ° Ù…Ù† staff_roles.role

âœ”ï¸ RBAC Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ permissions{}

âœ”ï¸ Ø­Ù…Ø§ÙŠØ© Ù‚ÙˆÙŠØ© Ù„Ù€ staff_roles

âœ”ï¸ ÙØµÙ„ ÙˆØ§Ø¶Ø­ Ø¨ÙŠÙ† Owner / Admin / Staff

âœ”ï¸ Ù„Ø§ ÙŠÙˆØ¬Ø¯ allowedSystems

âœ”ï¸ Default deny implicit (Ø´ÙŠØ¡ Ù…Ù…ØªØ§Ø²)

ğŸ‘‰ Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ: Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ØµØ­ÙŠØ­ ØªÙ…Ø§Ù…Ù‹Ø§.

2ï¸âƒ£ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ù†Ø´Ø± (Ø¶Ø±ÙˆØ±ÙŠØ©)
ğŸ”´ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© (1): Admin Ø§Ù„Ø¢Ù† Ù„Ù‡ ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù…Ø«Ù„ Owner

ÙÙŠ Ø¯Ø§Ù„Ø© hasPermission:

function hasPermission(key) {
  return isOwner() || isAdmin() ||
    (isAuthenticated() &&
     exists(...) &&
     get(...).data.permissions[key] == true);
}

Ù…Ø§Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ù‡Ø°Ø§ØŸ

Ø£ÙŠ Admin ÙŠØ³ØªØ·ÙŠØ¹:

Ù‚Ø±Ø§Ø¡Ø©/ÙƒØªØ§Ø¨Ø© ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©

Ø­ØªÙ‰ Ù„Ùˆ permissions.insurance = false

Ù„ÙƒÙ† Ø£Ù†Øª Ù‚Ù„Øª Ø³Ø§Ø¨Ù‚Ù‹Ø§ Ø¨ÙˆØ¶ÙˆØ­:

Ø§Ù„Ù…Ø§Ù„Ùƒ ÙŠØªØ­ÙƒÙ… ÙÙŠ ÙƒÙ„ Ø´ÙŠØ¡
Ø§Ù„Ø£Ø¯Ù…Ù† Ù‚Ø¯ ÙŠÙØ¹Ø·Ù‰ ÙƒÙ„ Ø´ÙŠØ¡ Ø£Ùˆ ÙŠÙÙ‚ÙŠÙ‘ÙØ¯

ğŸ” Ø¥Ø°Ù†:

Owner = bypass ÙƒØ§Ù…Ù„

Admin = ÙŠØ®Ø¶Ø¹ Ù„Ù€ permissions (Ø¥Ù„Ø§ ØµÙØ­Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©)

ğŸ”´ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø© (2): write = create + update + delete

Ù‡Ù†Ø§:

allow read, write: if hasPermission('complaints');


write ØªØ´Ù…Ù„:

create

update

delete

âš ï¸ Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ:

Ø£ÙŠ Ø´Ø®Øµ Ù„Ø¯ÙŠÙ‡ permission ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„Ø­Ø°Ù

ØºØ§Ù„Ø¨Ù‹Ø§ ÙÙŠ Ø£Ù†Ø¸Ù…Ø© Ø·Ø¨ÙŠØ©:

Ø§Ù„Ø­Ø°Ù ÙŠÙƒÙˆÙ† Owner ÙÙ‚Ø· Ø£Ùˆ Ù…Ù‚ÙŠÙ‘Ø¯

3ï¸âƒ£ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…ÙÙˆØµÙ‰ Ø¨Ù‡Ø§ (Ø§Ù†Ø³Ø®Ù‡Ø§ ÙƒÙ…Ø§ Ù‡ÙŠ)
âœ… ØªØ¹Ø¯ÙŠÙ„ (A): ØªØµØ­ÙŠØ­ hasPermission
function hasPermission(key) {
  return isOwner() ||
    (isAuthenticated() &&
     exists(/databases/$(database)/documents/staff_roles/$(request.auth.uid)) &&
     get(/databases/$(database)/documents/staff_roles/$(request.auth.uid))
       .data.permissions[key] == true);
}


âŒ Ø£Ø²Ù„ isAdmin() Ù…Ù† Ù‡Ù†Ø§
âœ”ï¸ Admin ÙŠØ®Ø¶Ø¹ Ù„Ù…Ø§ ÙŠØ¹Ø·ÙŠÙ‡ Ù„Ù‡ Owner

âœ… ØªØ¹Ø¯ÙŠÙ„ (B): ÙØµÙ„ delete Ø¹Ù† read/write
Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Ù…Ø«Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ÙŠ)
match /complaints/{docId} {
  allow read, create, update: if hasPermission('complaints');
  allow delete: if isOwner();
}

Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
match /incidents/{docId} {
  allow read, create, update: if hasPermission('incidents');
  allow delete: if isOwner();
}

Ø¨Ù‚ÙŠØ© Ø§Ù„Ø£Ù†Ø¸Ù…Ø© (Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø·)
match /risks/{docId} {
  allow read, create, update: if hasPermission('risks');
  allow delete: if isOwner();
}

match /rounds/{docId} {
  allow read, create, update: if hasPermission('rounds');
  allow delete: if isOwner();
}

match /calibration/{docId} {
  allow read, create, update: if hasPermission('calibration');
  allow delete: if isOwner();
}

match /maintenance/{docId} {
  allow read, create, update: if hasPermission('maintenance');
  allow delete: if isOwner();
}

4ï¸âƒ£ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø§Ù„Ù…Ø®ØªØµØ±Ø© (Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù†Ø´Ø±)

Ø¥Ø°Ø§ Ø·Ø¨Ù‘Ù‚Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ÙŠÙ† Ø£Ø¹Ù„Ø§Ù‡ ÙÙ‚Ø·:

ğŸ‘‘ Owner:

ÙŠØ±Ù‰ ÙƒÙ„ Ø´ÙŠØ¡

ÙŠÙƒØªØ¨ ÙˆÙŠØ­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡

ğŸ›  Admin:

Ù„Ø§ ÙŠØ±Ù‰ Ø¥Ù„Ø§ Ù…Ø§ ÙÙŠ permissions{}

Ù„Ø§ ÙŠØ­Ø°Ù

ğŸ‘¤ Staff:

Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ø¯Ù‚Ø©

ğŸ” Ù„Ø§ ØªØ¬Ø§ÙˆØ²

ğŸ” Ù„Ø§ Ø«ØºØ±Ø§Øª ÙˆØ§Ø¶Ø­Ø©