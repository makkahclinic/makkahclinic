<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>البوابة الذكية - مجمع مكة الطبي</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #1e3a5f;
      --primary-dark: #152a45;
      --gold: #c9a962;
      --accent: #DC143C;
      --success: #10b981;
      --bg: linear-gradient(135deg, #1e3a5f 0%, #0d1f33 100%);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Tajawal', sans-serif;
      min-height: 100vh;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem 1rem;
    }
    .header {
      text-align: center;
      margin-bottom: 2rem;
      color: #fff;
    }
    .header img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: rgba(255,255,255,0.1);
      padding: 10px;
      margin-bottom: 1rem;
    }
    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }
    .header h1 span { color: var(--gold); }
    .header p {
      opacity: 0.8;
      font-size: 1.1rem;
    }
    .portal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1000px;
      width: 100%;
    }
    .portal-card {
      background: rgba(255,255,255,0.98);
      border-radius: 20px;
      padding: 2rem;
      text-decoration: none;
      color: var(--primary);
      transition: all 0.3s;
      border-top: 5px solid transparent;
      position: relative;
      overflow: hidden;
    }
    .portal-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }
    .portal-card .icon {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      margin-bottom: 1rem;
    }
    .portal-card h2 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }
    .portal-card p {
      font-size: 0.95rem;
      color: #555;
      line-height: 1.6;
    }
    .portal-card.patient { border-top-color: var(--gold); }
    .portal-card.patient .icon { background: rgba(201,169,98,0.15); color: var(--gold); }
    .portal-card.doctor { border-top-color: var(--primary); }
    .portal-card.doctor .icon { background: rgba(30,58,95,0.15); color: var(--primary); }
    .portal-card.pharmacist { border-top-color: var(--success); }
    .portal-card.pharmacist .icon { background: rgba(16,185,129,0.15); color: var(--success); }
    .portal-card.insurance { border-top-color: #3b82f6; }
    .portal-card.insurance .icon { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .portal-card.staff { border-top-color: #8b5cf6; }
    .portal-card.staff .icon { background: rgba(139,92,246,0.15); color: #8b5cf6; }
    .portal-card.owner { border-top-color: var(--accent); }
    .portal-card.owner .icon { background: rgba(220,20,60,0.15); color: var(--accent); }
    .user-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(30,58,95,0.95);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    .user-bar span { color: #fff; opacity: 0.8; }
    .user-bar .role-badge {
      background: var(--gold);
      color: var(--primary);
      padding: 4px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: bold;
    }
    .user-bar button {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      padding: 8px 20px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .user-bar button:hover {
      background: var(--gold);
      color: var(--primary);
      border-color: var(--gold);
    }
    .login-prompt {
      text-align: center;
      color: #fff;
      margin-top: 2rem;
    }
    .login-prompt a {
      color: var(--gold);
      text-decoration: none;
      font-weight: bold;
    }
    .hidden { display: none !important; }
    @media (max-width: 600px) {
      .portal-grid { grid-template-columns: 1fr; }
      .header h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>

  <div class="header">
    <img src="logo-transparent.png" alt="Logo" onerror="this.style.display='none'">
    <h1><span>البوابة</span> الذكية</h1>
    <p>مجمع مكة الطبي بالزاهر</p>
  </div>

  <div class="portal-grid">
    <a href="patient-login.html" class="portal-card patient" id="patient-card">
      <div class="icon"><i class="fas fa-user-injured"></i></div>
      <h2>بوابة المريض</h2>
      <p>حجز المواعيد، متابعة نتائج الفحوصات، التواصل مع طبيبك، والحصول على استشارات ذكية.</p>
    </a>

    <a href="doctor-login.html" class="portal-card doctor" id="doctor-card">
      <div class="icon"><i class="fas fa-user-md"></i></div>
      <h2>بوابة الطبيب</h2>
      <p>جدول المواعيد، ملفات المرضى، كتابة الوصفات، وفحص التأمين الذكي.</p>
    </a>

    <a href="pharmacy.html" class="portal-card pharmacist" id="pharmacist-card">
      <div class="icon"><i class="fas fa-pills"></i></div>
      <h2>بوابة الصيدلي</h2>
      <p>الوصفات الواردة، صرف الأدوية، فحص التفاعلات الدوائية، وإدارة المخزون.</p>
    </a>

    <a href="insurance-check.html" class="portal-card insurance" id="insurance-card">
      <div class="icon"><i class="fas fa-shield-alt"></i></div>
      <h2>بوابة التأمين</h2>
      <p>فحص أهلية التأمين، الموافقات المسبقة، المطالبات، وتقارير التأمين.</p>
    </a>

    <a href="admin-login.html" class="portal-card staff" id="staff-card">
      <div class="icon"><i class="fas fa-users-cog"></i></div>
      <h2>بوابة الموظفين</h2>
      <p>سباهي والجودة، الجولات، الشكاوى، الصيانة، ومركز الطوارئ.</p>
    </a>

    <a href="admin-login.html" class="portal-card owner hidden" id="owner-card">
      <div class="icon"><i class="fas fa-crown"></i></div>
      <h2>لوحة المالك</h2>
      <p>رؤية شاملة، التقارير المالية، إدارة الموظفين، وجميع الأنظمة.</p>
    </a>
  </div>

  <div class="login-prompt" id="login-prompt">
    <p>لديك حساب؟ <a href="login.html">تسجيل الدخول</a></p>
  </div>

  <div class="user-bar hidden" id="user-bar">
    <span id="user-email"></span>
    <span class="role-badge" id="user-role"></span>
    <button onclick="logout()">تسجيل الخروج</button>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyDhrkTwtV3Zwbj2k-PCUeXFqaFvtf_UT7s",
      authDomain: "insurance-check-6cec9.firebaseapp.com",
      projectId: "insurance-check-6cec9",
      storageBucket: "insurance-check-6cec9.appspot.com",
      messagingSenderId: "992769471393",
      appId: "1:992769471393:web:c8a9400210a0e7901011e0"
    };

    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
    const { getAuth, onAuthStateChanged, signOut } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
    const { getFirestore, doc, getDoc } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const roleNames = {
      'owner': 'المالك',
      'admin': 'مدير',
      'staff': 'موظف',
      'doctor': 'طبيب',
      'pharmacist': 'صيدلي',
      'insurance': 'تأمين',
      'patient': 'مريض',
      'viewer': 'زائر'
    };

    const ownerEmail = "husseinbabsail@gmail.com";

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        document.getElementById('login-prompt').classList.add('hidden');
        document.getElementById('user-bar').classList.remove('hidden');
        document.getElementById('user-email').textContent = user.email;

        let role = 'viewer';
        
        if (user.email === ownerEmail) {
          role = 'owner';
          document.getElementById('owner-card').classList.remove('hidden');
        } else {
          try {
            const userDoc = await getDoc(doc(db, 'users', user.uid));
            if (userDoc.exists()) {
              role = userDoc.data().role || 'viewer';
            }
          } catch (e) {
            console.log('Error loading role:', e);
          }
        }

        document.getElementById('user-role').textContent = roleNames[role] || role;

        if (role === 'owner' || role === 'admin') {
          document.getElementById('owner-card').classList.remove('hidden');
        }
      } else {
        document.getElementById('login-prompt').classList.remove('hidden');
        document.getElementById('user-bar').classList.add('hidden');
        document.getElementById('owner-card').classList.add('hidden');
      }
    });

    window.logout = async function() {
      await signOut(auth);
      window.location.reload();
    };
  </script>
</body>
</html>
