<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุจูุงุจุฉ FMS โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Tajawal', sans-serif; background-color: #f9f9f9; }
    .dark body { background-color: #1a1a1a; color: #eee; }
    .sidebar { width: 260px; background: linear-gradient(180deg, #7B1E24, #C55A44); color: white; }
    .nav-link { display: block; padding: 0.75rem 1rem; border-radius: 0.5rem; transition: all 0.2s; }
    .nav-link:hover { background-color: rgba(255,255,255,0.15); }
    .active-link { background-color: rgba(255,255,255,0.25); }
    @media print {
      header, .sidebar, footer, #darkModeBtn { display: none !important; }
      body::after {
        content: "";
        background: url('logo.png') center center no-repeat;
        background-size: 40%;
        opacity: 0.07;
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        z-index: -1;
      }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="flex justify-between items-center bg-white shadow-md px-6 py-3 sticky top-0 z-50">
    <div class="flex items-center gap-3">
      <img src="logo.png" alt="ุดุนุงุฑ ูุฌูุน ููุฉ ุงูุทุจู" class="h-12 w-auto">
      <div>
        <h1 class="text-xl font-bold text-gray-800">ุจูุงุจุฉ FMS โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</h1>
        <p class="text-sm text-gray-500">ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู โ ุงูุฅุตุฏุงุฑ 2025</p>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button id="darkModeBtn" class="px-3 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">๐ ูุถุน ูููู</button>
      <button onclick="window.print()" class="px-3 py-2 bg-[#7B1E24] text-white rounded-lg hover:bg-[#8f2b33]">๐จ๏ธ ุทุจุงุนุฉ / PDF</button>
    </div>
  </header>

  <!-- Main Layout -->
  <div class="flex flex-1">

    <!-- Sidebar -->
    <aside class="sidebar p-4 text-sm leading-relaxed">
      <div class="font-bold mb-3">๐ ููุญุฉ ุงูุชุญูู</div>
      <a href="#dashboard" class="nav-link active-link">ููุญุฉ ุงููุคุดุฑุงุช</a>
      <div class="font-bold mt-4 mb-2">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ</div>
      <a href="#leadership" class="nav-link">ุงููููู ุงูุฅุฏุงุฑู</a>
      <a href="#committees" class="nav-link">ุงููุฌุงู ุงูุฑุณููุฉ</a>
      <div class="font-bold mt-4 mb-2">๐๏ธ ุงูุฎุทุท ุงูุซูุงููุฉ</div>
      <a href="#plans" class="nav-link">ุงูุฎุทุท (FMS-P01 ุฅูู FMS-P08)</a>
      <div class="font-bold mt-4 mb-2">๐ ุงูููุงุฐุฌ ูุงูุณุฌูุงุช</div>
      <a href="#forms" class="nav-link">ุงูููุงุฐุฌ (F01โF11)</a>
      <div class="font-bold mt-4 mb-2">๐ ุนุฑุถ ุงูุจูุงูุงุช</div>
      <a href="#sheet" class="nav-link">ุฌูุจ ุจูุงูุงุช ุงูุดูุช</a>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 overflow-y-auto" id="mainContent">
      <section id="dashboard">
        <h2 class="text-2xl font-bold mb-4 text-[#7B1E24]">๐ ููุญุฉ ุงููุคุดุฑุงุช ุงูุฑุฆูุณูุฉ</h2>
        <p class="text-gray-600 mb-6">ูุธุฑุฉ ุนุงูุฉ ุนูู ุฃุฏุงุก ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู.</p>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#7B1E24]">
            <h3 class="text-lg font-semibold">ูุณุจุฉ ุงูุฌููุงุช ุงููููุฐุฉ</h3>
            <p class="text-3xl font-bold text-[#7B1E24]" id="roundsRate">--%</p>
            <p class="text-sm text-gray-500">ูู ุฅุฌูุงูู ุงูุฌููุงุช ุงููุฌุฏููุฉ</p>
          </div>
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#C55A44]">
            <h3 class="text-lg font-semibold">ูุณุจุฉ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ</h3>
            <p class="text-3xl font-bold text-[#C55A44]" id="maintenanceRate">--%</p>
            <p class="text-sm text-gray-500">ูู ุฅุฌูุงูู ุฃูุงูุฑ ุงูุตูุงูุฉ</p>
          </div>
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#7B1E24]">
            <h3 class="text-lg font-semibold">ูุณุจุฉ ุงูุชุฏุฑูุจ ุงููููุฐ</h3>
            <p class="text-3xl font-bold text-[#7B1E24]" id="trainingRate">--%</p>
            <p class="text-sm text-gray-500">ูู ุฅุฌูุงูู ุงูููุธููู ุงููุณุชูุฏููู</p>
          </div>
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#C55A44]">
            <h3 class="text-lg font-semibold">ุนุฏุฏ ุงูุงุฌุชูุงุนุงุช</h3>
            <p class="text-3xl font-bold text-[#C55A44]" id="meetingCount">--</p>
            <p class="text-sm text-gray-500">ูู ูุฌุงู RM / FMS / PSC / EOC</p>
          </div>
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#7B1E24]">
            <h3 class="text-lg font-semibold">ุงุฎุชุจุงุฑุงุช ุงูุฅูุฐุงุฑ / ุงูุฅุทูุงุก ุงููุงุฌุญุฉ</h3>
            <p class="text-3xl font-bold text-[#7B1E24]" id="fireTests">--%</p>
            <p class="text-sm text-gray-500">ูุณุจุฉ ูุฌุงุญ ุงูุงุฎุชุจุงุฑุงุช ูู ุงูุณุฌูุงุช</p>
          </div>
          <div class="bg-white shadow-lg rounded-xl p-5 border-t-4 border-[#C55A44]">
            <h3 class="text-lg font-semibold">๐ธ ุนุฏุฏ ุงูุตูุฑ ุงููุฑููุฉ ูุฐุง ุงูุดูุฑ</h3>
            <p class="text-3xl font-bold text-[#C55A44]" id="photoCount">--</p>
            <p class="text-sm text-gray-500">ุฅุฌูุงูู ุตูุฑ ุงูุฌููุงุช ูุงูุฅุตูุงุญุงุช</p>
          </div>
        </div>

        <!-- ุฒุฑ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู -->
        <div class="mt-8 p-4 bg-gray-50 rounded-lg">
          <button onclick="testConnection()" class="px-4 py-2 bg-blue-600 text-white rounded-lg">
            ๐ ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ
          </button>
          <div id="connectionStatus" class="mt-2 text-sm"></div>
        </div>
<section id="committees" class="mt-10">
  <h2 class="text-2xl font-bold mb-4 text-[#7B1E24]">๐ ุงููุฌุงู ุงูุฑุณููุฉ (ุญุณุจ ุณุจุงูู)</h2>
  <p class="text-gray-600 mb-6">ุชูุซู ุงููุฌุงู ุงูุฑุณููุฉ ุงูุฃุทุฑ ุงูููุงุฏูุฉ ูุงูุชุดุบูููุฉ ูุถูุงู ุงูุฌูุฏุฉ ูุงูุณูุงูุฉ ูู ุฌููุน ุฅุฏุงุฑุงุช ุงููุฌูุนุ ููู ูุนุงููุฑ CBAHI.</p>

  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">

    <!-- ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ -->
    <div class="bg-blue-50 shadow-md rounded-xl p-5 border-t-4 border-blue-600">
      <h3 class="text-lg font-bold text-blue-700 mb-2">โ๏ธ ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฏ. ุญุณูู ุจุงุจุตูู</p>
      <p><strong>ุงูููุณู/ุงูุณูุฑุชูุฑ:</strong> ุฃ. ุนุฏูุงู ุงูุฑูุงุนู</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ุจูุงูุ ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏ</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ุดูุฑููุง</p>
    </div>

    <!-- ูุฌูุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู -->
    <div class="bg-green-50 shadow-md rounded-xl p-5 border-t-4 border-green-600">
      <h3 class="text-lg font-bold text-green-700 mb-2">๐๏ธ ูุฌูุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฃ. ุตุงุจุฑ ุนุจุฏู</p>
      <p><strong>ููุณู ุงูุชุฏุฑูุจ:</strong> ุฃ. ุจูุงู ูุชู</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ุนุฏูุงู ุงูุฑูุงุนูุ ุฎุงูุฏ ุงูุฎุทูุจุ ููุฏูุจ ุงูุฃูู</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ุดูุฑููุง</p>
    </div>

    <!-- ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู -->
    <div class="bg-orange-50 shadow-md rounded-xl p-5 border-t-4 border-orange-500">
      <h3 class="text-lg font-bold text-orange-700 mb-2">โค๏ธโ๐ฉน ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู (PSC)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฏ. ูุนุงุฐ ุงูุจููุด</p>
      <p><strong>ูุงุฆุจ ุงูุฑุฆูุณ:</strong> ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ุฏ. ุญุณููุ ููุซูุ ุจูุงู</p>
      <p><strong>ุงูุณูุฑุชูุฑ:</strong> ุนุฏูุงู</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ุดูุฑููุง</p>
    </div>

    <!-- ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู -->
    <div class="bg-red-50 shadow-md rounded-xl p-5 border-t-4 border-red-600">
      <h3 class="text-lg font-bold text-red-700 mb-2">๐งซ ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู (IPC)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฏ. ูุฌุฏู ุนุณูุฑ</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ุฎุงูุฏุ ุงูุชูุฑูุถุ ุงููุฎุชุจุฑุ ุงูุชุนููู</p>
      <p><strong>ุงูุณูุฑุชูุฑ:</strong> ุนุฏูุงู</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ุดูุฑููุง</p>
    </div>

    <!-- ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ -->
    <div class="bg-purple-50 shadow-md rounded-xl p-5 border-t-4 border-purple-600">
      <h3 class="text-lg font-bold text-purple-700 mb-2">๐ ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฏ. ุญุณูู ุจุงุจุตูู</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ููุซููู ูู ุงูุฃูุณุงู</p>
      <p><strong>ุงูุณูุฑุชูุฑ:</strong> ุนุฏูุงู</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ุฑุจุน ุณููู</p>
    </div>

    <!-- ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ -->
    <div class="bg-yellow-50 shadow-md rounded-xl p-5 border-t-4 border-yellow-500">
      <h3 class="text-lg font-bold text-yellow-700 mb-2">๐จ ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</h3>
      <p><strong>ุงูุฑุฆูุณ:</strong> ุฃ. ุจูุงู ูุชู</p>
      <p><strong>ุงูุฃุนุถุงุก:</strong> ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏุ ุงูุฃููุ ุงูุชูุฑูุถ</p>
      <p><strong>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</strong> ูุตู ุณููู</p>
    </div>

  </div>
</section>

      </section>
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-[#7B1E24] text-white text-center py-3 text-sm">
    ยฉ 2025 ูุฌูุน ุนูุงุฏุงุช ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ โ ุฌููุน ุงูุญููู ูุญููุธุฉ
  </footer>

  <!-- JavaScript -->
  <script>
    // ุฒุฑ ุงููุถุน ุงููููู
    document.getElementById('darkModeBtn').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });

    // ุฑุงุจุท Google Script
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyECw5N9TioHpaDLUl7YdIuzOpHJBRxQmRLtnvqsgNTolb9guSdMcJlwnEEaTO9Dy_6JQ/exec";

    // ุชุญููู ุงูุจูุงูุงุช ูู ุงูุดูุช
    async function loadDashboard() {
      try {
        const timestamp = new Date().getTime(); // ูุชุฌูุจ ุงููุงุด
        const url = `${WEB_APP_URL}?action=getDashboard&t=${timestamp}`;
        console.log("Attempting to fetch from:", url);

        const res = await fetch(url, { method: "GET", redirect: "follow" });
        console.log("Response status:", res.status);

        const text = await res.text();
        console.log("Raw response:", text);

        let data;
        try { data = JSON.parse(text); }
        catch (err) { console.error("JSON parse error:", err); return; }

        updateDashboard(data);
      } catch (err) {
        console.error("โ ุฎุทุฃ ูู ุฌูุจ ุจูุงูุงุช FMS:", err);
      }
    }

    // ุชุญุฏูุซ ุงูููู ูู ุงูุตูุญุฉ
    function updateDashboard(data) {
      const format = (k, v) =>
        (k.includes("Rate") || k === "fireTests") ? v + "%" : v;

      ["roundsRate","maintenanceRate","trainingRate",
       "meetingCount","fireTests","photoCount"].forEach(k => {
        const el = document.getElementById(k);
        if (el) el.textContent = format(k, data[k] ?? "--");
      });
      console.log("โ ุชู ุชุญููู ุจูุงูุงุช FMS:", data);
    }

    // ุงุฎุชุจุงุฑ ุงูุงุชุตุงู ุจุงูุณูุฑูุฑ
    async function testConnection() {
      const statusEl = document.getElementById("connectionStatus");
      try {
        statusEl.innerHTML = '<span class="text-blue-500">๐ ุฌุงุฑู ุงุฎุชุจุงุฑ ุงูุงุชุตุงู...</span>';
        const res = await fetch(WEB_APP_URL);
        const data = await res.json();
        statusEl.innerHTML = `<span class="text-green-600">โ ${data.message}</span>`;
        console.log("Connection OK:", data);
      } catch (err) {
        statusEl.innerHTML = `<span class="text-red-600">โ ูุดู ุงูุงุชุตุงู: ${err.message}</span>`;
        console.error("Connection failed:", err);
      }
    }

    // ุชุดุบูู ุนูุฏ ุชุญููู ุงูุตูุญุฉ
    loadDashboard();
  </script>
</body>
</html>
