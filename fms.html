<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ - Ù…ÙƒØ© ÙƒÙ„ÙŠÙ†Ùƒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; padding: 20px; color: #333; }
        .container { max-width: 1300px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 25px rgba(0,0,0,0.08); }
        h1 { color: #1a5f7a; text-align: center; margin-bottom: 25px; font-size: 2.2rem; }
        .status { padding: 12px 20px; border-radius: 8px; margin-bottom: 25px; text-align: center; font-weight: 600; }
        .status.success { background: #27ae60; color: white; }
        .status.warning { background: #f39c12; color: white; }
        .status.error { background: #e74c3c; color: white; }
        .btn { background: #1a5f7a; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; margin: 8px; font-size: 1rem; font-weight: 600; transition: all 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        .btn-warning { background: #f39c12; }
        table { width: 100%; border-collapse: collapse; margin-top: 25px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #eaeaea; }
        th { background: #f8f9fa; color: #1a5f7a; font-weight: 700; font-size: 1.05rem; }
        tr:hover { background: #f8f9fa; }
        .badge { padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; font-weight: 700; }
        .badge-danger { background: #e74c3c; color: white; }
        .badge-warning { background: #f39c12; color: white; }
        .badge-success { background: #27ae60; color: white; }
        .badge-info { background: #3498db; color: white; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; color: #2c3e50; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: #1a5f7a; outline: none; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; border-left: 5px solid #1a5f7a; }
        .stat-card h3 { font-size: 2.5rem; margin-bottom: 10px; color: #1a5f7a; }
        .stat-card p { color: #7f8c8d; font-weight: 600; }
        .urgent { border-left-color: #e74c3c !important; }
        .completed { border-left-color: #27ae60 !important; }
        .compliance { border-left-color: #3498db !important; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { background: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 600px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .task-details { background: #f8f9fa; padding: 20px; border-radius: 8px; margin: 15px 0; }
        .task-details p { margin: 10px 0; padding: 8px 0; border-bottom: 1px solid #e0e0e0; }
        .loading { text-align: center; padding: 30px; color: #7f8c8d; }
        .loading::after { content: '...'; animation: dots 1.5s steps(4, end) infinite; }
        @keyframes dots { 0%, 20% { color: rgba(0,0,0,0); text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); } 40% { color: #7f8c8d; text-shadow: .25em 0 0 rgba(0,0,0,0), .5em 0 0 rgba(0,0,0,0); } 60% { text-shadow: .25em 0 0 #7f8c8d, .5em 0 0 rgba(0,0,0,0); } 80%, 100% { text-shadow: .25em 0 0 #7f8c8d, .5em 0 0 #7f8c8d; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ (FMS) - Ù…ÙƒØ© ÙƒÙ„ÙŠÙ†Ùƒ</h1>
        
        <div class="status success" id="connection-status">âœ… Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„</div>
        
        <div style="text-align: center; margin-bottom: 30px; padding: 20px; background: linear-gradient(135deg, #1a5f7a 0%, #159895 100%); border-radius: 12px;">
            <button class="btn" style="background: white; color: #1a5f7a;" onclick="loadData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-success" onclick="showAddTaskForm()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn" style="background: #3498db;" onclick="testConnection()">ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
            <button class="btn btn-warning" onclick="showHelp()">â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
        </div>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="pending-tasks">0</h3>
                <p>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</p>
            </div>
            <div class="stat-card urgent">
                <h3 id="high-priority">0</h3>
                <p>ğŸš¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</p>
            </div>
            <div class="stat-card completed">
                <h3 id="completed-tasks">0</h3>
                <p>âœ… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
            </div>
            <div class="stat-card compliance">
                <h3 id="compliance-rate">0%</h3>
                <p>ğŸ“Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© -->
        <div id="add-task-form" style="display: none; background: #f8f9fa; padding: 25px; border-radius: 12px; margin-bottom: 25px; border: 2px dashed #1a5f7a;">
            <h3 style="color: #1a5f7a; margin-bottom: 20px;">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <form onsubmit="addTask(event)">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="task-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©:</label>
                        <input type="text" id="task-title" required placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©">
                    </div>
                    <div class="form-group">
                        <label for="task-assignedTo">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</label>
                        <input type="text" id="task-assignedTo" value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="task-department">Ø§Ù„Ù‚Ø³Ù…:</label>
                        <select id="task-department">
                            <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                            <option value="Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ">Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</option>
                            <option value="Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©">Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                            <option value="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                            <option value="Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                            <option value="Ø§Ù„Ù…Ø§Ù„ÙŠØ©">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="task-priority">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</label>
                        <select id="task-priority">
                            <option value="high">ğŸš¨ Ø¹Ø§Ù„ÙŠ (Ø¹Ø§Ø¬Ù„)</option>
                            <option value="medium" selected>âš ï¸ Ù…ØªÙˆØ³Ø·</option>
                            <option value="low">âœ… Ù…Ù†Ø®ÙØ¶</option>
                        </select>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="form-group">
                        <label for="task-dueDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</label>
                        <input type="date" id="task-dueDate" required>
                    </div>
                    <div class="form-group">
                        <label for="task-category">Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                        <select id="task-category">
                            <option value="ØªØ±Ø§Ø®ÙŠØµ">ØªØ±Ø§Ø®ÙŠØµ</option>
                            <option value="Ø³Ù„Ø§Ù…Ø©">Ø³Ù„Ø§Ù…Ø©</option>
                            <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                            <option value="ØªØ¯Ø±ÙŠØ¨">ØªØ¯Ø±ÙŠØ¨</option>
                            <option value="Ù…Ø´ØªØ±ÙŠØ§Øª">Ù…Ø´ØªØ±ÙŠØ§Øª</option>
                            <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="task-location">Ø§Ù„Ù…ÙƒØ§Ù†:</label>
                    <input type="text" id="task-location" value="Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ" placeholder="Ø£Ø¯Ø®Ù„ Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©">
                </div>

                <div class="form-group">
                    <label for="task-description">ÙˆØµÙ Ø§Ù„Ù…Ù‡Ù…Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                    <textarea id="task-description" rows="3" placeholder="Ø£Ø¯Ø®Ù„ ÙˆØµÙØ§Ù‹ ØªÙØµÙŠÙ„ÙŠØ§Ù‹ Ù„Ù„Ù…Ù‡Ù…Ø©"></textarea>
                </div>

                <div style="text-align: center; margin-top: 25px;">
                    <button type="submit" class="btn btn-success">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                    <button type="button" class="btn btn-danger" onclick="hideAddTaskForm()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>

        <h2 style="color: #e74c3c; margin-bottom: 20px;">ğŸš¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© <span class="badge badge-danger" id="urgent-count">0 Ø¹Ø§Ø¬Ù„</span></h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="urgent-tasks-table">
                <tr><td colspan="6" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</td></tr>
            </tbody>
        </table>

        <h2 style="color: #1a5f7a; margin: 40px 0 20px 0;">ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="tasks-table">
                <tr><td colspan="7" class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</td></tr>
            </tbody>
        </table>

        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© -->
        <div id="help-modal" class="modal">
            <div class="modal-content">
                <h3 style="color: #1a5f7a; margin-bottom: 20px;">â“ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
                <div class="task-details">
                    <p><strong>ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> Ù„Ø¬Ù„Ø¨ Ø£Ø­Ø¯Ø« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª</p>
                    <p><strong>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©:</strong> Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù… ÙˆØ§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª</p>
                    <p><strong>ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„:</strong> Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…</p>
                    <p><strong>âœ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©:</strong> Ù„ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ù…ÙƒØªÙ…Ù„</p>
                    <p><strong>ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„:</strong> Ù„Ø¹Ø±Ø¶ ÙƒØ§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©</p>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="hideHelp()">Ø­Ø³Ù†Ø§Ù‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± 3
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzq08BtHcIXGCke7j5UTckgFzixfYaPxvVS2QePiBdO5UQWLzqx09n74jAlCbV5DBjXXg/exec';
        
        let tasks = [];

        // ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚ Ù„ÙŠÙˆÙ… Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('task-dueDate').value = nextWeek.toISOString().split('T')[0];
        });

        // ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
        async function loadData() {
            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª...', 'warning');
                
                const response = await fetch(`${WEB_APP_URL}?action=getFMSData`);
                const data = await response.json();
                
                if (data.success) {
                    tasks = data.tasks || [];
                    updateStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${tasks.length} Ù…Ù‡Ù…Ø© Ù…Ù† Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª - ${new Date().toLocaleTimeString()}`, 'success');
                    updateDisplay();
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            } catch (error) {
                tasks = getSampleTasks();
                updateStatus(`âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© - ${error.message}`, 'warning');
                updateDisplay();
            }
        }

        // ğŸ§ª Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function getSampleTasks() {
            return [
                {
                    id: '1',
                    title: 'ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ Ù„Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                    assignedTo: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    department: 'Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ',
                    priority: 'high',
                    dueDate: '2025-11-15',
                    status: 'pending',
                    category: 'ØªØ±Ø§Ø®ÙŠØµ',
                    location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                    createdAt: new Date().toISOString()
                },
                {
                    id: '2', 
                    title: 'Ø§Ù„ØµÙŠØ§Ù†Ø© Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø±',
                    assignedTo: 'Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',
                    department: 'Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©',
                    priority: 'high',
                    dueDate: '2025-11-10',
                    status: 'in_progress',
                    category: 'Ø³Ù„Ø§Ù…Ø©',
                    location: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…',
                    createdAt: new Date().toISOString()
                },
                {
                    id: '3',
                    title: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø®Ø·Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦',
                    assignedTo: 'ÙØ§Ø·Ù…Ø© Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡',
                    department: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
                    priority: 'medium',
                    dueDate: '2025-11-01',
                    status: 'completed',
                    category: 'Ø®Ø·Ø·',
                    location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                    createdAt: new Date().toISOString()
                }
            ];
        }

        // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        function updateDisplay() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const pendingTasks = tasks.filter(t => t.status === 'pending').length;
            const highPriority = tasks.filter(t => t.priority === 'high').length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const totalTasks = tasks.length;
            const complianceRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('pending-tasks').textContent = pendingTasks;
            document.getElementById('high-priority').textContent = highPriority;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('compliance-rate').textContent = complianceRate + '%';
            document.getElementById('urgent-count').textContent = highPriority + ' Ø¹Ø§Ø¬Ù„';

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            updateUrgentTasksTable();
            updateTasksTable();
        }

        // ğŸš¨ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©
        function updateUrgentTasksTable() {
            const urgentTasks = tasks.filter(task => task.priority === 'high' && task.status !== 'completed');
            const tbody = document.getElementById('urgent-tasks-table');
            
            if (urgentTasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #7f8c8d; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø© ğŸ‰</td></tr>';
            } else {
                tbody.innerHTML = urgentTasks.map(task => `
                    <tr>
                        <td><strong>${task.title}</strong></td>
                        <td>${task.assignedTo}</td>
                        <td>${task.department}</td>
                        <td><span class="badge badge-danger">ğŸš¨ Ø¹Ø§Ù„ÙŠ</span></td>
                        <td style="color: ${isOverdue(task.dueDate) ? '#e74c3c' : '#2c3e50'}; font-weight: ${isOverdue(task.dueDate) ? 'bold' : 'normal'}">
                            ${task.dueDate} ${isOverdue(task.dueDate) ? 'â°' : ''}
                        </td>
                        <td>
                            <button class="btn btn-success" onclick="completeTask('${task.id}')">âœ… Ø¥ÙƒÙ…Ø§Ù„</button>
                            <button class="btn" style="background: #3498db;" onclick="viewTaskDetails('${task.id}')">ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // ğŸ“‹ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…
        function updateTasksTable() {
            const tbody = document.getElementById('tasks-table');
            
            if (tasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #7f8c8d; padding: 30px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</td></tr>';
            } else {
                tbody.innerHTML = tasks.map(task => `
                    <tr>
                        <td><strong>${task.title}</strong>${task.category ? `<br><small style="color: #7f8c8d;">${task.category}</small>` : ''}</td>
                        <td>${task.assignedTo}</td>
                        <td>${task.department}</td>
                        <td><span class="badge ${task.priority === 'high' ? 'badge-danger' : task.priority === 'medium' ? 'badge-warning' : 'badge-success'}">
                            ${task.priority === 'high' ? 'ğŸš¨ Ø¹Ø§Ù„ÙŠ' : task.priority === 'medium' ? 'âš ï¸ Ù…ØªÙˆØ³Ø·' : 'âœ… Ù…Ù†Ø®ÙØ¶'}
                        </span></td>
                        <td style="color: ${isOverdue(task.dueDate) && task.status !== 'completed' ? '#e74c3c' : '#2c3e50'}; font-weight: ${isOverdue(task.dueDate) && task.status !== 'completed' ? 'bold' : 'normal'}">
                            ${task.dueDate} ${isOverdue(task.dueDate) && task.status !== 'completed' ? 'â°' : ''}
                        </td>
                        <td><span class="badge ${task.status === 'completed' ? 'badge-success' : 'badge-warning'}">
                            ${task.status === 'completed' ? 'âœ… Ù…ÙƒØªÙ…Ù„' : 'ğŸ•’ Ù…Ø¹Ù„Ù‚'}
                        </span></td>
                        <td>
                            <button class="btn btn-success" onclick="completeTask('${task.id}')" ${task.status === 'completed' ? 'disabled style="background: #95a5a6;"' : ''}>âœ… Ø¥ÙƒÙ…Ø§Ù„</button>
                            <button class="btn" style="background: #3498db;" onclick="viewTaskDetails('${task.id}')">ğŸ‘ï¸ ØªÙØ§ØµÙŠÙ„</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // â° Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ£Ø®Ø± Ø§Ù„Ù…Ù‡Ù…Ø©
        function isOverdue(dueDate) {
            if (!dueDate) return false;
            const today = new Date().toISOString().split('T')[0];
            return dueDate < today;
        }

        // â• Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
        function showAddTaskForm() {
            document.getElementById('add-task-form').style.display = 'block';
        }

        function hideAddTaskForm() {
            document.getElementById('add-task-form').style.display = 'none';
        }

        // ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª
        async function addTask(event) {
            event.preventDefault();
            
            const newTask = {
                title: document.getElementById('task-title').value,
                assignedTo: document.getElementById('task-assignedTo').value,
                department: document.getElementById('task-department').value,
                priority: document.getElementById('task-priority').value,
                dueDate: document.getElementById('task-dueDate').value,
                status: 'pending',
                category: document.getElementById('task-category').value,
                location: document.getElementById('task-location').value,
                description: document.getElementById('task-description').value
            };

            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª...', 'warning');
                
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addTask',
                        taskData: newTask
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    updateStatus(`âœ… ${result.message} - Ø±Ù‚Ù… Ø§Ù„Ù…Ù‡Ù…Ø©: ${result.taskId}`, 'success');
                    // Ø£Ø¶Ù Ø§Ù„Ù…Ù‡Ù…Ø© Ù„Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©
                    newTask.id = result.taskId;
                    newTask.createdAt = new Date().toISOString();
                    tasks.push(newTask);
                    updateDisplay();
                    hideAddTaskForm();
                    // Ø§Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('task-title').value = '';
                    document.getElementById('task-description').value = '';
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                updateStatus(`âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©: ${error.message}`, 'error');
            }
        }

        // âœ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        async function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©: ${task.title}ØŸ`)) {
                const originalStatus = task.status;
                task.status = 'completed';
                
                try {
                    const response = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            action: 'updateTask',
                            taskData: task
                        })
                    });

                    const result = await response.json();
                    if (result.success) {
                        updateStatus('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ø¬ÙˆØ¬Ù„ Ø´ÙŠØª', 'success');
                        updateDisplay();
                    } else {
                        throw new Error(result.error);
                    }
                } catch (error) {
                    task.status = originalStatus; // ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ø§Ù„ØªØºÙŠÙŠØ±
                    updateStatus(`âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‡Ù…Ø©: ${error.message}`, 'error');
                }
            }
        }

        // ğŸ‘ï¸ Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©
        function viewTaskDetails(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                const details = `
ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‡Ù…Ø©:

ğŸ·ï¸ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${task.title}
ğŸ‘¤ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${task.assignedTo}
ğŸ¢ Ø§Ù„Ù‚Ø³Ù…: ${task.department}
ğŸš¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: ${task.priority === 'high' ? 'Ø¹Ø§Ù„ÙŠ' : task.priority === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶'}
ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚: ${task.dueDate}
ğŸ“Š Ø§Ù„Ø­Ø§Ù„Ø©: ${task.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ø¹Ù„Ù‚'}
ğŸ“‚ Ø§Ù„ØªØµÙ†ÙŠÙ: ${task.category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
ğŸ“ Ø§Ù„Ù…ÙƒØ§Ù†: ${task.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}
â° ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡: ${new Date(task.createdAt).toLocaleString('ar-SA')}
${task.description ? `ğŸ“ Ø§Ù„ÙˆØµÙ: ${task.description}` : ''}
                `.trim();
                
                alert(details);
            }
        }

        // ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…...', 'warning');
                const response = await fetch(`${WEB_APP_URL}?action=test`);
                const data = await response.json();
                
                if (data.success) {
                    updateStatus(`âœ… ${data.message} - Ø§Ù„Ø§ØªØµØ§Ù„ ÙŠØ¹Ù…Ù„ perfectly`, 'success');
                } else {
                    throw new Error('ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„');
                }
            } catch (error) {
                updateStatus(`âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        // â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
        function showHelp() {
            document.getElementById('help-modal').style.display = 'block';
        }

        function hideHelp() {
            document.getElementById('help-modal').style.display = 'none';
        }

        // ğŸ“ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateStatus(message, type) {
            const statusElement = document.getElementById('connection-status');
            statusElement.textContent = message;
            statusElement.className = 'status ' + type;
        }
    </script>
</body>
</html>
