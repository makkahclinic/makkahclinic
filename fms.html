<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ - Ù…ÙƒØ© ÙƒÙ„ÙŠÙ†Ùƒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1 { color: #1a5f7a; text-align: center; margin-bottom: 20px; }
        .status { background: #27ae60; color: white; padding: 10px; border-radius: 5px; margin-bottom: 20px; text-align: center; }
        .btn { background: #1a5f7a; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn-success { background: #27ae60; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: right; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; color: #1a5f7a; }
        .badge { padding: 5px 10px; border-radius: 15px; font-size: 12px; }
        .badge-danger { background: #e74c3c; color: white; }
        .badge-warning { background: #f39c12; color: white; }
        .badge-success { background: #27ae60; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ (FMS)</h1>
        
        <div class="status" id="connection-status">âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„</div>
        
        <div style="text-align: center; margin-bottom: 20px;">
            <button class="btn" onclick="loadData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-success" onclick="addTask()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</button>
        </div>

        <div id="stats" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px;">
            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                <h3 id="pending-tasks">0</h3>
                <p>Ù…Ù‡Ù…Ø© Ù…Ø¹Ù„Ù‚Ø©</p>
            </div>
            <div style="background: #ffeaa7; padding: 15px; border-radius: 8px; text-align: center;">
                <h3 id="high-priority">0</h3>
                <p>Ù…Ù‡Ù…Ø© Ø¹Ø§Ø¬Ù„Ø©</p>
            </div>
            <div style="background: #d4edda; padding: 15px; border-radius: 8px; text-align: center;">
                <h3 id="completed-tasks">0</h3>
                <p>Ù…Ù‡Ù…Ø© Ù…ÙƒØªÙ…Ù„Ø©</p>
            </div>
            <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; text-align: center;">
                <h3 id="compliance-rate">0%</h3>
                <p>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
            </div>
        </div>

        <h2>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© <span class="badge badge-danger" id="urgent-count">0 Ø¹Ø§Ø¬Ù„</span></h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="urgent-tasks-table">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </tbody>
        </table>

        <h2 style="margin-top: 30px;">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="tasks-table">
                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            </tbody>
        </table>
    </div>

    <script>
        // Ø¶Ø¹ Ù‡Ù†Ø§ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ Ù†Ø³Ø®ØªÙ‡ Ù…Ù† Ø§Ù„Ø®Ø·ÙˆØ© 1
        const WEB_APP_URL = 'Ø§Ù„Ø±Ø§Ø¨Ø·_Ø§Ù„Ø¬Ø¯ÙŠØ¯_Ø¶Ø¹_Ù‡Ù†Ø§';
        
        let tasks = [];

        async function loadData() {
            try {
                document.getElementById('connection-status').textContent = 'ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
                
                const response = await fetch(`${WEB_APP_URL}?action=getFMSData`);
                const data = await response.json();
                
                if (data.success) {
                    tasks = data.tasks || getSampleTasks();
                    document.getElementById('connection-status').textContent = 'âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­';
                    updateDisplay();
                } else {
                    throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            } catch (error) {
                tasks = getSampleTasks();
                document.getElementById('connection-status').textContent = 'âš ï¸ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
                updateDisplay();
            }
        }

        function getSampleTasks() {
            return [
                {
                    id: '1',
                    title: 'ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ',
                    assignedTo: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    department: 'Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ',
                    priority: 'high',
                    dueDate: '2025-11-15',
                    status: 'pending'
                },
                {
                    id: '2',
                    title: 'ØµÙŠØ§Ù†Ø© Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ø¥Ù†Ø°Ø§Ø±',
                    assignedTo: 'Ø®Ø§Ù„Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…',
                    department: 'Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©',
                    priority: 'high',
                    dueDate: '2025-11-10',
                    status: 'in_progress'
                }
            ];
        }

        function updateDisplay() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const pendingTasks = tasks.filter(t => t.status === 'pending').length;
            const highPriority = tasks.filter(t => t.priority === 'high').length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const totalTasks = tasks.length;
            const complianceRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('pending-tasks').textContent = pendingTasks;
            document.getElementById('high-priority').textContent = highPriority;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('compliance-rate').textContent = complianceRate + '%';
            document.getElementById('urgent-count').textContent = highPriority + ' Ø¹Ø§Ø¬Ù„';

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            updateUrgentTasksTable();
            updateTasksTable();
        }

        function updateUrgentTasksTable() {
            const urgentTasks = tasks.filter(task => task.priority === 'high' && task.status !== 'completed');
            const tbody = document.getElementById('urgent-tasks-table');
            
            tbody.innerHTML = urgentTasks.map(task => `
                <tr>
                    <td>${task.title}</td>
                    <td>${task.assignedTo}</td>
                    <td>${task.department}</td>
                    <td><span class="badge badge-danger">Ø¹Ø§Ù„ÙŠ</span></td>
                    <td>${task.dueDate}</td>
                    <td><button class="btn btn-success" onclick="completeTask('${task.id}')">Ø¥ÙƒÙ…Ø§Ù„</button></td>
                </tr>
            `).join('');
        }

        function updateTasksTable() {
            const tbody = document.getElementById('tasks-table');
            
            tbody.innerHTML = tasks.map(task => `
                <tr>
                    <td>${task.title}</td>
                    <td>${task.assignedTo}</td>
                    <td>${task.department}</td>
                    <td><span class="badge ${task.priority === 'high' ? 'badge-danger' : 'badge-warning'}">
                        ${task.priority === 'high' ? 'Ø¹Ø§Ù„ÙŠ' : 'Ù…ØªÙˆØ³Ø·'}
                    </span></td>
                    <td>${task.dueDate}</td>
                    <td><span class="badge ${task.status === 'completed' ? 'badge-success' : 'badge-warning'}">
                        ${task.status === 'completed' ? 'Ù…ÙƒØªÙ…Ù„' : 'Ù…Ø¹Ù„Ù‚'}
                    </span></td>
                    <td><button class="btn btn-success" onclick="completeTask('${task.id}')">Ø¥ÙƒÙ…Ø§Ù„</button></td>
                </tr>
            `).join('');
        }

        function addTask() {
            const title = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:');
            if (title) {
                const newTask = {
                    id: 'task_' + Date.now(),
                    title: title,
                    assignedTo: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    department: 'Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©',
                    priority: 'medium',
                    dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                    status: 'pending'
                };
                tasks.push(newTask);
                updateDisplay();
                alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }

        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©: ${task.title}ØŸ`)) {
                task.status = 'completed';
                updateDisplay();
                alert('ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        loadData();
    </script>
</body>
</html>
