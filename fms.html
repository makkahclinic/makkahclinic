<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ - Ù…ÙƒØ© ÙƒÙ„ÙŠÙ†Ùƒ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        
        .header { 
            background: linear-gradient(135deg, #1a5f7a 0%, #159895 100%); 
            color: white; 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 25px; 
            text-align: center; 
        }
        
        .status { 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0; 
            text-align: center; 
            font-weight: 600; 
            font-size: 1.1rem; 
        }
        .success { background: #27ae60; color: white; }
        .warning { background: #f39c12; color: white; }
        .error { background: #e74c3c; color: white; }
        
        .btn { 
            background: #1a5f7a; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 5px; 
            font-size: 1rem; 
            font-weight: 600; 
            transition: all 0.3s; 
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-success { background: #27ae60; }
        .btn-danger { background: #e74c3c; }
        
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin: 25px 0; 
        }
        .stat-card { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 3px 15px rgba(0,0,0,0.1); 
            text-align: center; 
            border-top: 5px solid #1a5f7a; 
        }
        .stat-card.urgent { border-top-color: #e74c3c; }
        .stat-card.completed { border-top-color: #27ae60; }
        .stat-card h3 { font-size: 2.5rem; margin: 10px 0; color: #1a5f7a; }
        .stat-card.urgent h3 { color: #e74c3c; }
        .stat-card.completed h3 { color: #27ae60; }
        
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            background: white; 
            border-radius: 10px; 
            overflow: hidden; 
            box-shadow: 0 3px 15px rgba(0,0,0,0.1); 
        }
        th, td { 
            padding: 15px; 
            text-align: right; 
            border-bottom: 1px solid #eaeaea; 
        }
        th { 
            background: #f8f9fa; 
            color: #1a5f7a; 
            font-weight: 700; 
            font-size: 1.05rem; 
        }
        tr:hover { background: #f8f9fa; }
        
        .badge { 
            padding: 6px 12px; 
            border-radius: 20px; 
            font-size: 0.85rem; 
            font-weight: 700; 
        }
        .badge-danger { background: #e74c3c; color: white; }
        .badge-warning { background: #f39c12; color: white; }
        .badge-success { background: #27ae60; color: white; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 700; color: #2c3e50; }
        .form-group input, .form-group select { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #e0e0e0; 
            border-radius: 8px; 
            font-size: 1rem; 
        }
        .form-group input:focus, .form-group select:focus { 
            border-color: #1a5f7a; 
            outline: none; 
        }
        
        .task-form { 
            background: #f8f9fa; 
            padding: 25px; 
            border-radius: 12px; 
            margin: 20px 0; 
            border: 2px dashed #1a5f7a; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¥ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø±Ø§ÙÙ‚ (FMS)</h1>
            <p>Ù…ÙƒØ© ÙƒÙ„ÙŠÙ†Ùƒ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„Ù…Ø¶Ù…ÙˆÙ†</p>
        </div>
        
        <div class="status success" id="connection-status">
            âœ… Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ´ØºÙŠÙ„ - Ø§Ù†ØªØ¸Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...
        </div>
        
        <div style="text-align: center; margin: 25px 0;">
            <button class="btn" onclick="loadData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            <button class="btn btn-success" onclick="showTaskForm()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn" style="background: #3498db;" onclick="testConnection()">ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„</button>
        </div>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="pending-tasks">0</h3>
                <p>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</p>
            </div>
            <div class="stat-card urgent">
                <h3 id="high-priority">0</h3>
                <p>ğŸš¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©</p>
            </div>
            <div class="stat-card completed">
                <h3 id="completed-tasks">0</h3>
                <p>âœ… Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</p>
            </div>
            <div class="stat-card">
                <h3 id="compliance-rate">0%</h3>
                <p>ğŸ“Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„</p>
            </div>
        </div>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© -->
        <div class="task-form" id="task-form" style="display: none;">
            <h3 style="color: #1a5f7a; margin-bottom: 20px; text-align: center;">ğŸ“ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="taskTitle">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©:</label>
                    <input type="text" id="taskTitle" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©" required>
                </div>
                <div class="form-group">
                    <label for="taskAssignedTo">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„:</label>
                    <input type="text" id="taskAssignedTo" value="Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="taskDepartment">Ø§Ù„Ù‚Ø³Ù…:</label>
                    <select id="taskDepartment">
                        <option value="Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©">Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</option>
                        <option value="Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ">Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</option>
                        <option value="Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©">Ù‚Ø³Ù… Ø§Ù„ØµÙŠØ§Ù†Ø©</option>
                        <option value="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskPriority">Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</label>
                    <select id="taskPriority">
                        <option value="high">ğŸš¨ Ø¹Ø§Ù„ÙŠ (Ø¹Ø§Ø¬Ù„)</option>
                        <option value="medium" selected>âš ï¸ Ù…ØªÙˆØ³Ø·</option>
                        <option value="low">âœ… Ù…Ù†Ø®ÙØ¶</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="form-group">
                    <label for="taskDueDate">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ø³ØªØ­Ù‚Ø§Ù‚:</label>
                    <input type="date" id="taskDueDate" required>
                </div>
                <div class="form-group">
                    <label for="taskCategory">Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <select id="taskCategory">
                        <option value="ØªØ±Ø§Ø®ÙŠØµ">ØªØ±Ø§Ø®ÙŠØµ</option>
                        <option value="Ø³Ù„Ø§Ù…Ø©">Ø³Ù„Ø§Ù…Ø©</option>
                        <option value="ØµÙŠØ§Ù†Ø©">ØµÙŠØ§Ù†Ø©</option>
                        <option value="Ø£Ø®Ø±Ù‰">Ø£Ø®Ø±Ù‰</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="taskLocation">Ø§Ù„Ù…ÙƒØ§Ù†:</label>
                <input type="text" id="taskLocation" value="Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ">
            </div>

            <div style="text-align: center; margin-top: 25px;">
                <button class="btn btn-success" onclick="addTask()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                <button class="btn btn-danger" onclick="hideTaskForm()">âŒ Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>

        <h2 style="color: #e74c3c; margin: 30px 0 20px 0;">ğŸš¨ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© 
            <span class="badge badge-danger" id="urgent-count">0 Ø¹Ø§Ø¬Ù„</span>
        </h2>
        
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="urgent-tasks-table">
                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #7f8c8d;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©...</td></tr>
            </tbody>
        </table>

        <h2 style="color: #1a5f7a; margin: 40px 0 20px 0;">ğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
        
        <table>
            <thead>
                <tr>
                    <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
                    <th>Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</th>
                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                    <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                    <th>Ø§Ù„Ù…ÙˆØ¹Ø¯</th>
                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                </tr>
            </thead>
            <tbody id="tasks-table">
                <tr><td colspan="7" style="text-align: center; padding: 30px; color: #7f8c8d;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…...</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ - Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzag89wJfUeJC8wx6XsCKi2OIhZx7aC-qiOdye4GRcNIiP7WXJu7kvsgpToiY7WDP268Q/exec';
        
        let tasks = [];

        // ğŸš€ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            // ØªØ¹ÙŠÙŠÙ† ØªØ§Ø±ÙŠØ® Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø¨Ø¹Ø¯ Ø£Ø³Ø¨ÙˆØ¹)
            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            document.getElementById('taskDueDate').value = nextWeek.toISOString().split('T')[0];
            
            loadData();
        });

        // ğŸ“Š ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets
        async function loadData() {
            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Google Sheets...', 'warning');
                
                const response = await fetch(`${WEB_APP_URL}?action=getFMSData`);
                const data = await response.json();
                
                if (data.success) {
                    tasks = data.tasks || [];
                    updateStatus(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ ${tasks.length} Ù…Ù‡Ù…Ø© Ù…Ù† Google Sheets`, 'success');
                    updateDisplay();
                } else {
                    throw new Error(data.error || 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            } catch (error) {
                updateStatus(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„: ${error.message}`, 'error');
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                tasks = getSampleTasks();
                updateDisplay();
            }
        }

        // ğŸ§ª Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function getSampleTasks() {
            return [
                {
                    id: '1',
                    title: 'ØªØ¬Ø¯ÙŠØ¯ ØªØ±Ø®ÙŠØµ Ø§Ù„Ø¯ÙØ§Ø¹ Ø§Ù„Ù…Ø¯Ù†ÙŠ',
                    assignedTo: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    department: 'Ø´Ø¤ÙˆÙ† Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ',
                    priority: 'high',
                    dueDate: '2025-11-15',
                    status: 'pending',
                    category: 'ØªØ±Ø§Ø®ÙŠØµ',
                    location: 'Ø§Ù„Ù…Ø¨Ù†Ù‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ'
                }
            ];
        }

        // ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
        function updateDisplay() {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const pendingTasks = tasks.filter(t => t.status === 'pending').length;
            const highPriority = tasks.filter(t => t.priority === 'high').length;
            const completedTasks = tasks.filter(t => t.status === 'completed').length;
            const totalTasks = tasks.length;
            const complianceRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;

            document.getElementById('pending-tasks').textContent = pendingTasks;
            document.getElementById('high-priority').textContent = highPriority;
            document.getElementById('completed-tasks').textContent = completedTasks;
            document.getElementById('compliance-rate').textContent = complianceRate + '%';
            document.getElementById('urgent-count').textContent = highPriority + ' Ø¹Ø§Ø¬Ù„';

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
            updateUrgentTasksTable();
            updateTasksTable();
        }

        // ğŸš¨ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©
        function updateUrgentTasksTable() {
            const urgentTasks = tasks.filter(task => task.priority === 'high' && task.status !== 'completed');
            const tbody = document.getElementById('urgent-tasks-table');
            
            if (urgentTasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; color: #27ae60;">ğŸ‰ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø¹Ø§Ø¬Ù„Ø©</td></tr>';
            } else {
                tbody.innerHTML = urgentTasks.map(task => `
                    <tr>
                        <td><strong>${task.title}</strong></td>
                        <td>${task.assignedTo}</td>
                        <td>${task.department}</td>
                        <td><span class="badge badge-danger">ğŸš¨ Ø¹Ø§Ù„ÙŠ</span></td>
                        <td>${task.dueDate}</td>
                        <td>
                            <button class="btn btn-success" onclick="completeTask('${task.id}')">âœ… Ø¥ÙƒÙ…Ø§Ù„</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // ğŸ“‹ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù‡Ø§Ù…
        function updateTasksTable() {
            const tbody = document.getElementById('tasks-table');
            
            if (tasks.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 30px; color: #7f8c8d;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…</td></tr>';
            } else {
                tbody.innerHTML = tasks.map(task => `
                    <tr>
                        <td><strong>${task.title}</strong></td>
                        <td>${task.assignedTo}</td>
                        <td>${task.department}</td>
                        <td><span class="badge ${task.priority === 'high' ? 'badge-danger' : task.priority === 'medium' ? 'badge-warning' : 'badge-success'}">
                            ${task.priority === 'high' ? 'ğŸš¨ Ø¹Ø§Ù„ÙŠ' : task.priority === 'medium' ? 'âš ï¸ Ù…ØªÙˆØ³Ø·' : 'âœ… Ù…Ù†Ø®ÙØ¶'}
                        </span></td>
                        <td>${task.dueDate}</td>
                        <td><span class="badge ${task.status === 'completed' ? 'badge-success' : 'badge-warning'}">
                            ${task.status === 'completed' ? 'âœ… Ù…ÙƒØªÙ…Ù„' : 'ğŸ•’ Ù…Ø¹Ù„Ù‚'}
                        </span></td>
                        <td>
                            <button class="btn btn-success" onclick="completeTask('${task.id}')" ${task.status === 'completed' ? 'disabled style="background: #95a5a6;"' : ''}>
                                âœ… Ø¥ÙƒÙ…Ø§Ù„
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // â• Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©
        function showTaskForm() {
            document.getElementById('task-form').style.display = 'block';
        }

        function hideTaskForm() {
            document.getElementById('task-form').style.display = 'none';
        }

        // ğŸ’¾ Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© - Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø¶Ù…ÙˆÙ†Ø©
        async function addTask() {
            const newTask = {
                title: document.getElementById('taskTitle').value,
                assignedTo: document.getElementById('taskAssignedTo').value,
                department: document.getElementById('taskDepartment').value,
                priority: document.getElementById('taskPriority').value,
                dueDate: document.getElementById('taskDueDate').value,
                category: document.getElementById('taskCategory').value,
                location: document.getElementById('taskLocation').value
            };

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            if (!newTask.title || !newTask.dueDate) {
                alert('âš ï¸ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                return;
            }

            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ø¥Ù„Ù‰ Google Sheets...', 'warning');

                // Ø·Ø±ÙŠÙ‚Ø© GET Ù„ØªØ¬Ù†Ø¨ Ù…Ø´Ø§ÙƒÙ„ CORS
                const taskDataParam = encodeURIComponent(JSON.stringify(newTask));
                const response = await fetch(`${WEB_APP_URL}?action=addTask&taskData=${taskDataParam}`);
                
                const result = await response.json();
                
                if (result.success) {
                    updateStatus(`âœ… ${result.message} - ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                    
                    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
                    newTask.id = result.taskId;
                    newTask.status = 'pending';
                    newTask.createdAt = new Date().toISOString();
                    tasks.push(newTask);
                    
                    updateDisplay();
                    hideTaskForm();
                    
                    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
                    document.getElementById('taskTitle').value = '';
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù… Ù„Ù„ØªØ£ÙƒØ¯
                    setTimeout(() => loadData(), 2000);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                updateStatus(`âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©: ${error.message}`, 'error');
                console.error('Error details:', error);
            }
        }

        // âœ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
        async function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©: ${task.title}ØŸ`)) {
                task.status = 'completed';
                updateDisplay();
                updateStatus('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ù‡Ù…Ø©', 'success');
            }
        }

        // ğŸ”— Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„
        async function testConnection() {
            try {
                updateStatus('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„...', 'warning');
                const response = await fetch(`${WEB_APP_URL}?action=test`);
                const data = await response.json();
                
                if (data.success) {
                    updateStatus(`âœ… ${data.message} - Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ù…Ø«Ø§Ù„ÙŠ`, 'success');
                } else {
                    throw new Error('ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„');
                }
            } catch (error) {
                updateStatus(`âŒ ÙØ´Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
            }
        }

        // ğŸ“ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        function updateStatus(message, type) {
            const statusElement = document.getElementById('connection-status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }
    </script>
</body>
</html>
