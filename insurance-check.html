<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© - GPT</title>
  <style>
    body {
      font-family: sans-serif;
      direction: rtl;
      padding: 2rem;
      background-color: #f8f8f8;
      max-width: 900px;
      margin: 2rem auto;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
      border-radius: 8px;
    }
    h2, h3, h4 {
      text-align: right;
      color: #333;
      margin-top: 2rem;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
      color: #555;
    }
    textarea, input[type="text"], input[type="number"], select {
      width: 100%;
      padding: 0.8rem;
      margin-top: 0.3rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    textarea {
      min-height: 80px;
      resize: vertical;
    }
    button {
      width: 100%;
      padding: 1rem;
      margin-top: 2rem;
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
      background-color: #007bff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.75rem;
      text-align: right;
    }
    th {
      background-color: #f0f0f0;
    }
    #response {
      background: #fff;
      padding: 2rem;
      margin-top: 2rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    #error {
      color: red;
      margin-top: 1rem;
      text-align: center;
    }
  </style>
</head>
<body>

  <h2>Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© - Ø§Ù„ØªØ£Ù…ÙŠÙ† Ø§Ù„Ø·Ø¨ÙŠ</h2>

  <label for="diagnosis">ØªØ´Ø®ÙŠØµ Ø§Ù„Ù…Ø±Ø¶ (ICD-10):</label>
  <input type="text" id="diagnosis" placeholder="Ù…Ø«Ø§Ù„: Ø³ÙƒØ±ÙŠ Ù†ÙˆØ¹ 2" />

  <label for="symptoms">Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶:</label>
  <textarea id="symptoms" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø·Ø´ØŒ ØªØ¨ÙˆÙ„ Ù…ØªÙƒØ±Ø±ØŒ Ø§Ù†Ø®ÙØ§Ø¶ ÙˆØ²Ù†"></textarea>

  <label for="age">Ø¹Ù…Ø± Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
  <input type="number" id="age" min="0" max="120" placeholder="Ù…Ø«Ø§Ù„: 45" />

  <label for="gender">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø±ÙŠØ¶:</label>
  <select id="gender">
    <option value="">Ø§Ø®ØªØ±</option>
    <option value="male">Ø°ÙƒØ±</option>
    <option value="female">Ø£Ù†Ø«Ù‰</option>
    <option value="other">Ø¢Ø®Ø±</option>
  </select>

  <label for="beforeProcedure">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ´Ø®ÙŠØµ:</label>
  <textarea id="beforeProcedure" placeholder="Ù…Ø«Ø§Ù„: ØªØ­Ù„ÙŠÙ„ Ø³ÙƒØ±ØŒ ØªØ­Ù„ÙŠÙ„ Ø¨ÙˆÙ„ØŒ ÙØ­Øµ Ø³Ø±ÙŠØ±ÙŠ"></textarea>

  <label for="afterProcedure">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¨Ø¹Ø¯ Ø§Ù„ØªØ´Ø®ÙŠØµ:</label>
  <textarea id="afterProcedure" placeholder="Ù…Ø«Ø§Ù„: ÙˆØµÙ Ø§Ù†Ø³ÙˆÙ„ÙŠÙ†ØŒ Ù…ØªØ§Ø¨Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©ØŒ ØªØ­ÙˆÙŠÙ„ Ù„Ø£Ø®ØµØ§Ø¦ÙŠ ØªØºØ°ÙŠØ©"></textarea>

  <button onclick="analyzeCase()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</button>

  <div id="response"></div>
  <div id="error"></div>

  <script>
    async function analyzeCase() {
      const diagnosis = document.getElementById('diagnosis').value;
      const symptoms = document.getElementById('symptoms').value;
      const age = document.getElementById('age').value;
      const gender = document.getElementById('gender').value;
      const beforeProcedure = document.getElementById('beforeProcedure').value;
      const afterProcedure = document.getElementById('afterProcedure').value;

      const responseBox = document.getElementById('response');
      const errorBox = document.getElementById('error');

      responseBox.innerHTML = "Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©...";
      errorBox.innerText = "";

      if (!diagnosis || !symptoms || !age || !gender || !beforeProcedure || !afterProcedure) {
        errorBox.innerText = "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.";
        responseBox.innerHTML = "";
        return;
      }

      try {
        const result = await fetch("https://makkahclinic.vercel.app/api/gpt", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            diagnosis, symptoms, age, gender, beforeProcedure, afterProcedure
          })
        });

        if (!result.ok) {
          const errorText = await result.text();
          throw new Error(`Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…: ${result.status}\n${errorText}`);
        }

        const json = await result.json();
        let html = `<h3>ğŸ“Œ Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ø§Ù„Ø©</h3><p>${json.result}</p>`;

        if (json.justification && Array.isArray(json.justification)) {
          html += `<h4>ğŸ“‹ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª:</h4><table><thead><tr><th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th><th>Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</th><th>Ø§Ù„Ø³Ø¨Ø¨</th></tr></thead><tbody>`;
          json.justification.forEach(j => {
            html += `<tr><td>${j.step}</td><td>${j.justification}</td><td>${j.explanation}</td></tr>`;
          });
          html += `</tbody></table>`;
        }

        if (json.rejectionRisk) {
          html += `<h4>ğŸš« Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© Ø§Ù„Ø±ÙØ¶:</h4><p><strong>${json.rejectionRisk}</strong></p>`;
          if (json.rejectionReason) html += `<p><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${json.rejectionReason}</p>`;
          if (json.rejectedValue) html += `<p><strong>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© Ù„Ù„Ø±ÙØ¶:</strong> ${json.rejectedValue} Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ</p>`;
        }

        if (json.improvementSuggestions && Array.isArray(json.improvementSuggestions)) {
          html += `<h4>ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¯Ø®Ù„:</h4><table><thead><tr><th>Ø§Ù„Ø®Ø¯Ù…Ø©</th><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</th></tr></thead><tbody>`;
          json.improvementSuggestions.forEach(s => {
            html += `<tr><td>${s.title}</td><td>${s.description}</td><td>${s.estimatedValue}</td></tr>`;
          });
          html += `</tbody></table>`;
        }

        if (json.potentialRevenueIncrease) {
          html += `<h4>ğŸ’° Ø§Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø­ØªÙ…Ù„Ø© ÙÙŠ Ø§Ù„Ø¯Ø®Ù„:</h4><p>${json.potentialRevenueIncrease}</p>`;
        }

        responseBox.innerHTML = html;

      } catch (err) {
        errorBox.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©: " + err.message;
        responseBox.innerHTML = "";
        console.error(err);
      }
    }
  </script>
</body>
</html>
