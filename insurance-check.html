<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ© - ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ®</title>
  <style>
    /* ... your CSS unchanged ... */
    .lang-switcher{
      position:absolute; top:14px; left:14px; z-index:10;
      background:var(--primary); color:#fff; border:none; border-radius:10px;
      padding:.5rem 1rem; cursor:pointer; font-weight:700;
      box-shadow: 0 2px 10px rgba(11,99,194,.12);
    }
    .lang-switcher:hover{background:var(--primary-dark);}
    .btn-export{background:var(--accent);}
    .btn-export:hover{filter:brightness(1.08);}
  </style>
</head>
<body>
  <div class="container">
    <div class="top-ribbon"></div>
    <button class="lang-switcher" onclick="toggleLanguage()"></button>
    <div class="home-icon" title="ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©" onclick="goToHome()">üè†</div>

    <h2 id="title"></h2>
    <div class="subtext" id="subtitle"></div>

    <!-- Use data-i18n attributes to identify elements for translation -->
    <div class="section-title"><span class="dot"></span> <span data-i18n="patient-info-title"></span></div>
    <div class="grid">
      <div>
        <label for="gender" data-i18n="gender-label"></label>
        <select id="gender">
          <option value="" selected disabled data-i18n="gender-choose"></option>
          <option value="male" data-i18n="male"></option>
          <option value="female" data-i18n="female"></option>
        </select>
        <div class="hint" data-i18n="pregnancy-hint"></div>
      </div>
      <div>
        <label for="age" data-i18n="age-label"></label>
        <input id="age" type="number" placeholder="" data-i18n-placeholder="age-ex"></input>
      </div>
      <div id="pregnancy-status-wrap" class="hidden">
        <label for="pregnancy-status" data-i18n="pregnancy-label"></label>
        <select id="pregnancy-status">
          <option value="" selected disabled data-i18n="choose"></option>
          <option value="yes" data-i18n="yes"></option>
          <option value="no" data-i18n="no"></option>
        </select>
      </div>
      <div id="pregnancy-month-wrap" class="hidden">
        <label for="pregnancy-month" data-i18n="pregnancy-month-label"></label>
        <input id="pregnancy-month" type="number" min="1" max="9" placeholder="" data-i18n-placeholder="pregnancy-month-ex"></input>
      </div>
      <div>
        <label for="height" data-i18n="height-label"></label>
        <input id="height" type="number" placeholder="" data-i18n-placeholder="height-ex"></input>
      </div>
      <div>
        <label for="weight" data-i18n="weight-label"></label>
        <input id="weight" type="number" placeholder="" data-i18n-placeholder="weight-ex"></input>
      </div>
      <div>
        <label for="temperature" data-i18n="temp-label"></label>
        <input id="temperature" type="text" placeholder="" data-i18n-placeholder="temp-ex"></input>
      </div>
      <div>
        <label for="blood-pressure" data-i18n="bp-label"></label>
        <input id="blood-pressure" type="text" placeholder="" data-i18n-placeholder="bp-ex"></input>
      </div>
    </div>
    <!-- ... (rest of your form, add data-i18n attributes as above) ... -->

    <!-- Export PDF Button (shown only if report is available) -->
    <div class="actions">
      <button id="analyzeBtn" class="btn btn-primary btn-compact" onclick="analyzeCase()"></button>
      <button class="btn btn-export btn-compact" style="display:none" id="exportPdfBtn" onclick="exportPdf()"></button>
      <button class="btn btn-danger btn-compact" onclick="logout()" data-i18n="logout"></button>
    </div>
    <div class="muted-mini" data-i18n="disclaimer"></div>

    <div id="notification-area" class="notification info"></div>
    <div id="response-container"></div>
  </div>
  <script src="https://unpkg.com/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script>
    // 1. Language Translations
    const translations = {
      ar: {
        "switch-to": "English",
        "patient-info-title": "Ÿ°) ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ±Ÿäÿ∂",
        "gender-label": "ÿßŸÑÿ¨ŸÜÿ≥",
        "gender-choose": "ÿßÿÆÿ™ÿ± ÿßŸÑÿ¨ŸÜÿ≥",
        "male": "ÿ∞ŸÉÿ±", "female": "ÿ£ŸÜÿ´Ÿâ",
        "pregnancy-hint": "ŸÑŸà ŸÉÿßŸÜÿ™ ÿßŸÑŸÖÿ±Ÿäÿ∂ÿ© ÿ£ŸÜÿ´Ÿâÿå ÿ≥ÿ™ÿ∏Ÿáÿ± ÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑÿ≠ŸÖŸÑ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß.",
        "age-label": "ÿßŸÑÿπŸÖÿ±", "age-ex": "ŸÖÿ´ÿßŸÑ: 63",
        "pregnancy-label": "ŸáŸÑ ÿßŸÑŸÖÿ±Ÿäÿ∂ÿ© ÿ≠ÿßŸÖŸÑÿü",
        "choose": "ÿßÿÆÿ™ÿ±",
        "yes": "ŸÜÿπŸÖ", "no": "ŸÑÿß",
        "pregnancy-month-label": "ÿ¥Ÿáÿ± ÿßŸÑÿ≠ŸÖŸÑ", "pregnancy-month-ex": "ŸÖÿ´ÿßŸÑ: 5",
        "height-label": "ÿßŸÑÿ∑ŸàŸÑ (ÿ≥ŸÖ)", "height-ex": "ŸÖÿ´ÿßŸÑ: 175",
        "weight-label": "ÿßŸÑŸàÿ≤ŸÜ (ŸÉÿ¨ŸÖ)", "weight-ex": "ŸÖÿ´ÿßŸÑ: 80",
        "temp-label": "ÿØÿ±ÿ¨ÿ© ÿßŸÑÿ≠ÿ±ÿßÿ±ÿ© (¬∞ŸÖ)", "temp-ex": "ŸÖÿ´ÿßŸÑ: 37.6",
        "bp-label": "ÿ∂ÿ∫ÿ∑ ÿßŸÑÿØŸÖ", "bp-ex": "ŸÖÿ´ÿßŸÑ: 120/80",
        // ... add all your fields similarly ...
        "analyze-btn": "ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©",
        "export-pdf": "ÿ™ÿµÿØŸäÿ± PDF",
        "logout": "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨",
        "disclaimer": "ÿ®ÿßŸÑÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ \"ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≠ÿßŸÑÿ©\" ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™ ŸÑÿ™ŸàŸÑŸäÿØ ÿ™ŸÇÿ±Ÿäÿ± HTML ÿ¥ÿßŸÖŸÑ ŸÑŸÑÿπŸäÿßÿØÿ© ŸàÿßŸÑÿ™ÿ£ŸÖŸäŸÜ.",
        "title": "ÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑ÿ®Ÿäÿ© Ÿàÿ∑ŸÑÿ®ÿßÿ™ ÿßŸÑÿ™ÿ£ŸÖŸäŸÜ",
        "subtitle": "Ÿàÿßÿ¨Ÿáÿ© ÿ•ÿØÿÆÿßŸÑ ÿ≥ÿ±Ÿäÿ±Ÿäÿ© ÿ≥ŸáŸÑÿ© ‚Äî ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿ§ÿ™ŸÖÿ™ Ÿàÿ±ÿ®ÿ∑ ŸÖÿπ ÿßÿ≠ÿ™Ÿäÿßÿ¨ÿßÿ™ ÿßŸÑÿ™ÿ£ŸÖŸäŸÜ"
      },
      en: {
        "switch-to": "ÿßŸÑÿπÿ±ÿ®Ÿäÿ©",
        "patient-info-title": "1) Patient Information",
        "gender-label": "Gender",
        "gender-choose": "Select Gender",
        "male": "Male", "female": "Female",
        "pregnancy-hint": "If the patient is female, pregnancy questions will appear.",
        "age-label": "Age", "age-ex": "e.g: 63",
        "pregnancy-label": "Is the patient pregnant?",
        "choose": "Select",
        "yes": "Yes", "no": "No",
        "pregnancy-month-label": "Pregnancy Month", "pregnancy-month-ex": "e.g: 5",
        "height-label": "Height (cm)", "height-ex": "e.g: 175",
        "weight-label": "Weight (kg)", "weight-ex": "e.g: 80",
        "temp-label": "Temperature (¬∞C)", "temp-ex": "e.g: 37.6",
        "bp-label": "Blood Pressure", "bp-ex": "e.g: 120/80",
        // ... all other fields ...
        "analyze-btn": "Analyze Case",
        "export-pdf": "Export PDF",
        "logout": "Logout",
        "disclaimer": "By clicking 'Analyze Case' your input will be sent to generate a full HTML report for clinic and insurance.",
        "title": "Medical Case Evaluation & Insurance Requests",
        "subtitle": "Easy clinical input interface ‚Äî Automated analysis and insurance integration"
      }
    };
    let currentLang = 'ar';

    function setLanguage(lang){
      currentLang = lang;
      // Set direction and lang attribute
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      // Translate all elements with data-i18n
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = translations[lang][key] || key;
      });
      document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
        const key = el.getAttribute('data-i18n-placeholder');
        el.placeholder = translations[lang][key] || key;
      });
      // Translate static texts
      document.getElementById('title').textContent = translations[lang]['title'];
      document.getElementById('subtitle').textContent = translations[lang]['subtitle'];
      document.querySelector('.lang-switcher').textContent = translations[lang === 'ar' ? 'en' : 'ar']['switch-to'];
      document.getElementById('analyzeBtn').textContent = translations[lang]['analyze-btn'];
      document.getElementById('exportPdfBtn').textContent = translations[lang]['export-pdf'];
    }
    function toggleLanguage(){
      setLanguage(currentLang === 'ar' ? 'en' : 'ar');
    }
    // Initialize language on load
    document.addEventListener('DOMContentLoaded', ()=> setLanguage(currentLang));

    // 2. When analyzing, include language in payload
    async function analyzeCase(){
      // ... existing code ...
      caseData.language = currentLang; // Add this!
      // ... existing code ...
      if (data?.htmlReport){
        clearNote();
        responseContainer.innerHTML = data.htmlReport;
        responseContainer.style.display = 'block';
        document.getElementById('exportPdfBtn').style.display = 'inline-flex';
        responseContainer.scrollIntoView({ behavior:'smooth', block:'start' });
      } else {
        // ...
      }
    }

    // 3. Export as PDF
    function exportPdf(){
      const el = document.getElementById('response-container');
      if (!el || !el.innerHTML.trim()) return;
      html2pdf().from(el).set({
        margin: [0.5,0.5,0.5,0.5],
        filename: 'medical_report.pdf',
        html2canvas: { scale: 2, useCORS:true },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      }).save();
    }
    window.exportPdf = exportPdf;

    // ... rest of your logic unchanged ...
  </script>
</body>
</html>
