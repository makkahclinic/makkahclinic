<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="app-title">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  
  <!-- âœ… Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© Ù„Ù„ØªØµØ¯ÙŠØ± -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    :root{
      --sea-50:#eef7ff; --sea-100:#d9efff; --sea-200:#b6dfff; --sea-300:#87c7ff; --sea-400:#4aa6ff; --sea-500:#1e90ff; --sea-600:#1677d3; --sea-700:#105ca5; --sea-800:#0b4479; --sea-900:#082f55;
      --ok:#2e7d32; --warn:#f9a825; --bad:#e53935; --muted:#6b7280; --card:#ffffff; --ring:#d1e8ff;
    }
    *{box-sizing:border-box}
    body{font-family:"Tajawal",system-ui; background:linear-gradient(180deg,var(--sea-50),#fff); color:#0f172a; margin:0}
    html[dir="ltr"] body{font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,'Open Sans','Helvetica Neue',sans-serif}
    .container{max-width:1050px; margin:32px auto; padding:24px; background:var(--card); border:1px solid #e5e7eb; border-radius:18px; box-shadow:0 10px 35px rgba(3,102,214,.07)}
    .title{display:flex; align-items:center; justify-content:center; gap:10px; color:var(--sea-800)}
    h1{font-size:28px; margin:8px 0 2px}
    .subtitle{color:var(--muted); font-size:14px; text-align:center; margin-bottom:14px}
    .topbar{display:flex; gap:10px; align-items:center; justify-content:flex-start; margin-bottom:12px}
    .chip{border:1px solid #e5e7eb; padding:8px 10px; border-radius:12px; font-size:14px; background:#fff; cursor:pointer}
    .home{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; background:var(--sea-500); color:#fff; border-radius:12px; text-decoration:none; border:1px solid var(--sea-600)}
    .home svg{width:18px; height:18px; fill:#fff}

    .evidence-banner{background:#eef6ff; border:1px solid #bfdbfe; color:#0b4479; padding:10px 12px; border-radius:12px; margin-bottom:12px; font-size:13px; display:flex; align-items:center; gap:8px}
    .evidence-banner svg{width:18px; height:18px; flex:0 0 auto}

    .section{margin-top:18px}
    .section h2{font-size:18px; color:var(--sea-700); display:flex; align-items:center; gap:8px; margin:0 0 10px}
    .dot{width:8px; height:8px; background:var(--sea-500); border-radius:50%}
    .card{border:1px dashed #dbeafe; background:#f8fbff; border-radius:14px; padding:14px}

    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:12px}
    .col-6{grid-column:span 6}
    .col-4{grid-column:span 4}
    .col-3{grid-column:span 3}
    .col-8{grid-column:span 8}
    .col-12{grid-column:span 12}

    label{display:block; font-size:14px; color:#0f172a; margin-bottom:6px}
    input, select, textarea{width:100%; padding:12px; border:1px solid #e5e7eb; border-radius:12px; background:#fff; outline:none}
    input:focus, select:focus, textarea:focus{border-color:var(--sea-400); box-shadow:0 0 0 4px var(--ring)}
    textarea{min-height:90px; resize:vertical}

    .uploader{border:2px dashed #cfe6ff; border-radius:16px; padding:26px; text-align:center; color:#64748b; background:#f5faff; cursor:pointer}
    .uploader.drag{background:#eef6ff}
    .uploader input{display:none}
    .cards{display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; margin-top:12px}
    .fileCard{position:relative; background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; box-shadow:0 8px 22px rgba(2,6,23,.05)}
    .thumb{width:100%; height:150px; object-fit:cover; display:block; background:#f1f5f9}
    .meta{padding:10px 12px; font-size:13px; color:#334155}
    .remove{position:absolute; top:10px; right:10px; width:30px; height:30px; border-radius:50%; background:var(--bad); color:#fff; border:none; cursor:pointer; font-weight:700}

    .btn{appearance:none; border:none; cursor:pointer; padding:14px 18px; border-radius:14px; background:var(--sea-600); color:#fff; font-weight:700}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn-secondary{background:#0b4479}
    .btn-outline{background:#fff; color:var(--sea-700); border:1px solid #cbd5e1}

    #reportWrap{margin-top:24px}
    .report-toolbar{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px}
    .muted{color:var(--muted)}

    /* ====== ğŸ”§ CSS Ù…Ø­Ø³Ù† Ù„Ù„Ù€ PDF ====== */
    .avoid-break, .card, table, tr, td, th { break-inside: avoid; page-break-inside: avoid; }
    .page-break { break-before: page; page-break-before: always; }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø®Ø§ØµØ© Ù„Ù„ØªØµØ¯ÙŠØ± */
    #reportContent {
      font-family: 'Tajawal', Arial, sans-serif !important;
      background: white !important;
      padding: 20px !important;
      color: #000 !important;
      line-height: 1.5 !important;
    }

    #reportContent .report-section {
      margin-bottom: 20px !important;
      break-inside: avoid !important;
      page-break-inside: avoid !important;
    }

    #reportContent .audit-table {
      width: 100% !important;
      border-collapse: collapse !important;
      font-size: 12px !important;
      margin-bottom: 15px !important;
    }

    #reportContent .audit-table th,
    #reportContent .audit-table td {
      border: 1px solid #ddd !important;
      padding: 8px !important;
      text-align: right !important;
      vertical-align: top !important;
      background: white !important;
    }

    #reportContent .audit-table th {
      background-color: #f5f5f5 !important;
      font-weight: 700 !important;
    }

    #reportContent img {
      max-width: 300px !important;
      max-height: 200px !important;
      object-fit: contain !important;
      display: block !important;
      margin: 10px auto !important;
      border: 1px solid #ddd !important;
    }

    #reportContent .source-docs-grid {
      display: grid !important;
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 15px !important;
      margin-bottom: 15px !important;
    }

    #reportContent .source-doc-card {
      border: 1px solid #ddd !important;
      padding: 10px !important;
      background: white !important;
      break-inside: avoid !important;
    }

    @media print{
      .no-print{display:none !important}
      body{background:#fff}
      .container{box-shadow:none; border:none}
      .page-break{break-before:page}
      * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <a class="home" href="https://www.m2020m.org/portal.html" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
        <span data-translate="home_page">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
      </a>
      <span class="chip" id="lang-switcher" data-translate="lang_english">English</span>
    </div>

    <div class="title"><h1 data-translate="main_title">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†</h1></div>
    <p class="subtitle" data-translate="subtitle">ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø±ÙŠØ±ÙŠØ© Ø³Ù‡Ù„Ø© â€” ØªØ­Ù„ÙŠÙ„ Ø¹Ù…ÙŠÙ‚ Ù…ØªÙ†Ø§ØºÙ… Ù…Ø¹ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†</p>

    <div class="evidence-banner">
      <svg viewBox="0 0 24 24"><path fill="#0b4479" d="M12 2 1 21h22L12 2Zm1 15h-2v-2h2v2Zm0-4h-2V8h2v5Z"/></svg>
      <div data-translate="evidence_banner">ÙŠØ³ØªÙ†Ø¯ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠ Ø¥Ù„Ù‰ Ø£Ø¯Ù„Ø© Ù…ÙˆØ¬Ø²Ø© Ù…Ù† <b>WHO</b> Ùˆ<b>CDC</b> Ùˆ<b>Medscape</b>â€”ÙˆÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ¨Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„.</div>
    </div>

    <!-- (1) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶ -->
    <div class="section">
      <h2><span class="dot"></span><span data-translate="patient_info_title"> 1) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶</span></h2>
      <div class="card avoid-break">
        <div class="grid">
          <div class="col-4"><label data-translate="label_name">Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label><input id="name" data-translate-placeholder="placeholder_name" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯" /></div>
          <div class="col-4">
            <label data-translate="label_gender">Ø§Ù„Ø¬Ù†Ø³</label>
            <select id="gender">
              <option value="" data-translate="option_select">Ø§Ø®ØªØ±</option>
              <option value="Ø°ÙƒØ±" data-translate="option_male">Ø°ÙƒØ±</option>
              <option value="Ø£Ù†Ø«Ù‰" data-translate="option_female">Ø£Ù†Ø«Ù‰</option>
            </select>
          </div>
          <div class="col-4"><label data-translate="label_age">Ø§Ù„Ø¹Ù…Ø± (Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª)</label><input id="age" type="number" min="0" data-translate-placeholder="placeholder_age" placeholder="Ù…Ø«Ø§Ù„: 63" /></div>

          <div class="col-4">
            <label data-translate="label_pregnant">Ù‡Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶Ø© Ø­Ø§Ù…Ù„ØŸ</label>
            <select id="pregnant">
              <option value="no" data-translate="option_no">Ù„Ø§</option>
              <option value="yes" data-translate="option_yes">Ù†Ø¹Ù…</option>
              <option value="na" data-translate="option_na">ØºÙŠØ± Ù…Ù†Ø·Ø¨Ù‚</option>
            </select>
          </div>
          <div class="col-4"><label data-translate="label_pregnancy_months">Ø´Ù‡Ø± Ø§Ù„Ø­Ù…Ù„ (Ø¥Ù† ÙˆÙØ¬Ø¯)</label><input id="pregnancyMonths" type="number" min="1" max="10" data-translate-placeholder="placeholder_pregnancy_months" placeholder="Ù…Ø«Ø§Ù„: 5" /></div>

          <div class="col-4">
            <label data-translate="label_smoking">Ù‡Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø¯Ø®Ù‘Ù†ØŸ</label>
            <select id="smoking">
              <option value="" data-translate="option_select">Ø§Ø®ØªØ±</option>
              <option value="Ù…Ø¯Ø®Ù†" data-translate="option_smoker">Ù…Ø¯Ø®Ù†</option>
              <option value="ØºÙŠØ± Ù…Ø¯Ø®Ù†" data-translate="option_non_smoker">ØºÙŠØ± Ù…Ø¯Ø®Ù†</option>
              <option value="Ø³Ø§Ø¨Ù‚" data-translate="option_ex_smoker">Ø³Ø§Ø¨Ù‚</option>
            </select>
          </div>

          <div class="col-4"><label data-translate="label_pack_years">Pack-Years (Ø¥Ù† ÙˆÙØ¬Ø¯)</label><input id="packYears" type="number" min="0" step="0.5" data-translate-placeholder="placeholder_pack_years" placeholder="Ù…Ø«Ø§Ù„: 15" /></div>
          <div class="col-4"><label data-translate="label_weight">Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)</label><input id="weight" type="number" min="0" step="0.1" data-translate-placeholder="placeholder_weight" placeholder="Ù…Ø«Ø§Ù„: 78" /></div>
          <div class="col-4"><label data-translate="label_height">Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)</label><input id="height" type="number" min="0" step="0.5" data-translate-placeholder="placeholder_height" placeholder="Ù…Ø«Ø§Ù„: 172" /></div>

          <div class="col-4"><label data-translate="label_temp">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°Ù…)</label><input id="temp" type="number" step="0.1" data-translate-placeholder="placeholder_temp" placeholder="Ù…Ø«Ø§Ù„: 37.4" /></div>
          <div class="col-4">
            <label data-translate="label_has_cough">Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø³ÙØ¹Ø§Ù„ØŸ</label>
            <select id="hasCough">
              <option value="" data-translate="option_select">Ø§Ø®ØªØ±</option>
              <option value="Ù†Ø¹Ù…" data-translate="option_yes">Ù†Ø¹Ù…</option>
              <option value="Ù„Ø§" data-translate="option_no">Ù„Ø§</option>
            </select>
          </div>
          <div class="col-4"><label data-translate="label_cough_weeks">Ù…Ø¯Ø© Ø§Ù„Ø³Ø¹Ø§Ù„ (Ø£Ø³Ø§Ø¨ÙŠØ¹)</label><input id="coughWeeks" type="number" min="0" data-translate-placeholder="placeholder_cough_weeks" placeholder="Ù…Ø«Ø§Ù„: 12" /></div>
          <div class="col-4">
            <label data-translate="label_cough_type">Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¹Ø§Ù„</label>
            <select id="coughType">
              <option value="" data-translate="option_select">Ø§Ø®ØªØ±</option>
              <option value="Ø¬Ø§Ù" data-translate="option_dry">Ø¬Ø§Ù</option>
              <option value="Ø¨Ø¨Ù„ØºÙ…" data-translate="option_productive">Ø¨Ø¨Ù„ØºÙ…</option>
              <option value="Ø¨Ø¯Ù…" data-translate="option_hemoptysis">Ø¨Ø¯Ù…</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- (2) Ø®Ø·Ù‘ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶ -->
    <div class="section">
      <h2><span class="dot"></span><span data-translate="timeline_symptoms_title"> 2) Ø®Ø·Ù‘ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶</span></h2>
      <div class="card avoid-break">
        <div class="grid">
          <div class="col-12"><label data-translate="label_free_text">ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© (Ù†Øµ Ø­Ø±)</label><textarea id="freeText" data-translate-placeholder="placeholder_free_text" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø¹Ø§Ù„ Ù…Ø²Ù…Ù† 12 Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§ Ù…Ø¹ ÙÙ‚Ø¯Ø§Ù† ÙˆØ²Ù† Ø¨Ø³ÙŠØ·..."></textarea></div>
          <div class="col-6"><label data-translate="label_initial_dx">Ø§Ù„ØªØ´Ø®ÙŠØµØ§Øª Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ© (Ù†Øµ)</label><textarea id="initialDx" data-translate-placeholder="placeholder_initial_dx" placeholder="Ù…Ø«Ø§Ù„: T2DM, HTN, COPD? Dermatitis"></textarea></div>
          <div class="col-6"><label data-translate="label_labs_imaging">ØªØ­Ø§Ù„ÙŠÙ„/Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© (Ù†Øµ)</label><textarea id="labsImaging" data-translate-placeholder="placeholder_labs_imaging" placeholder="Ù…Ø«Ø§Ù„: HbA1c 8.7%, eGFR 38â†’62, K 5.6 ..."></textarea></div>
          <div class="col-12"><label data-translate="label_orders">Ø§Ù„Ø£Ø¯ÙˆÙŠØ©/Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ù‘Ø±Ø© (Ø¥Ù† ÙˆÙØ¬Ø¯Øª)</label><textarea id="orders" data-translate-placeholder="placeholder_orders" placeholder="Ù…Ø«Ø§Ù„: Xigduo XR bid, Metformin 1000 tid ..."></textarea></div>
        </div>
      </div>
    </div>

    <!-- (3) Ø±ÙØ¹ Ù…Ù„ÙØ§Øª (ØµÙˆØ±/PDF) -->
    <div class="section">
      <h2><span class="dot"></span><span data-translate="file_upload_title"> 3) Ø±ÙØ¹ Ù…Ù„ÙØ§Øª (ØµÙˆØ±/PDF) â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ</span></h2>
      <label class="uploader no-print" for="fileInput" id="dropZone" data-translate="uploader_text">
        Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø£ÙƒØ«Ø±
        <input id="fileInput" type="file" multiple accept="image/*,application/pdf" />
      </label>
      <div id="cards" class="cards" aria-live="polite"></div>
      <div id="fileList" class="muted" style="margin-top:8px"></div>
    </div>

    <div class="section no-print" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
      <button class="btn" id="analyzeBtn" data-translate="analyze_button">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©</button>
      <span id="busy" class="muted" style="display:none" data-translate="analyzing_text">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„â€¦</span>
    </div>

    <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± -->
    <div id="reportWrap" class="section" style="display:none">
      <div class="report-toolbar no-print">
        <button class="btn-secondary btn" id="exportPdfBtn" data-translate="export_button">ğŸ“„ ØªØµØ¯ÙŠØ± PDF Ù…Ø­Ø³Ù†</button>
        <button class="btn btn-outline" id="exportServerBtn">ØªØµØ¯ÙŠØ± PDF (Ø®Ø§Ø¯Ù…)</button>
      </div>
      <!-- Ø³Ù†ØºÙ„Ù Ù…Ø®Ø±Ø¬Ø§Øª Ø§Ù„Ø®Ø§Ø¯Ù… Ø¯Ø§Ø®Ù„ reportContent -->
      <div id="reportHTML" class="avoid-break"></div>
      <details style="margin-top:10px" class="no-print">
        <summary data-translate="show_json_summary">Ø¥Ø¸Ù‡Ø§Ø± JSON (Ù„Ù„Ø¨Ø­Ø«/Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª)</summary>
        <pre id="jsonOut" style="white-space:pre-wrap; background:#0b44790b; padding:12px; border-radius:12px; border:1px solid #e5e7eb"></pre>
      </details>
    </div>
  </div>

  <script>
    // ===== Internationalization (i18n) =====
    const translations = {
      ar: {
        app_title: "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†",
        home_page: "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
        lang_english: "English",
        main_title: "ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙˆØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†",
        subtitle: "ÙˆØ§Ø¬Ù‡Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø±ÙŠØ±ÙŠØ© Ø³Ù‡Ù„Ø© â€” ØªØ­Ù„ÙŠÙ„ Ø¹Ù…ÙŠÙ‚ Ù…ØªÙ†Ø§ØºÙ… Ù…Ø¹ Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†",
        evidence_banner: "ÙŠØ³ØªÙ†Ø¯ Ø§Ù„Ø­ÙƒÙ… Ø§Ù„ØªØ£Ù…ÙŠÙ†ÙŠ Ø¥Ù„Ù‰ Ø£Ø¯Ù„Ø© Ù…ÙˆØ¬Ø²Ø© Ù…Ù† <b>WHO</b> Ùˆ<b>CDC</b> Ùˆ<b>Medscape</b>â€”ÙˆÙŠØ¸Ù‡Ø± Ø§Ù„ØªØ¨Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„.",
        patient_info_title: " 1) Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶",
        label_name: "Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)",
        placeholder_name: "Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ø®Ø§Ù„Ø¯",
        label_gender: "Ø§Ù„Ø¬Ù†Ø³",
        option_select: "Ø§Ø®ØªØ±",
        option_male: "Ø°ÙƒØ±",
        option_female: "Ø£Ù†Ø«Ù‰",
        label_age: "Ø§Ù„Ø¹Ù…Ø± (Ø¨Ø§Ù„Ø³Ù†ÙˆØ§Øª)",
        placeholder_age: "Ù…Ø«Ø§Ù„: 63",
        label_pregnant: "Ù‡Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶Ø© Ø­Ø§Ù…Ù„ØŸ",
        option_no: "Ù„Ø§",
        option_yes: "Ù†Ø¹Ù…",
        option_na: "ØºÙŠØ± Ù…Ù†Ø·Ø¨Ù‚",
        label_pregnancy_months: "Ø´Ù‡Ø± Ø§Ù„Ø­Ù…Ù„ (Ø¥Ù† ÙˆÙØ¬Ø¯)",
        placeholder_pregnancy_months: "Ù…Ø«Ø§Ù„: 5",
        label_smoking: "Ù‡Ù„ Ø§Ù„Ù…Ø±ÙŠØ¶ Ù…Ø¯Ø®Ù‘Ù†ØŸ",
        option_smoker: "Ù…Ø¯Ø®Ù†",
        option_non_smoker: "ØºÙŠØ± Ù…Ø¯Ø®Ù†",
        option_ex_smoker: "Ø³Ø§Ø¨Ù‚",
        label_pack_years: "Pack-Years (Ø¥Ù† ÙˆÙØ¬Ø¯)",
        placeholder_pack_years: "Ù…Ø«Ø§Ù„: 15",
        label_weight: "Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…)",
        placeholder_weight: "Ù…Ø«Ø§Ù„: 78",
        label_height: "Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…)",
        placeholder_height: "Ù…Ø«Ø§Ù„: 172",
        label_temp: "Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°Ù…)",
        placeholder_temp: "Ù…Ø«Ø§Ù„: 37.4",
        label_has_cough: "Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø³ÙØ¹Ø§Ù„ØŸ",
        label_cough_weeks: "Ù…Ø¯Ø© Ø§Ù„Ø³Ø¹Ø§Ù„ (Ø£Ø³Ø§Ø¨ÙŠØ¹)",
        placeholder_cough_weeks: "Ù…Ø«Ø§Ù„: 12",
        label_cough_type: "Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¹Ø§Ù„",
        option_dry: "Ø¬Ø§Ù",
        option_productive: "Ø¨Ø¨Ù„ØºÙ…",
        option_hemoptysis: "Ø¨Ø¯Ù…",
        timeline_symptoms_title: " 2) Ø®Ø·Ù‘ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø£Ø¹Ø±Ø§Ø¶",
        label_free_text: "ÙˆØµÙ Ø§Ù„Ø­Ø§Ù„Ø© (Ù†Øµ Ø­Ø±)",
        placeholder_free_text: "Ù…Ø«Ø§Ù„: Ø³Ø¹Ø§Ù„ Ù…Ø²Ù…Ù† 12 Ø£Ø³Ø¨ÙˆØ¹Ù‹Ø§ Ù…Ø¹ ÙÙ‚Ø¯Ø§Ù† ÙˆØ²Ù† Ø¨Ø³ÙŠØ·...",
        label_initial_dx: "Ø§Ù„ØªØ´Ø®ÙŠØµØ§Øª Ø§Ù„Ù…Ø¨Ø¯Ø¦ÙŠØ© (Ù†Øµ)",
        placeholder_initial_dx: "Ù…Ø«Ø§Ù„: T2DM, HTN, COPD? Dermatitis",
        label_labs_imaging: "ØªØ­Ø§Ù„ÙŠÙ„/Ø§Ù„Ø£Ø´Ø¹Ø© Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© (Ù†Øµ)",
        placeholder_labs_imaging: "Ù…Ø«Ø§Ù„: HbA1c 8.7%, eGFR 38â†’62, K 5.6 ...",
        label_orders: "Ø§Ù„Ø£Ø¯ÙˆÙŠØ©/Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ù‘Ø±Ø© (Ø¥Ù† ÙˆÙØ¬Ø¯Øª)",
        placeholder_orders: "Ù…Ø«Ø§Ù„: Xigduo XR bid, Metformin 1000 tid ...",
        file_upload_title: " 3) Ø±ÙØ¹ Ù…Ù„ÙØ§Øª (ØµÙˆØ±/PDF) â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ",
        uploader_text: "Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ø±ÙØ¹ Ù…Ù„Ù ÙˆØ§Ø­Ø¯ Ø£Ùˆ Ø£ÙƒØ«Ø±",
        analyze_button: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©",
        analyzing_text: "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„â€¦",
        export_button: "ğŸ“„ ØªØµØ¯ÙŠØ± PDF Ù…Ø­Ø³Ù†",
        show_json_summary: "Ø¥Ø¸Ù‡Ø§Ø± JSON (Ù„Ù„Ø¨Ø­Ø«/Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª)",
      },
      en: {
        app_title: "Medical Case & Insurance Claim Assessment",
        home_page: "Home Page",
        lang_english: "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©",
        main_title: "Medical Case & Insurance Claim Assessment",
        subtitle: "Easy clinical entry interface â€” Deep analysis aligned with insurance needs",
        evidence_banner: "Insurance judgment is based on concise evidence from <b>WHO</b>, <b>CDC</b>, and <b>Medscape</b>â€”justification appears within the table.",
        patient_info_title: " 1) Patient Information",
        label_name: "Name (Optional)",
        placeholder_name: "e.g., John Doe",
        label_gender: "Gender",
        option_select: "Select",
        option_male: "Male",
        option_female: "Female",
        label_age: "Age (Years)",
        placeholder_age: "e.g., 63",
        label_pregnant: "Is the patient pregnant?",
        option_no: "No",
        option_yes: "Yes",
        option_na: "N/A",
        label_pregnancy_months: "Month of Pregnancy (if any)",
        placeholder_pregnancy_months: "e.g., 5",
        label_smoking: "Is the patient a smoker?",
        option_smoker: "Smoker",
        option_non_smoker: "Non-smoker",
        option_ex_smoker: "Ex-smoker",
        label_pack_years: "Pack-Years (if any)",
        placeholder_pack_years: "e.g., 15",
        label_weight: "Weight (kg)",
        placeholder_weight: "e.g., 78",
        label_height: "Height (cm)",
        placeholder_height: "e.g., 172",
        label_temp: "Temperature (Â°C)",
        placeholder_temp: "e.g., 37.4",
        label_has_cough: "Is there a cough?",
        label_cough_weeks: "Cough Duration (weeks)",
        placeholder_cough_weeks: "e.g., 12",
        label_cough_type: "Cough Type",
        option_dry: "Dry",
        option_productive: "Productive",
        option_hemoptysis: "Hemoptysis",
        timeline_symptoms_title: " 2) Timeline & Symptoms",
        label_free_text: "Case Description (Free Text)",
        placeholder_free_text: "e.g., Chronic cough for 12 weeks with slight weight loss...",
        label_initial_dx: "Initial Diagnoses (Text)",
        placeholder_initial_dx: "e.g., T2DM, HTN, COPD? Dermatitis",
        label_labs_imaging: "Mentioned Labs/Imaging (Text)",
        placeholder_labs_imaging: "e.g., HbA1c 8.7%, eGFR 38â†’62, K 5.6 ...",
        label_orders: "Prescribed Meds/Procedures (if any)",
        placeholder_orders: "e.g., Xigduo XR bid, Metformin 1000 tid ...",
        file_upload_title: " 3) Upload Files (Images/PDF) â€” Optional",
        uploader_text: "Click here to upload one or more files",
        analyze_button: "Analyze Case",
        analyzing_text: "Analyzingâ€¦",
        export_button: "ğŸ“„ Export Improved PDF",
        show_json_summary: "Show JSON (for search/analytics)",
      }
    };

    let currentLang = 'ar';
    function setLanguage(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;
      document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      document.querySelectorAll('[data-translate]').forEach(el => {
        const key = el.getAttribute('data-translate');
        if (translations[lang][key]) el.innerHTML = translations[lang][key];
      });
      document.querySelectorAll('[data-translate-placeholder]').forEach(el => {
        const key = el.getAttribute('data-translate-placeholder');
        if (translations[lang][key]) el.placeholder = translations[lang][key];
      });
      document.title = translations[lang].app_title;
    }
    document.getElementById('lang-switcher').addEventListener('click', () => {
      const newLang = currentLang === 'ar' ? 'en' : 'ar';
      setLanguage(newLang);
    });

    // ===== Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø­Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¬Ù†Ø³ =====
    const genderEl = document.getElementById('gender');
    const pregSel = document.getElementById('pregnant');
    const pregMonths = document.getElementById('pregnancyMonths');
    function syncPregnancyControls(){
      const g = genderEl.value;
      if(g !== 'Ø£Ù†Ø«Ù‰'){
        pregSel.value = 'na'; pregSel.disabled = true; pregMonths.value = ''; pregMonths.disabled = true;
      }else{ pregSel.disabled = false; pregMonths.disabled = pregSel.value !== 'yes'; }
    }
    genderEl.addEventListener('change', syncPregnancyControls);
    pregSel.addEventListener('change', ()=>{ pregMonths.disabled = pregSel.value !== 'yes'; });
    syncPregnancyControls();

    // ===== Ø±Ø§ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª =====
    const fileInput = document.getElementById('fileInput');
    const dropZone  = document.getElementById('dropZone');
    const cardsBox  = document.getElementById('cards');
    const file
