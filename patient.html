<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>المساعد الصحي الذكي - بوابة المريض</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #28a745; /* Green for patient portal */
      --secondary-color: #0a4c8b;
      --background-color: #f4f7f9;
      --text-color: #333;
      --card-bg-color: #ffffff;
      --border-color: #e0e0e0;
      --error-color: #dc3545;
      --warning-color: #ffc107;
      --info-color: #17a2b8;
    }
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f4f7f9 0%, #e8f4f8 100%);
        color: var(--text-color);
        margin: 0;
        padding: 1rem;
        line-height: 1.6;
    }
    
    .home-icon-link {
        position: absolute;
        top: 25px;
        right: 30px;
        z-index: 1000;
        display: block;
        background-color: white;
        border-radius: 50%;
        padding: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
    }
    .home-icon-link:hover {
        transform: scale(1.1);
    }
    .home-icon-link svg {
        width: 32px;
        height: 32px;
        fill: var(--primary-color);
    }

    .container {
      max-width: 900px;
      margin: 2rem auto;
      background-color: var(--card-bg-color);
      padding: 2.5rem;
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
      position: relative;
      overflow: hidden;
    }
    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    }
    .header {
        text-align: center;
        margin-bottom: 2.5rem;
        padding-bottom: 1.5rem;
        position: relative;
    }
    .header::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 25%;
      width: 50%;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--primary-color), transparent);
    }
    .header h2 {
      color: var(--primary-color);
      margin: 0;
      font-size: 2.2rem;
      font-weight: 700;
      position: relative;
      display: inline-block;
    }
    .header h2::after {
      content: "⚕️";
      position: absolute;
      right: -40px;
      top: 50%;
      transform: translateY(-50%);
    }
    .header p {
        color: #555;
        margin-top: 0.5rem;
        font-size: 1.1rem;
    }
    label {
      font-weight: 600;
      display: block;
      margin-top: 1.5rem;
      margin-bottom: 0.5rem;
      color: var(--secondary-color);
      position: relative;
      padding-right: 8px;
    }
    label.required::after {
      content: "*";
      color: var(--error-color);
      margin-right: 4px;
    }
    textarea, input, select {
      width: 100%;
      padding: 0.9rem 1rem;
      font-size: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      box-sizing: border-box;
      transition: border-color 0.3s, box-shadow 0.3s;
      background-color: #fafafa;
    }
    textarea:focus, input:focus, select:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.15);
      background-color: white;
    }
    textarea {
      min-height: 120px;
      resize: vertical;
    }
    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.2rem 1.8rem;
    }
    .full-width {
        grid-column: 1 / -1;
    }
    .conditional-field {
        display: none;
        animation: slideDown 0.4s ease-out;
    }
    @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    button {
      padding: 1rem;
      font-size: 1.2rem;
      font-weight: bold;
      color: #fff;
      background: linear-gradient(45deg, var(--primary-color), #218838);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 2.5rem;
      width: 100%;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.25);
      position: relative;
      overflow: hidden;
    }
    button::after {
      content: "→";
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0;
      transition: all 0.3s;
    }
    button:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(40, 167, 69, 0.35);
    }
    button:hover::after {
      opacity: 1;
      left: 30px;
    }
    .image-upload-container {
        margin-top: 1.5rem;
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
        background-color: #f8f9fa;
    }
    .image-upload-container:hover {
        border-color: var(--primary-color);
        background-color: #f0f7ff;
    }
    .image-upload-container i {
      font-size: 2.5rem;
      color: var(--primary-color);
      margin-bottom: 10px;
      display: block;
    }
    #image-upload-input { display: none; }
    #image-preview-container { 
        margin-top: 1.5rem; 
        display: flex; 
        flex-wrap: wrap; 
        gap: 15px; 
        justify-content: center; 
    }
    .preview-wrapper { 
        position: relative; 
        display: inline-block;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
        transition: transform 0.3s;
    }
    .preview-wrapper:hover {
        transform: translateY(-5px);
    }
    .preview-image { 
        max-width: 150px; 
        max-height: 150px; 
        display: block;
    }
    .delete-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      background: var(--error-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-weight: bold;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      opacity: 0.9;
      transition: opacity 0.3s;
    }
    .delete-btn:hover {
      opacity: 1;
    }
    #response-container { 
        margin-top: 2.5rem; 
        display: none; 
        animation: fadeIn 0.5s ease-in-out; 
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .response-section { 
        padding: 1.8rem; 
        margin-bottom: 1.5rem; 
        border-radius: 12px; 
        background-color: #fdfdfd; 
        border: 1px solid var(--border-color); 
        text-align: right; 
        position: relative;
    }
    .response-section::before {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 5px;
      height: 100%;
      background-color: var(--primary-color);
      border-radius: 0 8px 8px 0;
    }
    .response-section h4 { 
        margin-top: 0; 
        margin-bottom: 1.2rem; 
        color: var(--secondary-color); 
        display: flex; 
        align-items: center; 
        gap: 10px; 
        font-size: 1.4rem;
    }
    .response-section h4 i {
      color: var(--primary-color);
    }
    .recommendation-box { 
        padding: 1.5rem; 
        border-radius: 12px; 
        font-size: 1.1rem; 
        font-weight: bold; 
        text-align: center;
        margin-top: 1.5rem;
        position: relative;
        overflow: hidden;
    }
    .recommendation-box::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
    }
    .recommendation-box.red { 
        background-color: #f8d7da; 
        color: #721c24; 
    }
    .recommendation-box.red::before {
        background-color: #dc3545;
    }
    .recommendation-box.yellow { 
        background-color: #fff3cd; 
        color: #856404; 
    }
    .recommendation-box.yellow::before {
        background-color: #ffc107;
    }
    .recommendation-box.green { 
        background-color: #d4edda; 
        color: #155724; 
    }
    .recommendation-box.green::before {
        background-color: #28a745;
    }
    .notification { 
        padding: 1rem; 
        margin-top: 1rem; 
        border-radius: 8px; 
        text-align: center; 
        display: none;
        animation: fadeIn 0.5s;
        position: relative;
        padding-right: 45px;
    }
    .notification i {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.5rem;
    }
    .notification.error { 
        background-color: #f8d7da; 
        color: #721c24; 
        border-left: 4px solid #dc3545;
    }
    .notification.info { 
        background-color: #d1ecf1; 
        color: #0c5460; 
        border-left: 4px solid #17a2b8;
    }
    .disclaimer { 
        font-size: 0.85rem; 
        text-align: center; 
        color: #777; 
        margin-top: 2rem;
        padding: 1rem;
        background-color: #f8f9fa;
        border-radius: 8px;
        line-height: 1.7;
    }
    .loading {
      display: none;
      text-align: center;
      padding: 1.5rem;
    }
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(40, 167, 69, 0.2);
      border-top: 4px solid var(--primary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
      .form-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      .container {
        padding: 1.5rem;
      }
      .home-icon-link {
        top: 15px;
        right: 15px;
      }
    }
  </style>
</head>
<body>
  <a href="https://www.m2020m.org/portal.html" class="home-icon-link" title="الرجوع إلى البوابة الرئيسية">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5z"/>
    </svg>
  </a>
  <div class="container">
    <div class="header">
        <h2>المساعد الصحي الذكي</h2>
        <p>أدخل معلوماتك للحصول على تحليل أولي لحالتك الصحية</p>
    </div>

    <div class="form-grid">
        <div class="full-width">
            <label for="symptoms" class="required">صف أعراضك بالتفصيل:</label>
            <textarea id="symptoms" placeholder="مثال: أشعر بصداع شديد في مقدمة الرأس، مع غثيان..."></textarea>
        </div>
        <div>
            <label for="age" class="required">العمر:</label>
            <input type="number" id="age" placeholder="مثال: 35" min="1" max="120" />
        </div>
        <div>
            <label for="gender" class="required">الجنس:</label>
            <select id="gender">
              <option value="" disabled selected>اختر...</option>
              <option value="male">ذكر</option>
              <option value="female">أنثى</option>
            </select>
        </div>
        <div id="pregnancy-section" class="conditional-field full-width">
            <label for="isPregnant">هل أنتِ حامل؟</label>
            <select id="isPregnant">
                <option value="no" selected>لا</option>
                <option value="yes">نعم</option>
            </select>
        </div>
        <div id="pregnancy-month-section" class="conditional-field full-width">
            <label for="pregnancyMonth">في أي شهر من الحمل؟</label>
            <select id="pregnancyMonth">
                <option value="1">الشهر الأول</option><option value="2">الشهر الثاني</option><option value="3">الشهر الثالث</option>
                <option value="4">الشهر الرابع</option><option value="5">الشهر الخامس</option><option value="6">الشهر السادس</option>
                <option value="7">الشهر السابع</option><option value="8">الشهر الثامن</option><option value="9">الشهر التاسع</option>
            </select>
        </div>
        <div>
            <label for="weight">الوزن (كجم) (اختياري):</label>
            <input type="number" id="weight" placeholder="مثال: 70" min="1" max="300">
        </div>
        <div>
            <label for="height">الطول (سم) (اختياري):</label>
            <input type="number" id="height" placeholder="مثال: 175" min="50" max="250">
        </div>
        <div>
            <label for="smoker" class="required">هل أنت مدخن؟</label>
            <select id="smoker">
              <option value="" disabled selected>اختر...</option>
              <option value="yes">نعم</option>
              <option value="no">لا</option>
            </select>
        </div>
        <div>
            <label for="vitals">الحرارة والضغط (اختياري):</label>
            <input type="text" id="vitals" placeholder="مثال: الحرارة 38.5، الضغط 120/80">
        </div>
        <div class="full-width">
            <label for="currentMedications">الأدوية الحالية (اختياري):</label>
            <textarea id="currentMedications" placeholder="اذكر أي أدوية تتناولها حالياً"></textarea>
        </div>
        <div class="full-width">
            <label for="labs">نتائج تحاليل حالية (اختياري):</label>
            <textarea id="labs" placeholder="إذا كان لديك أي نتائج تحاليل حديثة"></textarea>
        </div>
        <div class="full-width">
            <label for="diagnosis">أي تشخيص سابق (اختياري):</label>
            <textarea id="diagnosis" placeholder="إذا كان لديك أي تشخيص سابق من طبيب"></textarea>
        </div>
        <div class="full-width">
            <label for="image-upload-input">رفع ملفات للتحليل (اختياري):</label>
            <div class="image-upload-container" onclick="document.getElementById('image-upload-input').click();">
                <i class="fas fa-cloud-upload-alt"></i>
                <span>اضغط هنا لاختيار صورة أو أكثر (JPEG, PNG)</span>
                <p style="font-size: 0.85rem; color: #666; margin-top: 8px;">يمكنك رفع حتى 5 صور</p>
                <input type="file" id="image-upload-input" accept="image/jpeg,image/png" multiple>
            </div>
            <div id="image-preview-container"></div>
        </div>
    </div>

    <button onclick="analyzeSymptoms()" class="btn-primary">
      <span>تحليل الأعراض</span>
    </button>
    
    <div class="loading" id="loading">
      <div class="loading-spinner"></div>
      <p>جاري تحليل المعلومات، الرجاء الانتظار...</p>
    </div>

    <div id="notification-area"></div>
    <div id="response-container"></div>

    <p class="disclaimer">
      <strong>إخلاء مسؤولية:</strong> هذه الأداة تقدم نصائح أولية للمعلومات فقط ولا تعتبر بديلاً عن الاستشارة الطبية المتخصصة. النتائج المقدمة هي تحليل أولي ولا تغني عن زيارة الطبيب. في الحالات الطارئة، يرجى الاتصال بالطوارئ فورًا.
    </p>
  </div>

  <script>
    // تتبع حالة الحمل وعرض الحقول المشروطة
    const genderSelect = document.getElementById('gender');
    const pregnancySection = document.getElementById('pregnancy-section');
    const isPregnantSelect = document.getElementById('isPregnant');
    const pregnancyMonthSection = document.getElementById('pregnancy-month-section');

    genderSelect.addEventListener('change', () => {
        if (genderSelect.value === 'female') {
            pregnancySection.style.display = 'block';
            if (isPregnantSelect.value === 'yes') {
                pregnancyMonthSection.style.display = 'block';
            }
        } else {
            pregnancySection.style.display = 'none';
            pregnancyMonthSection.style.display = 'none';
        }
    });

    isPregnantSelect.addEventListener('change', () => {
        if (isPregnantSelect.value === 'yes') {
            pregnancyMonthSection.style.display = 'block';
        } else {
            pregnancyMonthSection.style.display = 'none';
        }
    });

    // معالجة رفع الصور
    const imageInput = document.getElementById('image-upload-input');
    const previewContainer = document.getElementById('image-preview-container');
    let imageBase64Data = [];

    imageInput.addEventListener('change', (event) => {
      previewContainer.innerHTML = '';
      imageBase64Data = [];
      const files = event.target.files;
      
      if (files.length > 5) {
        showNotification("error", "يمكنك رفع حتى 5 صور فقط");
        imageInput.value = '';
        return;
      }
      
      if (files.length > 0) {
        Array.from(files).forEach((file, index) => {
          // التحقق من نوع الملف
          if (!file.type.match('image/jpeg') && !file.type.match('image/png')) {
            showNotification("error", "نوع الملف غير مدعوم. الرجاء رفع صور JPEG أو PNG فقط.");
            return;
          }
          
          const reader = new FileReader();
          reader.onload = (e) => {
            const wrapper = document.createElement('div');
            wrapper.classList.add('preview-wrapper');

            const img = document.createElement('img');
            img.src = e.target.result;
            img.classList.add('preview-image');
            img.alt = "صورة مرفوعة";

            const deleteBtn = document.createElement('button');
            deleteBtn.innerHTML = '&times;';
            deleteBtn.className = 'delete-btn';
            deleteBtn.title = "حذف الصورة";
            deleteBtn.onclick = () => {
              imageBase64Data.splice(index, 1);
              wrapper.remove();
            };

            wrapper.appendChild(img);
            wrapper.appendChild(deleteBtn);
            previewContainer.appendChild(wrapper);

            imageBase64Data.push(e.target.result.split(',')[1]);
          };
          reader.readAsDataURL(file);
        });
      }
    });

    // عرض الإشعارات
    function showNotification(type, message) {
        const notificationArea = document.getElementById('notification-area');
        const notificationDiv = document.createElement('div');
        notificationDiv.className = `notification ${type}`;
        
        const icon = type === 'error' ? 'fas fa-exclamation-circle' : 'fas fa-info-circle';
        notificationDiv.innerHTML = `
          <i class="${icon}"></i>
          ${message}
        `;
        
        notificationArea.innerHTML = '';
        notificationArea.appendChild(notificationDiv);
        
        // إخفاء الإشعار بعد 5 ثواني
        setTimeout(() => {
          notificationDiv.style.opacity = '0';
          setTimeout(() => {
            notificationDiv.remove();
          }, 500);
        }, 5000);
    }

    // تحليل الأعراض
    async function analyzeSymptoms() {
      const symptoms = document.getElementById('symptoms').value;
      const age = document.getElementById('age').value;
      const gender = document.getElementById('gender').value;
      const smoker = document.getElementById('smoker').value;
      
      const responseContainer = document.getElementById('response-container');
      const notificationArea = document.getElementById('notification-area');
      const loading = document.getElementById('loading');
      
      responseContainer.style.display = 'none';
      responseContainer.innerHTML = '';
      notificationArea.innerHTML = '';

      // التحقق من الحقول المطلوبة
      if (!symptoms || !age || !gender || !smoker) {
        showNotification("error", "الرجاء ملء جميع الحقول المطلوبة (الأعراض، العمر، الجنس، والتدخين).");
        return;
      }
      
      // إظهار مؤشر التحميل
      loading.style.display = 'block';
      
      try {
        // في بيئة حقيقية، سيتم استبدال هذا بالاتصال بالخادم الخلفي
        // لمحاكاة زمن الاستجابة
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // إخفاء مؤشر التحميل
        loading.style.display = 'none';
        
        // إنشاء تقرير محاكاة
        const reportHTML = `
          <div class="response-section">
            <h4><i class="fas fa-stethoscope"></i> ملخص الأعراض</h4>
            <p>وصفت أعراضًا تشمل: ${symptoms.substring(0, 100)}...</p>
            <p>بناءً على المعلومات المقدمة، يبدو أنك تعاني من حالة قد تكون مرتبطة بالصداع النصفي أو التوتر.</p>
          </div>
          
          <div class="response-section">
            <h4><i class="fas fa-lightbulb"></i> التوصيات الأولية</h4>
            <ul>
              <li>الراحة في مكان هادئ مع إضاءة خافتة</li>
              <li>تناول مسكنات الألم المتاحة دون وصفة طبية مثل الباراسيتامول</li>
              <li>شرب كمية كافية من الماء</li>
              <li>تجنب الأضواء الساطعة والأصوات العالية</li>
            </ul>
          </div>
          
          <div class="response-section">
            <h4><i class="fas fa-exclamation-triangle"></i> متى يجب زيارة الطبيب</h4>
            <p>يجب مراجعة الطبيب في الحالات التالية:</p>
            <ul>
              <li>إذا استمر الصداع أكثر من 48 ساعة</li>
              <li>إذا صاحب الصداع تشوش في الرؤية أو صعوبة في الكلام</li>
              <li>إذا ازدادت حدة الأعراض بشكل مفاجئ</li>
              <li>إذا صاحب الصداع ارتفاع في درجة الحرارة أو تصلب في الرقبة</li>
            </ul>
          </div>
          
          <div class="recommendation-box yellow">
            <p>يوصى بمراجعة طبيب عام في خلال 24-48 ساعة إذا استمرت الأعراض</p>
          </div>
        `;
        
        responseContainer.innerHTML = reportHTML;
        responseContainer.style.display = 'block';
        
        // التمرير إلى نتائج التحليل
        responseContainer.scrollIntoView({ behavior: 'smooth' });

      } catch (err) {
        loading.style.display = 'none';
        showNotification("error", "حدث خطأ أثناء التحليل: " + err.message);
        console.error(err);
      }
    }
    
    // جعل الدالة متاحة عالمياً
    window.analyzeSymptoms = analyzeSymptoms;
  </script>
</body>
</html>
