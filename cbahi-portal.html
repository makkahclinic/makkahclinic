<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ (ุงูุฅุตุฏุงุฑ 2025)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --maroon: #7B1E24;
    --burgundy: #C55A44;
    --gold: #E9C46A;
    --brand1: #7B1E24;
    --brand2: #C55A44;
  }
  
  body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(180deg, #fff, #faf5f4 45%, #fff);
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,.08);
  }
  
  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .hero {
    background: linear-gradient(180deg, var(--maroon), var(--burgundy));
    color: #fff;
    text-align: center;
  }
  
  .hero-inner {
    padding: 56px 16px 72px;
  }
  
  .hero-logo-wrap {
    position: relative;
    display: inline-block;
  }
  
  .hero-logo-wrap::before {
    content: "";
    position: absolute;
    inset: -28px;
    border-radius: 9999px;
    background: radial-gradient(closest-side, rgba(233,196,106,.22), transparent 70%);
    filter: blur(1px);
  }
  
  .hero img {
    position: relative;
    z-index: 1;
    width: 150px;
    height: auto;
    filter: drop-shadow(0 0 24px var(--gold));
    animation: glow 3s ease-in-out infinite alternate;
  }
  
  @keyframes glow {
    from { filter: drop-shadow(0 0 10px var(--gold)); }
    to { filter: drop-shadow(0 0 32px var(--gold)); }
  }
  
  .sidebar {
    width: 270px;
    background: linear-gradient(180deg, var(--maroon), var(--burgundy));
    color: #fff;
    border-radius: 14px;
    padding: 1rem;
  }
  
  .nav-link {
    display: block;
    padding: .55rem .8rem;
    border-radius: .6rem;
    transition: .2s;
    color: white;
    text-decoration: none;
    margin-bottom: 0.25rem;
  }
  
  .nav-link:hover {
    background-color: rgba(255,255,255,.16);
    transform: translateX(-3px);
  }
  
  .nav-link.active {
    background-color: rgba(255,255,255,.28);
    font-weight: 700;
  }
  
  .card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,.06);
  }
  
  .hidden {
    display: none !important;
  }
  
  #scrollTopBtn {
    position: fixed;
    left: 18px;
    bottom: 18px;
    display: none;
    width: 48px;
    height: 48px;
    border-radius: 9999px;
    background: var(--gold);
    color: var(--maroon);
    box-shadow: 0 8px 18px rgba(123,30,36,.35);
    font-size: 20px;
    border: none;
    cursor: pointer;
    place-items: center;
  }
  
  #scrollTopBtn:hover {
    transform: scale(1.08);
  }
  
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 16px;
    z-index: 60;
  }
  
  .modal.open {
    display: flex;
  }
  
  .modal .panel {
    background: #fff;
    border-radius: 14px;
    overflow: hidden;
    width: min(1200px, 96vw);
    height: 80vh;
  }
  
  /* --- FMS tabs & cards --- */
  .tabs {
    display: flex;
    gap: 8px;
    overflow: auto;
    padding-bottom: 8px;
  }
  
  .tab {
    white-space: nowrap;
    border: 1px solid #e5e7eb;
    border-radius: 9999px;
    background: #fff;
    color: var(--maroon);
    padding: .4rem .9rem;
    cursor: pointer;
  }
  
  .tab.active {
    background: var(--maroon);
    color: #fff;
    border-color: transparent;
  }
  
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 14px;
  }
  
  .doc-card {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 14px;
    border: 1px solid #eee;
    border-radius: 12px;
    background: #fff;
    height: 100%;
  }
  
  .doc-code {
    color: var(--maroon);
    font-weight: 700;
  }
  
.content-section {
  display: none;
  scroll-margin-top: 96px; /* ูุชุนููุถ ุงุฑุชูุงุน ุงูููุฏุฑ ุงูู sticky ุนูุฏ ุงูุชูุฑูุฑ */
}

.content-section.active {
  display: block;
}

  
  .content-section.active {
    display: block;
  }
  
  .gold-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--maroon);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border: 1px solid var(--gold);
    border-radius: 8px;
    background: rgba(233, 196, 106, 0.1);
    transition: all 0.3s;
  }
  
  .gold-link:hover {
    background: var(--gold);
    color: var(--maroon);
  }
  
  .table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .table th, .table td {
    padding: 0.75rem;
    border: 1px solid #e5e7eb;
    text-align: right;
  }
  
  .table th {
    background-color: #f9fafb;
    font-weight: 700;
  }
  
  .chip {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: #f3f4f6;
    border-radius: 9999px;
    font-size: 0.75rem;
    margin-right: 0.5rem;
  }
  
  .grid-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }
  
  .box {
    background: white;
    border-radius: 14px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
  }
  
  .kpi-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  
  .kpi-table th, .kpi-table td {
    padding: 0.5rem;
    border: 1px solid #e5e7eb;
    text-align: center;
  }
  
  .kpi-table th {
    background-color: var(--maroon);
    color: white;
    font-weight: 600;
  }
  
  .kpi-table tr:nth-child(even) {
    background-color: #f9fafb;
  }
  
  .good {
    background-color: #dcfce7 !important;
    color: #166534;
  }
  
  .warning {
    background-color: #fef9c3 !important;
    color: #854d0e;
  }
  
  .critical {
    background-color: #fee2e2 !important;
    color: #991b1b;
  }
</style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header>
  <div class="container flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <img id="logoSmall" class="h-12 w-auto rounded bg-white p-1 shadow" alt="ุดุนุงุฑ ุงููุฌูุน" src="https://raw.githubusercontent.com/makkahclinic/makkahclinic/main/logo.png">
      <button id="btnSetLogo" class="text-[var(--maroon)] text-sm underline underline-offset-4 hover:text-[var(--burgundy)]">
        ุชุบููุฑ/ุชุญุฏูุซ ุงูุดุนุงุฑ
      </button>
      <input id="logoPicker" type="file" accept="image/*" class="hidden">
    </div>
    <div class="text-center">
      <div class="text-lg md:text-xl font-bold text-gray-800">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ</div>
      <div class="text-xs md:text-sm text-gray-500">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ โ ุงูุฅุตุฏุงุฑ 2025</div>
    </div>
    <div class="flex items-center gap-2">
      <a href="https://m2020m.org" target="_blank" class="px-3 py-2 rounded text-[var(--maroon)] hover:bg-gray-100">๐ฅ ูููุน ุงููุฌูุน</a>
      <button onclick="window.print()" class="bg-[var(--maroon)] hover:bg-[var(--burgundy)] text-white px-4 py-2 rounded"><i class="fas fa-print ml-2"></i> ุทุจุงุนุฉ / PDF</button>
    </div>
  </div>
</header>

<!-- Hero -->
<section class="hero">
  <div class="hero-inner container">
    <div class="hero-logo-wrap">
      <img id="logoHero" alt="ุดุนุงุฑ ูุฌูุน ููุฉ ุงูุทุจู"
     src="https://raw.githubusercontent.com/makkahclinic/makkahclinic/main/logo.png"
     decoding="async" fetchpriority="high" width="150" height="150">
    </div>
    <h1 class="text-3xl md:text-4xl font-bold mt-4">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ</h1>
    <p class="text-base md:text-lg opacity-95 mt-1">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ โ ุงูุฅุตุฏุงุฑ 2025</p>
    <div class="text-[13px] md:text-[14px] mt-2" style="color:#f8e8cc">ุจูุงุจุฉ ุฏุงุฎููุฉ ูุฅุฏุงุฑุฉ ุงููุซุงุฆู ูุงููุนุงููุฑ โ ูุง ุชุชุถูู ุฃู ุงุฏุนุงุก ุจุงูุญุตูู ุนูู ุงูุงุนุชูุงุฏ.</div>
  </div>
</section>

<!-- Layout -->
<div class="container px-4 py-6 flex flex-row gap-6">
  <!-- Sidebar -->
  <aside class="sidebar h-max sticky top-[92px]">
    <div class="font-bold mb-2 text-lg">๐ ุฃูุณุงู ุงูุจูุงุจุฉ</div>
    <a class="nav-link active" href="#home" onclick="return navTo('home')">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
    <a class="nav-link" href="#manuals" onclick="return navTo('manuals')">๐ ุงูุฏููู ุงูุฅุฏุงุฑู</a>
    <a class="nav-link" href="#leadership" onclick="return navTo('leadership')">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ (LD)</a>
    <a class="nav-link" href="#committees" onclick="return navTo('committees')">๐ฅ ุงููุฌุงู ุงูุฑุณููุฉ</a>
    <a class="nav-link" href="#rm" onclick="return navTo('rm')">โ๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</a>
    <a class="nav-link" href="#fms" onclick="return navTo('fms')">๐๏ธ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</a>
    <a class="nav-link" href="#psc" onclick="return navTo('psc')">โค๏ธ ุณูุงูุฉ ุงููุฑุถู (PSC)</a>
    <a class="nav-link" href="#ipc" onclick="return navTo('ipc')">๐งผ ููุงูุญุฉ ุงูุนุฏูู (IPC)</a>
    <a class="nav-link" href="#qi" onclick="return navTo('qi')">๐ ุงูุฌูุฏุฉ ูุงูุชุญุณูู (QI)</a>
    <a class="nav-link" href="#eoc" onclick="return navTo('eoc')">๐จ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</a>
    <a class="nav-link" href="#complaints" onclick="return navTo('complaints')">๐ข ุจูุงุบุงุช / ุดูุงูู ุงููุฑุถู</a>
    <a class="nav-link" href="#training" onclick="return navTo('training')">
  ๐ ุณุฌู ุงูุชุฏุฑูุจ
</a>
    <a class="nav-link" target="_blank" href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922#gid=597653922">๐๏ธ ุงูุณุฌู ุงูุฅููุชุฑููู (Google Sheet)</a>
  </aside> 
  <!-- Main Content -->
  <main class="flex-1 p-6 space-y-8">
    <!-- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ -->
    <section id="home" class="content-section active">
      <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)] mb-3">๐ ุงูุฑุณุงูุฉ (Mission Statement)</h2>
        <p class="text-gray-800 leading-8 text-lg">
          "ููุชุฒู ุจุชูุฏูู ุฑุนุงูุฉ ุตุญูุฉ ุฃูููุฉ ูุชุฎุตุตูุฉ ุขููุฉ ููุชูุญูุฑุฉ ุญูู ุงููุฑูุถ ูู ููุทูุฉ ููุฉ ุงูููุฑูุฉุ
          ูู ุฎูุงู ูุฑูู ุนูู ูุคูู ููุฑุงูู ูุชุทูุฑุฉุ ูุชุนุฒูุฒ ุตุญุฉ ุงููุฌุชูุน ูุงููุตูู ูุฃุนูู ูุณุชููุงุช ุงูุฌูุฏุฉ."
        </p>
        <div class="mt-4">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1YUE5GKeQmY3rrHk1j3dX3ztPAwX_3GdNjG9fB_fjPsQ/edit?usp=drive_link" title="ูุซููุฉ ุงูุฑุณุงูุฉุ ุงูุฑุคูุฉุ ูุงูููู ุงูููุนุชูุฏุฉ (LD.4.2)">
            <i class="fas fa-file-word"></i> ูุซููุฉ ุงูุฑุณุงูุฉุ ุงูุฑุคูุฉุ ูุงูููู ุงูููุนุชูุฏุฉ (LD.4.2)
          </a>
        </div>
      </div>
    </section>

    <!-- ุงูุฏููู ุงูุฅุฏุงุฑู -->
    <section id="manuals" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-5">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุงูุฏููู ุงูุฅุฏุงุฑู ูุงูุชูุธููู</h2>
        <div class="space-y-3">
          <div class="font-semibold">ุงูุฏููู ุงูุชูุธููู ุงููุฎุชุตุฑ:</div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
            <i class="fas fa-file"></i> ุงูุฏููู ุงูุชูุธููู ุงููุฎุชุตุฑ (ูุณุชูุฏ Google)
          </a>
        </div>
        <div class="space-y-3">
          <div class="font-semibold">ุงูุฏููู ุงูุฅุฏุงุฑู ุงูุชูุธููู ุงูุชูุตููู:</div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1hswi3r_fTUKQoVIj3lG9kEIQpFF7Ol7OLCXe3A45-Ao/edit?tab=t.0#heading=h.93zeqi5ae78k">
            <i class="fas fa-file-lines"></i> ุงูุฏููู ุงูุฅุฏุงุฑู ุงูุชูุธููู ุงูุชูุตููู (ูุณุชูุฏ Google)
          </a>
        </div>
      </div>
    </section>

    <!-- ุงูููุงุฏุฉ ูุงูุญูููุฉ -->
    <section id="leadership" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ (LD)</h2>
        <!-- ุจุทุงูุฉ ุงููุงุฆุฏ -->
        <div class="border rounded-xl p-5 flex items-center gap-4 bg-gradient-to-br from-[#fff] to-[#fff9f6]">
          <div class="h-14 w-14 rounded-full bg-gradient-to-br from-[var(--brand1)] to-[var(--brand2)] grid place-items-center text-white text-xl shadow">
            <i class="fas fa-user-tie"></i>
          </div>
          <div class="flex-1">
            <div class="text-lg font-extrabold text-gray-900">ุงููุงุฆุฏ/ุงููุฏูุฑ ุงูุนุงู: ุฏ. ุญุณูู ุจู ูุญูุฏ ุญุณู ุดูุฎ ุจุงุจุตูู</div>
            <div class="text-gray-600">ูุชุจุน ุฅุฏุงุฑููุง ููุฌูุณ ุงูุฅุฏุงุฑุฉ/ุงููุงูู ููุดุฑู ุนูู ุงูุฅุฏุงุฑุฉ ุงูุทุจูุฉุ ุงูุชูุฑูุถุ ุงูุฃูุณุงู ุงูุณุฑูุฑูุฉ ูุงูุฏุงุนูุฉ.</div>
          </div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1sZC9bpoqlOgJDN-akgPt5wYrpGC5bvdo-2VL7ZIKCvM/edit?tab=t.0" title="ูุฑุงุฑ ุงูุชุนููู">
            <i class="fas fa-file-signature"></i> ูุฑุงุฑ ุงูุชุนููู (LD)
          </a>
        </div>
        <!-- ุงูุฅุฏุงุฑุงุช ุงูุชูููุฐูุฉ -->
        <div>
          <h3 class="text-xl font-extrabold text-[var(--brand1)] mb-2">ุงูุฅุฏุงุฑุงุช ุงูุชูููุฐูุฉ (ุญุณุจ ุงูุนุฑุถ ุงููุนุชูุฏ)</h3>
          <div class="overflow-auto">
            <table class="table text-right">
              <thead>
                <tr>
                  <th>ุงููุณู</th>
                  <th>ุงููุฏูุฑ</th>
                  <th>ุงูููุงู ุงูุฃุณุงุณูุฉ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงูุฅุฏุงุฑูุฉ</td>
                  <td>ุฃ. ุจูุงู ูุชู</td>
                  <td>ุงูุชุดุบูู ุงูููููุ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉุ ุงูุชุฏุฑูุจุ ุงูุงุณุชูุจุงู ูุงูููุงุนูุฏ.</td>
                </tr>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงูุทุจูุฉ</td>
                  <td>ุฏ. ูุนุงุฐ ุงูุจููุด <span class="chip">ูุงุฆุจ: ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ</span></td>
                  <td>ุงูุฅุดุฑุงู ุนูู ุงูุนูุงุฏุงุช ูุงูุฎุฏูุงุช ุงูุณุฑูุฑูุฉ ูุฌูุฏุชูุง.</td>
                </tr>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ ูุงูุชุฃููู</td>
                  <td>ุฃ. ุตุงุจุฑ ุนุจุฏู</td>
                  <td>ุงูุญุณุงุจุงุชุ ุงููุทุงูุจุงุชุ ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุงูุฅูุฑุงุฏุ ุงูุชูุงุฑูุฑ ุงููุงููุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุตูุงูุฉ ูุงููุฑุงูู</td>
                  <td>ุฃ. ุนุฏูุงู ุงูุฑูุงุนู</td>
                  <td>ุงูุตูุงูุฉ ุงูููุงุฆูุฉุ ุงูุณูุงูุฉ ุงููุฑุงูููุฉุ ุงูุทูุงุฑุฆุ ุงููุดุชุฑูุงุช ุบูุฑ ุงูุทุจูุฉุ ุงููุธุงูุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุตูุฏููุฉ</td>
                  <td>ุฃ. ุนุจุฏุงููู ุญููุฏู</td>
                  <td>ุงูุตุฑู ุงูุฏูุงุฆู ุงูุขููุ ุถุจุท ุงูุฃุฏููุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉุ ุณูุณูุฉ ุงูุชุจุฑูุฏุ ุงููุฎุฒูู.</td>
                </tr>
                <tr>
                  <td>ุงููุฎุชุจุฑ</td>
                  <td>ุฃ. ููุซู ุงูุฌุนูู</td>
                  <td>ุถุจุท ุงูุฌูุฏุฉ ุงููุฎุจุฑูุฉุ ุณูุงูุฉ ุงูุนููุงุชุ ุงูุณูุงูุฉ ุงูุญูููุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุฃุดุนุฉ</td>
                  <td>ุฃ. ุจูุงู ูุชู</td>
                  <td>ุงูุฅุดุฑุงู ุงูููู ูุงูุฅุดุนุงุนู ููู ูุชุทูุจุงุช NRRC.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- ูุฑุงุฑ ุชุนููู ุงููุงุฏุฉ -->
        <div class="pt-2">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1LeyR6WnpUVth3hfr8UX2i5QKIHegA6RvKpkgEhfamA4/edit?usp=drive_link">
            <i class="fas fa-download"></i> ูุฑุงุฑ ุชุนููู ุงููุงุฏุฉ โ ูุณุฎุฉ ููุทุจุงุนุฉ/ุงูุชูุฒูู
          </a>
        </div>
      </div>
    </section>

    <!-- ุงููุฌุงู ุงูุฑุณููุฉ -->
    <section id="committees" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-5">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ฅ ุงููุฌุงู ุงูุฑุณููุฉ (ุญุณุจ ุณุจุงูู)</h2>
        <div class="overflow-auto">
          <table class="table text-right">
            <thead>
              <tr>
                <th>ุงูุฑูุฒ</th>
                <th>ุงุณู ุงููุฌูุฉ</th>
                <th>ุงูุฑุฆูุณ</th>
                <th>ุงูููุณู/ุงูุณูุฑุชูุฑ + ุงูุฃุนุถุงุก</th>
                <th>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="chip">RM</span></td>
                <td>ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</td>
                <td>ุฏ. ุญุณูู ุจุงุจุตูู</td>
                <td>ุงูููุณู/ุงูุณูุฑุชูุฑ: ุฃ. ุนุฏูุงู ุงูุฑูุงุนู โ ุงูุฃุนุถุงุก: ุจูุงูุ ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏ</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">FMS</span></td>
                <td>ูุฌูุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู</td>
                <td>ุฃ. ุตุงุจุฑ ุนุจุฏู</td>
                <td>ููุณู ุงูุชุฏุฑูุจ: ุฃ. ุจูุงู ูุชู โ ุงูุฃุนุถุงุก: ุนุฏูุงู ุงูุฑูุงุนูุ ุฎุงูุฏ ุงูุฎุทูุจุ ููุฏูุจ ูู ุงูุฃูู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">PSC</span></td>
                <td>ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู</td>
                <td>ุฏ. ูุนุงุฐ ุงูุจููุด</td>
                <td>ูุงุฆุจ ุงูุฑุฆูุณ: ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ โ ุงูุฃุนุถุงุก: ุฏ. ุญุณููุ ููุซูุ ุจูุงู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">IPC</span></td>
                <td>ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู</td>
                <td>ุฏ. ูุฌุฏู ุนุณูุฑ</td>
                <td>ุงูุฃุนุถุงุก: ุฎุงูุฏุ ุงูุชูุฑูุถุ ุงููุฎุชุจุฑุ ุงูุชุนููู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">QI</span></td>
                <td>ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ</td>
                <td>ุฏ. ุญุณูู ุจุงุจุตูู</td>
                <td>ุงูุฃุนุถุงุก: ููุซููู ูู ุงูุฃูุณุงู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุฑุจุน ุณููู</td>
              </tr>
              <tr>
                <td><span class="chip">EOC</span></td>
                <td>ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ</td>
                <td>ุฃ. ุจูุงู ูุชู</td>
                <td>ุงูุฃุนุถุงุก: ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏุ ุงูุฃููุ ุงูุชูุฑูุถ</td>
                <td>ูุตู ุณููู</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pt-2">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
            <i class="fas fa-file"></i> ุชูุงุตูู ุงููุฌุงู โ ูุณุฎุฉ ูู ุงููุณุชูุฏ (Google Doc)
          </a>
        </div>
      </div>
    </section>
    <!-- ูุณู ุงูุดูุงูู / ุจูุงุบุงุช ุงููุฑุถู -->
<section id="complaints" class="content-section">
  <div class="bg-white rounded-xl shadow p-6 space-y-6">
    <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ข ุจูุงุบุงุช / ุดูุงูู ุงููุฑุถู</h2>
    <p class="text-gray-700 leading-7">
      ูููู ูู ููุง ุงููุตูู ุฅูู ุงูููุงุฐุฌ ุงููุฎุตุตุฉ ูุชุณุฌูู ุงูุจูุงุบุงุช ุฃู ุงูุดูุงูู ุถูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM):
    </p>

<!-- ูุณู ุฎูุงุฑุงุช ุงูุฅุจูุงุบ ุงููุทูุฑ -->
<section class="max-w-4xl mx-auto text-center mt-10 space-y-6">
  <h2 class="text-2xl font-bold text-[var(--maroon)]">โ๏ธ ุงุฎุชุฑ ููุน ุงูุจูุงุบ ุงูุฐู ุชุฑุบุจ ูู ุชูุฏููู</h2>
  <p class="text-gray-700">ููููู ุงุฎุชูุงุฑ ุงููููุฐุฌ ุงูููุงุณุจ ูุชุณุฌูู ุงูุญูุงุฏุซ ุฃู ุงูุชุนุฑุถุงุช ุฃู ุงูุดูุงูู ุถูู ูุธุงู ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM):</p>

  <div class="grid md:grid-cols-2 gap-6 mt-6">
    <!-- ุฒุฑ ุงูุจูุงุบ ุงูุนุงู -->
    <a href="https://www.m2020m.org/report.html" target="_blank"
       class="p-6 bg-[var(--gold)] text-black rounded-xl shadow hover:bg-[#f5d97a] transition text-xl font-semibold">
       ๐งพ ุฅุจูุงุบ ุญุงุฏุซ / ุดููู ุนุงูุฉ
       <p class="text-sm mt-1 text-gray-700">ูุชุญ ุงููููุฐุฌ ูู ุตูุญุฉ ุฌุฏูุฏุฉ</p>
    </a>

    <!-- ุฒุฑ ุจูุงุบ ุงูุฅุจุฑ / ุงูุฏู -->
    <a href="https://www.m2020m.org/ipc/incidents/report-needlestick.html" target="_blank"
       class="p-6 bg-[var(--maroon)] text-white rounded-xl shadow hover:bg-[#8b2a2a] transition text-xl font-semibold">
       ๐ ุฅุจูุงุบ ุชุนุฑุถ ูุฎุฒู / ุฏููู / ุฃุบุดูุฉ ูุฎุงุทูุฉ
       <p class="text-sm mt-1 text-gray-200">ูุชุญ ุงููููุฐุฌ ูู ุตูุญุฉ ุฌุฏูุฏุฉ</p>
    </a>
  </div>

  <!-- ูุณู ุงูุณุฌูุงุช -->
  <div class="mt-10 border-t pt-6">
    <h3 class="text-xl font-semibold text-[var(--maroon)] mb-4">๐ ุณุฌูุงุช ุงูุจูุงุบุงุช ุงูุฅููุชุฑูููุฉ</h3>
    <div class="grid md:grid-cols-2 gap-6">
      <!-- ุณุฌู ุงูุดูุงูู ุงูุนุงูุฉ -->
      <a href="https://docs.google.com/spreadsheets/d/1zVzjvVBh8F7Gvut0kX8fTq2GyKrYo3fBop8jUBEsV3Q/edit?usp=sharing" 
         target="_blank"
         class="p-4 bg-gray-100 hover:bg-gray-200 rounded-lg shadow text-[var(--maroon)] font-semibold">
         ๐๏ธ ุนุฑุถ ุณุฌู ุจูุงุบุงุช / ุงูุดูุงูู (Google Sheet)
      </a>

      <!-- ุณุฌู ุฅุตุงุจุงุช ุงูุฅุจุฑ -->
      <a href="https://docs.google.com/spreadsheets/d/11ASpiUe6GTW4siaoPGnjqG3xKMeUdCmxPsTSbPTu9xw/edit?gid=0#gid=0" 
         target="_blank"
         class="p-4 bg-gray-100 hover:bg-gray-200 rounded-lg shadow text-[var(--maroon)] font-semibold">
         ๐ ุนุฑุถ ุณุฌู ุฅุตุงุจุงุช ุงูุฅุจุฑ / ุงูุชุนุฑุถุงุช (Google Sheet)
      </a>
    </div>
  </div>
</section>

      <a href="https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/view" target="_blank" class="p-4 border rounded-xl bg-gray-50 hover:bg-gray-100 transition flex items-center gap-3">
        <div class="h-12 w-12 rounded-full bg-yellow-100 grid place-items-center text-yellow-600 text-xl">
          <i class="fas fa-file-lines"></i>
        </div>
        <div>
          <div class="font-bold">ูููุฐุฌ ุจูุงุบ ุญุงุฏุซ (Incident Report)</div>
          <div class="text-sm text-gray-600">ูุณุฎุฉ PDF ุฌุงูุฒุฉ ููุทุจุงุนุฉ</div>
        </div>
      </a>
    </div>

    <div class="pt-2">
      <a href="https://docs.google.com/spreadsheets/d/1z-TjG3wK2PWFcX7L_JNum1G4VbXk9YNOvckEox6ayec/edit?gid=1291256589#gid=1291256589" 
         target="_blank" 
         class="gold-link">
        <i class="fas fa-database"></i> ุนุฑุถ ุณุฌู ุงูุจูุงุบุงุช / ุงูุดูุงูู (Google Sheet)
      </a>
    </div>
</section>
    <!-- ุณุฌู ุงูุชุฏุฑูุจ ุงูุนุงู ูููุฌุงู -->
<section id="training" class="content-section">
  <div class="bg-white rounded-xl shadow p-6 space-y-6">
    <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุณุฌู ุงูุชุฏุฑูุจ ุงูุนุงู ูููุฌุงู</h2>
    <a href="https://docs.google.com/spreadsheets/d/1z-TjG3wK2PWFcX7L_JNum1G4VbXk9YNOvckEox6ayec/edit?gid=1291256589#gid=1291256589" 
   target="_blank" 
   class="gold-link">
   <i class="fas fa-database"></i> ุนุฑุถ ุณุฌู ุงูุชุฏุฑูุจ ูู Google Sheet
</a>
    <form id="trainingForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold mb-1">ุงุฎุชุฑ ุงููุฌูุฉ *</label>
        <select name="committee_code" required class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงููุฌูุฉ</option>
          <option value="RM">RM โ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</option>
          <option value="FMS">FMS โ ุงูุณูุงูุฉ ูุงููุฑุงูู</option>
          <option value="PSC">PSC โ ุณูุงูุฉ ุงููุฑุถู</option>
          <option value="IPC">IPC โ ููุงูุญุฉ ุงูุนุฏูู</option>
          <option value="QI">QI โ ุงูุฌูุฏุฉ ูุงูุชุญุณูู</option>
          <option value="EOC">EOC โ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ</option>
        </select>
      </div>

<div>
  <label class="block text-sm font-semibold mb-1">ููุถูุน ุงูุชุฏุฑูุจ *</label>
  <input type="text" name="training_topic" list="topics-list" required 
         class="w-full border rounded-lg px-3 py-2"
         placeholder="ุงูุชุจ ุฃู ุงุฎุชุฑ ุงูุจุฑูุงูุฌ ุงูุชุฏุฑูุจู">
  <datalist id="topics-list"></datalist>
</div>

      <div>
        <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุชุฏุฑูุจ *</label>
        <input type="date" name="training_date" required class="w-full border rounded-lg px-3 py-2">
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">ููุงู ุงูุชุฏุฑูุจ *</label>
        <input type="text" name="training_place" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุงุนุฉ ุฃู ุงููุณู">
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">ุงููุฏุฑุจ *</label>
        <input type="text" name="trainer_name" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุฏุฑุจ">
      </div>

      <div class="md:col-span-2 flex items-center gap-3 pt-2">
        <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">๐พ ุญูุธ ุงูุชุฏุฑูุจ</button>
        <span id="trainMsg" class="text-sm"></span>
      </div>
    </form>
  </div>
</section>
    <!-- ุงูุจุฑุงูุฌ ุงูุชุฏุฑูุจูุฉ ุงููุนุชูุฏุฉ -->
<section id="training_programs" class="content-section">
  <div class="bg-white rounded-xl shadow p-6 space-y-6">
    <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุงูุจุฑุงูุฌ ุงูุชุฏุฑูุจูุฉ ุงููุนุชูุฏุฉ (ุณุจุงูู)</h2>

    <!-- ุงุฎุชูุงุฑ ุงููุฌูุฉ -->
    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold mb-1">ุงุฎุชุฑ ุงููุฌูุฉ *</label>
        <select id="committeeSelect" class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงููุฌูุฉ</option>
          <option value="RM">RM โ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</option>
          <option value="FMS">FMS โ ุงูุณูุงูุฉ ูุงููุฑุงูู</option>
          <option value="PSC">PSC โ ุณูุงูุฉ ุงููุฑุถู</option>
          <option value="IPC">IPC โ ููุงูุญุฉ ุงูุนุฏูู</option>
          <option value="QI">QI โ ุงูุฌูุฏุฉ ูุงูุชุญุณูู</option>
          <option value="EOC">EOC โ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-semibold mb-1">ุงุฎุชุฑ ุงูุจุฑูุงูุฌ *</label>
        <select id="programSelect" class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงูุจุฑูุงูุฌ ุงูุชุฏุฑูุจู</option>
        </select>
      </div>
    </div>
<!-- ุฒุฑ ุชุตุฏูุฑ PDF (ุฌุฏูุฏ) -->
<div class="flex items-center gap-3">
  <button id="exportPDF" type="button"
          class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">
    ๐จ๏ธ ุชุตุฏูุฑ ุงูุจุฑูุงูุฌ ูู PDF
  </button>
  <span class="text-sm text-gray-600">ุณูุชู ุฅูุดุงุก PDF ุจูุงุกู ุนูู ุงุฎุชูุงุฑ ุงููุฌูุฉ ูุงูุจุฑูุงูุฌ ุฃุนูุงู</span>
</div>


    <!-- ุชูุงุตูู ุงูุจุฑูุงูุฌ -->
    <div id="programDetails" class="hidden border rounded-xl p-4 bg-gray-50 space-y-3">
      <div><strong>๐ ุงูุชูุฑุงุฑ:</strong> <span id="progFrequency"></span></div>
      <div><strong>๐ ุงููุตู:</strong> <span id="progDescription"></span></div>
      <div><strong>๐ ููุน ุงูููู:</strong> <span id="progFileType"></span></div>

      <a id="programLink" href="#" target="_blank"
         class="gold-link inline-flex items-center gap-2">
        <i class="fas fa-chalkboard-teacher"></i> ูุชุญ ุงูุนุฑุถ ุงูุชุฏุฑูุจู
      </a>
    </div>
  </div>
</section>
    <!-- ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM) -->
<section id="rm" class="content-section">
  <div class="bg-white rounded-xl shadow p-6 space-y-6">

    <div class="flex flex-wrap items-center justify-between gap-3">
      <h2 class="text-2xl font-extrabold text-[var(--brand1)]">โ๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</h2>
    </div>

    <div class="border rounded-xl p-4">
      <h3 class="font-extrabold text-[var(--brand1)] mb-3">๐ ููุชุจุฉ ุงูุฃุฏูุฉ ุงูุฃุณุงุณูุฉ</h3>
      <div id="rmLib">
        </div>
    </div>

    <div class="border rounded-xl p-4">
     
    </div>
  </div>
</section>
<!-- ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS) -->
<section id="fms" class="content-section">
  <div class="bg-white rounded-xl shadow p-6 space-y-6">
    <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐๏ธ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</h2>

    <!-- ุชุจููุจุงุช -->
<!-- ุชุจููุจุงุช (ุชุฑุชูุจ ุฌุฏูุฏ) -->
<div id="fmsTabs" class="flex flex-wrap gap-2 border-b pb-3" role="tablist" aria-label="ุชุจููุจุงุช FMS">
  <button type="button"
          id="fms-tab-library"
          aria-controls="fmsTabContent"
          class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white"
          data-fms-tab="library"
          onclick="switchFmsTab('library')"
          role="tab" aria-selected="true">๐ ููุชุจุฉ ุงููุซุงุฆู</button>

  <button type="button"
          id="fms-tab-rounds"
          aria-controls="fmsTabContent"
          class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200"
          data-fms-tab="rounds"
          onclick="switchFmsTab('rounds')"
          role="tab" aria-selected="false">๐ ุชุณุฌูู ุฌููุฉ ุณูุงูุฉ</button>

  <button type="button"
          id="fms-tab-calibration"
          aria-controls="fmsTabContent"
          class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200"
          data-fms-tab="calibration"
          onclick="switchFmsTab('calibration')"
          role="tab" aria-selected="false">๐งช ูุนุงูุฑุฉ ุงูุฃุฌูุฒุฉ (CAL)</button>

  <button type="button"
          id="fms-tab-needs"
          aria-controls="fmsTabContent"
          class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200"
          data-fms-tab="needs"
          onclick="switchFmsTab('needs')"
          role="tab" aria-selected="false">โ ูุชุทูุจุงุช ุณุจุงูู</button>

</div>


    <div id="fmsTabContent" class="pt-4"></div>
  </div>
</section>


    <!-- ุณูุงูุฉ ุงููุฑุถู (PSC) -->
    <section id="psc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">โค๏ธ ุณูุงูุฉ ุงููุฑุถู (PSC)</h2>
          <div class="flex gap-2">
            <a href="https://www.m2020m.org/report.html" target="_blank" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
              <i class="fas fa-bullhorn ml-2"></i> ุงูุฅุจูุงุบ ุนู ุญุงุฏุซ
            </a>
          </div>
        </div>

        <!-- ุชุจููุจุงุช PSC -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-psc-tab="library" onclick="switchPscTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="indicators" onclick="switchPscTab('indicators')">๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="reporting" onclick="switchPscTab('reporting')">๐ ููุงุฐุฌ ุงูุฅุจูุงุบ</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="needs" onclick="switchPscTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู</button>
        </div>

        <!-- ูุญุชูู ุชุจููุจุงุช PSC -->
        <div id="pscTabContent"></div>
      </div>
    </section>

    <!-- ููุงูุญุฉ ุงูุนุฏูู (IPC) -->
    <section id="ipc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐งผ ููุงูุญุฉ ุงูุนุฏูู (IPC)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md border" onclick="ipcShowSecurity()">๐ ุฅุนุฏุงุฏ ุงูุฃูุงู (ุงุฎุชูุงุฑู)</button>
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="ipcExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช IPC (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="ipcImportInput" type="file" accept="application/json" class="hidden" onchange="ipcImportAll(this.files[0])">
            </label>
          </div>
        </div>
<!-- ุจุนุฏ: ุชุจููุจุงุช ุนููุฏูุฉ ูููููุง + ูุญุชูู ูุณุงุฑูุง -->
<div class="md:grid md:grid-cols-12 md:gap-4">
  <!-- ุนููุฏ ุงูุชุจููุจุงุช -->
  <aside class="md:col-span-3">
    <nav class="flex md:flex-col gap-2" id="ipcTabList">
      <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white w-full text-right"
              data-ipc-tab="library" onclick="switchIpcTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
      <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 w-full text-right"
              data-ipc-tab="surveillance" onclick="switchIpcTab('surveillance')">๐ ุงููุฑุงูุจุฉ ูุงููุคุดุฑุงุช</button>
      <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 w-full text-right"
              data-ipc-tab="forms" onclick="switchIpcTab('forms')">๐ ููุงุฐุฌ ุงูุฅุฏุฎุงู</button>
      <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200 w-full text-right"
              data-ipc-tab="needs" onclick="switchIpcTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู</button>
    </nav>
  </aside>
  <!-- ุนููุฏ ุงููุญุชูู -->
  <section class="md:col-span-9" id="ipcTabContent"></section>
</div>
</section>

    <!-- ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI) -->
    <section id="qi" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="qiExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช QI (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="qiImportInput" type="file" accept="application/json" class="hidden" onchange="qiImportAll(this.files[0])">
            </label>
          </div>
        </div>

        <!-- ุชุจููุจุงุช QI -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-qi-tab="library" onclick="switchQiTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" id="qi-tab-indicators" role="tab" aria-controls="qiTabContent" data-qi-tab="indicators" onclick="switchQiTab('indicators')">๐ ููุญุฉ ุงููุคุดุฑุงุช</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" id="qi-tab-forms" role="tab" aria-controls="qiTabContent" data-qi-tab="forms" onclick="switchQiTab('forms')"
>๐ ูุดุงุฑูุน ุงูุชุญุณูู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-qi-tab="needs" onclick="switchQiTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู (QI)</button>
        </div>
        <div id="qiTabContent"></div>
      </div>
    </section>

    <!-- ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC) -->
    <section id="eoc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐จ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="eocExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช EOC (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="eocImportInput" type="file" accept="application/json" class="hidden" onchange="eocImportAll(this.files[0])">
            </label>
          </div>
        </div>

        <!-- ุชุจููุจุงุช EOC -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-eoc-tab="library" onclick="switchEocTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" id="eoc-tab-forms" role="tab" aria-controls="eocTabContent" data-eoc-tab="forms" onclick="switchEocTab('forms')"
>๐โโ๏ธ ุงูุชูุงุฑูู ูุงูุฅุฎูุงุกุงุช</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" id="eoc-tab-plans" role="tab" aria-controls="eocTabContent" data-eoc-tab="plans" onclick="switchEocTab('plans')"
>๐ก๏ธ ุชูููู ุงูุฌุงูุฒูุฉ</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-eoc-tab="needs" onclick="switchEocTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู (EOC)</button>
        </div>
        <div id="eocTabContent"></div>
      </div>
    </section>
  </main>
</div>

<!-- Scroll to top -->
<button id="scrollTopBtn" title="ุฅูู ุงูุฃุนูู" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Document Modal -->
<div id="docModal" class="modal" role="dialog" aria-modal="true">
  <div class="panel">
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between px-4 py-3 border-b bg-gray-50">
        <div class="font-bold text-[var(--brand1)]" id="docTitle">ุนุฑุถ ุงููุซููุฉ</div>
        <button class="text-2xl" onclick="closeDocModal()">&times;</button>
      </div>
      <iframe id="docFrame" class="w-full flex-1 border-0" src="about:blank" allowfullscreen loading="lazy"></iframe>
    </div>
  </div>
</div>

<script>
// ====== ุงูุฏูุงู ุงูุฃุณุงุณูุฉ - ุชุนุฑูููุง ุฃููุงู ======
function navTo(sectionId){
  // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู
  document.querySelectorAll('.content-section').forEach(section => {
    section.classList.remove('active');
  });
  
  // ุฅุฒุงูุฉ ุงููุดุท ูู ุฌููุน ุงูุฑูุงุจุท
  document.querySelectorAll('.nav-link').forEach(link => {
    link.classList.remove('active');
  });
  
  // ุฅุธูุงุฑ ุงููุณู ุงููุทููุจ
  const targetSection = document.getElementById(sectionId);
  if (targetSection) {
    targetSection.classList.add('active');
    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
  
  // ุชุนููู ุงูุฑุงุจุท ููุดุท
 // ุตุญูุญ
const activeLink = document.querySelector(`.nav-link[href="#${sectionId}"]`);
  if (activeLink) {
    activeLink.classList.add('active');
  }
  // ุชููุฆุฉ ุงูุฃูุณุงู ุฅุฐุง ูุฒู ุงูุฃูุฑ
  if (sectionId === 'fms') {
    const fmsContent = document.getElementById('fmsTabContent');
    if (fmsContent && fmsContent.innerHTML.trim() === '') {
      switchFmsTab('library');
    }
  }
  
  if (sectionId === 'psc') {
    const pscContent = document.getElementById('pscTabContent');
    if (pscContent && pscContent.innerHTML.trim() === '') {
      switchPscTab('library');
    }
  }
  
  if (sectionId === 'ipc') {
    const ipcContent = document.getElementById('ipcTabContent');
    if (ipcContent && ipcContent.innerHTML.trim() === '') {
      switchIpcTab('library');
    }
  }
  
  if (sectionId === 'qi') {
    const qiContent = document.getElementById('qiTabContent');
    if (qiContent && qiContent.innerHTML.trim() === '') {
      switchQiTab('library');
    }
  }
  
  if (sectionId === 'eoc') {
    const eocContent = document.getElementById('eocTabContent');
    if (eocContent && eocContent.innerHTML.trim() === '') {
      switchEocTab('library');
    }
  }
if (sectionId === 'rm') {
  const rmLib = document.getElementById('rmLib');
  if (rmLib && rmLib.innerHTML.trim() === '') {
    renderRMLibrary();
  }
}

  return false;
}
// ====== ุนุฑุถ ุงููุซููุฉ ูู ุงูููุฏุงู ุจุฏูู ูุดุงูู Google Cookies ======
function openDocModal(title, previewUrl) {
  const modal = document.getElementById('docModal');
  const titleEl = document.getElementById('docTitle');
  const frame = document.getElementById('docFrame');

  titleEl.textContent = title;

  let safeUrl = previewUrl;
  let fileId = '';
  const match1 = previewUrl.match(/\/d\/([a-zA-Z0-9_-]+)/);
  const match2 = previewUrl.match(/id=([a-zA-Z0-9_-]+)/);
  if (match1) fileId = match1[1];
  else if (match2) fileId = match2[1];
  if (fileId) safeUrl = `https://drive.google.com/file/d/${fileId}/preview`;

  frame.src = safeUrl;

  modal.classList.add('open');
  modal.style.display = 'flex';
  document.body.style.overflow = 'hidden'; // ููุน ุชูุฑูุฑ ุงูุฎูููุฉ

  // ุชุฑููุฒ ุนูู ุฒุฑ ุงูุฅุบูุงู ูุณูููุฉ ุงููุตูู
  const closeBtn = modal.querySelector('button');
  closeBtn && closeBtn.focus();

  // ุฅุบูุงู ุนูุฏ ุงูุถุบุท ุนูู ESC
  function onKey(e){ if (e.key === 'Escape') closeDocModal(); }
  function onClick(e){ if (e.target === modal) closeDocModal(); }
  modal.dataset._esc = '1';
  document.addEventListener('keydown', onKey, { once:true });
  modal.addEventListener('click', onClick, { once:true });
}

function closeDocModal() {
  const modal = document.getElementById('docModal');
  const frame = document.getElementById('docFrame');
  frame.src = 'about:blank';
  modal.classList.remove('open');
  modal.style.display = 'none';
  document.body.style.overflow = ''; // ุฅุนุงุฏุฉ ุงูุชูุฑูุฑ
}

// ====== ุงูุฅุนุฏุงุฏุงุช ======


const CAL_API_URL = 'https://script.google.com/macros/s/AKfycbx9HEbtU9_lpshSkOEf5DZRQfOyYogi2NSDboqe4vGGlGsxbyiB1Fp46x_WoW7C-SPOhg/exec';
const CAL_API_TOKEN = 'Makkah7321@'; // ๐ ุถุน ููุง ููุณ ุงูุชููู ุงูููุฌูุฏ ูู Script Properties ุฏุงุฎู Apps Script
const CAL_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1HPQIlhnvynNKctQLgINtVc3OK8Ey4RX52dYdmlIT9F8/edit?gid=1186914285#gid=1186914285'; // โุณุฌู ูุนุงูุฑุฉ ุงูุฃุฌูุฒุฉโ
const FMS_API_URL = CAL_API_URL;  // ูููู ุงุณุชุฎุฏุงูู ูุคูุชูุง ูููุณ ุงูุนููุงู
const TRAIN_API_URL = 'https://script.google.com/macros/s/AKfycbyhFeodenLqh4EUTqeBUYkJsgk6TtU0QQ_I_zB8_dZ31w3kavPi83GFBLv9tQ1qz8IL/exec';

// ====== ุฏูุงู ุฅุฏุงุฑุฉ ุงูุดุนุงุฑ ======
function setupLogoChange() {
  const logoPicker = document.getElementById('logoPicker');
  const btnSetLogo = document.getElementById('btnSetLogo');
  
  if (btnSetLogo && logoPicker) {
    btnSetLogo.addEventListener('click', function() {
      logoPicker.click();
    });
    
    logoPicker.addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          const imageDataUrl = e.target.result;
          
          const logoSmall = document.getElementById('logoSmall');
          if (logoSmall) {
            logoSmall.src = imageDataUrl;
          }
          
          const logoHero = document.getElementById('logoHero');
          if (logoHero) {
            logoHero.src = imageDataUrl;
          }
          
          try {
            localStorage.setItem('customLogo', imageDataUrl);
          } catch (error) {
            console.log('ูุง ูููู ุญูุธ ุงูุดุนุงุฑ ูู ุงูุชุฎุฒูู ุงููุญูู');
          }
        };
        
        reader.readAsDataURL(file);
      }
    });
  }
}

function loadSavedLogo() {
  try {
    const savedLogo = localStorage.getItem('customLogo');
    if (savedLogo) {
      const logoSmall = document.getElementById('logoSmall');
      const logoHero = document.getElementById('logoHero');
      
      if (logoSmall) logoSmall.src = savedLogo;
      if (logoHero) logoHero.src = savedLogo;
    }
  } catch (error) {
    console.log('ูุง ูููู ุชุญููู ุงูุดุนุงุฑ ุงููุญููุธ');
  }
}

// ====== ููุชุจุฉ ูุซุงุฆู RM - ูุตุญุญุฉ ======
const RM_DOCS_ESSENTIAL = [
  { code:'LD.31', name:'ูุฑุงุฑ ุงุนุชูุงุฏ ุจุฑูุงูุฌ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (LD.31)', category:'DEC', url:'https://drive.google.com/file/d/1TYH87_v6rC2twWOZig2P5YDegRv6ir2dlYEU-v6KXwg/preview' },
  { code:'LD.31/32', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ูุณูุงูุฉ ุงููุฑุถู', category:'DEC', url:'https://drive.google.com/file/d/1yN0wiHu-mmNqFHF5XeEQIqOeMElIFSXn-xCz1AzAfco/preview' },
  { code:'LD.32', name:'ูุฑุงุฑ ุฅุฏุงุฑู ุจุงุนุชูุงุฏ ุณูุงุณุฉ ุงูุฅุจูุงุบ ุนู ุงูุญูุงุฏุซ/ุงูุดูุงูู', category:'POL', url:'https://drive.google.com/file/d/1irNRM1ovqwQEaEEj5gv9rmAuoV8O5aY-m0hSNykZDUk/preview' },
  { code:'IR', name:'ูููุฐุฌ ุจูุงุบ ุญุงุฏุซ (Incident Report)', category:'FRM', url:'https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/preview' },
  { code:'NM', name:'ูููุฐุฌ ุจูุงุบ ูุฑูุจ ูู ุงููููุน (Near Miss)', category:'FRM', url:'https://drive.google.com/file/d/1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0/preview' },
  { code:'UNSAFE', name:'ุจูุงุบ ุฎุทุฑ/ุดุฑุท ุบูุฑ ุขูู', category:'FRM', url:'https://drive.google.com/file/d/1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I/preview' },
  { code:'DEVICE', name:'ุจูุงุบ ุนุทู ุฌูุงุฒ/ุชุฌููุฒ', category:'FRM', url:'https://drive.google.com/file/d/17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ/preview' },
  { code:'SE', name:'ุฅุฎุทุงุฑ ุญุฏุซ ุฌุณูู (Sentinel Event)', category:'FRM', url:'https://drive.google.com/file/d/1LrOlWxfECxyzF77DnerV15RjS-ElSTbIEa1UuKG3rD0/preview' },
  { code:'RCA/CAP', name:'ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู ูุฎุทุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ', category:'TOOL', url:'https://drive.google.com/file/d/1lDKsjgPDCdwXNV935kB_DfAm-ZsdzLPK8p4Pn7hgJJ0/preview' },
  { code:'HFMEA', name:'HFMEA (ุชุญููู ูุณุจู ูููุฎุงุทุฑ)', category:'TOOL', url:'https://drive.google.com/file/d/15ZjKLJYhe3HCUWbAO2Iw96IY1GOn1VNCWIjzdi9U4x8/preview' },
  { code:'REGISTER', name:'ุณุฌู ุงููุฎุงุทุฑ ุงููุคุณุณู', category:'LOG', url:'https://drive.google.com/file/d/1XVMRWRZKoTpmXPzrPdXJA7PWf9r88YwLYv_tptdiZAA/preview' },
  { code:'KPI', name:'ููุญุฉ ุงููุคุดุฑุงุช ุงูุดูุฑูุฉ ูุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ', category:'DASH', url:'https://drive.google.com/file/d/1pj8P8rf4TZj_wVKgLrO8ayP9WNUBc1yTWeAy8r0xGOY/preview' },
  { code:'ESCALATION', name:'ููุญุฉ ุงุชุตุงูุงุช ูุณูุณูุฉ ุงูุชุตุนูุฏ', category:'REF', url:'https://drive.google.com/file/d/1dZrkUB_d1XblN3QonWxPt9F1LQ6xQIbyNFT4ixI2m64/preview' },
  { code:'LD.31-ALT', name:'LD31 (ูุณุฎุฉ ุฅุถุงููุฉ)', category:'DEC', url:'https://drive.google.com/file/d/1AEtBJgibYuSxVD_bSZgAlFgODnadZcDMTZaKle3pnYg/preview' },
  { code:'LD.32-ALT', name:'LD32 (ูุณุฎุฉ ุฅุถุงููุฉ)', category:'POL', url:'https://drive.google.com/file/d/1x6R5DKODJ1MKghpPEnaR-1GIohAEILzmY6VNgAPgzAE/preview' },
  { code:'ACT-RM-2025-001', name:'ุนุฑุถ ุงููุดุงูู ูุฎุทุฉ ุงูุญููู (Risk Issues & CAP)', category:'REP', url:'https://drive.google.com/file/d/1ZUBOoQgVbf41pcBxmU5iyoJzddd9e8JJDJ1Z2dekLfY/preview' }
];


// ====== ูุคุดุฑุงุช PSC ======
const PSC_KPI_DATA = [
  { ุงูุดูุฑ: 'ููุงูุฑ', ุชุนุฑูู_ุงููุฑูุถ: 98, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 85, ุฃุฎุทุงุก_ุฏูุงุก: 5.2, ุณููุท: 3.1, ุจูุงุบุงุช_ูุฑูุจุฉ: 12 },
  { ุงูุดูุฑ: 'ูุจุฑุงูุฑ', ุชุนุฑูู_ุงููุฑูุถ: 99, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 82, ุฃุฎุทุงุก_ุฏูุงุก: 6.1, ุณููุท: 3.5, ุจูุงุบุงุช_ูุฑูุจุฉ: 8 },
  { ุงูุดูุฑ: 'ูุงุฑุณ', ุชุนุฑูู_ุงููุฑูุถ: 92, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 88, ุฃุฎุทุงุก_ุฏูุงุก: 8.5, ุณููุท: 4.8, ุจูุงุบุงุช_ูุฑูุจุฉ: 15 },
  { ุงูุดูุฑ: 'ุฃุจุฑูู', ุชุนุฑูู_ุงููุฑูุถ: 99, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 95, ุฃุฎุทุงุก_ุฏูุงุก: 4.0, ุณููุท: 3.0, ุจูุงุบุงุช_ูุฑูุจุฉ: 35 },
  { ุงูุดูุฑ: 'ูุงูู', ุชุนุฑูู_ุงููุฑูุถ: 100, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 96, ุฃุฎุทุงุก_ุฏูุงุก: 3.5, ุณููุท: 2.9, ุจูุงุบุงุช_ูุฑูุจุฉ: 28 },
];

// ====== ููุชุจุฉ RM ุงูุฃุณุงุณูุฉ ======
// ====== ููุชุจุฉ RM ุงูุฃุณุงุณูุฉ (ููุณูุฉ ุจุงูุนุฑุจูุฉ) ======
function renderRMLibrary() {
  const mount = document.getElementById('rmLib');
  if (!mount) return;

  const categoriesMap = {
    DEC: 'ุงููุฑุงุฑุงุช',
    POL: 'ุงูุณูุงุณุงุช',
    FRM: 'ุงูููุงุฐุฌ',
    TOOL: 'ุงูุฃุฏูุงุช',
    LOG: 'ุงูุณุฌูุงุช',
    REP: 'ุงูุชูุงุฑูุฑ',
    DASH: 'ููุญุงุช ุงูููุงุฏุฉ',
    REF: 'ุงููุฑุงุฌุน'
  };

  mount.innerHTML = `
    <div class="flex flex-wrap items-center gap-2 mb-3">
      <button data-rm="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
      ${Object.entries(categoriesMap).map(([key, name]) =>
        `<button data-rm="${key}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${name}</button>`
      ).join('')}
      <div class="ml-auto w-full md:w-64">
        <input id="rmSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    </div>
    <div id="rmGrid" class="grid-cards"></div>
  `;

  const grid = mount.querySelector('#rmGrid');

  function renderRMItems(filter = 'ALL', query = '') {
    grid.innerHTML = '';
    const searchQuery = query.toLowerCase();

    const filtered = RM_DOCS_ESSENTIAL.filter(doc => {
      const matchesFilter = filter === 'ALL' || doc.category === filter;
      const matchesQuery = !searchQuery || doc.name.toLowerCase().includes(searchQuery) || doc.code.toLowerCase().includes(searchQuery);
      return matchesFilter && matchesQuery;
    });

    if (filtered.length === 0) {
      grid.innerHTML = `<p class="text-gray-500 text-center col-span-full">ูุง ุชูุฌุฏ ูุซุงุฆู ูุทุงุจูุฉ ููุจุญุซ.</p>`;
      return;
    }

    filtered.forEach(doc => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
      card.innerHTML = `
        <div class="text-xs text-gray-500 mb-1">${categoriesMap[doc.category] || doc.category}</div>
        <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
        <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
        <div class="mt-3 flex gap-2">
          <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]"
                  onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
            <i class="fas fa-eye ml-1"></i> ุนุฑุถ
          </button>
          <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50"
             target="_blank" href="${doc.url.replace('/preview','/view')}">
            <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ
          </a>
        </div>
      `;
      grid.appendChild(card);
    });
  }

  // ุงูููุงุชุฑ
  mount.querySelectorAll('button[data-rm]').forEach(button => {
    button.addEventListener('click', () => {
      mount.querySelectorAll('button[data-rm]').forEach(btn => {
        btn.classList.remove('bg-[var(--brand1)]', 'text-white');
      });
      button.classList.add('bg-[var(--brand1)]', 'text-white');
      renderRMItems(button.getAttribute('data-rm'), mount.querySelector('#rmSearch').value);
    });
  });

  mount.querySelector('#rmSearch').addEventListener('input', e => {
    const activeFilter = mount.querySelector('button[data-rm].bg-[var(--brand1)]') || { getAttribute: () => 'ALL' };
    renderRMItems(activeFilter.getAttribute('data-rm'), e.target.value);
  });

  renderRMItems('ALL', '');
}

// ====== ููุชุจุฉ ูุซุงุฆู PSC ======
  const PSC_DOCS_LIBRARY = [
    { code:'POL-PSC-2025-001', name:'ุณูุงุณุฉ ุจุฑูุงูุฌ ุณูุงูุฉ ุงููุฑุถู', category:'POL', url:'https://drive.google.com/file/d/1FEdKvutCYqWXYwnp70OsjRO-CIzzmZU2CAFstiFVmMw/preview' },
    { code:'DEC-PSC-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'DEC', url:'https://drive.google.com/file/d/1Qz7s61wIuWh1RbSLbMyrzWB_GwoPnfwqhZQHMKpgeyc/preview' },
    { code:'CHT-PSC-2025-001', name:'ููุซุงู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'CHT', url:'https://drive.google.com/file/d/1pDDwB4Y-l7EQbwJpLH5o9PpCbdhTFQleai7PvU2Ltjg/preview' },
    { code:'POL-PSC-2025-003', name:'ุณูุงุณุฉ ุงูุชุนุฑู ุงููุฒุฏูุฌ ุนูู ุงููุฑูุถ', category:'POL', url:'https://drive.google.com/file/d/1yNGDW_yLN9OrguG-_lJzXKxk6y0rJfjfc7aONgQiNqQ/preview' },
    { code:'POL-PSC-2025-002', name:'ุณูุงุณุฉ ุงูุฅุจูุงุบ ูุงูุชุนูู ูู ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ', category:'POL', url:'https://drive.google.com/file/d/1VRoEZjXxeIoHlDvtmmus-NM-zNK-oARCh_8_u74S7c0/preview' },
    { code:'FRM-PSC-2025-001', name:'ูููุฐุฌ ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'FRM', url:'https://drive.google.com/file/d/1KVTIutS3sdWTYhc1ZB-p9J3fXDjEu-CajxwlYyocz44/preview' },
    { code:'CHK-PSC-2025-001', name:'ูููุฐุฌ ูุฑุงุฌุนุฉ ุชุนุฑูู ุงููุฑูุถ', category:'CHK', url:'https://drive.google.com/file/d/1oS_fO9mBIggmaXbPfaXB3H1YKyTlwgGfT8Hwbs9qi7E/preview' },
    { code:'CHK-PSC-2025-002', name:'ูุฑุงุฌุนุฉ ุฃุฏููุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉ', category:'CHK', url:'https://drive.google.com/file/d/1t4Pt6bkxp9ER5mnc3lcDqy_E5z3eMm9WTqilWIPAIBM/preview' },
    { code:'LOG-PSC-2025-001', name:'ุณุฌู ุงูุญูุงุฏุซ ูุณูุงูุฉ ุงููุฑุถู', category:'LOG', url:'https://drive.google.com/file/d/12SS-Nn_TpvIsIoUfdOPRzC_tgLqmb2hfZZi53_dSyVI/preview' },
    { code:'FRM-PSC-2025-002', name:'ูููุฐุฌ SBAR ููุชุณููู', category:'FRM', url:'https://drive.google.com/file/d/1JgEPxYvK6X_cQ7eroNCkymfUzbTCbzljqvrOKYKBw1g/preview' },
    { code:'FRM-PSC-2025-003', name:'ูููุฐุฌ PDSA ูุชุญุณูู ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/file/d/1XE45nGctQGK3WIFnUxE5CqsIZu8BdBLZuqOLgsZaPXk/preview' },
    { code:'FRM-PSC-2025-004', name:'ูููุฐุฌ ุฅุญุงูุฉ ููุฌูุฉ M&M', category:'FRM', url:'https://drive.google.com/file/d/1LbD4aaIcyIDPJi2Cn_J69OEnpeCF3XTFCjjDstr2ny8/preview' },
    { code:'REP-PSC-2025-001', name:'ุชูุฑูุฑ ูุคุดุฑุงุช ุณูุงูุฉ ุงููุฑุถู', category:'REP', url:'https://drive.google.com/file/d/1wZGnfGcj1O-329jBUXfPHXqA09k6VS58mpu4rNELS20/preview' },
    { code:'TRN-PSC-2025-001', name:'ุฎุทุฉ ุงูุชูุนูุฉ ูุงูุชุฏุฑูุจ', category:'TRN', url:'https://drive.google.com/file/d/1Ohj-mB-Jk3mmdrW9Lm6GNSojRJaT__GQpjO7aFG4twY/preview' },
    { code:'TRN-PSC-2025-002', name:'ุณุฌู ุญุถูุฑ ุชุฏุฑูุจ', category:'TRN', url:'https://drive.google.com/file/d/1Sgj_Qps21a3GoalpZAf-08b43UmL30GLUvY8UQqyxjg/preview' },
    { code:'TRN-PSC-2025-002B', name:'ุณุฌู ุญุถูุฑ ุชุฏุฑูุจ (ูุณุฎุฉ ุงููุณุชุฎุฏู)', category:'TRN', url:'https://drive.google.com/file/d/1GIOUPLH9AzWB0PKZiaV_NJoQwjkbzZLyaPkoaV1niC8/preview' }
  ];

  const PSC_CATEGORY_NAMES = {
    POL:'ุงูุณูุงุณุงุช', 
    DEC:'ุงููุฑุงุฑุงุช', 
    CHT:'ุงูููุซุงู',
    FRM:'ุงูููุงุฐุฌ', 
    CHK:'ููุงุฆู ุงูุชุญูู', 
    LOG:'ุงูุณุฌูุงุช', 
    REP:'ุงูุชูุงุฑูุฑ', 
    TRN:'ุงูุชุฏุฑูุจ'
  };

  // ====== ุฏูุงู PSC ======
  function switchPscTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-psc-tab]').forEach(button => {
      if (button.getAttribute('data-psc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('pscTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderPscLibrary(container, PSC_DOCS_LIBRARY);
    } else if (tab === 'indicators') {
      renderPscIndicators(container);
    } else if (tab === 'reporting') {
      renderPscReporting(container);
    } else if (tab === 'needs') {
      renderPscNeeds(container);
    } else if (tab === 'forms') {
      renderPscForms(container);
    }
  }

  function renderPscLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-psc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-psc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${PSC_CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="pscSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'pscGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${PSC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-psc-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-psc-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-psc-filter'), document.getElementById('pscSearch').value);
      });
    });
    
    document.getElementById('pscSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-psc-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-psc-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderPscIndicators(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ุฌุฏูู ุงููุคุดุฑุงุช
    const tableSection = document.createElement('div');
    tableSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูุคุดุฑุงุช ุณูุงูุฉ ุงููุฑุถู ุงูุดูุฑูุฉ</h3>
      <div class="overflow-auto">
        <table class="kpi-table">
          <thead>
            <tr>
              <th>ุงูุดูุฑ</th>
              <th>ุชุนุฑูู ุงููุฑูุถ %</th>
              <th>ุงูุชุฒุงู ุบุณู ุงููุฏูู %</th>
              <th>ุฃุฎุทุงุก ุฏูุงุฆูุฉ ููู 1000 ูุตูุฉ</th>
              <th>ุณููุท ููู 1000 ุฒูุงุฑุฉ</th>
              <th>ุจูุงุบุงุช ูุฑูุจุฉ ูู ุงููููุน</th>
            </tr>
          </thead>
          <tbody id="kpiTableBody"></tbody>
        </table>
      </div>
    `;
    
    // ูุฎุทุท ุจูุงูู ูุจุณุท
    const chartSection = document.createElement('div');
    chartSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ุชุทูุฑ ูุคุดุฑุงุช ุงูุณูุงูุฉ</h3>
      <div class="border rounded-xl p-4 bg-white">
        <div class="flex flex-wrap gap-4 mb-4">
          <button class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm" onclick="renderPscChart('ุชุนุฑูู_ุงููุฑูุถ')">ุชุนุฑูู ุงููุฑูุถ</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุงูุชุฒุงู_ุบุณู_ุงููุฏูู')">ุบุณู ุงููุฏูู</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุฃุฎุทุงุก_ุฏูุงุก')">ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุณููุท')">ูุนุฏู ุงูุณููุท</button>
        </div>
        <div id="pscChart" class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
          <p class="text-gray-500">ุงุฎุชุฑ ูุคุดุฑุงู ูุนุฑุถ ุงูุฑุณู ุงูุจูุงูู</p>
        </div>
      </div>
    `;
    
    wrapper.appendChild(tableSection);
    wrapper.appendChild(chartSection);
    container.appendChild(wrapper);
    
    // ููุก ุฌุฏูู ุงููุคุดุฑุงุช
    renderPscKpiTable();
  }

  function renderPscKpiTable() {
    const tableBody = document.getElementById('kpiTableBody');
    tableBody.innerHTML = '';
    
    PSC_KPI_DATA.forEach(row => {
      const tr = document.createElement('tr');
      
      // ุชุญุฏูุฏ ูุฆุงุช ุงูุฃููุงู ุจูุงุกู ุนูู ุงูููู
      const patientIdClass = row.ุชุนุฑูู_ุงููุฑูุถ >= 95 ? 'good' : row.ุชุนุฑูู_ุงููุฑูุถ >= 90 ? 'warning' : 'critical';
      const handHygieneClass = row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู >= 90 ? 'good' : row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู >= 80 ? 'warning' : 'critical';
      const medErrorsClass = row.ุฃุฎุทุงุก_ุฏูุงุก <= 4 ? 'good' : row.ุฃุฎุทุงุก_ุฏูุงุก <= 6 ? 'warning' : 'critical';
      const fallsClass = row.ุณููุท <= 3 ? 'good' : row.ุณููุท <= 4 ? 'warning' : 'critical';
      const nearMissClass = row.ุจูุงุบุงุช_ูุฑูุจุฉ >= 20 ? 'good' : row.ุจูุงุบุงุช_ูุฑูุจุฉ >= 10 ? 'warning' : 'critical';
      
      tr.innerHTML = `
        <td class="font-semibold">${row.ุงูุดูุฑ}</td>
        <td class="${patientIdClass}">${row.ุชุนุฑูู_ุงููุฑูุถ}%</td>
        <td class="${handHygieneClass}">${row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู}%</td>
        <td class="${medErrorsClass}">${row.ุฃุฎุทุงุก_ุฏูุงุก}</td>
        <td class="${fallsClass}">${row.ุณููุท}</td>
        <td class="${nearMissClass}">${row.ุจูุงุบุงุช_ูุฑูุจุฉ}</td>
      `;
      tableBody.appendChild(tr);
    });
  }

  function renderPscChart(indicator) {
    const chartContainer = document.getElementById('pscChart');
    const indicatorName = {
      'ุชุนุฑูู_ุงููุฑูุถ': 'ุชุนุฑูู ุงููุฑูุถ %',
      'ุงูุชุฒุงู_ุบุณู_ุงููุฏูู': 'ุงูุชุฒุงู ุบุณู ุงููุฏูู %', 
      'ุฃุฎุทุงุก_ุฏูุงุก': 'ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ',
      'ุณููุท': 'ูุนุฏู ุงูุณููุท'
    }[indicator];
    
    // ุฑุณู ุจูุงูู ูุจุณุท ุจุงุณุชุฎุฏุงู HTML ูCSS
    const maxValue = Math.max(...PSC_KPI_DATA.map(row => row[indicator]));
    const minValue = Math.min(...PSC_KPI_DATA.map(row => row[indicator]));
    
    let chartHTML = `
      <div class="w-full h-full p-4">
        <h4 class="text-center font-bold mb-4">${indicatorName}</h4>
        <div class="flex items-end justify-between h-40 gap-2">
    `;
    
    PSC_KPI_DATA.forEach((row, index) => {
      const value = row[indicator];
      const percentage = ((value - minValue) / (maxValue - minValue)) * 80 + 20;
      
      chartHTML += `
        <div class="flex flex-col items-center flex-1">
          <div class="text-xs mb-1">${row.ุงูุดูุฑ}</div>
          <div class="w-full bg-[var(--brand1)] rounded-t transition-all" style="height: ${percentage}%"></div>
          <div class="text-xs mt-1">${value}</div>
        </div>
      `;
    });
    
    chartHTML += `</div></div>`;
    chartContainer.innerHTML = chartHTML;
    
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงููุคุดุฑุงุช ุงููุดุทุฉ
    (document.getElementById('pscChart') && document.getElementById('pscChart').closest('.border') ? document.getElementById('pscChart').closest('.border').querySelectorAll('button') : []).forEach(btn => {
      btn.classList.remove('bg-[var(--brand1)]', 'text-white');
      btn.classList.add('bg-gray-200');
    });
    
    const activeButton = document.querySelector(`[onclick="renderPscChart('${indicator}')"]`);
    if (activeButton) {
      activeButton.classList.add('bg-[var(--brand1)]', 'text-white');
      activeButton.classList.remove('bg-gray-200');
    }
  }

  function renderPscReporting(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ููุงุฐุฌ ุงูุฅุจูุงุบ ุงูุณุฑูุน
    const quickReports = document.createElement('div');
    quickReports.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ููุงุฐุฌ ุงูุฅุจูุงุบ ุงูุณุฑูุน</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a href="https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-red-100 grid place-items-center text-red-600">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุญุงุฏุซ</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุญุฏุงุซ ุงูุณูุจูุฉ ุงูุชู ููุนุช</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-yellow-100 grid place-items-center text-yellow-600">
            <i class="fas fa-bullseye"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ูุฑูุจ ูู ุงููููุน</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุญุฏุงุซ ุงูุชู ูุงุฏุช ุชูุน</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-orange-100 grid place-items-center text-orange-600">
            <i class="fas fa-triangle-exclamation"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุฎุทุฑ/ุดุฑุท ุบูุฑ ุขูู</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงููุฎุงุทุฑ ุงููุญุชููุฉ</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-blue-100 grid place-items-center text-blue-600">
            <i class="fas fa-toolbox"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุนุทู ุฌูุงุฒ/ุชุฌููุฒ</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุนุทุงู ูู ุงูุฃุฌูุฒุฉ ุงูุทุจูุฉ</div>
          </div>
        </a>
      </div>
    `;
    
    // ูููุฐุฌ ุฅุฏุฎุงู ุจูุงูุงุช ุงููุคุดุฑุงุช
    const dataEntry = document.createElement('div');
    dataEntry.className = 'border rounded-xl p-4 bg-white';
    dataEntry.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">โ ุฅุฏุฎุงู ุจูุงูุงุช ูุคุดุฑ ุฌุฏูุฏ</h3>
      <form id="kpiForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุดูุฑ *</label>
          <select name="month" required class="w-full border rounded-lg px-3 py-2">
            <option value="">ุงุฎุชุฑ ุงูุดูุฑ</option>
            <option value="ููุงูุฑ">ููุงูุฑ</option>
            <option value="ูุจุฑุงูุฑ">ูุจุฑุงูุฑ</option>
            <option value="ูุงุฑุณ">ูุงุฑุณ</option>
            <option value="ุฃุจุฑูู">ุฃุจุฑูู</option>
            <option value="ูุงูู">ูุงูู</option>
            <option value="ููููู">ููููู</option>
            <option value="ููููู">ููููู</option>
            <option value="ุฃุบุณุทุณ">ุฃุบุณุทุณ</option>
            <option value="ุณุจุชูุจุฑ">ุณุจุชูุจุฑ</option>
            <option value="ุฃูุชูุจุฑ">ุฃูุชูุจุฑ</option>
            <option value="ููููุจุฑ">ููููุจุฑ</option>
            <option value="ุฏูุณูุจุฑ">ุฏูุณูุจุฑ</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุนุฑูู ุงููุฑูุถ % *</label>
          <input type="number" min="0" max="100" name="patient_id" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุณุจุฉ ุงููุฆููุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุชุฒุงู ุบุณู ุงููุฏูู % *</label>
          <input type="number" min="0" max="100" name="hand_hygiene" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุณุจุฉ ุงููุฆููุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ *</label>
          <input type="number" step="0.1" min="0" name="med_errors" required class="w-full border rounded-lg px-3 py-2" placeholder="ููู 1000 ูุตูุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ูุนุฏู ุงูุณููุท *</label>
          <input type="number" step="0.1" min="0" name="falls" required class="w-full border rounded-lg px-3 py-2" placeholder="ููู 1000 ุฒูุงุฑุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุจูุงุบุงุช ูุฑูุจุฉ ุงููููุน *</label>
          <input type="number" min="0" name="near_miss" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุนุฏุฏ">
        </div>
        <div class="md:col-span-2 flex items-center gap-3 pt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุจูุงูุงุช</button>
          <span id="kpiMsg" class="text-sm"></span>
        </div>
      </form>
    `;
    
    wrapper.appendChild(quickReports);
    wrapper.appendChild(dataEntry);
    container.appendChild(wrapper);
    
    // ูุนุงูุฌุฉ ูููุฐุฌ ุฅุฏุฎุงู ุงูุจูุงูุงุช
    const kpiForm = document.getElementById('kpiForm');
    if (kpiForm) {
      kpiForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const messageElement = document.getElementById('kpiMsg');
        messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงูุจูุงูุงุช...';
        messageElement.className = 'text-sm text-blue-600';
        
        // ูู ุจูุฆุฉ ุญููููุฉุ ููุง ุณูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ูุฎุงุฏู
        setTimeout(() => {
          messageElement.textContent = 'โ ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ (ูู ุจูุฆุฉ ุญููููุฉ ุณูุชู ุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)';
          messageElement.className = 'text-sm text-green-600';
          kpiForm.reset();
        }, 1000);
      });
    }
  }

  function renderPscForms(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ูููุฐุฌ ุชุณุฌูู ุญุงุฏุซ ุณูุงูุฉ ุงููุฑุถู
    const incidentForm = document.createElement('div');
    incidentForm.className = 'border rounded-xl p-4 bg-white';
    incidentForm.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ุชุณุฌูู ุญุงุฏุซ ุณูุงูุฉ ุงููุฑุถู</h3>
      <form id="pscIncidentForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุญุงุฏุซ *</label>
          <input type="date" name="incident_date" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ููุช ุงูุญุงุฏุซ *</label>
          <input type="time" name="incident_time" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ููุงู ุงูุญุงุฏุซ *</label>
          <input name="incident_location" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุนูุงุฏุฉุ ุงููุณู...">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ููุน ุงูุญุงุฏุซ *</label>
          <select name="incident_type" required class="w-full border rounded-lg px-3 py-2">
            <option value="">ุงุฎุชุฑ ููุน ุงูุญุงุฏุซ</option>
            <option value="ุณููุท">ุณููุท</option>
            <option value="ุฎุทุฃ ุฏูุงุฆู">ุฎุทุฃ ุฏูุงุฆู</option>
            <option value="ุฎุทุฃ ูู ุงูุชุดุฎูุต">ุฎุทุฃ ูู ุงูุชุดุฎูุต</option>
            <option value="ุนุฏูู ูุฑุชุจุทุฉ ุจุงูุฑุนุงูุฉ ุงูุตุญูุฉ">ุนุฏูู ูุฑุชุจุทุฉ ุจุงูุฑุนุงูุฉ ุงูุตุญูุฉ</option>
            <option value="ุขุฎุฑ">ุขุฎุฑ</option>
          </select>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ูุตู ุงูุญุงุฏุซ *</label>
          <textarea name="incident_description" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุตู ููุตู ููุญุงุฏุซ..."></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ *</label>
          <textarea name="actions_taken" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุฅุฌุฑุงุกุงุช ุงูููุฑูุฉ ูุงููุชุฎุฐุฉ..."></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงุณู ุงููุจูุบ *</label>
          <input name="reporter_name" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงูุดุฎุต ุงูุฐู ุฃุจูุบ ุนู ุงูุญุงุฏุซ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุชูููุน</label>
          <input name="signature" class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุชูููุน ุงูุฅููุชุฑููู">
        </div>
        <div class="md:col-span-2 flex items-center gap-3 pt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุชูุฑูุฑ</button>
          <span id="pscIncidentMsg" class="text-sm"></span>
        </div>
      </form>
    `;
    
    wrapper.appendChild(incidentForm);
    container.appendChild(wrapper);
    
    // ูุนุงูุฌุฉ ูููุฐุฌ ุชุณุฌูู ุงูุญุงุฏุซ
    const pscIncidentForm = document.getElementById('pscIncidentForm');
    if (pscIncidentForm) {
      pscIncidentForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const messageElement = document.getElementById('pscIncidentMsg');
        messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงูุชูุฑูุฑ...';
        messageElement.className = 'text-sm text-blue-600';
        
        // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
        const formData = new FormData(pscIncidentForm);
        const incidentData = {};
        formData.forEach((value, key) => {
          incidentData[key] = value;
        });
        incidentData.timestamp = new Date().toISOString();
        
        // ุญูุธ ูู localStorage
        let incidents = JSON.parse(localStorage.getItem('psc_incidents') || '[]');
        incidents.push(incidentData);
        localStorage.setItem('psc_incidents', JSON.stringify(incidents));
        
        messageElement.textContent = 'โ ุชู ุญูุธ ุงูุชูุฑูุฑ ุจูุฌุงุญ';
        messageElement.className = 'text-sm text-green-600';
        pscIncidentForm.reset();
      });
    }
  }

  function renderPscNeeds(container) {
    const needs = [
      { key: 'charter', text: 'ููุซุงู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู ูุนุชูุฏ (CHT-PSC-2025-001)', required: true },
      { key: 'policy', text: 'ุณูุงุณุฉ ุจุฑูุงูุฌ ุณูุงูุฉ ุงููุฑุถู ูุนุชูุฏุฉ (POL-PSC-2025-001)', required: true },
      { key: 'committee', text: 'ูุฑุงุฑ ุชุดููู ุงููุฌูุฉ ููุนู (DEC-PSC-2025-001)', required: true },
      { key: 'patient_id', text: 'ุณูุงุณุฉ ุงูุชุนุฑู ุงููุฒุฏูุฌ ุนูู ุงููุฑูุถ ูุนุชูุฏุฉ (POL-PSC-2025-003)', required: true },
      { key: 'med_errors', text: 'ุณูุงุณุฉ ุงูุฅุจูุงุบ ุนู ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ ูุนุชูุฏุฉ (POL-PSC-2025-002)', required: true },
      { key: 'meetings', text: 'ูุญุงุถุฑ ุงุฌุชูุงุนุงุช ุงููุฌูุฉ ูุณุฌูุฉ ูููุธูุฉ', required: true },
      { key: 'indicators', text: 'ูุธุงู ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุณูุงูุฉ ููุนู', required: true },
      { key: 'training', text: 'ุฎุทุฉ ุชุฏุฑูุจ ุณูุงูุฉ ุงููุฑุถู ูููุฐุฉ', required: true },
    ];
    
    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    
    needs.forEach(need => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
          <span class="font-semibold">${need.text}</span>
        </label>
        ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validatePscNeeds()">
        ุชุญููู ูู ุงูุงูุชูุงู
      </button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generatePscReport()">
        ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validatePscNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#pscTabContent input[data-required="1"]')];
    const missingCount = requiredCheckboxes.filter(checkbox => !checkbox.checked).length;
    
    if (missingCount === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุณูุงูุฉ ุงููุฑุถู ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ุชูุจูู: ููุฌุฏ ${missingCount} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุณูุงูุฉ ุงููุฑุถู.`);
    }
  }

  function generatePscReport() {
    const checkboxes = [...document.querySelectorAll('#pscTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(checkbox => checkbox.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ ุณูุงูุฉ ุงููุฑุถู:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

  // ====== ุงูุฌูุฏุฉ ูุงูุชุญุณูู (QI) ======
  const QI_DOCS_LIBRARY = [
    { code:'QI_Package_Index', name:'ููุฑุณ ูุซุงุฆู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)', category:'INDEX', url:'https://drive.google.com/open?id=11nHPWSHeMVDPhpmIIY1mQfr3xWBhyMeXQL4m8rCkFE4' },
    { code:'LD.QI.FRM.004', name:'ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุญุงุฏุซ/ุญุฏุซ', category:'FRM', url:'https://drive.google.com/open?id=1mBTZexeL6dRFW-WiSqLoYTnYJakG3jiGrZTtvhgIzsk' },
    { code:'LD.QI.AGN.001', name:'ูููุฐุฌ ุฌุฏูู ุฃุนูุงู ุงุฌุชูุงุน ูุฌูุฉ ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/open?id=1Fz3V5L9JuP0gOGvdLcPRMIZWNBo_WjpvAhrpOxM4zko' },
    { code:'LD.QI.FRM.002', name:'ูููุฐุฌ ูุดุฑูุน ุชุญุณูู โ PDSA', category:'FRM', url:'https://drive.google.com/open?id=13w_V3iUq74n0xBJ3Rzh9uhPZs8cNY4MmGN528tO0eus' },
    { code:'LD.QI.SOP.003', name:'ุฅุฌุฑุงุก ููุงุณ ูุคุดุฑุงุช ุงูุฃุฏุงุก ูููุญุฉ ุงููุชุงุจุนุฉ', category:'SOP', url:'https://drive.google.com/open?id=1lu-IQSVouIX0PO3TWSHbGSvcOU41XcZpZZr8TyCkh_0' },
    { code:'LD.QI.POL.001', name:'ุณูุงุณุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ', category:'POL', url:'https://drive.google.com/open?id=1Bef5OQKyeY707CBjpXgLZgvCDUHwn36XLMvOmkpHHEk' },
    { code:'LD.QI.SOP.001', name:'ุฅุฌุฑุงุก ุฅุฏุงุฑุฉ ุงุฌุชูุงุนุงุช ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู', category:'SOP', url:'https://drive.google.com/open?id=1eQhsEZ5PoKTJtwbYevkXblDhnpDV_-9vKdbLq1qPxOc' },
    { code:'LD.QI.MIN.001', name:'ูููุฐุฌ ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/open?id=1psbjSnOnk-W8CowyvRCFo5psR9Wxt7x9dOKcR6xm_zs' },
    { code:'LD.QI.SOP.002', name:'ุฅุฌุฑุงุก ุงุฎุชูุงุฑ ูุชูููุฐ ูุดุงุฑูุน ุงูุชุญุณูู (PDSA)', category:'SOP', url:'https://drive.google.com/open?id=1i8P4re1TT8PnGyA0ElTvmloEMnkz5LPwnGqBC90ds9w' },
    { code:'LD.QI.PLN.001', name:'ุงูุฎุทุฉ ุงูุณูููุฉ ููุฌูุฏุฉ ูุงูุชุญุณูู', category:'PLN', url:'https://drive.google.com/open?id=1GZg0RwBCbP-eM2SK35_eQtXR67miAnFJtoF39NhvC4I' },
    { code:'LD.QI.AUD.001', name:'ุฎุทุฉ/ุณุฌู ุงูุชุฏููู ุงูุฏุงุฎูู', category:'AUD', url:'https://drive.google.com/open?id=1pg3m4jBax8plRxY-jlwMhc9skIopkhdy4h1DYEfKmSI' },
    { code:'LD.QI.FRM.003', name:'ุณุฌู ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ ูุงูููุงุฆูุฉ (CAPA)', category:'FRM', url:'https://drive.google.com/open?id=13PdXpCyaXb62NRXffoinW3EkLj7mltPUf4m6OWNaPeY' },
    { code:'LD.QI.FRM.001', name:'ุจุทุงูุฉ ุชุนุฑูู ูุคุดุฑ ุฃุฏุงุก (KPI)', category:'FRM', url:'https://drive.google.com/open?id=1C6Dx0M7E7Z4PME0guCOIDZGmImciMclkL0dBS7KyJtA' },
    { code:'LD.QI.SOP.004', name:'ุฅุฌุฑุงุก ุงูุชุฏููู ุงูุฏุงุฎูู ูุฅุฏุงุฑุฉ CAPA', category:'SOP', url:'https://drive.google.com/open?id=1v1pFDX2Yo7To9oCTVaIgVQfF83xNZu64K0BxmEAchTs' },
    { code:'LD.QI.TOR.001', name:'ูุงุฆุญุฉ/ููุซุงู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ', category:'TOR', url:'https://drive.google.com/open?id=1obups6Wt5ERePM5qzmzQQhYZn_CTxHbGRUBMWE2jpaM' }
  ];

  const QI_CATEGORY_NAMES = {
    INDEX:'ุงูููุฑุณ',
    POL:'ุงูุณูุงุณุงุช', 
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', 
    FRM:'ุงูููุงุฐุฌ', 
    PLN:'ุงูุฎุทุท', 
    AUD:'ุงูุชุฏููู', 
    TOR:'ุงูููุซุงู'
  };

  // ====== ุฏูุงู QI ======
  function switchQiTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-qi-tab]').forEach(button => {
      if (button.getAttribute('data-qi-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('qiTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderQiLibrary(container, QI_DOCS_LIBRARY);
    } else if (tab === 'indicators') {
      renderQiIndicators(container);
    } else if (tab === 'forms') {
      renderQiForms(container);
    } else if (tab === 'needs') {
      renderQiNeeds(container);
    }
  }

  function renderQiLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-qi-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-qi-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${QI_CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="qiSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'qiGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${QI_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
     
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-qi-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-qi-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-qi-filter'), document.getElementById('qiSearch').value);
      });
    });
    
    document.getElementById('qiSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-qi-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-qi-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderQiIndicators(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ูุคุดุฑุงุช ุงูุฌูุฏุฉ
    const indicatorsSection = document.createElement('div');
    indicatorsSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูุคุดุฑุงุช ุงูุฌูุฏุฉ ุงูุดูุฑูุฉ</h3>
      <div class="overflow-auto">
        <table class="kpi-table">
          <thead>
            <tr>
              <th>ุงูุดูุฑ</th>
              <th>ุฑุถุง ุงููุฑุถู %</th>
              <th>ููุช ุงูุงูุชุธุงุฑ (ุฏูููุฉ)</th>
              <th>ูุนุฏู ุฅุนุงุฏุฉ ุงูุฒูุงุฑุฉ %</th>
              <th>ูุคุดุฑ ุงูุฃุฏุงุก ุงูุทุจู</th>
              <th>ูุคุดุฑ ุงูุฃุฏุงุก ุงูุฅุฏุงุฑู</th>
            </tr>
          </thead>
          <tbody id="qiKpiTableBody"></tbody>
        </table>
      </div>
    `;
    
    // ูุฎุทุท ุจูุงูู ูุจุณุท
    const chartSection = document.createElement('div');
    chartSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ุชุทูุฑ ูุคุดุฑุงุช ุงูุฌูุฏุฉ</h3>
      <div class="border rounded-xl p-4 bg-white">
        <div class="flex flex-wrap gap-4 mb-4">
          <button class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm" onclick="renderQiChart('ุฑุถุง_ุงููุฑุถู')">ุฑุถุง ุงููุฑุถู</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderQiChart('ููุช_ุงูุงูุชุธุงุฑ')">ููุช ุงูุงูุชุธุงุฑ</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderQiChart('ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ')">ุฅุนุงุฏุฉ ุงูุฒูุงุฑุฉ</button>
        </div>
        <div id="qiChart" class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
          <p class="text-gray-500">ุงุฎุชุฑ ูุคุดุฑุงู ูุนุฑุถ ุงูุฑุณู ุงูุจูุงูู</p>
        </div>
      </div>
    `;
    
    wrapper.appendChild(indicatorsSection);
    wrapper.appendChild(chartSection);
    container.appendChild(wrapper);
    
    // ููุก ุฌุฏูู ุงููุคุดุฑุงุช
    renderQiKpiTable();
  }

  function renderQiKpiTable() {
    const tableBody = document.getElementById('qiKpiTableBody');
    tableBody.innerHTML = '';
    
    const QI_KPI_DATA = [
      { ุงูุดูุฑ: 'ููุงูุฑ', ุฑุถุง_ุงููุฑุถู: 85, ููุช_ุงูุงูุชุธุงุฑ: 25, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 8.2, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู: 92, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู: 88 },
      { ุงูุดูุฑ: 'ูุจุฑุงูุฑ', ุฑุถุง_ุงููุฑุถู: 88, ููุช_ุงูุงูุชุธุงุฑ: 22, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 7.5, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู: 94, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู: 90 },
      { ุงูุดูุฑ: 'ูุงุฑุณ', ุฑุถุง_ุงููุฑุถู: 82, ููุช_ุงูุงูุชุธุงุฑ: 28, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 9.1, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู: 89, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู: 85 },
      { ุงูุดูุฑ: 'ุฃุจุฑูู', ุฑุถุง_ุงููุฑุถู: 91, ููุช_ุงูุงูุชุธุงุฑ: 20, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 6.8, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู: 95, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู: 92 },
      { ุงูุดูุฑ: 'ูุงูู', ุฑุถุง_ุงููุฑุถู: 93, ููุช_ุงูุงูุชุธุงุฑ: 18, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 6.2, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู: 96, ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู: 94 },
    ];
    
    QI_KPI_DATA.forEach(row => {
      const tr = document.createElement('tr');
      
      // ุชุญุฏูุฏ ูุฆุงุช ุงูุฃููุงู ุจูุงุกู ุนูู ุงูููู
      const patientSatisfactionClass = row.ุฑุถุง_ุงููุฑุถู >= 90 ? 'good' : row.ุฑุถุง_ุงููุฑุถู >= 80 ? 'warning' : 'critical';
      const waitingTimeClass = row.ููุช_ุงูุงูุชุธุงุฑ <= 20 ? 'good' : row.ููุช_ุงูุงูุชุธุงุฑ <= 30 ? 'warning' : 'critical';
      const revisitRateClass = row.ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ <= 7 ? 'good' : row.ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ <= 9 ? 'warning' : 'critical';
      const medicalPerformanceClass = row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู >= 90 ? 'good' : row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู >= 80 ? 'warning' : 'critical';
      const adminPerformanceClass = row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู >= 90 ? 'good' : row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู >= 80 ? 'warning' : 'critical';
      
      tr.innerHTML = `
        <td class="font-semibold">${row.ุงูุดูุฑ}</td>
        <td class="${patientSatisfactionClass}">${row.ุฑุถุง_ุงููุฑุถู}%</td>
        <td class="${waitingTimeClass}">${row.ููุช_ุงูุงูุชุธุงุฑ}</td>
        <td class="${revisitRateClass}">${row.ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ}%</td>
        <td class="${medicalPerformanceClass}">${row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุทุจู}</td>
        <td class="${adminPerformanceClass}">${row.ูุคุดุฑ_ุงูุฃุฏุงุก_ุงูุฅุฏุงุฑู}</td>
      `;
      tableBody.appendChild(tr);
    });
  }

  function renderQiChart(indicator) {
    const chartContainer = document.getElementById('qiChart');
    const indicatorName = {
      'ุฑุถุง_ุงููุฑุถู': 'ุฑุถุง ุงููุฑุถู %',
      'ููุช_ุงูุงูุชุธุงุฑ': 'ููุช ุงูุงูุชุธุงุฑ (ุฏูููุฉ)', 
      'ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ': 'ูุนุฏู ุฅุนุงุฏุฉ ุงูุฒูุงุฑุฉ %'
    }[indicator];
    
    // ุฑุณู ุจูุงูู ูุจุณุท ุจุงุณุชุฎุฏุงู HTML ูCSS
    const QI_KPI_DATA = [
      { ุงูุดูุฑ: 'ููุงูุฑ', ุฑุถุง_ุงููุฑุถู: 85, ููุช_ุงูุงูุชุธุงุฑ: 25, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 8.2 },
      { ุงูุดูุฑ: 'ูุจุฑุงูุฑ', ุฑุถุง_ุงููุฑุถู: 88, ููุช_ุงูุงูุชุธุงุฑ: 22, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 7.5 },
      { ุงูุดูุฑ: 'ูุงุฑุณ', ุฑุถุง_ุงููุฑุถู: 82, ููุช_ุงูุงูุชุธุงุฑ: 28, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 9.1 },
      { ุงูุดูุฑ: 'ุฃุจุฑูู', ุฑุถุง_ุงููุฑุถู: 91, ููุช_ุงูุงูุชุธุงุฑ: 20, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 6.8 },
      { ุงูุดูุฑ: 'ูุงูู', ุฑุถุง_ุงููุฑุถู: 93, ููุช_ุงูุงูุชุธุงุฑ: 18, ูุนุฏู_ุฅุนุงุฏุฉ_ุงูุฒูุงุฑุฉ: 6.2 },
    ];
    
    const maxValue = Math.max(...QI_KPI_DATA.map(row => row[indicator]));
    const minValue = Math.min(...QI_KPI_DATA.map(row => row[indicator]));
    
    let chartHTML = `
      <div class="w-full h-full p-4">
        <h4 class="text-center font-bold mb-4">${indicatorName}</h4>
        <div class="flex items-end justify-between h-40 gap-2">
    `;
    
    QI_KPI_DATA.forEach((row, index) => {
      const value = row[indicator];
      const percentage = ((value - minValue) / (maxValue - minValue)) * 80 + 20;
      
      chartHTML += `
        <div class="flex flex-col items-center flex-1">
          <div class="text-xs mb-1">${row.ุงูุดูุฑ}</div>
          <div class="w-full bg-[var(--brand1)] rounded-t transition-all" style="height: ${percentage}%"></div>
          <div class="text-xs mt-1">${value}</div>
        </div>
      `;
    });
    
    chartHTML += `</div></div>`;
    chartContainer.innerHTML = chartHTML;
    
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงููุคุดุฑุงุช ุงููุดุทุฉ
    (document.getElementById('qiChart') && document.getElementById('qiChart').closest('.border') ? document.getElementById('qiChart').closest('.border').querySelectorAll('button') : []).forEach(btn => {
      btn.classList.remove('bg-[var(--brand1)]', 'text-white');
      btn.classList.add('bg-gray-200');
    });
    
    const activeButton = document.querySelector(`[onclick="renderQiChart('${indicator}')"]`);
    if (activeButton) {
      activeButton.classList.add('bg-[var(--brand1)]', 'text-white');
      activeButton.classList.remove('bg-gray-200');
    }
  }

  function renderQiForms(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ูููุฐุฌ ูุดุฑูุน ุชุญุณูู PDSA
    const pdsaForm = document.createElement('div');
    pdsaForm.className = 'border rounded-xl p-4 bg-white';
    pdsaForm.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูููุฐุฌ ูุดุฑูุน ุชุญุณูู PDSA</h3>
      <form id="qiPdsaForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ุงุณู ุงููุดุฑูุน *</label>
          <input name="project_name" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ูุดุฑูุน ุงูุชุญุณูู">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงููุณู ุงููุนูู *</label>
          <input name="department" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุณู ุงููุณุคูู">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงูุฎุทุฉ (Plan) *</label>
          <textarea name="plan" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุตู ุงูุฎุทุฉ ูุงูุฃูุฏุงู..."></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงูุชูููุฐ (Do) *</label>
          <textarea name="do" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ุฎุทูุงุช ุงูุชูููุฐ..."></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงูุฏุฑุงุณุฉ (Study) *</label>
          <textarea name="study" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุชุงุฆุฌ ูุงูููุงุญุธุงุช..."></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงูุฅุฌุฑุงุก (Act) *</label>
          <textarea name="act" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ..."></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุจุฏุก *</label>
          <input type="date" name="start_date" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุงูุชูุงุก *</label>
          <input type="date" name="end_date" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div class="md:col-span-2 flex items-center gap-3 pt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงููุดุฑูุน</button>
          <span id="qiPdsaMsg" class="text-sm"></span>
        </div>
      </form>
    `;
    
    wrapper.appendChild(pdsaForm);
    container.appendChild(wrapper);
    
    // ูุนุงูุฌุฉ ูููุฐุฌ PDSA
    const qiPdsaForm = document.getElementById('qiPdsaForm');
    if (qiPdsaForm) {
      qiPdsaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const messageElement = document.getElementById('qiPdsaMsg');
        messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงููุดุฑูุน...';
        messageElement.className = 'text-sm text-blue-600';
        
        // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
        const formData = new FormData(qiPdsaForm);
        const pdsaData = {};
        formData.forEach((value, key) => {
          pdsaData[key] = value;
        });
        pdsaData.timestamp = new Date().toISOString();
        
        // ุญูุธ ูู localStorage
        let pdsaProjects = JSON.parse(localStorage.getItem('qi_pdsa_projects') || '[]');
        pdsaProjects.push(pdsaData);
        localStorage.setItem('qi_pdsa_projects', JSON.stringify(pdsaProjects));
        
        messageElement.textContent = 'โ ุชู ุญูุธ ุงููุดุฑูุน ุจูุฌุงุญ';
        messageElement.className = 'text-sm text-green-600';
        qiPdsaForm.reset();
      });
    }
  }

  function renderQiNeeds(container) {
    const needs = [
      { key: 'charter', text: 'ููุซุงู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ ูุนุชูุฏ (LD.QI.TOR.001)', required: true },
      { key: 'policy', text: 'ุณูุงุณุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ ูุนุชูุฏุฉ (LD.QI.POL.001)', required: true },
      { key: 'plan', text: 'ุงูุฎุทุฉ ุงูุณูููุฉ ููุฌูุฏุฉ ูุงูุชุญุณูู ูุนุชูุฏุฉ (LD.QI.PLN.001)', required: true },
      { key: 'indicators', text: 'ูุธุงู ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก ููุนู', required: true },
      { key: 'pdsa', text: 'ูุดุงุฑูุน ุชุญุณูู PDSA ููุฏ ุงูุชูููุฐ', required: true },
      { key: 'audit', text: 'ุจุฑูุงูุฌ ุงูุชุฏููู ุงูุฏุงุฎูู ููุนู', required: true },
      { key: 'capa', text: 'ูุธุงู ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ ูุงูููุงุฆูุฉ (CAPA) ููุนู', required: true },
      { key: 'meetings', text: 'ูุญุงุถุฑ ุงุฌุชูุงุนุงุช ุงููุฌูุฉ ูุณุฌูุฉ ูููุธูุฉ', required: true },
    ];
    
    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    
    needs.forEach(need => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
          <span class="font-semibold">${need.text}</span>
        </label>
        ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateQiNeeds()">
        ุชุญููู ูู ุงูุงูุชูุงู
      </button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generateQiReport()">
        ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateQiNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#qiTabContent input[data-required="1"]')];
    const missingCount = requiredCheckboxes.filter(checkbox => !checkbox.checked).length;
    
    if (missingCount === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ุชูุจูู: ููุฌุฏ ${missingCount} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุงูุฌูุฏุฉ ูุงูุชุญุณูู.`);
    }
  }

  function generateQiReport() {
    const checkboxes = [...document.querySelectorAll('#qiTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(checkbox => checkbox.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

  function qiExportAll() {
    const data = {
      pdsaProjects: JSON.parse(localStorage.getItem('qi_pdsa_projects') || '[]')
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'qi_data_backup.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function qiImportAll(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.pdsaProjects) localStorage.setItem('qi_pdsa_projects', JSON.stringify(data.pdsaProjects));
        alert('โ ุชู ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฌูุฏุฉ ุจูุฌุงุญ.');
      } catch (err) {
        alert('โ๏ธ ููู ุบูุฑ ุตุงูุญ.');
      }
    };
    reader.readAsText(file, 'utf-8');
  }

  // ====== ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC) ======
  const EOC_DOCS_LIBRARY = [
    { code:'Readme-2025', name:'ุชุนูููุงุช ุงูุงุนุชูุงุฏ ูุงูุญูุธ', category:'GUIDE', url:'https://drive.google.com/open?id=1WkN1gTWJc_l1xJgOh--uq7MpQVGw-SlH_wA8XpdakdU' },
    { code:'EOC-FRM-2025-007', name:'ุณุฌู ุชูุงุฑูู ูุฅุฎูุงุกุงุช', category:'LOG', url:'https://drive.google.com/open?id=1y3Sjxlq39HTEQMHYpCGroil33nLaODFepJHfjYod9wY' },
    { code:'EOC-FRM-2025-002', name:'ุณุฌู ุญุถูุฑ ูุชุฏุฑูุจ ุงูุทูุงุฑุฆ', category:'LOG', url:'https://drive.google.com/open?id=1pR3gpKB1nv-98Nnh7YG9na0SjHE8ssshqwjsljvcVTQ' },
    { code:'EOC-FRM-2025-008', name:'ุณุฌู ูุนุฏุงุช ุงูุงุณุชุฌุงุจุฉ', category:'LOG', url:'https://drive.google.com/open?id=1Gxvm9A1CM1RPy3vTFDPxX5rsmlInqfeSid2YDe-ieGg' },
    { code:'EOC-SOP-2025-007', name:'ุชุนุทู ุงูุงุชุตุงูุงุช ูุชูููุฉ ุงููุนูููุงุช/ุงูุจูุงูุงุช (PDPL)', category:'SOP', url:'https://drive.google.com/open?id=1p-OsanRRMfaw9a1KV500Z-lxvCZ8Ch91EFJ0Alptviw' },
    { code:'EOC-FRM-2025-004', name:'ุฎุทุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ (CAPA Tracker)', category:'FRM', url:'https://drive.google.com/open?id=1y_-Uywr5VASlVMusD0NKFDdTHkFbExXdMyISSzYIh60' },
    { code:'References-2025', name:'ูุฑุงุฌุน ูุฑูุงุจุท', category:'REF', url:'https://drive.google.com/open?id=12plKBVOYvBfp6Kp8PX5NCC-iRuZdHU8xIuZLBFZxnLA' },
    { code:'EOC-Index-2025-001', name:'ููุฑุณ ูุซุงุฆู ุงูุญุฒูุฉ', category:'INDEX', url:'https://drive.google.com/open?id=12fiFYU5EeMzUv4UI11k2aIYoIuWPr-B2fmW1caIfXlY' },
    { code:'EOC-SOP-2025-005', name:'ุชูุดูู ุฃูุฑุงุถ ูุนุฏูุฉ/ุฅูุฐุงุฑ ุตุญู', category:'SOP', url:'https://drive.google.com/open?id=1OqFbjCJ9uqTbQPJicNU3cFBR-SgeuHwRjYBuWtAjM4Q' },
    { code:'EOC-SOP-2025-003', name:'ุงูุฅุฎูุงุก ูุงูุชุฌูุน ูุฅุนุงุฏุฉ ุงูุฏุฎูู', category:'SOP', url:'https://drive.google.com/open?id=1WX4T7VkA8G9s42YZE-g8tJ33Qmy-sDdYrGOTvzGbuYw' },
    { code:'EOC-LST-2025-001', name:'ููุญุฉ/ูุงุฆูุฉ ุงุชุตุงูุงุช ุงูุทูุงุฑุฆ', category:'REF', url:'https://drive.google.com/open?id=1sV8ABIFDAuUyo7vWaCPM5Y3hVtVTeK6AQhhUW0xuX1w' },
    { code:'EOC-FRM-2025-001', name:'ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'FRM', url:'https://drive.google.com/open?id=1SeopdYmHRU4CL--j054kA37WAwqCCc-lAQrlr_3PM74' },
    { code:'EOC-FRM-2025-005', name:'ุชูุฑูุฑ ุญุงุฏุซ ุทุงุฑุฆ/ูุง ุจุนุฏ ุงูุญุฏุซ', category:'FRM', url:'https://drive.google.com/open?id=1AyNMAdrJCalF9LqBmrdRh64W1gUrJpiQFN2yplFh5B8' },
    { code:'EOC-FRM-2025-006', name:'ูููุฐุฌ HVA ูุชูููู ูุฎุงุทุฑ ุงูููุงุฑุซ', category:'FRM', url:'https://drive.google.com/open?id=1AbB5BL4d_pki3to9wn3169PZ-OJBfwCBEjYNApvStGM' },
    { code:'EOC-QIP-2025-001', name:'ูุธุงู ุงูุชุญุณูู ูุงููุชุงุจุนุฉ (CAPA)', category:'SOP', url:'https://drive.google.com/open?id=1JSa-E4YoJL8iYjvGVVioEpp_Wu5tKQopC_tfFo56sWo' },
    { code:'EOC-SOP-2025-001', name:'ุชูุนูู ูุฅุฏุงุฑุฉ ุงูุญุงุฏุซ (ICS)', category:'SOP', url:'https://drive.google.com/open?id=1bjq5a9JSxCB_XVkzoKv-GSmTwzKJkAAEA3VjYgzZZwU' },
    { code:'EOC-CHK-2025-001', name:'ูุงุฆูุฉ ูุญุต ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ', category:'CHK', url:'https://drive.google.com/open?id=1Kp1OjuPEfzEA0JE_FMnf-padRq_0-VJABf1w4eZM1m8' },
    { code:'EOC-SOP-2025-002', name:'ุญุฑูู/ุฏุฎุงู (RACE/PASS)', category:'SOP', url:'https://drive.google.com/open?id=1VT17h68xnLmUSzvNOp4Brm79F9jyXBlTYFNSBewCQDo' },
    { code:'EOC-PRO-2025-001', name:'ุขููุฉ ุชูููู ุงููุฎุงุทุฑ ุงูุณูููุฉ (HVA)', category:'SOP', url:'https://drive.google.com/open?id=1IpfxWVyfSadhmLoHS2hAYSPs8jRF7pBYuCKo3lyTNg4' },
    { code:'EOC-PLN-2025-001', name:'ุฎุทุฉ ุงูุทูุงุฑุฆ ุงูุดุงููุฉ (EOP)', category:'PLN', url:'https://drive.google.com/open?id=1rMusdz3AtFzMgOQaAg3c-7DnjwLNt79ilzUTSRRngT4' },
    { code:'EOC-SOP-2025-004', name:'ุงููุทุงุน ุงูููุฑุจุงุก/ุงูุฃูุธูุฉ ุงูุญุฑุฌุฉ', category:'SOP', url:'https://drive.google.com/open?id=15Q6d_f8OvBbNmoArZtfzlg3PUeWVIHCcxMRqT4owQFI' },
    { code:'EOC-FRM-2025-003', name:'ุชูููู ุชูุฑูู ุงูุฅุฎูุงุก/ุงูุญุฑูู (After-Action)', category:'FRM', url:'https://drive.google.com/open?id=1fqd2ZeGjqXWxuTXlg8VJZUw1ddphrglHU2uGWb-V2jg' },
    { code:'EOC-SOP-2025-006', name:'ุญุงุฏุซ ุฌุณูู ุณุฑูุฑู ูุฅุฏุงุฑุฉ ูุง ุจุนุฏ ุงูุญุฏุซ (SPSC/RCA)', category:'SOP', url:'https://drive.google.com/open?id=1CHDPHSyer7Ruuy0NY_oByQ0ekU2ozGQttNw8lRimZRs' },
    { code:'EOC-POL-2025-001', name:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'POL', url:'https://drive.google.com/open?id=18IjABxZrfWdqs3ogcHJMRcXLC3LdYeLoOCG1DmPUnHk' },
    { code:'EOC-TOR-2025-001', name:'ููุซุงู ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'TOR', url:'https://drive.google.com/open?id=1GabuSVynwTrZDo6xAWlZ-vySD2oAK1FR8YL6JYe8uLY' },
    { code:'EOC-PLN-2025-002', name:'ุจุฑูุงูุฌ ุงูุชุฏุฑูุจ ูุงูุชูุงุฑูู', category:'PLN', url:'https://drive.google.com/open?id=1Y9nsgDQ1UXS60r3q5rhRBNkgE5EWW8dKsV9Vmvf3Dxw' }
  ];

  const EOC_CATEGORY_NAMES = {
    GUIDE:'ุงูุฏููู',
    POL:'ุงูุณูุงุณุงุช', 
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', 
    PLN:'ุงูุฎุทุท', 
    FRM:'ุงูููุงุฐุฌ', 
    LOG:'ุงูุณุฌูุงุช', 
    CHK:'ููุงุฆู ุงูุชุญูู', 
    REF:'ุงููุฑุงุฌุน', 
    INDEX:'ุงูููุฑุณ',
    TOR:'ุงูููุซุงู'
  };

  // ====== ุฏูุงู EOC ======
  function switchEocTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-eoc-tab]').forEach(button => {
      if (button.getAttribute('data-eoc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('eocTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderEocLibrary(container, EOC_DOCS_LIBRARY);
    } else if (tab === 'plans') {
      renderEocPlans(container);
    } else if (tab === 'forms') {
      renderEocForms(container);
    } else if (tab === 'needs') {
      renderEocNeeds(container);
    }
  }

  function renderEocLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-eoc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-eoc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${EOC_CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="eocSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'eocGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${EOC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-eoc-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-eoc-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-eoc-filter'), document.getElementById('eocSearch').value);
      });
    });
    
    document.getElementById('eocSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-eoc-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-eoc-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderEocPlans(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ุฎุทุท ุงูุทูุงุฑุฆ
    const plansSection = document.createElement('div');
    plansSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐บ๏ธ ุฎุทุท ุงูุทูุงุฑุฆ ุงูุฑุฆูุณูุฉ</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="p-4 border rounded-xl bg-white hover:shadow-md transition">
          <div class="h-12 w-12 rounded-full bg-red-100 grid place-items-center text-red-600 mb-3">
            <i class="fas fa-fire"></i>
          </div>
          <h4 class="font-bold mb-2">ุฎุทุฉ ุงูุญุฑูู</h4>
          <p class="text-sm text-gray-600 mb-3">ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู ูุน ุญุงูุงุช ุงูุญุฑูู ูุงูุฅุฎูุงุก</p>
          <a href="https://drive.google.com/open?id=1VT17h68xnLmUSzvNOp4Brm79F9jyXBlTYFNSBewCQDo" target="_blank" class="text-sm text-[var(--brand1)] font-semibold">ุนุฑุถ ุงูุฎุทุฉ โ</a>
        </div>
        
        <div class="p-4 border rounded-xl bg-white hover:shadow-md transition">
          <div class="h-12 w-12 rounded-full bg-blue-100 grid place-items-center text-blue-600 mb-3">
            <i class="fas fa-bolt"></i>
          </div>
          <h4 class="font-bold mb-2">ุงููุทุงุน ุงูููุฑุจุงุก</h4>
          <p class="text-sm text-gray-600 mb-3">ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู ูุน ุงููุทุงุน ุงูุชูุงุฑ ุงูููุฑุจุงุฆู</p>
          <a href="https://drive.google.com/open?id=15Q6d_f8OvBbNmoArZtfzlg3PUeWVIHCcxMRqT4owQFI" target="_blank" class="text-sm text-[var(--brand1)] font-semibold">ุนุฑุถ ุงูุฎุทุฉ โ</a>
        </div>
        
        <div class="p-4 border rounded-xl bg-white hover:shadow-md transition">
          <div class="h-12 w-12 rounded-full bg-green-100 grid place-items-center text-green-600 mb-3">
            <i class="fas fa-virus"></i>
          </div>
          <h4 class="font-bold mb-2">ุชูุดู ุงูุฃูุฑุงุถ</h4>
          <p class="text-sm text-gray-600 mb-3">ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู ูุน ุชูุดู ุงูุฃูุฑุงุถ ุงููุนุฏูุฉ</p>
          <a href="https://drive.google.com/open?id=1OqFbjCJ9uqTbQPJicNU3cFBR-SgeuHwRjYBuWtAjM4Q" target="_blank" class="text-sm text-[var(--brand1)] font-semibold">ุนุฑุถ ุงูุฎุทุฉ โ</a>
        </div>
        
        <div class="p-4 border rounded-xl bg-white hover:shadow-md transition">
          <div class="h-12 w-12 rounded-full bg-purple-100 grid place-items-center text-purple-600 mb-3">
            <i class="fas fa-tools"></i>
          </div>
          <h4 class="font-bold mb-2">ุชุนุทู ุงูุฃูุธูุฉ</h4>
          <p class="text-sm text-gray-600 mb-3">ุฅุฌุฑุงุกุงุช ุงูุชุนุงูู ูุน ุชุนุทู ุงูุฃูุธูุฉ ุงูุญุฑุฌุฉ</p>
          <a href="https://drive.google.com/open?id=1p-OsanRRMfaw9a1KV500Z-lxvCZ8Ch91EFJ0Alptviw" target="_blank" class="text-sm text-[var(--brand1)] font-semibold">ุนุฑุถ ุงูุฎุทุฉ โ</a>
        </div>
      </div>
    `;
    
    wrapper.appendChild(plansSection);
    container.appendChild(wrapper);
  }

  function renderEocForms(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ูููุฐุฌ ุชุณุฌูู ุชูุฑูู ุทูุงุฑุฆ
    const drillForm = document.createElement('div');
    drillForm.className = 'border rounded-xl p-4 bg-white';
    drillForm.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ุชุณุฌูู ุชูุฑูู ุทูุงุฑุฆ</h3>
      <form id="eocDrillForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ููุน ุงูุชูุฑูู *</label>
          <select name="drill_type" required class="w-full border rounded-lg px-3 py-2">
            <option value="">ุงุฎุชุฑ ููุน ุงูุชูุฑูู</option>
            <option value="ุญุฑูู">ุญุฑูู</option>
            <option value="ุฅุฎูุงุก">ุฅุฎูุงุก</option>
            <option value="ุงููุทุงุน ููุฑุจุงุก">ุงููุทุงุน ููุฑุจุงุก</option>
            <option value="ุชูุดู ุฃูุฑุงุถ">ุชูุดู ุฃูุฑุงุถ</option>
            <option value="ุขุฎุฑ">ุขุฎุฑ</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุชูุฑูู *</label>
          <input type="date" name="drill_date" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ููุช ุงูุชูุฑูู *</label>
          <input type="time" name="drill_time" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูููุงู *</label>
          <input name="drill_location" required class="w-full border rounded-lg px-3 py-2" placeholder="ููุงู ุฅุฌุฑุงุก ุงูุชูุฑูู">
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงููุฏู ูู ุงูุชูุฑูู *</label>
          <textarea name="drill_objective" rows="2" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุฏู ุงูุฑุฆูุณู ูู ุงูุชูุฑูู..."></textarea>
        </div>
        <div class="md:col-span-2">
          <label class="block text-sm font-semibold mb-1">ุงููุชุงุฆุฌ ูุงูููุงุญุธุงุช *</label>
          <textarea name="drill_results" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุชุงุฆุฌ ุงูุชูุฑูู ูุงูููุงุญุธุงุช..."></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงููุณุคูู ุนู ุงูุชูุฑูู *</label>
          <input name="drill_responsible" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุณุคูู">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุนุฏุฏ ุงููุดุงุฑููู *</label>
          <input type="number" name="participants_count" required class="w-full border rounded-lg px-3 py-2" placeholder="ุนุฏุฏ ุงููุดุงุฑููู">
        </div>
        <div class="md:col-span-2 flex items-center gap-3 pt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุชูุฑูุฑ</button>
          <span id="eocDrillMsg" class="text-sm"></span>
        </div>
      </form>
    `;
    
    wrapper.appendChild(drillForm);
    container.appendChild(wrapper);
    
    // ูุนุงูุฌุฉ ูููุฐุฌ ุชุณุฌูู ุงูุชูุฑูู
    const eocDrillForm = document.getElementById('eocDrillForm');
    if (eocDrillForm) {
      eocDrillForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const messageElement = document.getElementById('eocDrillMsg');
        messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงูุชูุฑูุฑ...';
        messageElement.className = 'text-sm text-blue-600';
        
        // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
        const formData = new FormData(eocDrillForm);
        const drillData = {};
        formData.forEach((value, key) => {
          drillData[key] = value;
        });
        drillData.timestamp = new Date().toISOString();
        
        // ุญูุธ ูู localStorage
        let drills = JSON.parse(localStorage.getItem('eoc_drills') || '[]');
        drills.push(drillData);
        localStorage.setItem('eoc_drills', JSON.stringify(drills));
        
        messageElement.textContent = 'โ ุชู ุญูุธ ุงูุชูุฑูุฑ ุจูุฌุงุญ';
        messageElement.className = 'text-sm text-green-600';
        eocDrillForm.reset();
      });
    }
  }

  function renderEocNeeds(container) {
    const needs = [
      { key: 'charter', text: 'ููุซุงู ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ูุนุชูุฏ (EOC-TOR-2025-001)', required: true },
      { key: 'policy', text: 'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ูุนุชูุฏุฉ (EOC-POL-2025-001)', required: true },
      { key: 'plan', text: 'ุฎุทุฉ ุงูุทูุงุฑุฆ ุงูุดุงููุฉ ูุนุชูุฏุฉ (EOC-PLN-2025-001)', required: true },
      { key: 'training', text: 'ุจุฑูุงูุฌ ุงูุชุฏุฑูุจ ูุงูุชูุงุฑูู ูููุฐ (EOC-PLN-2025-002)', required: true },
      { key: 'hva', text: 'ุชูููู ูุฎุงุทุฑ ุงูููุงุฑุซ (HVA) ููุชูู', required: true },
      { key: 'equipment', text: 'ุณุฌู ูุนุฏุงุช ุงูุงุณุชุฌุงุจุฉ ูุญุฏุซ', required: true },
      { key: 'communication', text: 'ููุญุฉ ุงุชุตุงูุงุช ุงูุทูุงุฑุฆ ูุญุฏุซุฉ', required: true },
      { key: 'meetings', text: 'ูุญุงุถุฑ ุงุฌุชูุงุนุงุช ุงููุฌูุฉ ูุณุฌูุฉ ูููุธูุฉ', required: true },
    ];
    
    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    
    needs.forEach(need => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
          <span class="font-semibold">${need.text}</span>
        </label>
        ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateEocNeeds()">
        ุชุญููู ูู ุงูุงูุชูุงู
      </button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generateEocReport()">
        ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateEocNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#eocTabContent input[data-required="1"]')];
    const missingCount = requiredCheckboxes.filter(checkbox => !checkbox.checked).length;
    
    if (missingCount === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ุชูุจูู: ููุฌุฏ ${missingCount} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ.`);
    }
  }

  function generateEocReport() {
    const checkboxes = [...document.querySelectorAll('#eocTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(checkbox => checkbox.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

  function eocExportAll() {
    const data = {
      drills: JSON.parse(localStorage.getItem('eoc_drills') || '[]')
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'eoc_data_backup.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function eocImportAll(file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.drills) localStorage.setItem('eoc_drills', JSON.stringify(data.drills));
        alert('โ ุชู ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุทูุงุฑุฆ ุจูุฌุงุญ.');
      } catch (err) {
        alert('โ๏ธ ููู ุบูุฑ ุตุงูุญ.');
      }
    };
    reader.readAsText(file, 'utf-8');
  }

  // ====== ููุงูุญุฉ ุงูุนุฏูู (IPC) โ ููุชุจุฉ + ูุคุดุฑุงุช + ููุงุฐุฌ ุจุฅุณูุงุฏ ูุญูู ======
  const IPC_DOCS_LIBRARY = [
    { code:'DEC-IPC-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู', category:'DEC', url:'#' },
    { code:'CHT-IPC-2025-001', name:'ููุซุงู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู', category:'CHT', url:'#' },
    { code:'POL-IPC-2025-001', name:'ุณูุงุณุฉ ุจุฑูุงูุฌ ููุงูุญุฉ ุงูุนุฏูู', category:'POL', url:'#' },
    { code:'POL-IPC-2025-002', name:'ุณูุงุณุฉ ุบุณู ุงููุฏูู', category:'POL', url:'#' },
    { code:'SOP-IPC-2025-003', name:'ุฅุฌุฑุงุก ุงูุชุนุงูู ูุน ุงูุชุนุฑุถ ุงููุฎุฒู (Needlestick)', category:'SOP', url:'#' },
    { code:'LOG-IPC-2025-004', name:'ุณุฌู ูุฑุงูุจุฉ ุงูุชุนููู ูุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ', category:'LOG', url:'#' },
    { code:'REP-IPC-2025-005', name:'ุชูุฑูุฑ ูุฑุงูุจุฉ ุนุฏูู ูุฑุชุจุทุฉ ุจุงูุฑุนุงูุฉ ุงูุตุญูุฉ', category:'REP', url:'#' },
  ];
  const IPC_CATEGORY_NAMES = { POL:'ุงูุณูุงุณุงุช', SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', DEC:'ุงููุฑุงุฑุงุช', CHT:'ุงูููุซุงู', LOG:'ุงูุณุฌูุงุช', REP:'ุงูุชูุงุฑูุฑ' };

  // ุชุฎุฒูู ูุญูู ุขูู ุงุฎุชูุงุฑู ุจุงุณุชุฎุฏุงู WebCrypto (AESโGCM)
  const SecureStore = (() => {
    const SALT_KEY = 'ipc_salt_v1';
    const MODE_KEY = 'ipc_secure_mode';
    let cryptoKey = null;

    function toBase64(buf) { return btoa(String.fromCharCode(...new Uint8Array(buf))); }
    function fromBase64(b64) { return Uint8Array.from(atob(b64), c => c.charCodeAt(0)).buffer; }

    async function deriveKey(passphrase, saltB64) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(passphrase), 'PBKDF2', false, ['deriveKey']);
      const salt = saltB64 ? fromBase64(saltB64) : crypto.getRandomValues(new Uint8Array(16)).buffer;
      const derived = await crypto.subtle.deriveKey(
        { name: 'PBKDF2', salt, iterations: 120000, hash: 'SHA-256' },
        keyMaterial,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt','decrypt']
      );
      const savedSalt = saltB64 || toBase64(salt);
      localStorage.setItem(SALT_KEY, savedSalt);
      return derived;
    }

    return {
      async setPassphrase(passphrase) {
        if (!window.crypto || !window.crypto.subtle) {
          alert('โ๏ธ ูุชุตูุญู ูุง ูุฏุนู WebCrypto ูุชูุนูู ุงูุญูุงูุฉ. ุณูุชู ุงูุญูุธ ุจุฏูู ุชุดููุฑ.');
          localStorage.setItem(MODE_KEY, 'off');
          cryptoKey = null;
          return false;
        }
        cryptoKey = await deriveKey(passphrase, localStorage.getItem(SALT_KEY));
        localStorage.setItem(MODE_KEY, 'on');
        return true;
      },
      clearPassphrase() {
        cryptoKey = null;
        localStorage.setItem(MODE_KEY, 'off');
      },
      isOn() {
        return localStorage.getItem(MODE_KEY) === 'on' && cryptoKey !== null;
      },
      async encryptJson(obj) {
        const enc = new TextEncoder();
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const data = enc.encode(JSON.stringify(obj));
        const encrypted = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, cryptoKey, data);
        return toBase64(iv) + ':' + toBase64(encrypted);
      },
      async decryptJson(ciphertext) {
        const [ivB64, dataB64] = ciphertext.split(':');
        const iv = fromBase64(ivB64);
        const data = fromBase64(dataB64);
        const decrypted = await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, cryptoKey, data);
        return JSON.parse(new TextDecoder().decode(decrypted));
      }
    };
  })();

  // ====== ุฏูุงู IPC ======
  function switchIpcTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-ipc-tab]').forEach(button => {
      if (button.getAttribute('data-ipc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('ipcTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderIpcLibrary(container, IPC_DOCS_LIBRARY);
    } else if (tab === 'surveillance') {
      renderIpcSurveillance(container);
    } else if (tab === 'forms') {
      renderIpcForms(container);
    } else if (tab === 'needs') {
      renderIpcNeeds(container);
    }
  }

  function renderIpcLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-ipc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-ipc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${IPC_CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="ipcSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'ipcGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${IPC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-ipc-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-ipc-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-ipc-filter'), document.getElementById('ipcSearch').value);
      });
    });
    
    document.getElementById('ipcSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-ipc-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-ipc-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderIpcSurveillance(container) {
    // ุชูููุฐ ูุงุฌูุฉ ุงููุฑุงูุจุฉ ูุงููุคุดุฑุงุช ูููุงูุญุฉ ุงูุนุฏูู
    container.innerHTML = `
      <div class="space-y-6">
        <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูุฑุงูุจุฉ ุนุฏูู ุงููุฑุงูู ุงูุตุญูุฉ</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="p-4 border rounded-xl bg-white text-center">
            <div class="text-3xl font-bold text-green-600 mb-1">92%</div>
            <div class="text-sm text-gray-600">ุงูุชุฒุงู ุบุณู ุงููุฏูู</div>
          </div>
          <div class="p-4 border rounded-xl bg-white text-center">
            <div class="text-3xl font-bold text-blue-600 mb-1">3</div>
            <div class="text-sm text-gray-600">ุญุงูุงุช ุนุฏูู ูุฐุง ุงูุดูุฑ</div>
          </div>
          <div class="p-4 border rounded-xl bg-white text-center">
            <div class="text-3xl font-bold text-orange-600 mb-1">100%</div>
            <div class="text-sm text-gray-600">ุงูุชุฒุงู ุงูุชุนููู</div>
          </div>
        </div>
        
        <div class="border rounded-xl p-4 bg-white">
          <h4 class="font-bold mb-3">โ ุฅุฏุฎุงู ุจูุงูุงุช ูุฑุงูุจุฉ ุงูุนุฏูู</h4>
          <form id="ipcSurveillanceForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label>
              <input type="date" name="surv_date" required class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุงููุณู *</label>
              <select name="surv_dept" required class="w-full border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ุงููุณู</option>
                <option value="ุงูุนูุงุฏุงุช">ุงูุนูุงุฏุงุช</option>
                <option value="ุงูุทูุงุฑุฆ">ุงูุทูุงุฑุฆ</option>
                <option value="ุงููุฎุชุจุฑ">ุงููุฎุชุจุฑ</option>
                <option value="ุงูุฃุดุนุฉ">ุงูุฃุดุนุฉ</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ููุน ุงูุนุฏูู</label>
              <select name="surv_type" class="w-full border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ุงูููุน</option>
                <option value="ุนุฏูู ูุฌุฑู ุงูุฏู">ุนุฏูู ูุฌุฑู ุงูุฏู</option>
                <option value="ุนุฏูู ุงููุณุงูู ุงูุจูููุฉ">ุนุฏูู ุงููุณุงูู ุงูุจูููุฉ</option>
                <option value="ุนุฏูู ูููุน ุงูุฌุฑุงุญุฉ">ุนุฏูู ูููุน ุงูุฌุฑุงุญุฉ</option>
                <option value="ุงูุชูุงุจ ุฑุฆูู">ุงูุชูุงุจ ุฑุฆูู</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุนุฏุฏ ุงูุญุงูุงุช</label>
              <input type="number" name="surv_cases" class="w-full border rounded-lg px-3 py-2" placeholder="0">
            </div>
            <div class="md:col-span-2 flex items-center gap-3 pt-2">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุจูุงูุงุช</button>
              <span id="ipcSurvMsg" class="text-sm"></span>
            </div>
          </form>
        </div>
      </div>
    `;
    
    const form = document.getElementById('ipcSurveillanceForm');
    if (form) {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const msg = document.getElementById('ipcSurvMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        msg.className = 'text-sm text-blue-600';
        
        // ูู ุจูุฆุฉ ุญููููุฉุ ููุง ุณูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ูุฎุงุฏู
        setTimeout(() => {
          msg.textContent = 'โ ุชู ุญูุธ ุงูุจูุงูุงุช (ูู ุจูุฆุฉ ุญููููุฉ ุณูุชู ุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)';
          msg.className = 'text-sm text-green-600';
          form.reset();
        }, 1000);
      });
    }
  }

  function renderIpcForms(container) {
    // ุชูููุฐ ููุงุฐุฌ ุฅุฏุฎุงู ุจูุงูุงุช ููุงูุญุฉ ุงูุนุฏูู
    container.innerHTML = `
      <div class="space-y-6">
        <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ููุงุฐุฌ ุฅุฏุฎุงู ุจูุงูุงุช IPC</h3>
        
        <div class="border rounded-xl p-4 bg-white">
          <h4 class="font-bold mb-3">๐งผ ูุฑุงูุจุฉ ุบุณู ุงููุฏูู</h4>
          <form id="ipcHandHygieneForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label>
              <input type="date" name="hh_date" required class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุงููุณู *</label>
              <select name="hh_dept" required class="w-full border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ุงููุณู</option>
                <option value="ุงูุนูุงุฏุงุช">ุงูุนูุงุฏุงุช</option>
                <option value="ุงูุทูุงุฑุฆ">ุงูุทูุงุฑุฆ</option>
                <option value="ุงููุฎุชุจุฑ">ุงููุฎุชุจุฑ</option>
                <option value="ุงูุฃุดุนุฉ">ุงูุฃุดุนุฉ</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุนุฏุฏ ูุฑุงุช ุงูุงูุชุฒุงู *</label>
              <input type="number" name="hh_compliant" required class="w-full border rounded-lg px-3 py-2" placeholder="0">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุฅุฌูุงูู ุงููุฑุต *</label>
              <input type="number" name="hh_opportunities" required class="w-full border rounded-lg px-3 py-2" placeholder="0">
            </div>
            <div class="md:col-span-2 flex items-center gap-3 pt-2">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุจูุงูุงุช</button>
              <span id="ipcHandHygieneMsg" class="text-sm"></span>
            </div>
          </form>
        </div>
        
        <div class="border rounded-xl p-4 bg-white">
          <h4 class="font-bold mb-3">๐ฆ ุชุณุฌูู ุญุงูุฉ ุนุฏูู</h4>
          <form id="ipcInfectionForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุชุดุฎูุต *</label>
              <input type="date" name="inf_date" required class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ููุน ุงูุนุฏูู *</label>
              <select name="inf_type" required class="w-full border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ุงูููุน</option>
                <option value="ุนุฏูู ูุฌุฑู ุงูุฏู">ุนุฏูู ูุฌุฑู ุงูุฏู</option>
                <option value="ุนุฏูู ุงููุณุงูู ุงูุจูููุฉ">ุนุฏูู ุงููุณุงูู ุงูุจูููุฉ</option>
                <option value="ุนุฏูู ูููุน ุงูุฌุฑุงุญุฉ">ุนุฏูู ูููุน ุงูุฌุฑุงุญุฉ</option>
                <option value="ุงูุชูุงุจ ุฑุฆูู">ุงูุชูุงุจ ุฑุฆูู</option>
                <option value="ุขุฎุฑ">ุขุฎุฑ</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุงููุณู *</label>
              <select name="inf_dept" required class="w-full border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ุงููุณู</option>
                <option value="ุงูุนูุงุฏุงุช">ุงูุนูุงุฏุงุช</option>
                <option value="ุงูุทูุงุฑุฆ">ุงูุทูุงุฑุฆ</option>
                <option value="ุงููุฎุชุจุฑ">ุงููุฎุชุจุฑ</option>
                <option value="ุงูุฃุดุนุฉ">ุงูุฃุดุนุฉ</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุงููุณุฌู *</label>
              <input name="inf_reporter" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุณุฌู">
            </div>
            <div class="md:col-span-2 flex items-center gap-3 pt-2">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุชูุฑูุฑ</button>
              <span id="ipcInfectionMsg" class="text-sm"></span>
            </div>
          </form>
        </div>
      </div>
    `;
    
    // ูุนุงูุฌุฉ ููุงุฐุฌ IPC
    const handHygieneForm = document.getElementById('ipcHandHygieneForm');
    if (handHygieneForm) {
      handHygieneForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const msg = document.getElementById('ipcHandHygieneMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        msg.className = 'text-sm text-blue-600';
        
        setTimeout(() => {
          msg.textContent = 'โ ุชู ุญูุธ ุงูุจูุงูุงุช';
          msg.className = 'text-sm text-green-600';
          handHygieneForm.reset();
        }, 1000);
      });
    }
    
    const infectionForm = document.getElementById('ipcInfectionForm');
    if (infectionForm) {
      infectionForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const msg = document.getElementById('ipcInfectionMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        msg.className = 'text-sm text-blue-600';
        
        setTimeout(() => {
          msg.textContent = 'โ ุชู ุญูุธ ุงูุชูุฑูุฑ';
          msg.className = 'text-sm text-green-600';
          infectionForm.reset();
        }, 1000);
      });
    }
  }

  function renderIpcNeeds(container) {
    // ุชูููุฐ ูุชุทูุจุงุช ุณุจุงูู ูููุงูุญุฉ ุงูุนุฏูู
    container.innerHTML = `
      <div class="grid-cards">
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ููุซุงู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู ูุนุชูุฏ</span>
          </label>
          <div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>
        </div>
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ุณูุงุณุฉ ุจุฑูุงูุฌ ููุงูุญุฉ ุงูุนุฏูู ูุนุชูุฏุฉ</span>
          </label>
          <div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>
        </div>
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ุณูุงุณุฉ ุบุณู ุงููุฏูู ูุนุชูุฏุฉ</span>
          </label>
          <div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>
        </div>
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ุฅุฌุฑุงุกุงุช ุงูุชุนุฑุถ ุงููุฎุฒู ูุนุชูุฏุฉ</span>
          </label>
        </div>
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ูุธุงู ูุฑุงูุจุฉ ุงูุนุฏูู ููุนู</span>
          </label>
        </div>
        <div class="p-4 rounded-xl border bg-white shadow-sm">
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5">
            <span class="font-semibold">ุจุฑูุงูุฌ ุชุฏุฑูุจ IPC ูููุฐ</span>
          </label>
        </div>
      </div>
      <div class="pt-4 flex gap-3">
        <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="alert('โ ูุญุต ูุชุทูุจุงุช IPC: ุฌุงุฑู ุงูุชุญูู...')">ุชุญููู ูู ุงูุงูุชูุงู</button>
        <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="alert('๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ IPC: 6/6 ูุชุทูุจุงุช ููุชููุฉ')">ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ</button>
      </div>
    `;
  }

  // ====== ุฏูุงู ุฅุฏุงุฑุฉ ุงูุฃูุงู ูู IPC ======
  function ipcShowSecurity() {
    const isOn = SecureStore.isOn();
    const passphrase = prompt(
      isOn ? 'ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ ุงูุญุงููุฉ ูุฅููุงู ุงูุญูุงูุฉ:' : 'ุชุนููู ูููุฉ ูุฑูุฑ ูุญูุงูุฉ ุจูุงูุงุช IPC (ุงุฎุชูุงุฑู):'
    );
    if (passphrase === null) return;
    
    if (isOn) {
      SecureStore.clearPassphrase();
      alert('๐ ุชู ุฅููุงู ุงูุญูุงูุฉ.');
    } else {
      if (passphrase.length < 4) {
        alert('ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 4 ุฃุญุฑู ุนูู ุงูุฃูู.');
        return;
      }
      SecureStore.setPassphrase(passphrase).then(success => {
        if (success) alert('๐ ุชู ุชูุนูู ุงูุญูุงูุฉ.');
      });
    }
  }

  function ipcExportAll() {
    // ูู ุจูุฆุฉ ุญููููุฉุ ุณูุชู ุฌูุน ุงูุจูุงูุงุช ูู localStorage ูุชุตุฏูุฑูุง
    alert('โฌ๏ธ ูู ุจูุฆุฉ ุญููููุฉุ ุณูุชู ุชุตุฏูุฑ ุฌููุน ุจูุงูุงุช IPC ุจุชูุณูู JSON.');
  }

  function ipcImportAll(file) {
    // ูู ุจูุฆุฉ ุญููููุฉุ ุณูุชู ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ูู ููู JSON
    alert('โฌ๏ธ ูู ุจูุฆุฉ ุญููููุฉุ ุณูุชู ุงุณุชูุฑุงุฏ ุจูุงูุงุช IPC ูู ููู JSON.');
  }
// ====== ููุชุจุฉ ูุซุงุฆู FMS ======
const FMS_DOCS_LIBRARY = [
  { code:'LOG-FMS-2025-005', name:'ุณุฌู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ', category:'LOG', url:'https://drive.google.com/file/d/10QjYYiAppgrOJpb6F2GxxwmRgRt2ooNOClo0etgzWpw/preview' },
  { code:'PLN-FMS-2025-018', name:'ุฎุทุฉ ุงูุฃูู ุงููุงุฏู ูููุฑุงูู', category:'PLN', url:'https://drive.google.com/file/d/1aF0KTinNcF3gMIotj_byzrAkubX6Y30nZWmVuFM7BcA/preview' },
  { code:'LOG-FMS-2025-014', name:'ุณุฌู ุฒูุงุฑุงุช ุงูุฏูุงุน ุงููุฏูู ูุงูุฌูุงุช ุงูุชูุธูููุฉ', category:'LOG', url:'https://drive.google.com/file/d/1VMNxaSlkz_LX4OqktVHQsj1IT-GA6Y3eUnZa2rgegMA/preview' },
  { code:'POL-FMS-2025-015', name:'ุณูุงุณุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุงูููุงุก ูุงูุชูููุฉ', category:'POL', url:'https://drive.google.com/file/d/18caApXqHeQSZdBFSvgyIKICX0qMSsN7UuRxz3u7R10o/preview' },
  { code:'CHK-FMS-2025-003', name:'ูุงุฆูุฉ ุงูุชุญูู ุงูุฏูุฑูุฉ ููุณูุงูุฉ', category:'CHK', url:'https://drive.google.com/file/d/1C07oXDzj_Vfok81wQUde3P-ExeXhJh6LDwOS35jTDpk/preview' },
  { code:'CHK-FMS-2025-009', name:'ุณุฌู ุฌููุงุช ูุฌูุฉ ุงูุณูุงูุฉ', category:'CHK', url:'https://drive.google.com/file/d/1fKMIzns80N9IeSU18WudplOpA8DmbL4zmq72PRUmfZw/preview' },
  { code:'PLN-FMS-2025-012', name:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ูุงูููุงู', category:'PLN', url:'https://drive.google.com/file/d/1b8oP_LOE_k7A0qXqhhVKWXF9zAvJMuSUOLFc1rBoflA/preview' },
  { code:'SOP-FMS-2025-002', name:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู ุงูููุงุณูุฉ ููุฌููุงุช ููุญุต ุงูุฃูุธูุฉ', category:'SOP', url:'https://drive.google.com/file/d/1mrKI8YTjSphAk-noRO8sp9GhYYLzR1FCBti2EDyDZOU/preview' },
  { code:'FRM-FMS-2025-011', name:'ูููุฐุฌ ุชูููู ุงููุฎุงุทุฑ ุงูุจูุฆูุฉ ูุงููุงุฏูุฉ', category:'FRM', url:'https://drive.google.com/file/d/15uefBzxMrX33-lBCHP3sZb_OZqoQ4hyiymQRnBrN_jo/preview' },
  { code:'FRM-FMS-2025-017', name:'ูููุฐุฌ ูุชุงุจุนุฉ ุชูููุฐ ุงูุชูุตูุงุช', category:'FRM', url:'https://drive.google.com/file/d/1Z7Bof_s4Dchx3G5tPzHAC77M4EDVGaxKVRlvJG_wMNY/preview' },
  { code:'LOG-FMS-2025-006', name:'ุณุฌู ุงูุญูุงุฏุซ ูุงูููุงุญุธุงุช', category:'LOG', url:'https://drive.google.com/file/d/12D_ESZYNwjEfKZM6C0yzswbsccugSZZBOcMdHELd3TY/preview' },
  { code:'REP-FMS-2025-013', name:'ุชูุฑูุฑ ุงูุญูุงุฏุซ ุงูุทุงุฑุฆุฉ', category:'REP', url:'https://drive.google.com/file/d/126D1IVGQpoCUxXZeNlob1fBD0LkXeNQdITDzL5OLXn0/preview' },
  { code:'PLN-FMS-2025-016', name:'ุฎุทุฉ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ', category:'PLN', url:'https://drive.google.com/file/d/1tQYPW6VHtr1liM7qMoPGgzDxopw9njYivS7WyKxokZw/preview' },
  { code:'POL-FMS-2025-001', name:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู', category:'POL', url:'https://drive.google.com/file/d/1YS1Jk5FgwJoY5in71yUQ1oIjE4JEsaecMGWTt00aQ0o/preview' },
  { code:'REP-FMS-2025-008', name:'ุชูุฑูุฑ ูุญุต ุงูุทูุงูุงุช ูุฃูุธูุฉ ุงูุฅูุฐุงุฑ', category:'REP', url:'https://drive.google.com/file/d/1Doz1piFf3dnYXKYtWoV4ExjXG_gmgRLVXkP7ej0sw9E/preview' },
  { code:'TRN-FMS-2025-010', name:'ุฎุทุฉ ุชุฏุฑูุจ ุงูุฃูู ูุงูุณูุงูุฉ', category:'TRN', url:'https://drive.google.com/file/d/1IwnBiZp11BjIDQLUtT5Ntr7kEhv3jmssvF5Vj6D7yRk/preview' },
  { code:'DEC-FMS-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุงูุณูุงูุฉ', category:'DEC', url:'https://drive.google.com/file/d/1KJcIqUbXfHIH0qt1UwoJ0Dohc_7n-745rhx90shaqNg/preview' },
  { code:'PLN-FMS-2025-007', name:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูููุงูุงุช', category:'PLN', url:'https://drive.google.com/file/d/1iSoFBh8u4uTHzDJECxyjlEMeWqaScZwezgOXygEVdso/preview' },
  { code:'PLN-FMS-2025-004', name:'ุฎุทุฉ ุงูุทูุงุฑุฆ ูุงูุฅุฎูุงุก', category:'PLN', url:'https://drive.google.com/file/d/1rPIuA5g52gQSroaaxznZ_SQNOj1TjEDuZ9DF0j3jvf4/preview' },
  { code:'FMS_Docs_2025_endorsed', name:'ููุฑุณ ูุซุงุฆู FMS ุงููุนุชูุฏุฉ 2025', category:'INDEX', url:'https://drive.google.com/file/d/1fTJG9dYRDsgBo0UFSKWlOIkVLkKCY0zO/preview' }
];

const FMS_CATEGORY_NAMES = {
  POL: 'ุงูุณูุงุณุงุช',
  SOP: 'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', 
  DEC: 'ุงููุฑุงุฑุงุช',
  PLN: 'ุงูุฎุทุท',
  TRN: 'ุงูุชุฏุฑูุจ',
  LOG: 'ุงูุณุฌูุงุช',
  CHK: 'ููุงุฆู ุงูุชุญูู',
  FRM: 'ุงูููุงุฐุฌ',
  REP: 'ุงูุชูุงุฑูุฑ',
  INDEX: 'ุงูููุฑุณ'
};

// ====== ุฏูุงู FMS ุงูุฃุณุงุณูุฉ ======
function switchFmsTab(tab) {
  const section = document.getElementById('fms');
  const container = document.getElementById('fmsTabContent');
  if (!section || !container) return;

  // ุงูุญุงูุฉ ุงููุฑุฆูุฉ + ARIA ููุฃุฒุฑุงุฑ
  const buttons = section.querySelectorAll('[data-fms-tab]');
  buttons.forEach(btn => {
    const isActive = btn.getAttribute('data-fms-tab') === tab;
    btn.classList.toggle('bg-[var(--brand1)]', isActive);
    btn.classList.toggle('text-white', isActive);
    btn.classList.toggle('bg-gray-100', !isActive);
    btn.setAttribute('role', 'tab');
    btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
    btn.setAttribute('aria-controls', 'fmsTabContent');
  });
// ููุญ ุงูุชุจููุจ
container.innerHTML = '';
container.setAttribute('role', 'tabpanel');
const activeBtn = section.querySelector(`[data-fms-tab="${tab}"]`);
if (activeBtn && activeBtn.id) container.setAttribute('aria-labelledby', activeBtn.id);

if (tab === 'library')       renderFmsLibrary(container);
else if (tab === 'rounds')   renderFmsRounds(container);
else if (tab === 'needs')    renderFmsNeeds(container);
else if (tab === 'calibration') renderFmsCalibration(container);
else container.innerHTML = `<div class="p-4 rounded-lg bg-amber-50 text-amber-800">ุชุจููุจ ุบูุฑ ูุนุฑูู: ${tab}</div>`;
}

function renderFmsLibrary(container) {
  // ุนูุงุตุฑ ุงูุชุญูู
  const categories = [...new Set(FMS_DOCS_LIBRARY.map(doc => doc.category))];
  const controls = document.createElement('div');
  controls.className = 'flex flex-wrap items-center gap-2 mb-4';
  controls.innerHTML = `
    <div class="flex flex-wrap gap-2">
      <button data-fms-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
      ${categories.map(cat => 
        `<button data-fms-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${FMS_CATEGORY_NAMES[cat] || cat}</button>`
      ).join('')}
    </div>
    <div class="ml-auto w-full md:w-64">
      <input id="fmsSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
    </div>
  `;
  
  const grid = document.createElement('div');
  grid.className = 'grid-cards';
  grid.id = 'fmsGrid';
  
  container.appendChild(controls);
  container.appendChild(grid);
  
  // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
  function renderFilteredDocs(filter = 'ALL', query = '') {
    grid.innerHTML = '';
    const searchQuery = query.toLowerCase();
    
    const filteredDocs = FMS_DOCS_LIBRARY.filter(doc => {
      const matchesFilter = filter === 'ALL' || doc.category === filter;
      const matchesQuery = !searchQuery || 
        doc.code.toLowerCase().includes(searchQuery) || 
        doc.name.toLowerCase().includes(searchQuery);
      return matchesFilter && matchesQuery;
    });
    
    filteredDocs.forEach(doc => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
      card.innerHTML = `
        <div class="text-xs text-gray-500 mb-1">${FMS_CATEGORY_NAMES[doc.category] || doc.category}</div>
        <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
        <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
        <div class="mt-3 flex gap-2">
          <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                  onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
            <i class="fas fa-eye ml-1"></i> ุนุฑุถ
          </button>
          <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
             target="_blank" href="${doc.url.replace('/preview','/view')}">
            <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
          </a>
        </div>
      `;
      grid.appendChild(card);
    });
  }
  
  // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
  controls.querySelectorAll('button[data-fms-filter]').forEach(button => {
    button.addEventListener('click', () => {
      controls.querySelectorAll('button[data-fms-filter]').forEach(btn => {
        btn.classList.remove('bg-[var(--brand1)]', 'text-white');
      });
      button.classList.add('bg-[var(--brand1)]', 'text-white');
      renderFilteredDocs(button.getAttribute('data-fms-filter'), document.getElementById('fmsSearch').value);
    });
  });
  
  document.getElementById('fmsSearch').addEventListener('input', (e) => {
    const activeFilter = controls.querySelector('button[data-fms-filter].bg-[var(--brand1)]') || 
                        { getAttribute: () => 'ALL' };
    renderFilteredDocs(activeFilter.getAttribute('data-fms-filter'), e.target.value);
  });
  
  // ุงูุชููุฆุฉ ุงูุฃูููุฉ
  renderFilteredDocs('ALL', '');
}

function renderFmsRounds(container) {
  const wrapper = document.createElement('div');
  wrapper.className = 'space-y-6';
  
  // ูููุฐุฌ ุฌููุฉ ุงูุณูุงูุฉ ุงูุฅููุชุฑููู
  const safetyRoundForm = document.createElement('div');
  safetyRoundForm.className = 'border rounded-xl p-4 bg-white';
  safetyRoundForm.innerHTML = `
    <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูููุฐุฌ ุฌููุฉ ุงูุณูุงูุฉ ุงูุฅููุชุฑููู</h3>
    <form id="fmsSafetyRoundForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุฌููุฉ *</label>
        <input type="date" name="round_date" required class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ููุช ุงูุฌููุฉ *</label>
        <input type="time" name="round_time" required class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุงููุณุคูู ุนู ุงูุฌููุฉ *</label>
        <input name="round_responsible" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุณุคูู">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุงูููุทูุฉ ุงูููุญูุตุฉ *</label>
        <select name="round_area" required class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงูููุทูุฉ</option>
          <option value="ุงูุนูุงุฏุงุช">ุงูุนูุงุฏุงุช</option>
          <option value="ุงููุฎุชุจุฑ">ุงููุฎุชุจุฑ</option>
          <option value="ุงูุฃุดุนุฉ">ุงูุฃุดุนุฉ</option>
          <option value="ุงูุตูุฏููุฉ">ุงูุตูุฏููุฉ</option>
          <option value="ุงูุทูุงุฑุฆ">ุงูุทูุงุฑุฆ</option>
          <option value="ุงูููุงุชุจ ุงูุฅุฏุงุฑูุฉ">ุงูููุงุชุจ ุงูุฅุฏุงุฑูุฉ</option>
          <option value="ุงูููุฑุงุช ูุงููุฏุงุฎู">ุงูููุฑุงุช ูุงููุฏุงุฎู</option>
        </select>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold mb-1">ุงูููุงุญุธุงุช ุงูุฅูุฌุงุจูุฉ</label>
        <textarea name="positive_notes" rows="2" class="w-full border rounded-lg px-3 py-2" placeholder="ุงูููุงุญุธุงุช ุงูุฅูุฌุงุจูุฉ..."></textarea>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold mb-1">ุงููุฎุงุทุฑ / ุงูููุงุญุธุงุช ุงูุณูุจูุฉ</label>
        <textarea name="negative_notes" rows="2" class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุฎุงุทุฑ ูุงูููุงุญุธุงุช ุงูุณูุจูุฉ..."></textarea>
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold mb-1">ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ</label>
        <textarea name="actions_taken" rows="2" class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุฅุฌุฑุงุกุงุช ุงููุชุฎุฐุฉ..."></textarea>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงููุชุงุจุนุฉ</label>
        <input type="date" name="followup_date" class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ูุณุคูู ุงููุชุงุจุนุฉ</label>
        <input name="followup_responsible" class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ูุณุคูู ุงููุชุงุจุนุฉ">
      </div>
      <div class="md:col-span-2 flex items-center gap-3 pt-2">
        <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุฌููุฉ</button>
        <span id="fmsRoundMsg" class="text-sm"></span>
      </div>
    </form>
  `;
  
  // ูููุฐุฌ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ
  const maintenanceForm = document.createElement('div');
  maintenanceForm.className = 'border rounded-xl p-4 bg-white';
  maintenanceForm.innerHTML = `
    <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ง ูููุฐุฌ ุงูุตูุงูุฉ ุงูููุงุฆูุฉ</h3>
    <form id="fmsMaintenanceForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุตูุงูุฉ *</label>
        <input type="date" name="maintenance_date" required class="w-full border rounded-lg px-3 py-2">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ููุน ุงูุฌูุงุฒ / ุงููุธุงู *</label>
        <select name="equipment_type" required class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงูููุน</option>
          <option value="ูุธุงู ุงูุชูููู">ูุธุงู ุงูุชูููู</option>
          <option value="ูุธุงู ุงูููุฑุจุงุก">ูุธุงู ุงูููุฑุจุงุก</option>
          <option value="ูุธุงู ุงูููุงู">ูุธุงู ุงูููุงู</option>
          <option value="ูุธุงู ุงูุฅูุฐุงุฑ">ูุธุงู ุงูุฅูุฐุงุฑ</option>
          <option value="ุงูุทูุงูุงุช">ุงูุทูุงูุงุช</option>
          <option value="ูุนุฏุงุช ุทุจูุฉ">ูุนุฏุงุช ุทุจูุฉ</option>
          <option value="ุฃุฎุฑู">ุฃุฎุฑู</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุฑูู/ููุงู ุงูุฌูุงุฒ *</label>
        <input name="equipment_location" required class="w-full border rounded-lg px-3 py-2" placeholder="ุฑูู ุฃู ููุงู ุงูุฌูุงุฒ">
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุงูููู ุงููุณุคูู *</label>
        <input name="technician" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงูููู">
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-semibold mb-1">ุฃุนูุงู ุงูุตูุงูุฉ ุงููููุฐุฉ *</label>
        <textarea name="maintenance_work" rows="3" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุตู ุฃุนูุงู ุงูุตูุงูุฉ..."></textarea>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุงูุญุงูุฉ ุจุนุฏ ุงูุตูุงูุฉ *</label>
        <select name="status_after" required class="w-full border rounded-lg px-3 py-2">
          <option value="">ุงุฎุชุฑ ุงูุญุงูุฉ</option>
          <option value="ุฌูุฏ">ุฌูุฏ</option>
          <option value="ุจุญุงุฌุฉ ููุทุน ุบูุงุฑ">ุจุญุงุฌุฉ ููุทุน ุบูุงุฑ</option>
          <option value="ูุชุทูุจ ุตูุงูุฉ ูุชุฎุตุตุฉ">ูุชุทูุจ ุตูุงูุฉ ูุชุฎุตุตุฉ</option>
          <option value="ุฎุงุฑุฌ ุงูุฎุฏูุฉ">ุฎุงุฑุฌ ุงูุฎุฏูุฉ</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุตูุงูุฉ ุงููุงุฏูุฉ</label>
        <input type="date" name="next_maintenance" class="w-full border rounded-lg px-3 py-2">
      </div>
      <div class="md:col-span-2 flex items-center gap-3 pt-2">
        <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุตูุงูุฉ</button>
        <span id="fmsMaintenanceMsg" class="text-sm"></span>
      </div>
    </form>
  `;
  
  wrapper.appendChild(safetyRoundForm);
  wrapper.appendChild(maintenanceForm);
  container.appendChild(wrapper);
  
  // ูุนุงูุฌุฉ ูููุฐุฌ ุฌููุฉ ุงูุณูุงูุฉ
  const safetyRoundFormElement = document.getElementById('fmsSafetyRoundForm');
  if (safetyRoundFormElement) {
    safetyRoundFormElement.addEventListener('submit', function(e) {
      e.preventDefault();
      const messageElement = document.getElementById('fmsRoundMsg');
      messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงูุฌููุฉ...';
      messageElement.className = 'text-sm text-blue-600';
      
      // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
      const formData = new FormData(safetyRoundFormElement);
      const roundData = {};
      formData.forEach((value, key) => { roundData[key] = value; });
      roundData.timestamp = new Date().toISOString();
      
      let rounds = JSON.parse(localStorage.getItem('fms_safety_rounds') || '[]');
      rounds.push(roundData);
      localStorage.setItem('fms_safety_rounds', JSON.stringify(rounds));
      
      messageElement.textContent = 'โ ุชู ุญูุธ ุงูุฌููุฉ ุจูุฌุงุญ';
      messageElement.className = 'text-sm text-green-600';
      safetyRoundFormElement.reset();
    });
  }
  
  // ูุนุงูุฌุฉ ูููุฐุฌ ุงูุตูุงูุฉ
  const maintenanceFormElement = document.getElementById('fmsMaintenanceForm');
  if (maintenanceFormElement) {
    maintenanceFormElement.addEventListener('submit', function(e) {
      e.preventDefault();
      const messageElement = document.getElementById('fmsMaintenanceMsg');
      messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุจูุงูุงุช ุงูุตูุงูุฉ...';
      messageElement.className = 'text-sm text-blue-600';
      
      // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู
      const formData = new FormData(maintenanceFormElement);
      const maintenanceData = {};
      formData.forEach((value, key) => { maintenanceData[key] = value; });
      maintenanceData.timestamp = new Date().toISOString();
      
      let maintenanceRecords = JSON.parse(localStorage.getItem('fms_maintenance_records') || '[]');
      maintenanceRecords.push(maintenanceData);
      localStorage.setItem('fms_maintenance_records', JSON.stringify(maintenanceRecords));
      
      messageElement.textContent = 'โ ุชู ุญูุธ ุจูุงูุงุช ุงูุตูุงูุฉ ุจูุฌุงุญ';
      messageElement.className = 'text-sm text-green-600';
      maintenanceFormElement.reset();
    });
  }
}

function renderFmsNeeds(container) {
  const needs = [
    { key: 'policy', text: 'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู ูุนุชูุฏุฉ (POL-FMS-2025-001)', required: true },
    { key: 'committee', text: 'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุงูุณูุงูุฉ ููุนู (DEC-FMS-2025-001)', required: true },
    { key: 'emergency_plan', text: 'ุฎุทุฉ ุงูุทูุงุฑุฆ ูุงูุฅุฎูุงุก ูุนุชูุฏุฉ (PLN-FMS-2025-004)', required: true },
    { key: 'maintenance_plan', text: 'ุฎุทุฉ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ ูุนุชูุฏุฉ (PLN-FMS-2025-016)', required: true },
    { key: 'waste_plan', text: 'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูููุงูุงุช ูุนุชูุฏุฉ (PLN-FMS-2025-007)', required: true },
    { key: 'security_plan', text: 'ุฎุทุฉ ุงูุฃูู ุงููุงุฏู ูููุฑุงูู ูุนุชูุฏุฉ (PLN-FMS-2025-018)', required: true },
    { key: 'training_plan', text: 'ุฎุทุฉ ุชุฏุฑูุจ ุงูุฃูู ูุงูุณูุงูุฉ ูููุฐุฉ (TRN-FMS-2025-010)', required: true },
    { key: 'safety_rounds', text: 'ุณุฌู ุฌููุงุช ุงูุณูุงูุฉ ูุญุฏุซ (CHK-FMS-2025-009)', required: true },
    { key: 'maintenance_logs', text: 'ุณุฌู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ ูุญุฏุซ (LOG-FMS-2025-005)', required: true },
    { key: 'incident_logs', text: 'ุณุฌู ุงูุญูุงุฏุซ ูุงูููุงุญุธุงุช ูุญุฏุซ (LOG-FMS-2025-006)', required: true },
  ];

  const wrapper = document.createElement('div');
  wrapper.className = 'grid-cards';
  
  needs.forEach(need => {
    const card = document.createElement('div');
    card.className = 'p-4 rounded-xl border bg-white shadow-sm';
    card.innerHTML = `
      <label class="flex items-start gap-3 cursor-pointer">
        <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
        <span class="font-semibold">${need.text}</span>
      </label>
      ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
    `;
    card.querySelector('input').addEventListener('change', ()=>{/* placeholder for future persistence */});
    wrapper.appendChild(card);
  });
  
  const actions = document.createElement('div');
  actions.className = 'pt-4 flex gap-3';
  actions.innerHTML = `
    <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateFmsNeeds()">
      ุชุญููู ูู ุงูุงูุชูุงู
    </button>
    <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generateFmsReport()">
      ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ
    </button>
  `;
  
  container.appendChild(wrapper);
  container.appendChild(actions);
}

// ============ ูุนุงูุฑุฉ ุงูุฃุฌูุฒุฉ (CAL) โ ูุณุฎุฉ ูุญููุฉ ูุน ุฅุญุตุงุกุงุช + ุฌุฏูู ุซุงุจุช + ูููุฐุฌ ============
function renderFmsCalibration(container) {
  // ุฃูุณุงู / ุฃุฌูุฒุฉ / ุงุฎุชุจุงุฑุงุช ุงูุชุฑุงุถูุฉ (ูููู ูุงุญููุง ุชุญููููุง ูู ุงูู API ุฅู ุฑุบุจุช)
  const DEPT_LABEL = { RAD:'๐ฉป ูุณู ุงูุฃุดุนุฉ', LAB:'๐งช ูุณู ุงููุฎุชุจุฑ', CSSD:'๐งด ูุณู ุงูุชุนููู (CSSD)', ER:'โก ูุณู ุงูุทูุงุฑุฆ (ER)' };
  const ASSETS_MAP = {
    RAD: ['X-Ray','Portable X-Ray','Dental X-Ray','Mammogram','Ultrasound'],
    LAB: ['Biochemistry Analyzer','Hematology Analyzer','Centrifuge','Micropipettes','Incubator','Refrigerator'],
    CSSD: ['Autoclave (Steam)','Dry Heat Sterilizer','Sealing Machine','Ultrasonic Cleaner'],
    ER: ['Defibrillator (DC Shock)','ECG Monitor','Suction Machine','Oxygen Flowmeter','Pulse Oximeter']
  };
  const TESTS_BY_ASSET = {
    'X-Ray': ['kVp Accuracy','mAs Linearity','Exposure Reproducibility'],
    'Portable X-Ray': ['Output Consistency','Timer Accuracy'],
    'Dental X-Ray': ['Beam Alignment','kVp Accuracy'],
    'Mammogram': ['AEC Performance','Contrast Resolution'],
    'Ultrasound': ['Axial Resolution','Depth Calibration'],
    'Biochemistry Analyzer': ['Precision (CV%)','Accuracy (Bias)'],
    'Hematology Analyzer': ['Background Count','Linearity'],
    'Centrifuge': ['RPM Accuracy','Timer Accuracy'],
    'Micropipettes': ['Volume Accuracy','Leak Test'],
    'Incubator': ['Temperature Stability','Uniformity'],
    'Refrigerator': ['Temperature Mapping','Alarm Check'],
    'Autoclave (Steam)': ['Bowie-Dick Test','Biological Indicator'],
    'Dry Heat Sterilizer': ['Temp Uniformity','Timer Accuracy'],
    'Sealing Machine': ['Seal Integrity','Temp Setting'],
    'Ultrasonic Cleaner': ['Cavitation Test','Timer Accuracy'],
    'Defibrillator (DC Shock):':['Energy Output','Charging Time'],
    'ECG Monitor': ['Heart Rate Accuracy','Alarm Function'],
    'Suction Machine': ['Vacuum Pressure','Flow Rate'],
    'Oxygen Flowmeter': ['Flow Accuracy','Leak Test'],
    'Pulse Oximeter': ['SpO2 Accuracy','Probe Check']
  };
  const FREQ_OPTIONS = [
    {label:'ุฃุณุจูุนู', months:0, days:7},
    {label:'ุดูุฑู', months:1, days:0},
    {label:'ุฑุจุน ุณููู (3 ุฃุดูุฑ)', months:3, days:0},
    {label:'ูุตู ุณููู (6 ุฃุดูุฑ)', months:6, days:0},
    {label:'ุณููู', months:12, days:0}
  ];
  const KEY = 'fms_calibration_records';

  // ูุงุด ูุญูู
  function safeParseLocal(k){ try{ return JSON.parse(localStorage.getItem(k)||'[]'); } catch(_){ return []; } }
  function toISO(d){ return new Date(d).toISOString().slice(0,10); }
  function daysLeftStr(iso){
    if (!iso) return 'โ';
    const d = new Date(iso);
    const dl = Math.floor((d - new Date())/(1000*3600*24));
    if (isNaN(dl)) return 'โ';
    return dl >= 0 ? `${dl} ููู` : `ูุชุฃุฎุฑ ${Math.abs(dl)} ููู`;
  }

  // ุฅุญุตุงุกุงุช ูู ุงููุงุด
  const cache = safeParseLocal(KEY);
  const counters = { pass:0, fail:0, upcoming:0, overdue:0, nosched:0 };
  const now = new Date();
  cache.forEach(r=>{
    const res = (r.result||'').toLowerCase();
    if (res==='pass') counters.pass++;
    else if (res==='fail') counters.fail++;
    const nd = r.next_due ? new Date(r.next_due) : null;
    if (!nd) counters.nosched++;
    else {
      const dl = Math.floor((nd - now)/(1000*3600*24));
      if (dl<0) counters.overdue++;
      else if (dl<=30) counters.upcoming++;
    }
  });

  container.innerHTML = `
    <div class="space-y-6">

      <!-- ุดุฑูุท ุนููู: ุฒุฑ ูุชุญ ุณุฌู Google ูุดุฑุญ ูุฎุชุตุฑ -->
      <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-3">
        <div class="text-sm text-gray-700">
          ุนูุฏ ุงูุญูุธ: ุชููุดุฃ ุดูุงุฏุฉ PDF ุชููุงุฆููุง ูุชูุฑูุน ุฅูู ูุฌูุฏ ุงููุณู ุงูุตุญูุญ ูู Google Driveุ ูููุณุฌู ุงูุณุฌู ูู Google Sheet.
        </div>
        <a href="${CAL_SHEET_URL}" target="_blank" rel="noopener noreferrer"
           class="px-3 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">
          ๐ ูุชุญ โุณุฌู ูุนุงูุฑุฉ ุงูุฃุฌูุฒุฉโ
        </a>
      </div>

      <!-- ููุญุฉ ุงูุฅุญุตุงุกุงุช -->
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
        <div class="p-4 rounded-xl border bg-white">
          <div class="text-sm text-gray-600 mb-1">โ Pass</div>
          <div class="text-3xl font-extrabold text-green-600" id="calStatPass">${counters.pass}</div>
        </div>
        <div class="p-4 rounded-xl border bg-white">
          <div class="text-sm text-gray-600 mb-1">โ Fail</div>
          <div class="text-3xl font-extrabold text-red-600" id="calStatFail">${counters.fail}</div>
        </div>
        <div class="p-4 rounded-xl border bg-white">
          <div class="text-sm text-gray-600 mb-1">โณ ุฎูุงู 30 ููู</div>
          <div class="text-3xl font-extrabold text-amber-600" id="calStatUpcoming">${counters.upcoming}</div>
        </div>
        <div class="p-4 rounded-xl border bg-white">
          <div class="text-sm text-gray-600 mb-1">โ๏ธ ูุชุฃุฎุฑ</div>
          <div class="text-3xl font-extrabold text-rose-600" id="calStatOverdue">${counters.overdue}</div>
        </div>
        <div class="p-4 rounded-xl border bg-white">
          <div class="text-sm text-gray-600 mb-1">โ ุจูุง ููุนุฏ</div>
          <div class="text-3xl font-extrabold text-gray-800" id="calStatNosched">${counters.nosched}</div>
        </div>
      </div>

      <!-- ุฌุฏูู ุซุงุจุช ููุฃูุณุงู -->
      <div class="calibration-table-wrapper" dir="rtl" style="background:#fff;border-radius:16px;padding:24px;box-shadow:0 4px 10px rgba(0,0,0,0.08);max-width:1100px;margin:0 auto;">
        <h2 style="text-align:center;color:#7B1E24;font-weight:700;margin-bottom:20px;border-bottom:3px solid #E9C46A;display:inline-block;padding-bottom:6px;">
          ๐งพ ุฌุฏูู ูุนุงูุฑุฉ ุงูุฃุฌูุฒุฉ ุงูุทุจูุฉ โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ (ุงูุฅุตุฏุงุฑ 2025)
        </h2>
        <table class="calibration-table" style="width:100%;border-collapse:collapse;text-align:center;direction:rtl;">
          <thead>
            <tr>
              <th style="background:#7B1E24;color:#E9C46A;padding:12px;border-bottom:2px solid #E9C46A;">ุงููุณู</th>
              <th style="background:#7B1E24;color:#E9C46A;padding:12px;border-bottom:2px solid #E9C46A;">ุงูุฃุฌูุฒุฉ</th>
              <th style="background:#7B1E24;color:#E9C46A;padding:12px;border-bottom:2px solid #E9C46A;">ุงูุชูุฑุงุฑ</th>
              <th style="background:#7B1E24;color:#E9C46A;padding:12px;border-bottom:2px solid #E9C46A;">ุงููุณุคูู</th>
              <th style="background:#7B1E24;color:#E9C46A;padding:12px;border-bottom:2px solid #E9C46A;">ุงูุฌูุฉ/ุงูุชูุซูู</th>
            </tr>
          </thead>
          <tbody>
            <tr><td style="background:#faf7f6;padding:10px;font-weight:bold;color:#7B1E24;">๐ฉป ุงูุฃุดุนุฉ</td><td style="background:#faf7f6;padding:10px;">X-Ray / Portable / Dental / Mammogram / Ultrasound</td><td style="background:#faf7f6;padding:10px;">ุณููููุง</td><td style="background:#faf7f6;padding:10px;">ุฃ. ุจูุงู ูุชู</td><td style="background:#faf7ู6;padding:10px;">NRRC โ LOG-FMS-2025-021</td></tr>
            <tr><td style="background:#fdf9f7;padding:10px;font-weight:bold;color:#7B1E24;">๐งช ุงููุฎุชุจุฑ</td><td style="background:#fdf9f7;padding:10px;">Biochem / Heme / Centrifuge / Micropipettes / Incubator / Refrigerator</td><td style="background:#fdf9f7;padding:10px;">ูุตู ุณููู/ุณููู</td><td style="background:#fdf9f7;padding:10px;">ุฃ. ููุซู ุงูุฌุนูู</td><td style="background:#fdf9f7;padding:10px;">FMS Approved Vendors โ LOG-FMS-2025-020</td></tr>
            <tr><td style="background:#faf7f6;padding:10px;font-weight:bold;color:#7B1E24;">๐งด CSSD</td><td style="background:#faf7f6;padding:10px;">Autoclave / Dry Heat / Sealer / Ultrasonic</td><td style="background:#faf7f6;padding:10px;">ุณููููุง</td><td style="background:#faf7f6;padding:10px;">ุฏ. ูุฌุฏู ุนุณูุฑ</td><td style="background:#faf7f6;padding:10px;">Indicators โ LOG-FMS-2025-022</td></tr>
            <tr><td style="background:#fdf9f7;padding:10px;font-weight:bold;color:#7B1E24;">โก ุงูุทูุงุฑุฆ</td><td style="background:#fdf9f7;padding:10px;">Defib / ECG / Suction / O2 Flow / PulseOx</td><td style="background:#fdf9f7;padding:10px;">ุณููู + ูููู</td><td style="background:#fdf9f7;padding:10px;">ุฏ. ูุนุงุฐ ุงูุจููุด</td><td style="background:#fdf9f7;padding:10px;">FMS+EOC โ LOG-FMS-2025-023</td></tr>
          </tbody>
        </table>
      </div>

      <!-- ุงููููุฐุฌ -->
      <div class="border rounded-xl p-4 bg-white">
        <h4 class="font-bold mb-3">โ ุฅุถุงูุฉ ุณุฌู ูุนุงูุฑุฉ</h4>
        <form id="fmsCalForm" class="grid grid-cols-1 md:grid-cols-2 gap-4" novalidate>
          <div>
            <label class="block text-sm font-semibold mb-1">ุงููุณู *</label>
            <select name="department" id="calDept" required class="w-full border rounded-lg px-3 py-2">
              <option value="">ุงุฎุชุฑ ุงููุณู</option>
              <option value="RAD">๐ฉป ูุณู ุงูุฃุดุนุฉ</option>
              <option value="LAB">๐งช ูุณู ุงููุฎุชุจุฑ</option>
              <option value="CSSD">๐งด ูุณู ุงูุชุนููู (CSSD)</option>
              <option value="ER">โก ูุณู ุงูุทูุงุฑุฆ (ER)</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ุงุณู ุงููุณุคูู *</label>
            <input name="staff" id="calStaff" list="staffList" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฎุชุฑ/ุงูุชุจ ุงูุงุณู">
            <datalist id="staffList"></datalist>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ุงูุฌูุงุฒ *</label>
            <select name="asset" id="calAsset" required class="w-full border rounded-lg px-3 py-2">
              <option value="">ุงุฎุชุฑ ุงูุฌูุงุฒ</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ููุน ุงูุงุฎุชุจุงุฑ *</label>
            <select name="test_name" id="calTest" required class="w-full border rounded-lg px-3 py-2">
              <option value="">ุงุฎุชุฑ ููุน ุงูุงุฎุชุจุงุฑ</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงููุนุงูุฑุฉ *</label>
            <input type="date" name="date" id="calDate" required class="w-full border rounded-lg px-3 py-2">
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ุงูุชูุฑุงุฑ *</label>
            <select name="frequency" id="calFreq" required class="w-full border rounded-lg px-3 py-2">
              ${FREQ_OPTIONS.map((f,i)=>`<option value="${i}">${f.label}</option>`).join('')}
            </select>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-1">ุงููุชูุฌุฉ *</label>
            <select name="result" id="calResult" required class="w-full border rounded-lg px-3 py-2">
              <option value="Pass">Pass (ูุทุงุจู)</option>
              <option value="Fail">Fail (ุบูุฑ ูุทุงุจู)</option>
            </select>
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-semibold mb-1">ุงููููุน (ุบุฑูุฉ/ุฑูุฒ)</label>
            <input name="location" id="calLocation" list="roomList" class="w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: XR-01 / LAB-INC-02">
            <datalist id="roomList"></datalist>
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-semibold mb-1">ุฑูุน ุตูุฑุฉ/ููู ุงูุดูุงุฏุฉ (ุงุฎุชูุงุฑู)</label>
            <input type="file" id="calPhoto" accept=".pdf,image/*" class="w-full">
          </div>

          <div class="md:col-span-2">
            <label class="block text-sm font-semibold mb-1">ููุงุญุธุงุช</label>
            <textarea name="notes" id="calNotes" rows="2" class="w-full border rounded-lg px-3 py-2"></textarea>
          </div>

          <div class="md:col-span-2 flex items-center gap-3">
            <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">๐พ ุญูุธ ุงูุณุฌู</button>
            <span id="fmsCalMsg" class="text-sm"></span>
          </div>
        </form>
      </div>

      <!-- ุขุฎุฑ ุงูุณุฌูุงุช -->
      <div class="border rounded-xl p-4 bg-white">
        <div class="flex items-center justify-between mb-3">
          <h4 class="font-bold">๐๏ธ ุขุฎุฑ ุงูุณุฌูุงุช</h4>
          <div class="flex items-center gap-2">
            <label class="text-sm text-gray-700">ุชุตููุฉ ุญุณุจ ุงููุณู:</label>
            <select id="calFilterDept" class="border rounded-lg px-2 py-1">
              <option value="">ุงููู</option>
              <option value="RAD">ุงูุฃุดุนุฉ</option>
              <option value="LAB">ุงููุฎุชุจุฑ</option>
              <option value="CSSD">ุงูุชุนููู</option>
              <option value="ER">ุงูุทูุงุฑุฆ</option>
            </select>
            <button id="calPrint" class="px-3 py-1 rounded bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">๐จ๏ธ ุทุจุงุนุฉ</button>
          </div>
        </div>
        <div class="overflow-auto">
          <table class="table w-full" id="calTable">
            <thead>
              <tr>
                <th>ุงููุณู</th><th>ุงูุฌูุงุฒ</th><th>ุงูุงุฎุชุจุงุฑ</th><th>ุงูุชุงุฑูุฎ</th><th>ุงููุชูุฌุฉ</th><th>ุงูููุนุฏ ุงููุงุฏู</th><th>ุงูุดูุงุฏุฉ</th>
              </tr>
            </thead>
            <tbody id="calTbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  `;

  // ุชุนุจุฆุฉ Staff/Rooms (ุงุฎุชูุงุฑููุง ููููู ูุงุญููุง ุฌูุจูุง ูู API bootstrap)
  // ููุง ูุญุงูุธ ุนูู ุงููุฑููุฉ: ุชูุฏุฑ ุชูุชุจ ุงูุงุณู ูุฏูููุง ุฃู ุชุฎุชุงุฑู ูู datalist
  const staffList = container.querySelector('#staffList');
  ['ุฃ. ุจูุงู ูุชู','ุฃ. ููุซู ุงูุฌุนูู','ุฏ. ูุฌุฏู ุนุณูุฑ','ุฏ. ูุนุงุฐ ุงูุจููุด','ุฃ. ุนุฏูุงู ุงูุฑูุงุนู'].forEach(n=>{
    const o=document.createElement('option'); o.value=n; staffList.appendChild(o);
  });

  const roomList = container.querySelector('#roomList');
  // ุฎูุงุฑูู: ุฃ) ุฅุฏุฎุงู ูุฏููุ ุจ) ุงุณุชุฏุนุงุก ุบุฑู ูู ุดูุช (ูู ูุงุญููุง ูุนูููุง bootstrap rooms)
  ['XR-01','XR-02','LAB-INC-01','LAB-HEM-01','CSSD-AUTO-01','ER-TRIAGE-01'].forEach(r=>{
    const o=document.createElement('option'); o.value=r; roomList.appendChild(o);
  });

  // ุฑุจุท ููุงุฆู ุงูุฃุฌูุฒุฉ/ุงูุงุฎุชุจุงุฑุงุช
  const deptSel = container.querySelector('#calDept');
  const assetSel = container.querySelector('#calAsset');
  const testSel  = container.querySelector('#calTest');

  deptSel.addEventListener('change', ()=>{
    const d = deptSel.value;
    assetSel.innerHTML = `<option value="">ุงุฎุชุฑ ุงูุฌูุงุฒ</option>` + (ASSETS_MAP[d]||[]).map(a=>`<option value="${a}">${a}</option>`).join('');
    testSel.innerHTML = `<option value="">ุงุฎุชุฑ ููุน ุงูุงุฎุชุจุงุฑ</option>`;
  });
  assetSel.addEventListener('change', ()=>{
    const a = assetSel.value;
    const tests = TESTS_BY_ASSET[a] || ['ูุธุงุฆู ุฃุณุงุณูุฉ','ุงุฎุชุจุงุฑ ุนุงู'];
    testSel.innerHTML = `<option value="">ุงุฎุชุฑ ููุน ุงูุงุฎุชุจุงุฑ</option>` + tests.map(t=>`<option value="${t}">${t}</option>`).join('');
  });

  // ุฃุฏูุงุช ุฏุงุฎููุฉ
  function refreshCalStats(root){
    const all = safeParseLocal(KEY);
    const now  = new Date();
    let pass=0, fail=0, up=0, od=0, ns=0;
    all.forEach(r=>{
      const res=(r.result||'').toLowerCase();
      if (res==='pass') pass++; else if (res==='fail') fail++;
      const nd=r.next_due?new Date(r.next_due):null;
      if (!nd) ns++;
      else { const dl=Math.floor((nd-now)/(1000*3600*24)); if(dl<0) od++; else if(dl<=30) up++; }
    });
    root.querySelector('#calStatPass').textContent = pass;
    root.querySelector('#calStatFail').textContent = fail;
    root.querySelector('#calStatUpcoming').textContent = up;
    root.querySelector('#calStatOverdue').textContent = od;
    root.querySelector('#calStatNosched').textContent = ns;
  }
  function fillCalTable(root, data){
    const tb = root.querySelector('#calTbody'); tb.innerHTML='';
    if (!data.length){ tb.innerHTML = `<tr><td colspan="7" class="text-center text-gray-500 py-3">ูุง ุชูุฌุฏ ุณุฌูุงุช.</td></tr>`; return; }
    data.slice().reverse().forEach(r=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td>${DEPT_LABEL[r.department]||r.department||'โ'}</td>
        <td>${r.asset||'โ'}</td>
        <td>${r.test_name||'โ'}</td>
        <td>${r.date||'โ'}</td>
        <td class="${(r.result||'').toLowerCase()==='pass'?'good':'critical'}">${r.result||'โ'}</td>
        <td>${r.next_due||'โ'} <div class="text-xs text-gray-500">${daysLeftStr(r.next_due)}</div></td>
        <td>${r.certificate_name?`<span class="px-2 py-1 rounded bg-gray-100">${r.certificate_name}</span>`:'โ'}</td>`;
      tb.appendChild(tr);
    });
  }

  // ุญูุธ ุงูุณุฌู (ูุฑุณู ูู Apps Script + ูุญููุธ ููุงุด)
  const form = container.querySelector('#fmsCalForm');
  const msg  = container.querySelector('#fmsCalMsg');
  const photoInput = container.querySelector('#calPhoto');

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    msg.textContent='โณ ุฌุงุฑู ุงูุญูุธ...'; msg.className='text-sm text-blue-600';

    const fd = new FormData(form);
    const payload = Object.fromEntries(fd.entries());

    // ุญุณุงุจ NextDue
    const date = payload.date ? new Date(payload.date) : new Date();
    const freq = FREQ_OPTIONS[ Number(payload.frequency) ] || FREQ_OPTIONS[4];
    const next = new Date(date);
    if (freq.months) next.setMonth(next.getMonth()+freq.months);
    if (freq.days)   next.setDate(next.getDate()+freq.days);

    // ุชุฌููุฒ ูุฑูู ุงูุดูุงุฏุฉ (ุงุฎุชูุงุฑู) โ base64
    let certificate = null;
    const f = photoInput.files[0];
    if (f){
      certificate = await new Promise((resolve,reject)=>{
        const fr=new FileReader();
        fr.onload=()=>resolve({
          filename:f.name, mime:f.type,
          base64: String(fr.result).split(',')[1]
        });
        fr.onerror=reject; fr.readAsDataURL(f);
      });
    }

    // ุชุญููู ุงููุณู ุฅูู Category ูุบุฑุถ ุชูุฌูู ุงูุดูุงุฏุฉ ููุฌูุฏ ุงููุณู ูู Apps Script
    // NOTE: Apps Script ูุณุชุฎุฏู FOLDER_MAP = {RAD,LAB,ER,CSSD}
    const Category = payload.department; // RAD/LAB/ER/CSSD

    // ุจูุงุก ุงูุฌุณู ููุฏุงุก Apps Script
    const body = {
      action: 'createCalibration',
      token:  CAL_API_TOKEN,
      // ุญููู ุงูุฃุฌูุฒุฉ (ูู ุนูุฏู AssetID/Subtype/RoomCode ูู Devices Sheet ููููู ุฅูุญุงููุง)
      Department: DEPT_LABEL[payload.department] || payload.department,
      Staff:      payload.staff,
      AssetID:    '',               // ุฅู ุชููุฑ ูุฏูู ุฑูู ุฃุตู ูู Devices Sheet
      DeviceName: payload.asset,
      Category:   Category,         // ููู ูุชูุฌูู ุงููุฌูุฏ ุงูุตุญูุญ
      Subtype:    '',               // ุฅู ุฑุบุจุช ูุณุชูุจูุงู
      RoomCode:   payload.location, // ุฃู ุฑูุฒ ุงูุบุฑูุฉ
      RoomName:   '',
      Date:       toISO(date),
      TestName:   payload.test_name,
      Result:     payload.result,
      Notes:      payload.notes || '',
      CalibrationFreqMonths: freq.months? (freq.months) : (freq.days? Math.round(freq.days/30) : 12),
      certificate // {filename,mime,base64} ุฃู null
    };

    // ุงููุฏุงุก
    try{
      const res = await fetch(CAL_API_URL, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(body)
      });
      const data = await res.json();

      if (data.status!=='success') throw new Error(data.message||'ูุดู ุบูุฑ ูุนุฑูู');

      // ุฎุฒูู ูุณุฎุฉ ูุงุด ูุญูููุง ูุนุฑุถูุง ููุฑูุง
      const rec = {
        department: payload.department,
        staff: payload.staff,
        asset: payload.asset,
        test_name: payload.test_name,
        date: toISO(date),
        result: payload.result,
        certificate_name: (f && f.name) ? f.name : '',
        location: payload.location || '',
        notes: payload.notes || '',
        next_due: data.nextDue || toISO(next),
        frequency: freq.label,
        timestamp: new Date().toISOString()
      };
      const all = safeParseLocal(KEY); all.push(rec);
      localStorage.setItem(KEY, JSON.stringify(all));

      // ุชุญุฏูุซ ุงููุงุฌูุฉ
      refreshCalStats(container);
      fillCalTable(container, all);

      msg.textContent = 'โ ุชู ุงูุญูุธ ูุฅูุดุงุก ุงูุดูุงุฏุฉ ููุชุงุจุฉ ุงูุณุฌู ูู Google Sheet';
      msg.className   = 'text-sm text-green-600';
      form.reset(); photoInput.value='';
      assetSel.innerHTML=`<option value="">ุงุฎุชุฑ ุงูุฌูุงุฒ</option>`; testSel.innerHTML=`<option value="">ุงุฎุชุฑ ููุน ุงูุงุฎุชุจุงุฑ</option>`;
    }catch(err){
      msg.textContent='โ '+err.message;
      msg.className='text-sm text-red-600';
    }
  });

  // ุชุนุจุฆุฉ ุฌุฏูู ุงูุณุฌูุงุช ูู ุงููุงุด ุงูุญุงูู
  fillCalTable(container, cache);

  // ููุชุฑุฉ + ุทุจุงุนุฉ
  container.querySelector('#calFilterDept').addEventListener('change', (e)=>{
    const v=e.target.value; const all=safeParseLocal(KEY);
    const filtered = v ? all.filter(r=>r.department===v) : all;
    fillCalTable(container, filtered);
  });
  container.querySelector('#calPrint').addEventListener('click', ()=>window.print());
}
</script>


<!-- ุณูุฑุจุช ุณุฌู ุงูุชุฏุฑูุจ (ููุงุฆู ููุธูู) -->
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const form = document.getElementById("trainingForm");
  if (!form) return;
  const msg = document.getElementById("trainMsg");
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyhFeodenLqh4EUTqeBUYkJsgk6TtU0QQ_I_zB8_dZ31w3kavPi83GFBLv9tQ1qz8IL/exec";

  // ุชุญููู ุงูููุงุฆู ุงูุฃุณุงุณูุฉ (ุงูููุธููู + ุงูุฃูุงูู)
  try {
    msg.textContent = "โณ ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...";
    const res = await fetch(WEB_APP_URL);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    msg.textContent = "";

    // โ ุชุนุจุฆุฉ ูุงุฆูุฉ ุฃุณูุงุก ุงูููุธููู
    const traineeBox = document.createElement("div");
    traineeBox.className = "md:col-span-2";
    traineeBox.innerHTML = `
      <label class="block text-sm font-semibold mb-1">ุงุฎุชุฑ ุงููุชุฏุฑุจูู *</label>
      <div id="traineeList" class="max-h-60 overflow-y-auto border rounded-lg p-3 bg-gray-50"></div>
      <div class="flex justify-between items-center mt-2 text-sm">
        <button type="button" id="selectAll" class="text-[var(--brand1)] hover:underline">ุชุญุฏูุฏ ุงููู</button>
        <button type="button" id="deselectAll" class="text-gray-600 hover:underline">ุฅูุบุงุก ุงูุชุญุฏูุฏ</button>
      </div>
      <div id="selectedCount" class="text-xs text-gray-600 mt-1">0 ูุชุฏุฑุจ ูุญุฏุฏ</div>
    `;
    form.insertBefore(traineeBox, form.querySelector(".md\\:col-span-2.flex"));

    const traineeList = document.getElementById("traineeList");
    traineeList.innerHTML = data.trainees
      .map(name => `<label class="block"><input type="checkbox" name="trainees" value="${name}" class="trainee-checkbox mr-2">${name}</label>`)
      .join("");

    // โ ุชุนุจุฆุฉ ุงูุฃูุงูู
    const placeInput = form.querySelector('input[name="training_place"]');
    placeInput.setAttribute("list", "places-list");
    const datalistPlaces = document.createElement("datalist");
    datalistPlaces.id = "places-list";
    data.places.forEach(place => datalistPlaces.innerHTML += `<option value="${place}">`);
    placeInput.after(datalistPlaces);

    // โ ุชุญููู ุงูุจุฑุงูุฌ ุงูุชุฏุฑูุจูุฉ ุญุณุจ ุงููุฌูุฉ
    const committeeSel = form.querySelector('select[name="committee_code"]');
    const topicInput = form.querySelector('input[name="training_topic"]');

    let topicsDL = document.getElementById('topics-list');
    if (!topicsDL) {
      topicsDL = document.createElement('datalist');
      topicsDL.id = 'topics-list';
      topicInput.setAttribute('list', 'topics-list');
      topicInput.after(topicsDL);
    }

    async function loadProgramsForCommittee(code) {
      topicsDL.innerHTML = '';
      topicInput.value = '';
      if (!code) return;

      try {
        const url = `${WEB_APP_URL}?action=programs&code=${encodeURIComponent(code)}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();

        console.log('Programs payload:', payload);

        if (payload.status !== 'success') throw new Error(payload.message || 'ูุดู ุชุญููู ุงูุจุฑุงูุฌ');
        if (!Array.isArray(payload.programs)) throw new Error('ูุงุฆูุฉ ุงูุจุฑุงูุฌ ุบูุฑ ุตุญูุญุฉ');

        payload.programs.forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.program_name;
          opt.title = `๐ ${p.frequency}\n๐ ${p.description}\n๐ ${p.file_type}`;
          topicsDL.appendChild(opt);
        });

        showProgramHintArea(payload.programs);
      } catch (err) {
        console.error('โ๏ธ ูุดู ุชุญููู ุงูุจุฑุงูุฌ:', err.message);
      }
    }

    // โ ุนุฑุถ ุชูุงุตูู ุงูุจุฑูุงูุฌ ุฃุณูู ุฎุงูุฉ ุงูููุถูุน
    function showProgramHintArea(programs) {
      let hintBox = document.getElementById('programHintBox');
      if (!hintBox) {
        hintBox = document.createElement('div');
        hintBox.id = 'programHintBox';
        hintBox.className = 'mt-3 text-sm bg-gray-50 border rounded-lg p-4';
        topicInput.after(hintBox);
      }

      topicInput.addEventListener('input', () => {
        const selected = programs.find(p => p.program_name === topicInput.value.trim());
        if (selected) {
          hintBox.innerHTML = `
            <div class="font-bold text-[var(--brand1)] text-lg mb-1">${selected.program_name}</div>
            <div class="text-gray-700 mb-1"><strong>๐ ุงูุชูุฑุงุฑ:</strong> ${selected.frequency}</div>
            <div class="text-gray-700 mb-1"><strong>๐ ุงููุตู:</strong> ${selected.description}</div>
            <div class="text-gray-700 mb-2"><strong>๐ ููุน ุงูููู:</strong> ${selected.file_type}</div>
            ${
              selected.drive_link && selected.drive_link !== "(ุฑุงุจุท ุงูุนุฑุถ ููุง ูุงุญููุง)"
                ? `<a href="${selected.drive_link}" target="_blank"
                    class="inline-flex items-center gap-2 mt-2 px-3 py-1.5 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
                    <i class="fas fa-chalkboard-teacher"></i> ูุชุญ ุงูุนุฑุถ ุงูุชุฏุฑูุจู
                  </a>`
                : `<div class="text-xs text-gray-500 italic">ูู ูุชู ุฑูุน ุฑุงุจุท ุงูุนุฑุถ ุจุนุฏ.</div>`
            }
          `;
        } else {
          hintBox.innerHTML = `<span class="text-gray-500">ุงุฎุชุฑ ุฃู ุงูุชุจ ุงุณู ุงูุจุฑูุงูุฌ ูุนุฑุถ ุงูุชูุงุตูู...</span>`;
        }
      });
    }

    committeeSel.addEventListener('change', () => loadProgramsForCommittee(committeeSel.value));
    if (committeeSel.value) loadProgramsForCommittee(committeeSel.value);

    // โ ุนุฏุงุฏ ุงููุชุฏุฑุจูู
    const countEl = document.getElementById("selectedCount");
    function updateCount() {
      const count = document.querySelectorAll(".trainee-checkbox:checked").length;
      countEl.textContent = `${count} ูุชุฏุฑุจ ูุญุฏุฏ`;
    }
    traineeList.addEventListener("change", updateCount);
    document.getElementById("selectAll").addEventListener("click", () => {
      document.querySelectorAll(".trainee-checkbox").forEach(cb => cb.checked = true);
      updateCount();
    });
    document.getElementById("deselectAll").addEventListener("click", () => {
      document.querySelectorAll(".trainee-checkbox").forEach(cb => cb.checked = false);
      updateCount();
    });

  } catch (err) {
    msg.textContent = "โ๏ธ ูุดู ุชุญููู ุงูููุงุฆู: " + err.message;
    msg.className = "text-sm text-red-600";
  }

  // โ ุฅุฑุณุงู ุงูุจูุงูุงุช
  form.addEventListener("submit", async e => {
    e.preventDefault();
    msg.textContent = "โณ ุฌุงุฑู ุงูุฅุฑุณุงู...";
    msg.className = "text-sm text-blue-600";

    const selectedTrainees = Array.from(form.querySelectorAll(".trainee-checkbox:checked")).map(cb => cb.value);
    if (selectedTrainees.length === 0) {
      msg.textContent = "โ ุงุฎุชุฑ ูุชุฏุฑุจ ูุงุญุฏ ุนูู ุงูุฃูู.";
      msg.className = "text-sm text-red-600";
      return;
    }

    const payload = Object.fromEntries(new FormData(form).entries());
    payload.trainees = selectedTrainees;
    payload.department = payload.committee_code;

    try {
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        body: JSON.stringify(payload),
        headers: { "Content-Type": "text/plain;charset=utf-8" }
      });
      const data = await res.json();
      if (data.status === "success") {
        msg.textContent = "โ ุชู ุญูุธ ุณุฌู ุงูุชุฏุฑูุจ ุจูุฌุงุญ";
        msg.className = "text-sm text-green-600";
        form.reset();
        document.querySelectorAll(".trainee-checkbox").forEach(cb => cb.checked = false);
        document.getElementById("selectedCount").textContent = "0 ูุชุฏุฑุจ ูุญุฏุฏ";
      } else throw new Error(data.message);
    } catch (err) {
      msg.textContent = "โ ูุดู ุงูุญูุธ: " + err.message;
      msg.className = "text-sm text-red-600";
    }
  });
});
</script>


<!-- ๐จ๏ธ ุณูุฑุจุช ุชุตุฏูุฑ ุงูุจุฑูุงูุฌ ูู PDF -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const exportBtn = document.getElementById("exportPDF");
  const committeeSelect = document.getElementById("committeeSelect");
  const programSelect = document.getElementById("programSelect");
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyhFeodenLqh4EUTqeBUYkJsgk6TtU0QQ_I_zB8_dZ31w3kavPi83GFBLv9tQ1qz8IL/exec";

  exportBtn.addEventListener("click", async () => {
    const code = committeeSelect.value;
    const name = programSelect.value;
    if (!code || !name) {
      alert("โ๏ธ ูุฑุฌู ุงุฎุชูุงุฑ ุงููุฌูุฉ ูุงูุจุฑูุงูุฌ ุฃููุงู.");
      return;
    }

    exportBtn.textContent = "โณ ุฌุงุฑู ุฅูุดุงุก ููู PDF...";
    exportBtn.disabled = true;

    try {
      const res = await fetch(`${WEB_APP_URL}?action=export&code=${encodeURIComponent(code)}&name=${encodeURIComponent(name)}`);
      const data = await res.json();

      if (data.status === "success") {
        const link = document.createElement("a");
        link.href = "data:application/pdf;base64," + data.file;
        link.download = data.filename;
        link.click();
      } else {
        alert("โ ูุดู ุฅูุดุงุก PDF: " + data.message);
      }
    } catch (err) {
      alert("โ๏ธ ุฎุทุฃ ูู ุงูุงุชุตุงู: " + err.message);
    }

    exportBtn.textContent = "๐จ๏ธ ุชุตุฏูุฑ ุงูุจุฑูุงูุฌ ูู PDF";
    exportBtn.disabled = false;
  });
});
</script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('a[target="_blank"]').forEach(a => {
    const rel = (a.getAttribute('rel') || '').split(/\s+/);
    if (!rel.includes('noopener')) rel.push('noopener');
    if (!rel.includes('noreferrer')) rel.push('noreferrer');
    a.setAttribute('rel', rel.join(' ').trim());
  });
});
</script>
</body>
</html>
