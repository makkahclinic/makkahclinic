<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>بوابة سباهي الإلكترونية – مجمع مكة الطبي بالزاهر (الإصدار 2025)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --maroon:#7B1E24;--burgundy:#C55A44;--gold:#E9C46A;--bg:#faf7f6;
  }
  body{font-family:'Tajawal',sans-serif;background:linear-gradient(180deg,#fff,#faf5f4 45%,#fff);}
  header{position:sticky;top:0;z-index:50;background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.08)}
  .container{max-width:1280px;margin:0 auto}
  .hero{background:linear-gradient(180deg,var(--maroon),var(--burgundy));color:#fff;text-align:center;position:relative;overflow:hidden}
  .hero-inner{padding:56px 16px 72px}
  .hero-logo-wrap{position:relative;display:inline-block}
  .hero-logo-wrap::before{
    content:"";position:absolute;inset:-28px;z-index:0;border-radius:9999px;
    background:radial-gradient(closest-side,rgba(233,196,106,.25),transparent 70%);
    filter:blur(1px)
  }
  .hero img{position:relative;z-index:1;width:150px;height:auto;filter:drop-shadow(0 0 22px var(--gold));animation:glow 3s ease-in-out infinite alternate}
  @keyframes glow{from{filter:drop-shadow(0 0 10px var(--gold))}to{filter:drop-shadow(0 0 32px var(--gold))}}
  .sidebar{width:270px;background:linear-gradient(180deg,var(--maroon),var(--burgundy));color:#fff}
  .nav-link{display:block;padding:.55rem .8rem;border-radius:.6rem;transition:.2s}
  .nav-link:hover{background-color:rgba(255,255,255,.16);transform:translateX(-3px)}
  .nav-link.active{background-color:rgba(255,255,255,.28);font-weight:700}
  .card{background:#fff;border:1px solid #eee;border-radius:14px;box-shadow:0 6px 16px rgba(0,0,0,.06)}
  .grid-docs{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:16px}
  @media(min-width:768px){.grid-docs{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media(min-width:1024px){.grid-docs{grid-template-columns:repeat(3,minmax(0,1fr))}}
  .fade{opacity:0;transform:translateY(12px);transition:all .35s}
  .fade.active{opacity:1;transform:none}
  /* scroll-to-top */
  #scrollTop{position:fixed;left:18px;bottom:18px;display:none;width:48px;height:48px;border-radius:9999px;
    background:var(--gold);color:var(--maroon);box-shadow:0 8px 18px rgba(123,30,36,.35);font-size:20px}
  #scrollTop:hover{transform:scale(1.08)}
  /* doc modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:60}
  .modal.open{display:flex}
  .modal .panel{background:#fff;border-radius:14px;overflow:hidden;width:min(1200px,96vw)}
  .modal header{box-shadow:none}
  .hidden{display:none !important}
</style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header>
  <div class="container flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <img id="logoSmall" class="h-12 w-auto rounded bg-white p-1 shadow" alt="شعار المجمع">
      <button id="btnSetLogo" class="text-[var(--maroon)] text-sm underline underline-offset-4 hover:text-[var(--burgundy)]">
        تغيير/تحديث الشعار
      </button>
      <input id="logoPicker" type="file" accept="image/*" class="hidden">
    </div>
    <div class="text-center">
      <div class="text-lg md:text-xl font-bold text-gray-800">بوابة سباهي الإلكترونية</div>
      <div class="text-xs md:text-sm text-gray-500">مجمع مكة الطبي بالزاهر – الإصدار 2025</div>
    </div>
    <div class="flex items-center gap-2">
      <a href="https://makkahclinic.com.sa" target="_blank" class="px-3 py-2 rounded text-[var(--maroon)] hover:bg-gray-100">
        🏥 الصفحة الرئيسية للمجمع
      </a>
      <button onclick="window.print()" class="bg-[var(--maroon)] hover:bg-[var(--burgundy)] text-white px-4 py-2 rounded">
        <i class="fas fa-print ml-2"></i> طباعة / PDF
      </button>
    </div>
  </div>
</header>

<!-- Hero -->
<section class="hero">
  <div class="hero-inner container">
    <div class="hero-logo-wrap">
      <img id="logoHero" alt="شعار مجمع مكة الطبي">
    </div>
    <h1 class="text-3xl md:text-4xl font-bold mt-4">بوابة سباهي الإلكترونية</h1>
    <p class="text-base md:text-lg opacity-95 mt-1">مجمع مكة الطبي بالزاهر – الإصدار 2025</p>
    <div class="text-[13px] md:text-[14px] mt-2" style="color:#f8e8cc">
      بوابة رقمية لإدارة الوثائق والمعايير — لا تتضمن أي ادعاء بالحصول على الاعتماد.
    </div>
  </div>
</section>

<!-- Layout -->
<div class="container px-4 py-6 flex gap-6">
  <!-- Sidebar -->
  <aside class="sidebar rounded-xl p-4 h-max sticky top-[92px]">
    <div class="font-bold mb-2 text-lg">📚 أقسام البوابة</div>
    <a class="nav-link active" href="#home"        onclick="navTo('home')">🏠 الصفحة الرئيسية</a>
    <a class="nav-link"        href="#leadership"  onclick="navTo('leadership')">🏛️ القيادة والحوكمة (LD)</a>
    <a class="nav-link"        href="#committees"  onclick="navTo('committees')">👥 اللجان الرسمية</a>
    <a class="nav-link"        href="#rm"          onclick="navTo('rm')">⚠️ إدارة المخاطر (RM)</a>
    <a class="nav-link"        href="#fms"         onclick="navTo('fms')">🛠️ السلامة والمرافق (FMS)</a>
    <a class="nav-link"        href="#manuals"     onclick="navTo('manuals')">📘 الدليل الإداري</a>
  </aside>

  <!-- Main -->
  <main id="main" class="flex-1 space-y-6">

    <!-- Home -->
    <section id="home" class="card p-6 fade active">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-2">أهلًا بك</h2>
      <p class="text-gray-600 mb-4">هذه منصة داخلية لتجميع مستندات اللجان، النماذج، وخطط السلامة والمرافق وفق متطلبات سباهي.</p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <a href="#fms" onclick="navTo('fms')" class="card p-5 hover:shadow-xl transition block">
          <div class="text-3xl text-[var(--maroon)] mb-2"><i class="fas fa-helmet-safety"></i></div>
          <div class="font-bold">السلامة والمرافق (FMS)</div>
          <div class="text-gray-600 text-sm">مكتبة وثائق FMS + نموذج جولات السلامة.</div>
        </a>
        <a href="#rm" onclick="navTo('rm')" class="card p-5 hover:shadow-xl transition block">
          <div class="text-3xl text-[var(--maroon)] mb-2"><i class="fas fa-triangle-exclamation"></i></div>
          <div class="font-bold">إدارة المخاطر (RM)</div>
          <div class="text-gray-600 text-sm">نماذج البلاغ والتحليل، القرارات، اللوحات.</div>
        </a>
        <a href="#manuals" onclick="navTo('manuals')" class="card p-5 hover:shadow-xl transition block">
          <div class="text-3xl text-[var(--maroon)] mb-2"><i class="fas fa-book-open"></i></div>
          <div class="font-bold">الدليل الإداري</div>
          <div class="text-gray-600 text-sm">عرض الدليل الكامل والمختصر من Google Drive.</div>
        </a>
      </div>
    </section>

    <!-- Leadership (LD) -->
    <section id="leadership" class="card p-6 fade hidden">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-4">🏛️ القيادة والحوكمة (LD)</h2>
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
        <div class="text-blue-800 font-medium">المدير العام / المالك المعتمد:</div>
        <div class="text-blue-900 text-lg font-bold mt-1">د. حسين بن محمد حسن شيخ بابصيل</div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-right border">
          <thead class="bg-gray-100">
            <tr><th class="p-2 border">القسم</th><th class="p-2 border">المدير/الرئيس</th><th class="p-2 border">المهام الأساسية</th></tr>
          </thead>
          <tbody>
            <tr><td class="p-2 border">الإدارة الإدارية</td><td class="p-2 border">أ. بلال نتو</td><td class="p-2 border">التشغيل اليومي، الموارد البشرية، التدريب.</td></tr>
            <tr><td class="p-2 border">الإدارة الطبية</td><td class="p-2 border">د. معاذ البيوش (نائب: د. خالد الخطيب)</td><td class="p-2 border">الإشراف على العيادات وجودة الخدمات السريرية.</td></tr>
            <tr><td class="p-2 border">الإدارة المالية والتأمين</td><td class="p-2 border">أ. صابر عبده</td><td class="p-2 border">الحسابات، المطالبات، إدارة دورة الإيراد.</td></tr>
            <tr><td class="p-2 border">الصيانة والمرافق (FMS)</td><td class="p-2 border">أ. عدنان الرفاعي</td><td class="p-2 border">الصيانة الوقائية، السلامة، الطوارئ، النظافة.</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Committees -->
    <section id="committees" class="card p-6 fade hidden">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-4">👥 اللجان الرسمية</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-lg font-bold">لجنة السلامة والمرافق (FMS)</div>
            <span class="bg-[var(--maroon)] text-white text-xs px-2 py-1 rounded">FMS</span>
          </div>
          <div class="text-sm text-gray-700">الرئيس: أ. صابر عبده — الاجتماعات: شهريًا</div>
        </div>
        <div class="card p-5">
          <div class="flex items-center justify-between mb-2">
            <div class="text-lg font-bold">لجنة إدارة المخاطر (RM)</div>
            <span class="bg-[var(--maroon)] text-white text-xs px-2 py-1 rounded">RM</span>
          </div>
          <div class="text-sm text-gray-700">الرئيس: د. حسين بابصيل — المنسق: أ. عدنان الرفاعي</div>
        </div>
      </div>
    </section>

    <!-- Risk Management (RM) -->
    <section id="rm" class="card p-6 fade hidden">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-1">⚠️ إدارة المخاطر (RM)</h2>
      <p class="text-gray-600 mb-5">نماذج البلاغات، التحليل RCA/HFMEA، القرارات LD.31/LD.32، اللوحات، وسجل المخاطر المؤسسي.</p>

      <!-- مجموعات -->
      <h3 class="font-bold text-[var(--maroon)] mb-2">📝 نماذج البلاغ</h3>
      <div class="grid-docs">
        <div class="card p-4"><div class="font-bold mb-1">نموذج الإبلاغ عن شكوى/حادث</div><button class="bg-[var(--maroon)] text-white px-3 py-2 rounded" onclick="openDoc('نموذج الإبلاغ','https://docs.google.com/document/d/1Zm7fbMRW01mGPtInWvrtvP5-KlI1Uzb8Hu9rNM8ZiKM/preview')">📄 عرض</button></div>
        <div class="card p-4"><div class="font-bold mb-1">إخطار حدث جسيم (SE)</div><button class="bg-[var(--maroon)] text-white px-3 py-2 rounded" onclick="openDoc('SE','https://drive.google.com/open?id=1LrOlWxfECxyzF77DnerV15RjS-ElSTbIEa1UuKG3rD0')">📄 عرض</button></div>
        <div class="card p-4"><div class="font-bold mb-1">بلاغ حادث IR</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">بلاغ قريب من الوقوع (Near Miss)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">بلاغ خطر/شرط غير آمن</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">بلاغ عطل جهاز/تجهيز</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ">📄 فتح</a></div>
      </div>

      <h3 class="font-bold text-[var(--maroon)] my-3">🧩 التحقيق والتحليل</h3>
      <div class="grid-docs">
        <div class="card p-4"><div class="font-bold mb-1">RCA / CAP</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1lDKsjgPDCdwXNV935kB_DfAm-ZsdzLPK8p4Pn7hgJJ0">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">HFMEA – ورقة عمل</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=15ZjKLJYhe3HCUWbAO2Iw96IY1GOn1VNCWIjzdi9U4x8">📄 فتح</a></div>
      </div>

      <h3 class="font-bold text-[var(--maroon)] my-3">📢 التوعية والتدريب</h3>
      <div class="grid-docs">
        <div class="card p-4"><div class="font-bold mb-1">إعلان التبليغ الإلكتروني (بوستر)</div><button class="bg-[var(--maroon)] text-white px-3 py-2 rounded" onclick="openDoc('بوستر التبليغ','https://docs.google.com/document/d/18CZj5b-JuKAqBvGSpd8-hb8Zf744HFjEfNJ78VMMd_s/preview')">📄 عرض</button></div>
        <div class="card p-4"><div class="font-bold mb-1">نموذج حضور تدريب</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1GIOUPLH9AzWB0PKZiaV_NJoQwjkbzZLyaPkoaV1niC8">📄 فتح</a></div>
      </div>

      <h3 class="font-bold text-[var(--maroon)] my-3">📊 لوحات ومؤشرات</h3>
      <div class="grid-docs">
        <div class="card p-4"><div class="font-bold mb-1">لوحة الاتصالات وسلسلة التصعيد</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1dZrkUB_d1XblN3QonWxPt9F1LQ6xQIbyNFT4ixI2m64">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">لوحة المؤشرات الشهرية</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1pj8P8rf4TZj_wVKgLrO8ayP9WNUBc1yTWeAy8r0xGOY">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">سجل المخاطر المؤسسي</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1XVMRWRZKoTpmXPzrPdXJA7PWf9r88YwLYv_tptdiZAA">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">عرض المشاكل وخطة الحلول (RM)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1ZUBOoQgVbf41pcBxmU5iyoJzddd9e8JJDJ1Z2dekLfY">📄 فتح</a></div>
      </div>

      <h3 class="font-bold text-[var(--maroon)] my-3">🧷 الحوكمة والقرارات</h3>
      <div class="grid-docs">
        <div class="card p-4"><div class="font-bold mb-1">قرار اعتماد برنامج إدارة المخاطر (LD.31)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1TYH87_v6rC2twWOZig2P5YDegRv6ir2dlYEU-v6KXwg">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">قرار/سياسة البلاغ (LD.32)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1irNRM1ovqwQEaEEj5gv9rmAuoV8O5aY-m0hSNykZDUk">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">قرار تشكيل لجنة إدارة المخاطر وسلامة المرضى (LD.31/LD.32)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1yN0wiHu-mmNqFHF5XeEQIqOeMElIFSXn-xCz1AzAfco">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">LD31 (ملف)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1AEtBJgibYuSxVD_bSZgAlFgODnadZcDMTZaKle3pnYg">📄 فتح</a></div>
        <div class="card p-4"><div class="font-bold mb-1">LD32 (ملف)</div><a class="bg-[var(--maroon)] text-white px-3 py-2 rounded inline-block" target="_blank" href="https://drive.google.com/open?id=1x6R5DKODJ1MKghpPEnaR-1GIohAEILzmY6VNgAPgzAE">📄 فتح</a></div>
      </div>
    </section>

    <!-- FMS -->
    <section id="fms" class="card p-6 fade hidden">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-4">🛠️ مكتبة وثائق FMS 2025</h2>
      <p class="text-gray-600 mb-4">كل الروابط أدناه من Google Drive كما وردت منكم مباشرة.</p>
      <div id="fmsLibrary" class="grid-docs"></div>

      <hr class="my-6">
      <h3 class="text-xl font-bold text-[var(--maroon)] mb-2">📝 نموذج جولة السلامة (يرسل إلى Google Sheet)</h3>
      <form id="roundForm" class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <div><label class="text-sm">اسم المراقب*</label><input required name="inspector" class="w-full border rounded px-3 py-2"></div>
        <div><label class="text-sm">الموقع/القسم*</label><input required name="location" class="w-full border rounded px-3 py-2"></div>
        <div>
          <label class="text-sm">الأولوية*</label>
          <select name="priority" class="w-full border rounded px-3 py-2">
            <option>عالية (High)</option><option selected>متوسطة (Medium)</option><option>منخفضة (Low)</option>
          </select>
        </div>
        <div class="md:col-span-3"><label class="text-sm">الملاحظة والتوصية*</label><textarea required name="observation" rows="3" class="w-full border rounded px-3 py-2"></textarea></div>
        <div class="md:col-span-3 flex items-center gap-3">
          <button class="bg-[var(--maroon)] hover:bg-[var(--burgundy)] text-white px-4 py-2 rounded" type="submit">إرسال الملاحظة</button>
          <a target="_blank" class="bg-[var(--gold)] text-[var(--maroon)] px-4 py-2 rounded shadow" href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922">🔄 عرض آخر الجولات المسجلة</a>
          <span id="roundMsg" class="text-sm"></span>
        </div>
      </form>
    </section>

    <!-- Manuals -->
    <section id="manuals" class="card p-6 fade hidden">
      <h2 class="text-2xl font-bold text-[var(--maroon)] mb-4">📘 الدليل الإداري والتنظيمي</h2>
      <div class="flex gap-2 mb-3">
        <button class="px-3 py-2 rounded bg-[var(--maroon)] text-white" onclick="showManual('full')">الدليل الكامل</button>
        <button class="px-3 py-2 rounded bg-gray-200 hover:bg-gray-300" onclick="showManual('short')">الدليل المختصر</button>
      </div>
      <div id="manualFull" class="block">
        <iframe class="w-full" style="height:85vh" src="https://docs.google.com/document/d/1hswi3r_fTUKQoVIj3lG9kEIQpFF7Ol7OLCXe3A45-Ao/preview" allow="autoplay"></iframe>
      </div>
      <div id="manualShort" class="hidden">
        <iframe class="w-full" style="height:85vh" src="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/preview" allow="autoplay"></iframe>
      </div>
    </section>

  </main>
</div>

<!-- Doc Modal -->
<div id="docModal" class="modal" role="dialog" aria-modal="true">
  <div class="panel">
    <div class="flex items-center justify-between px-4 py-3 border-b">
      <div id="docTitle" class="font-bold text-[var(--maroon)]">عرض الوثيقة</div>
      <button class="text-2xl" onclick="closeDoc()">×</button>
    </div>
    <div class="p-0"><iframe id="docFrame" class="w-full" style="height:74vh" src="about:blank"></iframe></div>
    <div class="px-4 py-3 border-t text-left">
      <button class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300" onclick="closeDoc()">إغلاق</button>
    </div>
  </div>
</div>

<!-- Scroll To Top -->
<button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="أعلى">
  ⬆️
</button>

<footer class="text-center text-sm text-white py-4 mt-10" style="background:var(--maroon)">© 2025 مجمع مكة الطبي بالزاهر.</footer>

<script>
/* ===================== إعداد الشعار (Base64 محفوظ محليًا) ===================== */
(function initLogo(){
  const fallback = "data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='180' height='180' viewBox='0 0 180 180'>\
<defs><linearGradient id='g' x1='0' y1='0' x2='0' y2='1'><stop offset='0%' stop-color='%237B1E24'/><stop offset='100%' stop-color='%23C55A44'/></linearGradient></defs>\
<circle cx='90' cy='90' r='88' fill='url(%23g)'/>\
<text x='50%' y='52%' font-size='52' text-anchor='middle' fill='white' font-family='Arial' dy='.35em'>MC</text>\
</svg>";
  const b64 = localStorage.getItem('logoBase64');
  const src = b64 || fallback;
  document.getElementById('logoSmall').src = src;
  document.getElementById('logoHero').src  = src;
})();
document.getElementById('btnSetLogo').addEventListener('click',()=>document.getElementById('logoPicker').click());
document.getElementById('logoPicker').addEventListener('change',e=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader(); r.onload=()=>{localStorage.setItem('logoBase64',r.result);
    document.getElementById('logoSmall').src=r.result;document.getElementById('logoHero').src=r.result;
    alert('✅ تم تحديث الشعار وحفظه محليًا.');}; r.readAsDataURL(f);
});

/* ===================== تنقّل الأقسام ===================== */
function navTo(id){
  document.querySelectorAll('main > section').forEach(s=>s.classList.add('hidden'));
  const sec = document.getElementById(id); if(sec){sec.classList.remove('hidden'); sec.classList.add('active');}
  document.querySelectorAll('.sidebar .nav-link').forEach(a=>a.classList.remove('active'));
  const link = document.querySelector('.sidebar .nav-link[href="#'+id+'"]'); if(link) link.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
}
window.addEventListener('scroll',()=>{document.getElementById('scrollTop').style.display=(window.scrollY>220)?'block':'none'});

/* ===================== عارض الوثائق ===================== */
function openDoc(title,url){ document.getElementById('docTitle').textContent=title; document.getElementById('docFrame').src=url; document.getElementById('docModal').classList.add('open'); }
function closeDoc(){ document.getElementById('docModal').classList.remove('open'); document.getElementById('docFrame').src='about:blank'; }

/* ===================== الدليل الإداري تبويب ===================== */
function showManual(which){
  document.getElementById('manualFull').classList.toggle('hidden', which!=='full');
  document.getElementById('manualShort').classList.toggle('hidden', which!=='short');
}

/* ===================== مكتبة FMS (روابطكم) ===================== */
const FMS_DOCS = [
  // POL
  {code:'POL-FMS-2025-001',name:'سياسة إدارة السلامة والمرافق',cat:'POL',url:'https://drive.google.com/open?id=1YS1Jk5FgwJoY5in71yUQ1oIjE4JEsaecMGWTt00aQ0o'},
  {code:'POL-FMS-2025-015',name:'سياسة مراقبة جودة الهواء والتهوية',cat:'POL',url:'https://drive.google.com/open?id=18caApXqHeQSZdBFSvgyIKICX0qMSsN7UuRxz3u7R10o'},

  // SOP
  {code:'SOP-FMS-2025-002',name:'إجراءات التشغيل القياسية للجولات وفحص الأنظمة',cat:'SOP',url:'https://drive.google.com/open?id=1mrKI8YTjSphAk-noRO8sp9GhYYLzR1FCBti2EDyDZOU'},

  // DEC
  {code:'DEC-FMS-2025-001',name:'قرار تشكيل لجنة السلامة',cat:'DEC',url:'https://drive.google.com/open?id=1KJcIqUbXfHIH0qt1UwoJ0Dohc_7n-745rhx90shaqNg'},

  // PLN
  {code:'PLN-FMS-2025-004',name:'خطة الطوارئ والإخلاء',cat:'PLN',url:'https://drive.google.com/open?id=1rPIuA5g52gQSroaaxznZ_SQNOj1TjEDuZ9DF0j3jvf4'},
  {code:'PLN-FMS-2025-007',name:'خطة إدارة النفايات',cat:'PLN',url:'https://drive.google.com/open?id=1iSoFBh8u4uTHzDJECxyjlEMeWqaScZwezgOXygEVdso'},
  {code:'PLN-FMS-2025-012',name:'خطة إدارة الطاقة والمياه',cat:'PLN',url:'https://drive.google.com/open?id=1b8oP_LOE_k7A0qXqhhVKWXF9zAvJMuSUOLFc1rBoflA'},
  {code:'PLN-FMS-2025-016',name:'خطة الصيانة الطارئة',cat:'PLN',url:'https://drive.google.com/open?id=1tQYPW6VHtr1liM7qMoPGgzDxopw9njYivS7WyKxokZw'},
  {code:'PLN-FMS-2025-018',name:'خطة الأمن المادي للمرافق',cat:'PLN',url:'https://drive.google.com/open?id=1aF0KTinNcF3gMIotj_byzrAkubX6Y30nZWmVuFM7BcA'},

  // TRN
  {code:'TRN-FMS-2025-010',name:'خطة تدريب الأمن والسلامة',cat:'TRN',url:'https://drive.google.com/open?id=1IwnBiZp11BjIDQLUtT5Ntr7kEhv3jmssvF5Vj6D7yRk'},

  // LOG
  {code:'LOG-FMS-2025-005',name:'سجل الصيانة الوقائية',cat:'LOG',url:'https://drive.google.com/open?id=10QjYYiAppgrOJpb6F2GxxwmRgRt2ooNOClo0etgzWpw'},
  {code:'LOG-FMS-2025-006',name:'سجل الحوادث والملاحظات',cat:'LOG',url:'https://drive.google.com/open?id=12D_ESZYNwjEfKZM6C0yzswbsccugSZZBOcMdHELd3TY'},
  {code:'LOG-FMS-2025-014',name:'سجل زيارات الدفاع المدني والجهات التنظيمية',cat:'LOG',url:'https://drive.google.com/open?id=1VMNxaSlkz_LX4OqktVHQsj1IT-GA6Y3eUnZa2rgegMA'},

  // CHK
  {code:'CHK-FMS-2025-003',name:'قائمة التحقق الدورية للسلامة',cat:'CHK',url:'https://drive.google.com/open?id=1C07oXDzj_Vfok81wQUde3P-ExeXhJh6LDwOS35jTDpk'},
  {code:'CHK-FMS-2025-009',name:'سجل جولات لجنة السلامة',cat:'CHK',url:'https://drive.google.com/open?id=1fKMIzns80N9IeSU18WudplOpA8DmbL4zmq72PRUmfZw'},

  // FRM
  {code:'FRM-FMS-2025-011',name:'نموذج تقييم المخاطر البيئية والمادية',cat:'FRM',url:'https://drive.google.com/open?id=15uefBzxMrX33-lBCHP3sZb_OZqoQ4hyiymQRnBrN_jo'},
  {code:'FRM-FMS-2025-017',name:'نموذج متابعة تنفيذ التوصيات',cat:'FRM',url:'https://drive.google.com/open?id=1Z7Bof_s4Dchx3G5tPzHAC77M4EDVGaxKVRlvJG_wMNY'},

  // REP
  {code:'REP-FMS-2025-008',name:'تقرير فحص الطفايات وأنظمة الإنذار',cat:'REP',url:'https://drive.google.com/open?id=1Doz1piFf3dnYXKYtWoV4ExjXG_gmgRLVXkP7ej0sw9E'},
  {code:'REP-FMS-2025-013',name:'تقرير الحوادث الطارئة',cat:'REP',url:'https://drive.google.com/open?id=126D1IVGQpoCUxXZeNlob1fBD0LkXeNQdITDzL5OLXn0'},

  // Misc index
  {code:'FMS_Docs_2025_endorsed',name:'فهرس وثائق FMS المعتمدة 2025',cat:'IDX',url:'https://drive.google.com/open?id=1fTJG9dYRDsgBo0UFSKWlOIkVLkKCY0zO'}
];

const CAT_NAMES = {POL:'السياسات', SOP:'إجراءات التشغيل', DEC:'القرارات', PLN:'الخطط', TRN:'التدريب', LOG:'السجلات', CHK:'قوائم التحقق', FRM:'النماذج', REP:'التقارير', IDX:'فهرس'};
function renderFms(){
  const container=document.getElementById('fmsLibrary'); container.innerHTML='';
  const order=['POL','SOP','DEC','PLN','TRN','LOG','CHK','FRM','REP','IDX'];
  order.forEach(cat=>{
    const items = FMS_DOCS.filter(x=>x.cat===cat);
    if(!items.length) return;
    const group = document.createElement('div'); group.className='card p-4';
    group.innerHTML = `<div class="font-bold text-[var(--maroon)] mb-3">${CAT_NAMES[cat]||cat}</div>`;
    const grid = document.createElement('div'); grid.className='grid-docs';
    items.forEach(d=>{
      const c = document.createElement('div'); c.className='card p-4';
      c.innerHTML = `
        <div class="font-bold text-[var(--maroon)] mb-1">${d.code}</div>
        <div class="text-gray-700 mb-3">${d.name}</div>
        <div class="flex gap-2">
          <button class="bg-[var(--maroon)] text-white px-3 py-2 rounded" onclick="openDoc('${d.code}','${d.url}')">📄 عرض</button>
          <a class="px-3 py-2 rounded border text-[var(--maroon)]" target="_blank" href="${d.url}">↗ فتح في تبويب</a>
        </div>`;
      grid.appendChild(c);
    });
    group.appendChild(grid); container.appendChild(group);
  });
}
renderFms();

/* ===================== نموذج جولة السلامة (Google Apps Script) ===================== */
// ضَع رابط Web App هنا (ينتهي بـ /exec)
const FMS_API_URL = 'YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE';
document.getElementById('roundForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const msg = document.getElementById('roundMsg'); msg.textContent='جارٍ الإرسال...';
  try{
    if(!FMS_API_URL || FMS_API_URL.includes('YOUR_GOOGLE_SCRIPT')) throw new Error('API URL not set');
    const data = new FormData(e.target);
    const res = await fetch(FMS_API_URL, {method:'POST', body:data});
    if(res.ok || res.type==='opaque'){ msg.textContent='✅ تم الإرسال بنجاح إلى Google Sheet'; e.target.reset(); }
    else { msg.textContent='⚠️ لم يتم الإرسال — تأكد من صلاحيات Web App'; }
  }catch(err){ msg.textContent='❌ خطأ في الاتصال — حدّث رابط Web App وتحقق من CORS/الأذونات'; }
});
</script>
</body>
</html>
