<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>بوابة سباهي الإلكترونية – مجمع مكة الطبي بالزاهر (الإصدار 2025)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand1:#7B1E24; /* Maroon */
      --brand2:#8f2b33; /* Burgundy */
      --gold:#E9C46A;
      --bg:#faf7f6;
    }
    html,body{height:100%;}
    body{font-family:'Tajawal',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#fff,#fff8f7 40%,#fff);color:#1f2937;overflow-x:hidden;}
    /* Header */
    header{position:sticky;top:0;z-index:50;background:#fff;box-shadow:0 6px 16px rgba(0,0,0,.06);}
    /* Hero with luxury gradient + logo glow */
    .hero{
      position:relative;
      background:linear-gradient(135deg,var(--brand1),var(--brand2));
      color:#fff; padding:4rem 1rem 3.5rem; text-align:center; overflow:hidden;
    }
    .hero .logo-wrap{position:relative; display:inline-flex; align-items:center; justify-content:center;}
    .hero .logo-backdrop{
      position:absolute; inset:auto; width:220px; height:220px; border-radius:50%;
      background:radial-gradient(ellipse at center, rgba(255,255,255,.18), rgba(255,255,255,0) 65%);
      filter:blur(6px);
    }
    .hero img{height:120px; width:auto; filter:drop-shadow(0 0 16px rgba(233,196,106,.85)); border-radius:.5rem;}
    .hero h1{font-size:2.2rem; font-weight:800; letter-spacing:.5px; margin-top:1rem}
    .hero p{opacity:.95; margin-top:.35rem}
    .tagline{font-size:.95rem; color:#fde8bd; margin-top:.4rem}
    /* Sidebar */
    .sidebar{width:280px; background:linear-gradient(180deg,var(--brand1),var(--brand2)); color:#fff; padding:1rem}
    .nav-link{display:flex; align-items:center; gap:.65rem; padding:.55rem .8rem; border-radius:.6rem; transition:.2s}
    .nav-link:hover{background:rgba(255,255,255,.14)}
    .active-link{background:rgba(255,255,255,.25)}
    .nav-link i{width:20px; text-align:center; margin-left:.5rem}
    /* Sections fade */
    .content-section{display:none; opacity:0; transform:translateY(10px); transition:opacity .35s ease, transform .35s ease;}
    .content-section.active{display:block; opacity:1; transform:translateY(0)}
    /* Gold link style */
    .gold-link{
      display:inline-flex; align-items:center; gap:.6rem; padding:.75rem 1rem; border-radius:.9rem;
      border:1px solid #f0d9a1; background:linear-gradient(180deg,#ffffff,#fffaf0); color:var(--brand1); font-weight:700; text-decoration:none;
      box-shadow:0 4px 12px rgba(0,0,0,.06); transition:transform .15s ease, box-shadow .2s ease, border-color .2s ease;
    }
    .gold-link:hover{transform:translateY(-1px); border-color:var(--gold); box-shadow:0 14px 26px rgba(233,196,106,.28)}
    /* Cards grid */
    .grid-cards{display:grid; grid-template-columns:repeat(1,minmax(0,1fr)); gap:1rem}
    @media (min-width:640px){ .grid-cards{grid-template-columns:repeat(2,minmax(0,1fr));} }
    @media (min-width:1024px){ .grid-cards{grid-template-columns:repeat(3,minmax(0,1fr));} }
    @media (min-width:1280px){ .grid-cards{grid-template-columns:repeat(4,minmax(0,1fr));} }
    /* Modal */
    #docModal{position:fixed; inset:0; background:rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; z-index:80}
    #docModal .box{background:#fff; width:min(96vw,1100px); height:min(86vh,820px); border-radius:1rem; box-shadow:0 30px 60px rgba(0,0,0,.3); overflow:hidden}
    /* Scroll-to-top button */
    #scrollTopBtn{position:fixed; left:22px; bottom:24px; width:46px; height:46px; border-radius:50%; background:var(--gold); color:var(--brand1); display:none; place-items:center; box-shadow:0 8px 16px rgba(123,30,36,.45); z-index:60}
    #scrollTopBtn:hover{transform:scale(1.06)}
    /* Nice table */
    .table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:.8rem; border:1px solid #eee}
    .table thead th{background:#faf9f7; padding:.85rem; font-weight:800; color:#374151; border-bottom:1px solid #eee}
    .table td{padding:.85rem; border-bottom:1px solid #f2f2f2}
    .chip{display:inline-flex; align-items:center; gap:.35rem; padding:.25rem .55rem; border-radius:999px; font-size:.8rem; background:#f3f4f6; color:#374151}
    /* Prevent RTL anchor jump */
    .nav-link, .nav-link:hover{transform:none !important}
  </style>
</head>
<body>

  <!-- ===== Header ===== -->
  <header class="px-4 md:px-6 py-3">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="logoHeader" alt="شعار المجمع" class="h-10 w-auto hidden"/>
        <div id="logoFallbackSmall" class="h-10 w-10 rounded-lg bg-gradient-to-br from-[var(--brand1)] to-[var(--brand2)] grid place-items-center text-white text-lg shadow">
          <i class="fas fa-hospital"></i>
        </div>
        <div class="font-bold text-gray-800">بوابة سباهي الإلكترونية</div>
      </div>
      <div class="flex items-center gap-2">
        <button onclick="window.print()" class="px-3.5 py-2 rounded-md bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
          <i class="fas fa-print ml-2"></i> PDF / طباعة
        </button>
      </div>
    </div>
  </header>

  <!-- ===== Hero ===== -->
  <section class="hero">
    <div class="logo-wrap">
      <div class="logo-backdrop"></div>
      <img id="logoHero" alt="شعار مجمع مكة الطبي" class="hidden"/>
      <div id="logoFallback"
           class="h-[120px] w-[120px] rounded-xl bg-gradient-to-br from-[var(--brand1)] to-[var(--brand2)] grid place-items-center text-3xl font-extrabold shadow-2xl">
        MC
      </div>
    </div>
    <h1>بوابة سباهي الإلكترونية</h1>
    <p>مجمع مكة الطبي العام بالزاهر – الإصدار 2025</p>
    <div class="tagline">بوابة داخلية لإدارة الوثائق والمعايير – لا تتضمن أي ادعاء بالحصول على الاعتماد.</div>
  </section>

  <div class="flex">
    <!-- ===== Sidebar (order as requested) ===== -->
    <aside class="sidebar">
      <div class="font-bold mb-2 text-lg">📚 أقسام البوابة</div>

      <a href="#!" class="nav-link active-link" onclick="showSection(event,'home')"><i class="fas fa-house"></i> الصفحة الرئيسية</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'admin-guide')"><i class="fas fa-book-open"></i> الدليل الإداري</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'governance')"><i class="fas fa-landmark"></i> القيادة والحوكمة (LD)</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'committees')"><i class="fas fa-users"></i> اللجان الرسمية</a>

      <a href="#!" class="nav-link" onclick="showSection(event,'rm')"><i class="fas fa-triangle-exclamation"></i> إدارة المخاطر (RM)</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'fms')"><i class="fas fa-screwdriver-wrench"></i> السلامة والمرافق (FMS)</a>

      <a href="#!" class="nav-link" onclick="showSection(event,'ipc')"><i class="fas fa-shield-virus"></i> مكافحة العدوى (IPC)</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'psc')"><i class="fas fa-heart-circle-check"></i> سلامة المرضى (PSC)</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'qi')"><i class="fas fa-chart-line"></i> الجودة والتحسين (QI)</a>
      <a href="#!" class="nav-link" onclick="showSection(event,'eoc')"><i class="fas fa-person-running"></i> الطوارئ والكوارث (EOC)</a>

      <a href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922"
         target="_blank" class="nav-link"><i class="fas fa-table"></i> السجل الإلكتروني (Google Sheet)</a>
    </aside>

    <!-- ===== Main ===== -->
    <main class="flex-1 p-6 space-y-8">

      <!-- الصفحة الرئيسية -->
      <section id="home" class="content-section active">
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)] mb-3">📌 الرسالة (Mission Statement)</h2>
          <p class="text-gray-800 leading-8 text-lg">
            "نلتزم بتقديم رعاية صحية أولية وتخصصية آمنة ومتمحورة حول المريض في منطقة مكة المكرمة،
            من خلال فريق عمل مؤهل ومرافق متطورة، لتعزيز صحة المجتمع والوصول لأعلى مستويات الجودة."
          </p>
          <div class="mt-4">
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1YUE5GKeQmY3rrHk1j3dX3ztPAwX_3GdNjG9fB_fjPsQ/edit?usp=drive_link"
               title="وثيقة الرسالة، الرؤية، والقيم المُعتمدة (LD.4.2)">
              <i class="fas fa-file-word"></i> وثيقة الرسالة، الرؤية، والقيم المُعتمدة (LD.4.2)
            </a>
          </div>
        </div>
      </section>

      <!-- الدليل الإداري -->
      <section id="admin-guide" class="content-section">
        <div class="bg-white rounded-xl shadow p-6 space-y-5">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">📘 الدليل الإداري والتنظيمي</h2>

          <div class="space-y-3">
            <div class="font-semibold">الدليل التنظيمي المختصر:</div>
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
              <i class="fas fa-file"></i> الدليل التنظيمي المختصر (مستند Google)
            </a>
          </div>

          <div class="space-y-3">
            <div class="font-semibold">الدليل الإداري التنظيمي التفصيلي:</div>
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1hswi3r_fTUKQoVIj3lG9kEIQpFF7Ol7OLCXe3A45-Ao/edit?tab=t.0#heading=h.93zeqi5ae78k">
              <i class="fas fa-file-lines"></i> الدليل الإداري التنظيمي التفصيلي (مستند Google)
            </a>
          </div>
        </div>
      </section>

      <!-- القيادة والحوكمة -->
      <section id="governance" class="content-section">
        <div class="bg-white rounded-xl shadow p-6 space-y-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">🏛️ القيادة والحوكمة (LD)</h2>

          <!-- بطاقة القائد -->
          <div class="border rounded-xl p-5 flex items-center gap-4 bg-gradient-to-br from-[#fff] to-[#fff9f6]">
            <div class="h-14 w-14 rounded-full bg-gradient-to-br from-[var(--brand1)] to-[var(--brand2)] grid place-items-center text-white text-xl shadow">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="flex-1">
              <div class="text-lg font-extrabold text-gray-900">القائد/المدير العام: د. حسين بن محمد حسن شيخ بابصيل</div>
              <div class="text-gray-600">يتبع إداريًا لمجلس الإدارة/المالك ويشرف على الإدارة الطبية، التمريض، الأقسام السريرية والداعمة.</div>
            </div>
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1sZC9bpoqlOgJDN-akgPt5wYrpGC5bvdo-2VL7ZIKCvM/edit?tab=t.0"
               title="قرار التعيين">
              <i class="fas fa-file-signature"></i> قرار التعيين (LD)
            </a>
          </div>

          <!-- الإدارات التنفيذية -->
          <div>
            <h3 class="text-xl font-extrabold text-[var(--brand1)] mb-2">الإدارات التنفيذية (حسب العرض المعتمد)</h3>
            <div class="overflow-auto">
              <table class="table text-right">
                <thead>
                  <tr>
                    <th>القسم</th>
                    <th>المدير</th>
                    <th>المهام الأساسية</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>الإدارة الإدارية</td>
                    <td>أ. بلال نتو</td>
                    <td>التشغيل اليومي، الموارد البشرية، التدريب، الاستقبال والمواعيد.</td>
                  </tr>
                  <tr>
                    <td>الإدارة الطبية</td>
                    <td>د. معاذ البيوش <span class="chip">نائب: د. خالد الخطيب</span></td>
                    <td>الإشراف على العيادات والخدمات السريرية وجودتها.</td>
                  </tr>
                  <tr>
                    <td>الإدارة المالية والتأمين</td>
                    <td>أ. صابر عبده</td>
                    <td>الحسابات، المطالبات، إدارة دورة الإيراد، التقارير المالية.</td>
                  </tr>
                  <tr>
                    <td>الصيانة والمرافق</td>
                    <td>أ. عدنان الرفاعي</td>
                    <td>الصيانة الوقائية، السلامة المرافقية، الطوارئ، المشتريات غير الطبية، النظافة.</td>
                  </tr>
                  <tr>
                    <td>الصيدلية</td>
                    <td>أ. عبدالله حموده</td>
                    <td>الصرف الدوائي الآمن، ضبط الأدوية عالية الخطورة، سلسلة التبريد، المخزون.</td>
                  </tr>
                  <tr>
                    <td>المختبر</td>
                    <td>أ. هيثم الجعلي</td>
                    <td>ضبط الجودة المخبرية، سلامة العينات، السلامة الحيوية.</td>
                  </tr>
                  <tr>
                    <td>الأشعة</td>
                    <td>أ. بلال نتو</td>
                    <td>الإشراف الفني والإشعاعي وفق متطلبات NRRC.</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- قرار تعيين القادة (للتنزيل/الطباعة) -->
          <div class="pt-2">
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1LeyR6WnpUVth3hfr8UX2i5QKIHegA6RvKpkgEhfamA4/edit?usp=drive_link">
              <i class="fas fa-download"></i> قرار تعيين القادة – نسخة للطباعة/التنزيل
            </a>
          </div>
        </div>
      </section>

      <!-- اللجان الرسمية -->
      <section id="committees" class="content-section">
        <div class="bg-white rounded-xl shadow p-6 space-y-5">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">👥 اللجان الرسمية (حسب سباهي)</h2>
          <div class="overflow-auto">
            <table class="table text-right">
              <thead>
                <tr>
                  <th>الرمز</th>
                  <th>اسم اللجنة</th>
                  <th>الرئيس</th>
                  <th>المنسق/السكرتير + الأعضاء</th>
                  <th>تكرار الاجتماعات</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span class="chip">RM</span></td>
                  <td>لجنة إدارة المخاطر</td>
                  <td>د. حسين بابصيل</td>
                  <td>المنسق/السكرتير: أ. عدنان الرفاعي – الأعضاء: بلال، صابر، معاذ، خالد</td>
                  <td>شهريًا</td>
                </tr>
                <tr>
                  <td><span class="chip">FMS</span></td>
                  <td>لجنة السلامة والمرافق</td>
                  <td>أ. صابر عبده</td>
                  <td>منسق التدريب: أ. بلال نتو – الأعضاء: عدنان الرفاعي، خالد الخطيب، مندوب من الأمن</td>
                  <td>شهريًا</td>
                </tr>
                <tr>
                  <td><span class="chip">PSC</span></td>
                  <td>لجنة سلامة المرضى</td>
                  <td>د. معاذ البيوش</td>
                  <td>نائب الرئيس: د. خالد الخطيب – الأعضاء: د. حسين، هيثم، بلال – السكرتير: عدنان</td>
                  <td>شهريًا</td>
                </tr>
                <tr>
                  <td><span class="chip">IPC</span></td>
                  <td>لجنة مكافحة العدوى</td>
                  <td>د. مجدي عسكر</td>
                  <td>الأعضاء: خالد، التمريض، المختبر، التعقيم – السكرتير: عدنان</td>
                  <td>شهريًا</td>
                </tr>
                <tr>
                  <td><span class="chip">QI</span></td>
                  <td>لجنة الجودة والتحسين المستمر</td>
                  <td>د. حسين بابصيل</td>
                  <td>الأعضاء: ممثلين من الأقسام – السكرتير: عدنان</td>
                  <td>ربع سنوي</td>
                </tr>
                <tr>
                  <td><span class="chip">EOC</span></td>
                  <td>لجنة الطوارئ والكوارث</td>
                  <td>أ. بلال نتو</td>
                  <td>الأعضاء: صابر، معاذ، خالد، الأمن، التمريض</td>
                  <td>نصف سنوي</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="pt-2">
            <a class="gold-link" target="_blank"
               href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
              <i class="fas fa-file"></i> تفاصيل اللجان – نسخة من المستند (Google Doc)
            </a>
          </div>
        </div>
      </section>

      <!-- إدارة المخاطر (RM) -->
      <section id="rm" class="content-section">
        <div class="bg-white rounded-xl shadow p-6 space-y-6">
          <div class="flex flex-wrap items-center justify-between gap-3">
            <h2 class="text-2xl font-extrabold text-[var(--brand1)]">⚠️ إدارة المخاطر (RM)</h2>
            <a href="https://www.m2020m.org/report.html" target="_blank"
               class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
              <i class="fas fa-bullhorn ml-2"></i> الإبلاغ الإلكتروني للشكاوى/الحوادث
            </a>
          </div>

          <!-- مكتبة RM الأساسية -->
          <div class="border rounded-xl p-4">
            <h3 class="font-extrabold text-[var(--brand1)] mb-3">📚 مكتبة الأدلة الأساسية</h3>
            <div id="rmLib"></div>
          </div>

          <!-- 📢 التوعية والتدريب: نموذج حضور -->
          <div class="border rounded-xl p-4">
            <h3 class="font-extrabold text-[var(--brand1)] mb-2">📢 التوعية والتدريب — تسجيل حضور متدرب</h3>
            <form id="trainForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-semibold mb-1">اسم المتدرب *</label>
                <input name="trainee_name" required class="w-full border rounded-lg px-3 py-2" placeholder="الاسم الثلاثي">
              </div>
              <div>
                <label class="block text-sm font-semibold mb-1">موضوع التدريب *</label>
                <input name="training_topic" required class="w-full border rounded-lg px-3 py-2" placeholder="مثال: سياسة الإبلاغ عن الحوادث">
              </div>
              <div>
                <label class="block text-sm font-semibold mb-1">تاريخ التدريب *</label>
                <input type="date" name="training_date" required class="w-full border rounded-lg px-3 py-2">
              </div>
              <div>
                <label class="block text-sm font-semibold mb-1">مكان التدريب *</label>
                <input name="training_place" required class="w-full border rounded-lg px-3 py-2" placeholder="قاعة الاجتماعات / عيادة ...">
              </div>
              <div class="sm:col-span-2 flex items-center gap-3 pt-2">
                <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">حفظ الحضور</button>
                <span id="trainMsg" class="text-sm"></span>
              </div>
            </form>
          </div>
        </div>
      </section>

      <!-- السلامة والمرافق (FMS) -->
      <section id="fms" class="content-section">
        <div class="bg-white rounded-xl shadow p-6 space-y-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">🛠️ السلامة والمرافق (FMS)</h2>

          <!-- تبويبات بسيطة -->
          <div class="flex flex-wrap gap-2 border-b pb-3">
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-fms-tab="library" onclick="switchFmsTab('library')">📚 مكتبة الوثائق</button>
            <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-fms-tab="rounds" onclick="switchFmsTab('rounds')">📝 تسجيل جولة سلامة</button>
            <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-fms-tab="needs" onclick="switchFmsTab('needs')">✅ متطلبات سباهي</button>
          </div>

          <div id="fmsTabContent"></div>
        </div>
      </section>

      <!-- بقية اللجان كأقسام (Placeholders للتغذية لاحقًا) -->
      <section id="ipc" class="content-section">
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">🧼 مكافحة العدوى (IPC)</h2>
          <p class="text-gray-700">سيتم تغذية هذا القسم لاحقًا بالخطط والسياسات والنماذج المعتمدة.</p>
        </div>
      </section>

      <section id="psc" class="content-section">
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">❤️ سلامة المرضى (PSC)</h2>
          <p class="text-gray-700">سيتم تغذية هذا القسم لاحقًا بسياسات سلامة المرضى ونماذج M&M وتقارير تحسين السلامة.</p>
        </div>
      </section>

      <section id="qi" class="content-section">
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">📈 الجودة والتحسين المستمر (QI)</h2>
          <p class="text-gray-700">سيتم إضافة مؤشرات الأداء وخطط التحسين لاحقًا.</p>
        </div>
      </section>

      <section id="eoc" class="content-section">
        <div class="bg-white rounded-xl shadow p-6">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">🚨 الطوارئ والكوارث (EOC)</h2>
          <p class="text-gray-700">سيتم إضافة خطط الطوارئ وجداول الإخلاء والتمارين لاحقًا.</p>
        </div>
      </section>
    </main>
  </div>

  <!-- Scroll to top -->
  <button id="scrollTopBtn" title="إلى الأعلى" onclick="window.scrollTo({top:0,behavior:'smooth'})">
    <i class="fas fa-arrow-up"></i>
  </button>

  <!-- Document Modal -->
  <div id="docModal" role="dialog" aria-modal="true">
    <div class="box flex flex-col">
      <div class="flex items-center justify-between px-4 py-3 border-b bg-gray-50">
        <div class="font-bold text-[var(--brand1)]" id="docTitle">عرض الوثيقة</div>
        <button class="text-2xl" onclick="closeDocModal()">&times;</button>
      </div>
      <iframe id="docFrame" class="w-full flex-1" src="about:blank" allowfullscreen></iframe>
    </div>
  </div>

  <!-- ================== Scripts ================== -->
  <script>
    /* ====== Settings ====== */
    // 1) الشعار (Base64). الصق هنا السلسلة Base64 لشعاركم (بدون data:image/..)
    const LOGO_B64 = ``; // مثال: /9j/4AAQSkZJRgABAQAAAQABAAD/… (سطر واحد)

    // 2) سكربت Google Apps Script لتسجيل جولة السلامة
    const FMS_API_URL = 'YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE';

    // 3) سكربت حفظ حضور التدريب (اختياري – ضع Placeholder الآن)
    const TRAIN_API_URL = 'YOUR_GAS_TRAINING_WEB_APP_URL_HERE';

    /* ====== Utilities ====== */
    function showSection(ev, id){
      if(ev) ev.preventDefault();
      document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
      const sec = document.getElementById(id);
      if(sec){ sec.classList.add('active'); sec.scrollIntoView({behavior:'smooth', block:'start'}); }
      document.querySelectorAll('.nav-link').forEach(a=>a.classList.remove('active-link'));
      if(ev && ev.currentTarget) ev.currentTarget.classList.add('active-link');
      if(id==='fms' && document.getElementById('fmsTabContent').innerHTML.trim()===''){ switchFmsTab('library'); }
    }

    function openDocModal(title, previewUrl){
      document.getElementById('docTitle').textContent = title;
      document.getElementById('docFrame').src = previewUrl;
      const m = document.getElementById('docModal'); m.style.display='flex';
    }
    function closeDocModal(){
      const f = document.getElementById('docFrame'); f.src='about:blank';
      document.getElementById('docModal').style.display='none';
    }

    window.addEventListener('scroll',()=>{
      const btn = document.getElementById('scrollTopBtn');
      btn.style.display = window.scrollY>220 ? 'grid' : 'none';
    });

    // تحميل الشعار
    document.addEventListener('DOMContentLoaded', ()=>{
      if(LOGO_B64 && LOGO_B64.length>0){
        const src = `data:image/jpeg;base64,${LOGO_B64}`;
        ['logoHero','logoHeader'].forEach(id=>{
          const el = document.getElementById(id);
          el.src = src; el.classList.remove('hidden');
        });
        document.getElementById('logoFallback').classList.add('hidden');
        document.getElementById('logoFallbackSmall').classList.add('hidden');
      }
    });
  </script>

  <!-- ====== FMS Docs (Library + Forms) & RM Docs ====== -->
  <script>
    // مكتبة FMS (روابط مباشرة للمعاينة داخل النافذة)
    const FMS_DOCS_LIBRARY = [
      // POL السياسات
      { code:'POL-FMS-2025-001', name:'سياسة إدارة السلامة والمرافق', category:'POL', url:'https://drive.google.com/file/d/1YS1Jk5FgwJoY5in71yUQ1oIjE4JEsaecMGWTt00aQ0o/preview' },
      { code:'POL-FMS-2025-015', name:'سياسة مراقبة جودة الهواء والتهوية', category:'POL', url:'https://drive.google.com/file/d/18caApXqHeQSZdBFSvgyIKICX0qMSsN7UuRxz3u7R10o/preview' },

      // SOP إجراءات التشغيل
      { code:'SOP-FMS-2025-002', name:'إجراءات التشغيل القياسية للجولات وفحص الأنظمة', category:'SOP', url:'https://drive.google.com/file/d/1mrKI8YTjSphAk-noRO8sp9GhYYLzR1FCBti2EDyDZOU/preview' },

      // DEC القرارات
      { code:'DEC-FMS-2025-001', name:'قرار تشكيل لجنة السلامة', category:'DEC', url:'https://drive.google.com/file/d/1KJcIqUbXfHIH0qt1UwoJ0Dohc_7n-745rhx90shaqNg/preview' },

      // PLN الخطط
      { code:'PLN-FMS-2025-004', name:'خطة الطوارئ والإخلاء', category:'PLN', url:'https://drive.google.com/file/d/1rPIuA5g52gQSroaaxznZ_SQNOj1TjEDuZ9DF0j3jvf4/preview' },
      { code:'PLN-FMS-2025-007', name:'خطة إدارة النفايات', category:'PLN', url:'https://drive.google.com/file/d/1iSoFBh8u4uTHzDJECxyjlEMeWqaScZwezgOXygEVdso/preview' },
      { code:'PLN-FMS-2025-012', name:'خطة إدارة الطاقة والمياه', category:'PLN', url:'https://drive.google.com/file/d/1b8oP_LOE_k7A0qXqhhVKWXF9zAvJMuSUOLFc1rBoflA/preview' },
      { code:'PLN-FMS-2025-016', name:'خطة الصيانة الطارئة', category:'PLN', url:'https://drive.google.com/file/d/1tQYPW6VHtr1liM7qMoPGgzDxopw9njYivS7WyKxokZw/preview' },
      { code:'PLN-FMS-2025-018', name:'خطة الأمن المادي للمرافق', category:'PLN', url:'https://drive.google.com/file/d/1aF0KTinNcF3gMIotj_byzrAkubX6Y30nZWmVuFM7BcA/preview' },

      // TRN التدريب
      { code:'TRN-FMS-2025-010', name:'خطة تدريب الأمن والسلامة', category:'TRN', url:'https://drive.google.com/file/d/1IwnBiZp11BjIDQLUtT5Ntr7kEhv3jmssvF5Vj6D7yRk/preview' },

      // LOG السجلات
      { code:'LOG-FMS-2025-005', name:'سجل الصيانة الوقائية', category:'LOG', url:'https://drive.google.com/file/d/10QjYYiAppgrOJpb6F2GxxwmRgRt2ooNOClo0etgzWpw/preview' },
      { code:'LOG-FMS-2025-006', name:'سجل الحوادث والملاحظات', category:'LOG', url:'https://drive.google.com/file/d/12D_ESZYNwjEfKZM6C0yzswbsccugSZZBOcMdHELd3TY/preview' },
      { code:'LOG-FMS-2025-014', name:'سجل زيارات الدفاع المدني والجهات التنظيمية', category:'LOG', url:'https://drive.google.com/file/d/1VMNxaSlkz_LX4OqktVHQsj1IT-GA6Y3eUnZa2rgegMA/preview' },

      // CHK قوائم التحقق
      { code:'CHK-FMS-2025-003', name:'قائمة التحقق الدورية للسلامة', category:'CHK', url:'https://drive.google.com/file/d/1C07oXDzj_Vfok81wQUde3P-ExeXhJh6LDwOS35jTDpk/preview' },
      { code:'CHK-FMS-2025-009', name:'سجل جولات لجنة السلامة', category:'CHK', url:'https://drive.google.com/file/d/1fKMIzns80N9IeSU18WudplOpA8DmbL4zmq72PRUmfZw/preview' },

      // FRM النماذج
      { code:'FRM-FMS-2025-011', name:'نموذج تقييم المخاطر البيئية والمادية', category:'FRM', url:'https://drive.google.com/file/d/15uefBzxMrX33-lBCHP3sZb_OZqoQ4hyiymQRnBrN_jo/preview' },
      { code:'FRM-FMS-2025-017', name:'نموذج متابعة تنفيذ التوصيات', category:'FRM', url:'https://drive.google.com/file/d/1Z7Bof_s4Dchx3G5tPzHAC77M4EDVGaxKVRlvJG_wMNY/preview' },

      // REP التقارير
      { code:'REP-FMS-2025-008', name:'تقرير فحص الطفايات وأنظمة الإنذار', category:'REP', url:'https://drive.google.com/file/d/1Doz1piFf3dnYXKYtWoV4ExjXG_gmgRLVXkP7ej0sw9E/preview' },
      { code:'REP-FMS-2025-013', name:'تقرير الحوادث الطارئة', category:'REP', url:'https://drive.google.com/file/d/126D1IVGQpoCUxXZeNlob1fBD0LkXeNQdITDzL5OLXn0/preview' },

      // INDEX فهرس
      { code:'FMS_Docs_2025_endorsed', name:'فهرس وثائق FMS المعتمدة 2025', category:'INDEX', url:'https://drive.google.com/file/d/1fTJG9dYRDsgBo0UFSKWlOIkVLkKCY0zO/preview' },
    ];

    const CATEGORY_NAMES = {POL:'السياسات', SOP:'إجراءات التشغيل', DEC:'القرارات', PLN:'الخطط', TRN:'التدريب', LOG:'السجلات', CHK:'قوائم التحقق', FRM:'النماذج', REP:'التقارير', INDEX:'الفهرس'};

    function switchFmsTab(tab){
      document.querySelectorAll('[data-fms-tab]').forEach(b=>{
        if(b.getAttribute('data-fms-tab')===tab){ b.classList.add('bg-[var(--brand1)]','text-white'); b.classList.remove('bg-gray-100'); }
        else{ b.classList.remove('bg-[var(--brand1)]','text-white'); b.classList.add('bg-gray-100'); }
      });
      const container=document.getElementById('fmsTabContent'); container.innerHTML='';
      if(tab==='library') renderFmsLibrary(container,FMS_DOCS_LIBRARY);
      if(tab==='rounds') renderRoundsForm(container);
      if(tab==='needs') renderNeeds(container);
    }

    function renderFmsLibrary(container, docs){
      // Controls
      const cats=[...new Set(docs.map(d=>d.category))];
      const controls=document.createElement('div');
      controls.className='flex flex-wrap items-center gap-2 mb-4';
      controls.innerHTML=`
        <div class="flex flex-wrap gap-2">
          <button data-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">الكل</button>
          ${cats.map(c=>`<button data-filter="${c}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${CATEGORY_NAMES[c]||c}</button>`).join('')}
        </div>
        <div class="ml-auto w-full md:w-64">
          <input id="fmsSearch" type="text" placeholder="ابحث بالرمز أو العنوان..." class="w-full border rounded-lg px-3 py-2">
        </div>
      `;
      const grid=document.createElement('div'); grid.className='grid-cards'; grid.id='fmsGrid';
      container.appendChild(controls); container.appendChild(grid);

      const paint=(f='ALL',q='')=>{
        grid.innerHTML='';
        const query=(q||'').toLowerCase();
        docs.filter(d=>(f==='ALL'||d.category===f))
            .filter(d=>!query || d.code.toLowerCase().includes(query) || d.name.toLowerCase().includes(query))
            .forEach(d=>{
              const card=document.createElement('div');
              card.className='p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
              card.innerHTML=`
                <div class="text-xs text-gray-500 mb-1">${CATEGORY_NAMES[d.category]||d.category}</div>
                <div class="font-extrabold text-[var(--brand1)]">${d.code}</div>
                <div class="text-gray-800 mt-1 flex-1">${d.name}</div>
                <div class="mt-3 flex gap-2">
                  <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" onclick="openDocModal('${d.code}: ${d.name}','${d.url}')"><i class="fas fa-eye ml-1"></i> عرض</button>
                  <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" target="_blank" href="${d.url.replace('/preview','/view')}"><i class="fas fa-up-right-from-square ml-1"></i> فتح في تبويب</a>
                </div>`;
              grid.appendChild(card);
            });
      };
      controls.querySelectorAll('button[data-filter]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          controls.querySelectorAll('button[data-filter]').forEach(b=>b.classList.remove('bg-[var(--brand1)]','text-white'));
          btn.classList.add('bg-[var(--brand1)]','text-white');
          paint(btn.getAttribute('data-filter'), document.getElementById('fmsSearch').value);
        });
      });
      controls.querySelector('#fmsSearch').addEventListener('input',e=>{
        const active=controls.querySelector('button[data-filter].bg-[var(--brand1)]') || {getAttribute:()=> 'ALL'};
        paint(active.getAttribute('data-filter'), e.target.value);
      });
      paint('ALL','');
    }

    // جولات السلامة (إرسال لـ GAS)
    function renderRoundsForm(container){
      const form=document.createElement('form');
      form.id='roundsForm';
      form.className='space-y-4 p-4 border rounded-xl';
      form.innerHTML=`
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-semibold mb-1">اسم المراقب *</label>
            <input name="inspector" required class="w-full border rounded-lg px-3 py-2" placeholder="اختر/اكتب اسم المراقب">
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">الموقع/القسم *</label>
            <input name="location" required class="w-full border rounded-lg px-3 py-2" placeholder="عيادة 5، المدخل الرئيسي...">
          </div>
          <div>
            <label class="block text-sm font-semibold mb-1">الأولوية *</label>
            <select name="priority" class="w-full border rounded-lg px-3 py-2">
              <option>🔴 عالية (إجراء فوري)</option>
              <option selected>🟡 متوسطة (خلال أسبوع)</option>
              <option>🟢 منخفضة (مجدول)</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">الملاحظة والتوصية *</label>
          <textarea name="observation" rows="4" required class="w-full border rounded-lg px-3 py-2" placeholder="اذكر الملاحظة والإجراء المقترح..."></textarea>
        </div>
        <div class="flex items-center gap-3">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">إرسال</button>
          <a class="px-4 py-2 rounded-lg bg-[var(--gold)] text-[var(--brand1)] shadow hover:opacity-90" target="_blank"
             href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922">🔄 عرض آخر الجولات</a>
          <span id="formMsg" class="text-sm"></span>
        </div>
      `;
      form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const msg=document.getElementById('formMsg'); msg.textContent='جارٍ الإرسال...';
        if(!FMS_API_URL || FMS_API_URL.includes('YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE')){ msg.textContent='❗ رجاءً أضف رابط Web App أولًا.'; msg.className='text-sm text-red-600'; return; }
        try{
          const res=await fetch(FMS_API_URL,{method:'POST',body:new FormData(form)});
          if(res.ok || res.type==='opaque'){ msg.textContent='✅ تم الإرسال بنجاح.'; msg.className='text-sm text-green-600'; form.reset(); }
          else{ msg.textContent='⚠️ تعذّر الإرسال. تحقق من صلاحيات Web App.'; msg.className='text-sm text-red-600'; }
        }catch(err){ msg.textContent='⚠️ خطأ اتصال. افحص الرابط أو الشبكة.'; msg.className='text-sm text-red-600'; }
      });
      container.appendChild(form);
    }

    function renderNeeds(container){
      const needs=[
        {k:'policy',txt:'سياسة إدارة السلامة والمرافق (POL-001) معتمدة', req:true},
        {k:'committee',txt:'قرار تشكيل لجنة السلامة (DEC-001) مُفعّل', req:true},
        {k:'emerg',txt:'خطة الطوارئ والإخلاء (PLN-004) مُحدّثة', req:true},
        {k:'ppm',txt:'سجل الصيانة الوقائية (LOG-005) مكتمل', req:true},
        {k:'training',txt:'تنفيذ خطة التدريب (TRN-010)', req:true},
      ];
      const wrap=document.createElement('div'); wrap.className='grid-cards';
      needs.forEach(n=>{
        const c=document.createElement('div'); c.className='p-4 rounded-xl border bg-white shadow-sm';
        c.innerHTML=`
          <label class="flex items-start gap-3 cursor-pointer">
            <input type="checkbox" class="mt-1 h-5 w-5" data-required="${n.req?1:0}">
            <span class="font-semibold">${n.txt}</span>
          </label>
          ${n.req?'<div class="text-xs text-red-600 mt-1">متطلب إلزامي</div>':''}
        `;
        wrap.appendChild(c);
      });
      const actions=document.createElement('div'); actions.className='pt-2';
      actions.innerHTML=`<button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateNeeds()">تحقّق من الاكتمال</button>`;
      container.appendChild(wrap); container.appendChild(actions);
    }
    function validateNeeds(){
      const req=[...document.querySelectorAll('input[data-required="1"]')];
      const miss=req.filter(x=>!x.checked).length;
      if(miss===0) alert('ممتاز ✅ — جميع المتطلبات الإلزامية مكتملة.');
      else alert(`⚠️ تنبيه: يوجد ${miss} متطلب(ات) إلزامي غير مكتمل.`);
    }

    /* ====== RM Essentials Library ====== */
    const RM_DOCS_ESSENTIAL = [
      // قرارات/سياسات
      { code:'LD.31',    name:'قرار اعتماد برنامج إدارة المخاطر (LD.31)', category:'DEC',  url:'https://drive.google.com/file/d/1TYH87_v6rC2twWOZig2P5YDegRv6ir2dlYEU-v6KXwg/preview' },
      { code:'LD.31/32', name:'قرار تشكيل لجنة إدارة المخاطر وسلامة المرضى', category:'DEC',  url:'https://drive.google.com/file/d/1yN0wiHu-mmNqFHF5XeEQIqOeMElIFSXn-xCz1AzAfco/preview' },
      { code:'LD.32',    name:'قرار إداري باعتماد سياسة الإبلاغ عن الحوادث/الشكاوى', category:'POL',  url:'https://drive.google.com/file/d/1irNRM1ovqwQEaEEj5gv9rmAuoV8O5aY-m0hSNykZDUk/preview' },

      // نماذج البلاغات الأساسية
      { code:'IR',   name:'نموذج بلاغ حادث (Incident Report)', category:'FRM', url:'https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/preview' },
      { code:'NM',   name:'نموذج بلاغ قريب من الوقوع (Near Miss)', category:'FRM', url:'https://drive.google.com/file/d/1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0/preview' },
      { code:'UNSAFE', name:'بلاغ خطر/شرط غير آمن', category:'FRM', url:'https://drive.google.com/file/d/1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I/preview' },
      { code:'DEVICE', name:'بلاغ عطل جهاز/تجهيز', category:'FRM', url:'https://drive.google.com/file/d/17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ/preview' },
      { code:'SE',   name:'إخطار حدث جسيم (Sentinel Event)', category:'FRM', url:'https://drive.google.com/file/d/1LrOlWxfECxyzF77DnerV15RjS-ElSTbIEa1UuKG3rD0/preview' },

      // التحقيق والتحسين
      { code:'RCA/CAP', name:'تحليل السبب الجذري وخطة الإجراءات التصحيحية', category:'TOOL', url:'https://drive.google.com/file/d/1lDKsjgPDCdwXNV935kB_DfAm-ZsdzLPK8p4Pn7hgJJ0/preview' },
      { code:'HFMEA',   name:'HFMEA (تحليل مسبق للمخاطر)', category:'TOOL', url:'https://drive.google.com/file/d/15ZjKLJYhe3HCUWbAO2Iw96IY1GOn1VNCWIjzdi9U4x8/preview' },

      // المتابعة والقياس
      { code:'REGISTER', name:'سجل المخاطر المؤسسي', category:'LOG',  url:'https://drive.google.com/file/d/1XVMRWRZKoTpmXPzrPdXJA7PWf9r88YwLYv_tptdiZAA/preview' },
      { code:'KPI',      name:'لوحة المؤشرات الشهرية لإدارة المخاطر', category:'DASH', url:'https://drive.google.com/file/d/1pj8P8rf4TZj_wVKgLrO8ayP9WNUBc1yTWeAy8r0xGOY/preview' },

      // الحوكمة/التصعيد
      { code:'ESCALATION', name:'لوحة اتصالات وسلسلة التصعيد', category:'REF', url:'https://drive.google.com/file/d/1dZrkUB_d1XblN3QonWxPt9F1LQ6xQIbyNFT4ixI2m64/preview' },
    ];

    function renderRMLibrary(){
      const mount=document.getElementById('rmLib');
      mount.innerHTML=`
        <div class="flex flex-wrap items-center gap-2 mb-3">
          <button data-rm="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">الكل</button>
          ${[...new Set(RM_DOCS_ESSENTIAL.map(i=>i.category))].map(c=>`<button data-rm="${c}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${c}</button>`).join('')}
          <div class="ml-auto w-full md:w-64"><input id="rmSearch" type="text" placeholder="بحث..." class="w-full border rounded-lg px-3 py-2"></div>
        </div>
        <div id="rmGrid" class="grid-cards"></div>
      `;
      const grid=mount.querySelector('#rmGrid');
      const paint=(f='ALL',q='')=>{
        grid.innerHTML='';
        const query=q.toLowerCase();
        RM_DOCS_ESSENTIAL
          .filter(i=>f==='ALL'||i.category===f)
          .filter(i=>!query || i.code.toLowerCase().includes(query)||i.name.toLowerCase().includes(query))
          .forEach(i=>{
            const card=document.createElement('div');
            card.className='p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
            card.innerHTML=`
              <div class="text-xs text-gray-500 mb-1">${i.category}</div>
              <div class="font-extrabold text-[var(--brand1)]">${i.code}</div>
              <div class="text-gray-800 mt-1 flex-1">${i.name}</div>
              <div class="mt-3 flex gap-2">
                <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" onclick="openDocModal('${i.code}: ${i.name}','${i.url}')"><i class="fas fa-eye ml-1"></i> عرض</button>
                <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" target="_blank" href="${i.url.replace('/preview','/view')}"><i class="fas fa-up-right-from-square ml-1"></i> فتح في تبويب</a>
              </div>
            `;
            grid.appendChild(card);
          });
      };
      mount.querySelectorAll('button[data-rm]').forEach(b=>{
        b.addEventListener('click',()=>{
          mount.querySelectorAll('button[data-rm]').forEach(x=>x.classList.remove('bg-[var(--brand1)]','text-white'));
          b.classList.add('bg-[var(--brand1)]','text-white');
          paint(b.getAttribute('data-rm'), mount.querySelector('#rmSearch').value||'');
        });
      });
      mount.querySelector('#rmSearch').addEventListener('input',e=>{
        const active=mount.querySelector('button[data-rm].bg-[var(--brand1)]') || {getAttribute:()=> 'ALL'};
        paint(active.getAttribute('data-rm'), e.target.value);
      });
      paint('ALL','');
    }

    // حفظ حضور التدريب (Placeholder إرسال)
    document.addEventListener('DOMContentLoaded',()=>{
      const form=document.getElementById('trainForm');
      if(form){
        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const msg=document.getElementById('trainMsg'); msg.textContent='جارٍ الحفظ...';
          if(!TRAIN_API_URL || TRAIN_API_URL.includes('YOUR_GAS_TRAINING_WEB_APP_URL_HERE')){ msg.textContent='❗ أضف رابط سكربت التدريب لاحقًا.'; msg.className='text-sm text-red-600'; return; }
          try{
            const res=await fetch(TRAIN_API_URL,{method:'POST',body:new FormData(form)});
            if(res.ok || res.type==='opaque'){ msg.textContent='✅ تم الحفظ.'; msg.className='text-sm text-green-600'; form.reset(); }
            else{ msg.textContent='⚠️ تعذّر الحفظ. افحص صلاحيات السكربت.'; msg.className='text-sm text-red-600'; }
          }catch(err){ msg.textContent='⚠️ خطأ اتصال.'; msg.className='text-sm text-red-600'; }
        });
      }
    });

    // تهيئة
    document.addEventListener('DOMContentLoaded',()=>{
      renderRMLibrary();
    });

    // فتح/إغلاق نافذة الوثائق (تصدير لدوال عامة)
    window.openDocModal = openDocModal;
    window.closeDocModal = closeDocModal;
  </script>
</body>
</html>
