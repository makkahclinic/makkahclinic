<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root { --brand:#7B1E24; --brand2:#C55A44; }
    body { font-family:'Tajawal',sans-serif; background:#f9f9f9; }
    .dark body { background:#1a1a1a; color:#eee; }
    .sidebar { width:270px; background:linear-gradient(180deg,var(--brand),var(--brand2)); color:white; }
    .nav-link { display:block; padding:.75rem 1rem; border-radius:.5rem; transition:.2s; }
    .nav-link:hover { background-color:rgba(255,255,255,.15); }
    .active-link { background-color:rgba(255,255,255,.25); }
    .content-section { display:none; }
    .content-section.active { display:block; }
    .org-chart{ display:flex; flex-direction:column; align-items:center; }
    .org-level{ display:flex; justify-content:center; margin:20px 0; }
    .org-node{ background:white; border:1px solid #ddd; border-radius:8px; padding:15px; margin:0 10px; text-align:center; width:200px; box-shadow:0 2px 4px rgba(0,0,0,.1); }
    .org-node.director{ background:var(--brand); color:white; }
    .org-node.manager{ background:var(--brand2); color:white; }
    .org-node.head{ background:#e9c46a; }
    .committee-card{ background:white; border-radius:8px; padding:20px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,.1); }
    .committee-header{ display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; }
    .committee-code{ background:var(--brand); color:white; padding:5px 10px; border-radius:4px; font-weight:bold; }
    .indicator-card{ background:white; border-radius:8px; padding:20px; box-shadow:0 2px 10px rgba(0,0,0,.1); text-align:center; }
    .indicator-value{ font-size:2rem; font-weight:bold; margin:10px 0; }
    .progress-bar{ height:10px; background:#e0e0e0; border-radius:5px; overflow:hidden; margin:10px 0; }
    .progress-fill{ height:100%; background:var(--brand); }
    .document-card{ background:white; border-radius:8px; padding:15px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,.1); }
    .badge{ font-size:.8rem; background:#f1f5f9; padding:.15rem .4rem; border-radius:.35rem; }
    .btn{ display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .8rem; border-radius:.5rem; }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-primary:hover{ background:#8f2b33; }
    .btn-muted{ background:#e5e7eb; }
    .btn-muted:hover{ background:#d1d5db; }
    .field{ display:flex; flex-direction:column; gap:.3rem; }
    .label{ font-weight:600; color:#374151; }
    .input,.select,.textarea{ border:1px solid #d1d5db; border-radius:.5rem; padding:.55rem .7rem; background:#fff; }
    .textarea{ min-height:120px; }
    .pill{ padding:.15rem .5rem; border-radius:999px; font-size:.75rem; background:#f3f4f6; }
    .watermark { position: absolute; inset-inline-end: 1rem; inset-block-start: 1rem; opacity:.08; }
  </style>
</head>

<body class="min-h-screen flex flex-col">

  <!-- Header with logo -->
  <header class="flex justify-between items-center bg-white shadow-md px-6 py-4 sticky top-0 z-50 relative">
    <img id="orgLogoWater" class="watermark h-24 w-24 object-contain pointer-events-none select-none" alt="">
    <div class="flex items-center gap-4">
      <div class="flex items-center gap-3">
        <!-- ุดุนุงุฑ ูู ุงูุทุฑู (ุงูุชุฑููุณุฉ) -->
        <img id="orgLogo" src="assets/logo.png" alt="ุดุนุงุฑ ูุฌูุน ููุฉ ุงูุทุจู ุงูุนุงู ุจุงูุฒุงูุฑ"
             class="h-14 w-14 object-contain rounded-xl bg-white p-1 shadow-lg">
        <div>
          <h1 class="text-xl font-bold text-gray-800">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ</h1>
          <p class="text-sm text-gray-500">ูุฌูุน ููุฉ ุงูุทุจู ุงูุนุงู ุจุงูุฒุงูุฑ โ ุงูุฅุตุฏุงุฑ 2025</p>
        </div>
      </div>
    </div>
    <div class="flex items-center gap-3">
      <button id="darkModeBtn" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
        <i class="fas fa-moon ml-1"></i> ูุถุน ูููู
      </button>
      <button onclick="window.print()" class="px-4 py-2 btn btn-primary">
        <i class="fas fa-print ml-1"></i> ุทุจุงุนุฉ / PDF
      </button>
    </div>
  </header>

  <div class="flex flex-1">
    <!-- Sidebar -->
    <aside class="sidebar p-4 text-sm leading-relaxed">
      <!-- ุดุนุงุฑ ูู ุงูุฌุงูุจ -->
      <div class="flex items-center gap-2 mb-4">
        <img id="orgLogoSide" src="assets/logo.png" alt="ุดุนุงุฑ" class="h-10 w-10 object-contain rounded bg-white p-1 shadow">
        <div class="font-bold">ูุฌูุน ููุฉ ุงูุทุจู</div>
      </div>

      <div class="font-bold mb-3 text-lg">๐ ุฃูุณุงู ุจูุงุจุฉ ุณุจุงูู</div>
      <a href="#home" class="nav-link active-link" onclick="showSection('home')">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>

      <div class="font-bold mt-4 mb-2">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ (LD)</div>
      <a href="#leadership" class="nav-link" onclick="showSection('leadership')">ุงูุฏููู ุงูุฅุฏุงุฑู ูุงูุชูุธููู</a>
      <a href="#organizational-structure" class="nav-link" onclick="showSection('organizational-structure')">ุงููููู ุงูุชูุธููู</a>
      <a href="#committees" class="nav-link" onclick="showSection('committees')">ุงููุฌุงู ุงูุฑุณููุฉ</a>
      <a href="#key-indicators" class="nav-link" onclick="showSection('key-indicators')">ุงููุคุดุฑุงุช ุงูุฃุณุงุณูุฉ</a>

      <div class="font-bold mt-4 mb-2">๐๏ธ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</div>
      <a href="#fms-workspace" class="nav-link" onclick="showSection('fms-workspace')">ูุณุงุญุฉ ุนูู FMS</a>
      <a href="#dashboard" class="nav-link" onclick="showSection('dashboard')">ููุญุฉ ุงููุคุดุฑุงุช</a>
      <a href="#plans" class="nav-link" onclick="showSection('plans')">ุงูุฎุทุท ุงูุซูุงููุฉ</a>
      <a href="#forms" class="nav-link" onclick="showSection('forms')">ุงูููุงุฐุฌ ูุงูุณุฌูุงุช</a>
      <a href="#sources2025" class="nav-link" onclick="showSection('sources2025')">๐ฆ ูุตุงุฏุฑ FMS 2025</a>

      <div class="font-bold mt-4 mb-2">๐ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)</div>
      <a href="#qi" class="nav-link" onclick="showSection('qi')">ูุคุดุฑุงุช ุงูุฌูุฏุฉ</a>

      <div class="font-bold mt-4 mb-2">โ๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</div>
      <a href="#rm" class="nav-link" onclick="showSection('rm')">ููุงุฐุฌ ูุชุญุงููู ุงููุฎุงุทุฑ</a>

      <div class="font-bold mt-4 mb-2">๐งซ ููุงูุญุฉ ุงูุนุฏูู (IPC)</div>
      <a href="#ipc" class="nav-link" onclick="showSection('ipc')">ุงูุฎุทุท ูุงูุณูุงุณุงุช</a>

      <div class="font-bold mt-4 mb-2">โค๏ธโ๐ฉน ุณูุงูุฉ ุงููุฑุถู (PSC)</div>
      <a href="#psc" class="nav-link" onclick="showSection('psc')">ุณูุงุณุงุช ูููุงุฐุฌ ุณูุงูุฉ ุงููุฑุถู</a>

      <div class="font-bold mt-4 mb-2">๐จ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</div>
      <a href="#eoc" class="nav-link" onclick="showSection('eoc')">ุงูุฎุทุท ูุงูุฅุฎูุงุก</a>

      <div class="font-bold mt-4 mb-2">๐๏ธ ุงูุชูุงุฑูุฑ ูุงูุงุนุชูุงุฏุงุช</div>
      <a href="#reports" class="nav-link" onclick="showSection('reports')">ุงูุชูุงุฑูุฑ ุงูุณูููุฉ</a>
      <a href="#accreditation" class="nav-link" onclick="showSection('accreditation')">ูููุงุช ุงูุงุนุชูุงุฏ</a>
    </aside>

    <!-- Main -->
    <main class="flex-1 p-6 overflow-y-auto" id="mainContent">

      <!-- Home -->
      <section id="home" class="content-section active">
        <div class="flex flex-col items-center justify-center h-full mt-10 relative">
          <div class="h-40 w-40 bg-gradient-to-br from-[var(--brand)] to-[var(--brand2)] rounded-full flex items-center justify-center text-white text-4xl font-bold mb-6 shadow-xl">
            <!-- ุดุนุงุฑ ุฏุงุฎู ุงููุต -->
            <img id="orgLogoInHero" src="assets/logo.png" alt="ุงูุดุนุงุฑ" class="h-24 w-24 object-contain rounded bg-white p-2 shadow-md">
          </div>
          <h2 class="text-3xl font-bold text-[var(--brand)] mb-3">CBAHI Electronic Portal</h2>
          <p class="text-gray-600 text-lg mb-2">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ โ ูุฌูุน ููุฉ ุงูุทุจู ุงูุนุงู ุจุงูุฒุงูุฑ</p>
          <p class="text-sm text-gray-400 mb-8">ุงูุฅุตุฏุงุฑ ุงูุฑุณูู 2025 โ ุฌููุน ุงูุญููู ูุญููุธุฉ</p>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full max-w-4xl">
            <div class="bg-white p-6 rounded-lg shadow-md border hover:shadow-lg transition">
              <i class="fas fa-chart-line text-3xl text-[var(--brand)] mb-3"></i>
              <h3 class="font-bold text-lg mb-2">ุงููุคุดุฑุงุช ุงูุญูููุฉ</h3>
              <p class="text-gray-600">ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก ูุงูุฌูุฏุฉ</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md border hover:shadow-lg transition">
              <i class="fas fa-file-alt text-3xl text-[var(--brand)] mb-3"></i>
              <h3 class="font-bold text-lg mb-2">ุงููุซุงุฆู ูุงูุณูุงุณุงุช</h3>
              <p class="text-gray-600">ุฌููุน ูุซุงุฆู ุงูุนูู ุงููุนุชูุฏุฉ</p>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-md border hover:shadow-lg transition">
              <i class="fas fa-chart-bar text-3xl text-[var(--brand)] mb-3"></i>
              <h3 class="font-bold text-lg mb-2">ุงูุชูุงุฑูุฑ ุงูุฅุฏุงุฑูุฉ</h3>
              <p class="text-gray-600">ุชูุงุฑูุฑ ุงูุฃุฏุงุก ูุงูุฅุญุตุงุฆูุงุช</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Committees (ูุฎุชุตุฑ) -->
      <section id="committees" class="content-section">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-2xl font-bold text-[var(--brand)] mb-6">๐ฅ ุงููุฌุงู ุงูุฑุณููุฉ (ุญุณุจ ุณุจุงูู)</h2>
          <!-- (ุชูุงุตูู ุงููุฌุงู ููุง ูู ุงููุณุฎุฉ ุงูุณุงุจูุฉ) -->
          <div class="committee-card">
            <div class="committee-header">
              <h3 class="text-xl font-bold">ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</h3><span class="committee-code">RM</span>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
              <div><p class="font-bold text-[var(--brand)]">ุงูุฑุฆูุณ:</p><p>ุฏ. ุญุณูู ุจุงุจุตูู</p></div>
              <div><p class="font-bold text-[var(--brand)]">ุงูููุณู/ุงูุณูุฑุชูุฑ:</p><p>ุฃ. ุนุฏูุงู ุงูุฑูุงุนู</p></div>
              <div><p class="font-bold text-[var(--brand)]">ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช:</p><p>ุดูุฑููุง</p></div>
            </div>
            <div>
              <p class="font-bold text-[var(--brand)] mb-2">ุงูุฃุนุถุงุก:</p>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                <div class="pill">ุจูุงู ูุชู</div><div class="pill">ุตุงุจุฑ ุนุจุฏู</div>
                <div class="pill">ุฏ. ูุนุงุฐ ุงูุจููุด</div><div class="pill">ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ</div>
              </div>
            </div>
          </div>
          <!-- ุจุงูู ุงููุฌุงู ููููู ุชูุฑุงุฑูุง ูู ูุณุฎุชู ุงูุฃุตููุฉ -->
        </div>
      </section>

      <!-- Key Indicators -->
      <section id="key-indicators" class="content-section">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-2xl font-bold text-[var(--brand)] mb-6">๐ ุงููุคุดุฑุงุช ุงูุฃุณุงุณูุฉ ููููุงุณ ูุงููุชุงุจุนุฉ</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงูููุงุฏุฉ</h3><div class="indicator-value">92%</div><p>ูุนุฏู ุญุถูุฑ ุงุฌุชูุงุนุงุช ุงูููุงุฏุฉ</p><div class="progress-bar"><div class="progress-fill" style="width:92%"></div></div></div>
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงูุฅุฏุงุฑุฉ</h3><div class="indicator-value">88%</div><p>ุชูููุฐ ุงูุฎุทุท ุงูุฅุณุชุฑุงุชูุฌูุฉ</p><div class="progress-bar"><div class="progress-fill" style="width:88%"></div></div></div>
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงูููุงุฑุฏ ุงูุจุดุฑูุฉ</h3><div class="indicator-value">85%</div><p>ูุนุฏู ุฅูุฌุงุฒ ุชูููู ุงูุฃุฏุงุก</p><div class="progress-bar"><div class="progress-fill" style="width:85%"></div></div></div>
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงููุงููุฉ</h3><div class="indicator-value">94%</div><p>ุฏูุฉ ุงูุชูุงุฑูุฑ ุงููุงููุฉ</p><div class="progress-bar"><div class="progress-fill" style="width:94%"></div></div></div>
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงูุฌูุฏุฉ</h3><div class="indicator-value">89%</div><p>ูุนุฏู ุชุญููู ุฃูุฏุงู ุงูุฌูุฏุฉ</p><div class="progress-bar"><div class="progress-fill" style="width:89%"></div></div></div>
            <div class="indicator-card"><h3 class="font-bold text-lg text-[var(--brand)]">ูุคุดุฑุงุช ุงูุณูุงูุฉ</h3><div class="indicator-value">91%</div><p>ูุนุฏู ุชูููุฐ ูุชุทูุจุงุช ุงูุณูุงูุฉ</p><div class="progress-bar"><div class="progress-fill" style="width:91%"></div></div></div>
          </div>
        </div>
      </section>

      <!-- FMS Workspace -->
      <section id="fms-workspace" class="content-section">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-2xl font-bold text-[var(--brand)]">๐๏ธ ูุณุงุญุฉ ุนูู FMS (ูุชุทูุจุงุช ุณุจุงูู)</h2>
            <div class="flex gap-2">
              <button onclick="window.print()" class="px-3 py-2 text-sm btn btn-primary">๐จ๏ธ ุทุจุงุนุฉ ูุฐู ุงูุตูุญุฉ</button>
            </div>
          </div>

          <div class="border-b border-gray-200 mb-4 flex flex-wrap gap-2">
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="needs" onclick="switchFmsTab('needs')">โ ุจุงูู ุงูุงุญุชูุงุฌุงุช</button>
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="plans" onclick="switchFmsTab('plans')">๐ ุงูุฎุทุท ุงูุซูุงููุฉ</button>
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="governance" onclick="switchFmsTab('governance')">๐๏ธ ุงูุญูููุฉ ูุงูุณูุงุณุงุช</button>
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="forms" onclick="switchFmsTab('forms')">๐๏ธ ุงูููุงุฐุฌ ูุงูุณุฌูุงุช</button>
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="kpis" onclick="switchFmsTab('kpis')">๐ ูุคุดุฑุงุช FMS</button>
            <button class="px-3 py-2 text-sm rounded bg-gray-100 hover:bg-gray-200" data-fms-tab="rounds" onclick="switchFmsTab('rounds')">๐ ูููุฐุฌ ุฌููุฉ ุงูุณูุงูุฉ</button>
          </div>

          <div id="fmsTabContent" class="space-y-4"></div>
        </div>
      </section>

      <!-- Sources 2025 -->
      <section id="sources2025" class="content-section">
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <h2 class="text-2xl font-bold text-[var(--brand)] mb-4">๐ฆ ูุตุงุฏุฑ FMS 2025 (ุฎุทุท/ุณูุงุณุงุช/ููุงุฐุฌ/ุณุฌูุงุช)</h2>
          <p class="text-gray-600 mb-3">ุชูุนุฑุถ ุฃุฏูุงู ุฌููุน ุงููุตุงุฏุฑ ุงูุชู ุฒููุฏุชูู ุจูุง. ุฅุฐุง ูุงู ููู <span class="font-mono bg-gray-100 px-1 rounded">index.json</span> ูู Google Drive ุนุงูุงู ููุญุชูู ุนูู ุฑุจุท (Code โ File ID)ุ ูุณูุชู ูุชุญ ูู ูุตุฏุฑ ูุจุงุดุฑุฉ ุฏุงุฎู ุงูุนุงุฑุถ. ูุฅูุง ุณุชุธูุฑ ูุตูุฉ ุฅูู ูุฌูุฏ ุงููุตุงุฏุฑ.</p>
          <div id="sourcesList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
          <div class="mt-3 text-sm text-gray-600">๐ ูุฌูุฏ ุงููุตุงุฏุฑ: <a id="sourcesFolderLink" class="underline text-blue-700" target="_blank" rel="noopener"></a></div>
        </div>
      </section>

      <!-- Other sections headings only -->
      <section id="dashboard" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐ ููุญุฉ ูุคุดุฑุงุช ุงูุณูุงูุฉ ูุงููุฑุงูู</h2></section>
      <section id="plans" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐๏ธ ุงูุฎุทุท ุงูุซูุงููุฉ</h2></section>
      <section id="forms" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐ ุงูููุงุฐุฌ ูุงูุณุฌูุงุช</h2></section>
      <section id="qi" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐ ูุคุดุฑุงุช ุงูุฌูุฏุฉ</h2></section>
      <section id="rm" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">โ๏ธ ููุงุฐุฌ ูุชุญุงููู ุงููุฎุงุทุฑ</h2></section>
      <section id="ipc" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐งซ ุงูุฎุทุท ูุงูุณูุงุณุงุช</h2></section>
      <section id="psc" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">โค๏ธโ๐ฉน ุณูุงุณุงุช ูููุงุฐุฌ ุณูุงูุฉ ุงููุฑุถู</h2></section>
      <section id="eoc" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐จ ุงูุฎุทุท ูุงูุฅุฎูุงุก</h2></section>
      <section id="reports" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐๏ธ ุงูุชูุงุฑูุฑ ุงูุณูููุฉ</h2></section>
      <section id="accreditation" class="content-section"><h2 class="text-2xl font-bold mb-6 text-[var(--brand)]">๐ ูููุงุช ุงูุงุนุชูุงุฏ</h2></section>

    </main>
  </div>

  <footer class="bg-[var(--brand)] text-white text-center py-3 text-sm">
    ยฉ 2025 ูุฌูุน ููุฉ ุงูุทุจู ุงูุนุงู ุจุงูุฒุงูุฑ โ ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ
  </footer>

  <!-- ===== Scripts ===== -->
  <script>
  // ====== ุงูุฅุนุฏุงุฏุงุช ุงูุนุงูุฉ ======
  // ุฑุงุจุท Web App ุจุนุฏ ูุดุฑ ุณูุฑุจุช Google Apps Script (ูุณู โก)
  const FMS_API_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL';

  // ุดุนุงุฑ ุนุจุฑ Google Drive (ุงุฎุชูุงุฑู): ุถุน ID ููุตูุฑุฉ ุงูุนุงูุฉ ุฅู ุฑุบุจุช
  const LOGO_DRIVE_ID = ''; // ูุซุงู: '1ABCDEF...'
  if (LOGO_DRIVE_ID) {
    const logoURL = `https://drive.google.com/uc?export=view&id=${LOGO_DRIVE_ID}`;
    document.addEventListener('DOMContentLoaded', () => {
      ['orgLogo','orgLogoSide','orgLogoInHero','orgLogoWater'].forEach(id=>{
        const el=document.getElementById(id); if(el) el.src = logoURL;
      });
    });
  }

  // ุฃุณูุงุก ุงููุฑุงูุจูู (ูุงุจูุฉ ููุชุนุฏูู)
  const INSPECTORS = [
    'ุฃ. ุจูุงู ูุชู','ุฃ. ุนุฏูุงู ุงูุฑูุงุนู','ุฃ. ุตุงุจุฑ ุนุจุฏู','ุฃ. ุนุจุฏุงููู ุญููุฏู',
    'ุฃ. ููุซู ุงูุฌุนูู','ุฏ. ูุนุงุฐ ุงูุจููุด','ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ','ุฏ. ุญุณูู ุจุงุจุตูู'
  ];

  // ุฑูุงุจุท Google Drive ุงูุณุงุจูุฉ ููุฎุทุท/ุงูุญูููุฉ/ุงูููุงุฐุฌ (ูููู ุงูุฅุจูุงุก ุนูููุง ููุง ูุนูููุง ุณุงุจูุงู)
  const FMS_PLANS = [];
  const FMS_GOV = [];
  const FMS_FORMS = [];

  // ===== ูุตุงุฏุฑ FMS 2025 ุงูุชู ุฒููุฏุชูู ุจูุง (Code + Title) =====
  const SOURCES_FOLDER_ID = '11CvxbZpNVfRvTXFyJPgbE3y8QM68x461'; // ูุฌูุฏ ุงููุตุงุฏุฑ
  const INDEX_JSON_ID    = '1FSJ6H5o4I4iG1DZV9-fJLnnsXiAjZwd3'; // index.json ุฅู ููุฌุฏ

  const FMS_SOURCES = [
    {code:'LOG-FMS-2025-005', title:'ุณุฌู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ'},
    {code:'PLN-FMS-2025-018', title:'ุฎุทุฉ ุงูุฃูู ุงููุงุฏู ูููุฑุงูู'},
    {code:'LOG-FMS-2025-014', title:'ุณุฌู ุฒูุงุฑุงุช ุงูุฏูุงุน ุงููุฏูู ูุงูุฌูุงุช ุงูุชูุธูููุฉ'},
    {code:'POL-FMS-2025-015', title:'ุณูุงุณุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุงูููุงุก ูุงูุชูููุฉ'},
    {code:'CHK-FMS-2025-003', title:'ูุงุฆูุฉ ุงูุชุญูู ุงูุฏูุฑูุฉ ููุณูุงูุฉ'},
    {code:'CHK-FMS-2025-009', title:'ุณุฌู ุฌููุงุช ูุฌูุฉ ุงูุณูุงูุฉ'},
    {code:'PLN-FMS-2025-012', title:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ูุงูููุงู'},
    {code:'SOP-FMS-2025-002', title:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู ุงูููุงุณูุฉ ููุฌููุงุช ููุญุต ุงูุฃูุธูุฉ'},
    {code:'FRM-FMS-2025-011', title:'ูููุฐุฌ ุชูููู ุงููุฎุงุทุฑ ุงูุจูุฆูุฉ ูุงููุงุฏูุฉ'},
    {code:'FRM-FMS-2025-017', title:'ูููุฐุฌ ูุชุงุจุนุฉ ุชูููุฐ ุงูุชูุตูุงุช'},
    {code:'FMS_Docs_2025_endorsed', title:'ูุฌููุนุฉ ูุซุงุฆู FMS 2025 ุงููุนุชูุฏุฉ'},
    {code:'LOG-FMS-2025-006', title:'ุณุฌู ุงูุญูุงุฏุซ ูุงูููุงุญุธุงุช'},
    {code:'REP-FMS-2025-013', title:'ุชูุฑูุฑ ุงูุญูุงุฏุซ ุงูุทุงุฑุฆุฉ'},
    {code:'PLN-FMS-2025-016', title:'ุฎุทุฉ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ'},
    {code:'POL-FMS-2025-001', title:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู'},
    {code:'REP-FMS-2025-008', title:'ุชูุฑูุฑ ูุญุต ุงูุทูุงูุงุช ูุฃูุธูุฉ ุงูุฅูุฐุงุฑ'},
    {code:'TRN-FMS-2025-010', title:'ุฎุทุฉ ุชุฏุฑูุจ ุงูุฃูู ูุงูุณูุงูุฉ'},
    {code:'DEC-FMS-2025-001', title:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุงูุณูุงูุฉ'},
    {code:'PLN-FMS-2025-007', title:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูููุงูุงุช'},
    {code:'PLN-FMS-2025-004', title:'ุฎุทุฉ ุงูุทูุงุฑุฆ ูุงูุฅุฎูุงุก'},
  ];

  // ===== ุฃุฏูุงุช ุนุงูุฉ ======
  const toPreviewById = (id) => `https://drive.google.com/file/d/${id}/preview`;
  const toFolderLink  = (id) => `https://drive.google.com/drive/folders/${id}?usp=sharing`;

  // ุงููุถุน ุงููููู
  document.getElementById('darkModeBtn').addEventListener('click',()=>document.documentElement.classList.toggle('dark'));

  // ุฅุธูุงุฑ ุงูุฃูุณุงู
  function showSection(sectionId){
    document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
    document.getElementById(sectionId).classList.add('active');
    document.querySelectorAll('.nav-link').forEach(link=>link.classList.remove('active-link'));
    const targetLink=document.querySelector(`.nav-link[href="#${sectionId}"]`); if(targetLink) targetLink.classList.add('active-link');
  }

  // ====== ูุณุงุญุฉ ุนูู FMS (ูููุฐุฌ ุงูุฌููุงุช) ======
  function switchFmsTab(tab){
    document.querySelectorAll('[data-fms-tab]').forEach(btn=>{
      btn.classList.remove('bg-[var(--brand)]','text-white'); btn.classList.add('bg-gray-100','hover:bg-gray-200');
      if(btn.getAttribute('data-fms-tab')===tab){ btn.classList.add('bg-[var(--brand)]','text-white'); btn.classList.remove('bg-gray-100','hover:bg-gray-200'); }
    });
    const c=document.getElementById('fmsTabContent'); c.innerHTML='';
    if(tab==='needs') renderNeeds(c);
    if(tab==='plans') renderList(c, FMS_PLANS, 'ุฎุทุฉ/ุจุฑูุงูุฌ');
    if(tab==='governance') renderList(c, FMS_GOV, 'ุณูุงุณุฉ/ุญูููุฉ');
    if(tab==='forms') renderList(c, FMS_FORMS, 'ูููุฐุฌ/ุณุฌู');
    if(tab==='kpis') renderKpis(c);
    if(tab==='rounds') renderRounds(c);
  }

  // ุจุงูู ุงูุงุญุชูุงุฌุงุช
  const FMS_NEEDS = [
    {key:'charter', label:'ููุซุงู ูุฌูุฉ ุงูุณูุงูุฉ ูุฅุฏุงุฑุฉ ุงููุฑุงูู (G01) ูุนุชูุฏ', required:true},
    {key:'plans8', label:'ุงุนุชูุงุฏ ูุชููุฑ ุงูุฎุทุท ุงูุซูุงููุฉ (P01โP08)', required:true},
    {key:'ppmpolicy', label:'ุณูุงุณุฉ PPM + ุฎุทุฉ ุณูููุฉ ููููุนุฉ (G04)', required:true},
    {key:'tours', label:'ุฌููุงุช ุณูุงูุฉ ุฑุจุน ุณูููุฉ + ุณุฌูุงุช F-01/F-08', required:true},
    {key:'civildef', label:'ุชุฑุฎูุต ุงูุฏูุงุน ุงููุฏูู ุณุงุฑู + ุณุฌู F-07', required:true},
    {key:'fire', label:'ุณุฌูุงุช ุฅูุฐุงุฑ/ุฅุทูุงุก/ุฅูุงุฑุฉ ุทูุงุฑุฆ (F-02/F-03/F-10)', required:true},
    {key:'waste', label:'ุณุฌู ุงูุชุฎูุต ูู ุงูููุงูุงุช ุงูุทุจูุฉ/ุงูุฎุทุฑุฉ (F-09)', required:true},
    {key:'medgas', label:'ุณูุงุณุฉ/ุณุฌู ุงูุบุงุฒุงุช ุงูุทุจูุฉ (ุฅู ูุฌุฏุช) (G11/F-06)', required:false},
    {key:'training', label:'ุชุนุฑูู ุงูููุธููู ุงูุฌุฏุฏ + ุฎุทุฉ ุชูุงุฑูู (G08/G09)', required:true},
    {key:'risk', label:'HVA ุณูููุฉ + FMEA ููุนูููุงุช ุงูุญุฑุฌุฉ (G07)', required:true},
    {key:'compliance', label:'ุณูุงุณุฉ ุงูุงูุชุซุงู ููููุงููู ูุงูุฃูุธูุฉ (G05)', required:true},
  ];
  function renderNeeds(container){
    const wrap=document.createElement('div'); wrap.className='grid grid-cols-1 md:grid-cols-2 gap-4';
    FMS_NEEDS.forEach(item=>{
      const card=document.createElement('div'); card.className='p-4 rounded border shadow-sm bg-gray-50';
      card.innerHTML = `
        <div class="flex items-start gap-3">
          <input type="checkbox" id="need_${item.key}" class="mt-1 h-5 w-5" ${item.required?'data-required="1"':''}>
          <div><label for="need_${item.key}" class="font-semibold">${item.label}</label>${item.required?'<div class="text-xs text-red-600 mt-1">ูุทููุจ</div>':''}</div>
        </div>`;
      wrap.appendChild(card);
    });
    const actions=document.createElement('div'); actions.className='flex items-center gap-2 mt-2';
    actions.innerHTML = `<button class="btn btn-primary" onclick="validateNeeds()">ุชุญููู ูู ุงูุงูุชูุงู</button>
                         <button class="btn btn-muted" onclick="window.print()">ุทุจุงุนุฉ</button>`;
    container.appendChild(wrap); container.appendChild(actions);
  }
  function validateNeeds(){
    const missing=[...document.querySelectorAll('input[data-required="1"]')].filter(cb=>!cb.checked);
    alert(missing.length===0?'ููุชุงุฒ โ โ ุฌููุน ุงููุชุทูุจุงุช ุงูุฅูุฒุงููุฉ ููุคุดูุฑ ุนูููุง.':('โ๏ธ ุนูุงุตุฑ ุฅูุฒุงููุฉ ุบูุฑ ููุชููุฉ: '+missing.length));
  }

  // ููุงุฆู ุงููุซุงุฆู ุงูุนุงูุฉ
  function renderList(container, items, kind){
    const list=document.createElement('div'); list.className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4';
    items.forEach(d=>{
      const card=document.createElement('div'); card.className='p-4 rounded border shadow-sm bg-white';
      const openBtn = d.url ? `<button class="px-3 py-1 text-sm btn btn-primary" onclick="openFmsDoc('${d.code||''}: ${d.name||''}', '${d.url}')">๐ ุนุฑุถ</button>`
                            : `<button class="px-3 py-1 text-sm btn btn-muted" disabled>โ</button>`;
      const openNew = d.url ? `<a class="px-3 py-1 text-sm btn btn-muted" href="${d.url}" target="_blank" rel="noopener">โ ูุชุญ</a>` : '';
      card.innerHTML = `
        <div class="flex items-center justify-between mb-2">
          <div class="font-bold text-[var(--brand)]">${d.code||''}</div>
          <span class="text-xs bg-gray-100 px-2 py-1 rounded">${kind}</span>
        </div>
        <div class="mb-3 font-medium">${d.name||''}</div>
        <div class="flex items-center gap-2">${openBtn}${openNew}</div>`;
      list.appendChild(card);
    });
    container.appendChild(list);
  }

  // KPIs
  function renderKpis(container){
    const box=document.createElement('div'); box.className='grid grid-cols-1 md:grid-cols-3 gap-4';
    box.innerHTML = `
      <div class="bg-white p-4 rounded border shadow"><div class="text-sm text-gray-500">ูุณุจุฉ ุฅูุฌุงุฒ ุงูุฌููุงุช</div><div class="text-2xl font-bold text-[var(--brand)]">85%</div></div>
      <div class="bg-white p-4 rounded border shadow"><div class="text-sm text-gray-500">ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (PPM)</div><div class="text-2xl font-bold text-[var(--brand2)]">92%</div></div>
      <div class="bg-white p-4 rounded border shadow"><div class="text-sm text-gray-500">ุงูุชุฏุฑูุจ ุงููููุฐ</div><div class="text-2xl font-bold text-[var(--brand)]">78%</div></div>`;
    container.appendChild(box);
  }

  // ===== ูููุฐุฌ ุงูุฌููุงุช (ูุฑุณู ุฅูู Google Sheets ุนุจุฑ Web App) =====
  function renderRounds(container){
    const wrap=document.createElement('div'); wrap.className='grid grid-cols-1 gap-4';
    wrap.innerHTML = `
      <div class="p-4 rounded border shadow-sm bg-white">
        <h3 class="font-bold text-lg mb-3 text-[var(--brand)]">๐ ุฅุฏุฎุงู ุฌููุฉ ุณูุงูุฉ</h3>
        <form id="roundForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="field">
            <label class="label">ุงุณู ุงููุฑุงูุจ</label>
            <select name="inspector" id="inspector" class="select" required></select>
          </div>
          <div class="field">
            <label class="label">ุงููููุน/ุงููุณู</label>
            <input name="area" id="area" class="input" placeholder="ูุซุงู: ุนูุงุฏุงุช ุงูุฃุณูุงู / ุงููุฎุชุจุฑ" required/>
          </div>
          <div class="field md:col-span-2">
            <label class="label">ุงููุตู/ุงูููุงุญุธุฉ</label>
            <textarea name="observation" id="observation" class="textarea" placeholder="ูุตู ุงูููุงุญุธุฉ ุจุฏูุฉ" required></textarea>
          </div>
          <div class="field">
            <label class="label">ุงูุฃููููุฉ</label>
            <select name="priority" id="priority" class="select" required>
              <option value="ุญุฑุฌุฉ">ุญุฑุฌุฉ (ุนุงููุฉ ุฌุฏูุง)</option>
              <option value="ุนุงููุฉ">ุนุงููุฉ</option>
              <option value="ูุชูุณุทุฉ" selected>ูุชูุณุทุฉ</option>
              <option value="ููุฎูุถุฉ">ููุฎูุถุฉ</option>
            </select>
          </div>
          <div class="field">
            <label class="label">ุงูุชุตููู</label>
            <select name="category" id="category" class="select">
              <option>ุณูุงูุฉ ุนุงูุฉ</option><option>ููุฑุจุงุก</option><option>ูููุงููู</option><option>ุบุงุฒุงุช ุทุจูุฉ</option>
              <option>ูุธุงูุฉ</option><option>ุฃูู</option><option>ููุงูุงุช</option><option>ุญุฑูู</option><option>ุฃุฎุฑู</option>
            </select>
          </div>
          <div class="field">
            <label class="label">ูู ุชุญุชุงุฌ ุชุฐูุฑุฉ ุตูุงูุฉุ</label>
            <select name="needMaintenance" id="needMaintenance" class="select">
              <option value="ูุนู">ูุนู</option><option value="ูุง" selected>ูุง</option>
            </select>
          </div>
          <div class="field">
            <label class="label">ุฑุงุจุท ูุฑูู (ุงุฎุชูุงุฑู)</label>
            <input name="attachment" id="attachment" class="input" placeholder="ุฑุงุจุท ุตูุฑุฉ Google Drive/ููู"/>
          </div>
          <div class="field">
            <label class="label">ุชุงุฑูุฎ ุงููุชุงุจุนุฉ (ุงุฎุชูุงุฑู)</label>
            <input type="date" name="followUp" id="followUp" class="input"/>
          </div>
          <div class="field">
            <label class="label">ุงูุญุงูุฉ</label>
            <select name="status" id="status" class="select">
              <option>ููุชูุญุฉ</option><option>ููุฏ ุงููุนุงูุฌุฉ</option><option>ููุฌุฒุฉ</option>
            </select>
          </div>
          <div class="md:col-span-2 flex items-center gap-2">
            <button class="btn btn-primary" type="submit">ุฅุฑุณุงู ุงูุณุฌู</button>
            <button class="btn btn-muted" type="button" id="refreshRounds">ุชุญุฏูุซ ุงูุณุฌู (ุขุฎุฑ ุงูุฅุฏุฎุงูุงุช)</button>
            <span id="roundMsg" class="text-sm"></span>
          </div>
        </form>
      </div>

      <div class="p-4 rounded border shadow-sm bg-white">
        <h3 class="font-bold text-lg mb-3 text-[var(--brand)]">๐ ุฃุญุฏุซ ุงูุฅุฏุฎุงูุงุช</h3>
        <div id="roundsTable" class="overflow-x-auto text-sm">โ</div>
      </div>`;
    container.appendChild(wrap);

    // ุชุนุจุฆุฉ ุฃุณูุงุก ุงููุฑุงูุจูู
    const sel=document.getElementById('inspector'); sel.innerHTML = INSPECTORS.map(n=>`<option>${n}</option>`).join('');

    // ุฅุฑุณุงู
    document.getElementById('roundForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      if(!FMS_API_URL || FMS_API_URL==='YOUR_APPS_SCRIPT_WEB_APP_URL'){
        alert('โ๏ธ ุฑุฌุงุกู ุถุน ุฑุงุจุท Web App ูู ุงููุชุบูุฑ FMS_API_URL ุฃุนูู ุงูุตูุญุฉ.'); return;
      }
      const data = new URLSearchParams({
        mode:'add',
        inspector: document.getElementById('inspector').value,
        area: document.getElementById('area').value,
        observation: document.getElementById('observation').value,
        priority: document.getElementById('priority').value,
        category: document.getElementById('category').value,
        needMaintenance: document.getElementById('needMaintenance').value,
        attachment: document.getElementById('attachment').value,
        followUp: document.getElementById('followUp').value,
        status: document.getElementById('status').value
      });

      const msg=document.getElementById('roundMsg'); msg.textContent='ุฌุงุฑู ุงูุฅุฑุณุงูโฆ';
      try{
        // ูุณุชุฎุฏู x-www-form-urlencoded ูุชุฌููุจ ูุดุงูู preflight CORS (ุทูุจ ุจุณูุท)
        const res = await fetch(FMS_API_URL, {
          method:'POST',
          headers:{ 'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8' },
          body:data.toString()
        });
        if(res.ok){ msg.textContent='โ ุชูู ุงูุฅุฑุณุงู ุจูุฌุงุญ.'; (e.target).reset(); }
        else { msg.textContent='โ๏ธ ูู ูุชู ุงูุฅุฑุณุงู (ุชุญูู ูู ุตูุงุญูุงุช ุงูููุจ ุขุจ).'; }
      }catch(err){ console.error(err); msg.textContent='โ๏ธ ุชุนุฐูุฑ ุงูุฅุฑุณุงู โ ุชุญูู ูู ุงูุฑุงุจุท/ุงูุตูุงุญูุงุช.'; }
    });

    // ุฌูุจ ุขุฎุฑ ุงูุฅุฏุฎุงูุงุช
    async function loadRounds(){
      if(!FMS_API_URL || FMS_API_URL==='YOUR_APPS_SCRIPT_WEB_APP_URL'){
        document.getElementById('roundsTable').textContent='ุถุน ุฑุงุจุท Web App ูู FMS_API_URL ูุนุฑุถ ุงูุณุฌู.'; return;
      }
      try{
        const url = FMS_API_URL + '?mode=list&last=30';
        const res = await fetch(url);
        const json = await res.json();
        const rows = json.rows || [];
        if(rows.length===0){ document.getElementById('roundsTable').textContent='ูุง ุชูุฌุฏ ุจูุงูุงุช ุจุนุฏ.'; return; }
        const headers = ['ุงูุชุงุฑูุฎ/ุงูููุช','ุงููุฑุงูุจ','ุงููููุน','ุงูุฃููููุฉ','ุงูุชุตููู','ุงููุตู','ุชุฐูุฑุฉ ุตูุงูุฉ','ุฑุงุจุท','ูุชุงุจุนุฉ','ุงูุญุงูุฉ'];
        const html = `
          <table class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-100">
              <tr>${headers.map(h=>`<th class="px-3 py-2 text-right border-b">${h}</th>`).join('')}</tr>
            </thead>
            <tbody>
              ${rows.map(r=>`
                <tr class="border-b hover:bg-gray-50">
                  <td class="px-3 py-2">${r.timestamp||''}</td>
                  <td class="px-3 py-2">${r.inspector||''}</td>
                  <td class="px-3 py-2">${r.area||''}</td>
                  <td class="px-3 py-2">${r.priority||''}</td>
                  <td class="px-3 py-2">${r.category||''}</td>
                  <td class="px-3 py-2">${r.observation||''}</td>
                  <td class="px-3 py-2">${r.needMaintenance||''}</td>
                  <td class="px-3 py-2">${r.attachment?`<a class="text-blue-600 underline" href="${r.attachment}" target="_blank">ูุชุญ</a>`:''}</td>
                  <td class="px-3 py-2">${r.followUp||''}</td>
                  <td class="px-3 py-2">${r.status||''}</td>
                </tr>`).join('')}
            </tbody>
          </table>`;
        document.getElementById('roundsTable').innerHTML = html;
      }catch(err){
        console.warn('CORS?', err);
        document.getElementById('roundsTable').innerHTML =
          '<div class="text-red-600">โ๏ธ ุชุนุฐูุฑ ุฌูุจ ุงูุณุฌู ูู ุงูููุจ ุขุจ (ูุฏ ุชููู ูููุฏ CORS). ุงูุฅุฑุณุงู ุณูุนููุ ููู ุนุฑุถ ุงูุณุฌู ุฏุงุฎู ุงูุจูุงุจุฉ ูุฏ ูุญุชุงุฌ ุถุจุท ุฅุนุฏุงุฏุงุช ุงููุดุฑ.</div>';
      }
    }
    document.getElementById('refreshRounds').addEventListener('click', loadRounds);
    setTimeout(loadRounds, 300);
  }

  // ===== ูุตุงุฏุฑ 2025: ุจูุงุก ุงููุงุฆูุฉ ูุงูุฑูุงุจุท =====
  async function buildSources(){
    const folderLink = toFolderLink(SOURCES_FOLDER_ID);
    document.getElementById('sourcesFolderLink').href = folderLink;
    document.getElementById('sourcesFolderLink').textContent = folderLink;

    // ุฌุฑูุจ ุชุญููู index.json (ูุฑููุน ูู "ุนุงู")
    let indexMap = {};
    try {
      const indexUrl = `https://drive.google.com/uc?export=download&id=${INDEX_JSON_ID}`;
      const res = await fetch(indexUrl);
      if (res.ok) {
        const data = await res.json();
        // ูุชููุน ุดููุงู ูุซู: { "LOG-FMS-2025-005": "FILE_ID", ... }
        indexMap = data || {};
      }
    } catch(e) { console.warn('index.json not reachable or not JSON', e); }

    const list = document.getElementById('sourcesList');
    list.innerHTML = '';
    FMS_SOURCES.forEach(src=>{
      const id = indexMap[src.code]; // ูุฏ ุชููู ุบูุฑ ููุฌูุฏุฉ
      const previewUrl = id ? toPreviewById(id) : null;

      const card=document.createElement('div'); card.className='p-4 rounded border shadow-sm bg-white';
      card.innerHTML = `
        <div class="flex items-center justify-between mb-2">
          <div class="font-bold text-[var(--brand)]">${src.code}</div>
          <span class="text-xs bg-gray-100 px-2 py-1 rounded">ูุตุฏุฑ</span>
        </div>
        <div class="mb-3 font-medium">${src.title}</div>
        <div class="flex items-center gap-2">
          ${ previewUrl
              ? `<button class="px-3 py-1 text-sm btn btn-primary" onclick="openFmsDoc('${src.code}: ${src.title}', '${previewUrl}')">๐ ุนุฑุถ</button>
                 <a class="px-3 py-1 text-sm btn btn-muted" href="${previewUrl}" target="_blank" rel="noopener">โ ูุชุญ</a>`
              : `<a class="px-3 py-1 text-sm btn btn-primary" href="${folderLink}" target="_blank" rel="noopener">๐ ูุชุญ ุงููุฌูุฏ</a>
                 <span class="text-xs text-gray-500">ูู ููุญุฏููุฏ ุงููุนุฑูู ูู index.json</span>`
          }
        </div>`;
      list.appendChild(card);
    });
  }

  // Modal
  function openFmsDoc(title,url){
    document.getElementById('fmsModalTitle').textContent=title;
    document.getElementById('fmsModalFrame').src=url||'about:blank';
    document.getElementById('fmsModalOpenNew').href=url||'#';
    document.getElementById('fmsModal').classList.remove('hidden'); document.getElementById('fmsModal').classList.add('flex');
  }
  function closeFmsModal(){
    document.getElementById('fmsModal').classList.add('hidden'); document.getElementById('fmsModal').classList.remove('flex');
    document.getElementById('fmsModalFrame').src='about:blank';
  }

  // ุงูุชุญ ุชุจููุจ ยซุงูุงุญุชูุงุฌุงุชยป ุงูุชุฑุงุถูุงู ุนูุฏ ุฏุฎูู ูุณุงุญุฉ ุงูุนูู
  document.addEventListener('DOMContentLoaded', ()=>{
    const activeSection=document.querySelector('.content-section.active');
    if(activeSection && activeSection.id==='fms-workspace'){ switchFmsTab('needs'); }
    document.querySelectorAll('.nav-link').forEach(link=>{
      link.addEventListener('click',(e)=>{
        const sectionId=e.target.getAttribute('href').substring(1);
        if(sectionId==='fms-workspace'){ setTimeout(()=>switchFmsTab('needs'),50); }
        if(sectionId==='sources2025'){ setTimeout(buildSources, 50); }
      });
    });
    // ุนููู ุฑุงุจุท ุงููุฌูุฏ ุฃุณูู ูุณู ุงููุตุงุฏุฑ
    const folderLink = toFolderLink(SOURCES_FOLDER_ID);
    const a = document.getElementById('sourcesFolderLink'); a.href = folderLink; a.textContent = folderLink;

    // ุดุนุงุฑ ูุงุฆู ุฎููู
    const wm = document.getElementById('orgLogoWater');
    const mainLogo = document.getElementById('orgLogo');
    if (mainLogo && wm && mainLogo.src) { wm.src = mainLogo.src; }
  });
  </script>

  <!-- FMS Modal -->
  <div id="fmsModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white w-[95vw] max-w-4xl rounded-lg shadow-xl overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b">
        <h3 id="fmsModalTitle" class="font-bold text-lg">ุนุฑุถ ุงููุซููุฉ</h3>
        <button onclick="closeFmsModal()" class="text-gray-600 hover:text-gray-900">โ</button>
      </div>
      <div class="p-0"><iframe id="fmsModalFrame" class="w-full h-[70vh]" src="about:blank" allow="autoplay"></iframe></div>
      <div class="flex items-center justify-between px-4 py-3 border-t bg-gray-50">
        <a id="fmsModalOpenNew" href="#" target="_blank" class="text-[var(--brand)] underline">ูุชุญ ูู ุชุจููุจ ุฌุฏูุฏ</a>
        <button onclick="closeFmsModal()" class="px-3 py-2 btn btn-muted">ุฅุบูุงู</button>
      </div>
    </div>
  </div>
</body>
</html>
