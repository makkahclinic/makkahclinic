<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ โ ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ (ุงูุฅุตุฏุงุฑ 2025)</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --maroon: #7B1E24;
    --burgundy: #C55A44;
    --gold: #E9C46A;
    --brand1: #7B1E24;
    --brand2: #C55A44;
  }
  
  body {
    font-family: 'Tajawal', sans-serif;
    background: linear-gradient(180deg, #fff, #faf5f4 45%, #fff);
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  header {
    position: sticky;
    top: 0;
    z-index: 50;
    background: #fff;
    box-shadow: 0 2px 10px rgba(0,0,0,.08);
  }
  
  .container {
    max-width: 1280px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .hero {
    background: linear-gradient(180deg, var(--maroon), var(--burgundy));
    color: #fff;
    text-align: center;
  }
  
  .hero-inner {
    padding: 56px 16px 72px;
  }
  
  .hero-logo-wrap {
    position: relative;
    display: inline-block;
  }
  
  .hero-logo-wrap::before {
    content: "";
    position: absolute;
    inset: -28px;
    border-radius: 9999px;
    background: radial-gradient(closest-side, rgba(233,196,106,.22), transparent 70%);
    filter: blur(1px);
  }
  
  .hero img {
    position: relative;
    z-index: 1;
    width: 150px;
    height: auto;
    filter: drop-shadow(0 0 24px var(--gold));
    animation: glow 3s ease-in-out infinite alternate;
  }
  
  @keyframes glow {
    from { filter: drop-shadow(0 0 10px var(--gold)); }
    to { filter: drop-shadow(0 0 32px var(--gold)); }
  }
  
  .sidebar {
    width: 270px;
    background: linear-gradient(180deg, var(--maroon), var(--burgundy));
    color: #fff;
    border-radius: 14px;
    padding: 1rem;
  }
  
  .nav-link {
    display: block;
    padding: .55rem .8rem;
    border-radius: .6rem;
    transition: .2s;
    color: white;
    text-decoration: none;
    margin-bottom: 0.25rem;
  }
  
  .nav-link:hover {
    background-color: rgba(255,255,255,.16);
    transform: translateX(-3px);
  }
  
  .nav-link.active {
    background-color: rgba(255,255,255,.28);
    font-weight: 700;
  }
  
  .card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,.06);
  }
  
  .hidden {
    display: none !important;
  }
  
  #scrollTopBtn {
    position: fixed;
    left: 18px;
    bottom: 18px;
    display: none;
    width: 48px;
    height: 48px;
    border-radius: 9999px;
    background: var(--gold);
    color: var(--maroon);
    box-shadow: 0 8px 18px rgba(123,30,36,.35);
    font-size: 20px;
    border: none;
    cursor: pointer;
    place-items: center;
  }
  
  #scrollTopBtn:hover {
    transform: scale(1.08);
  }
  
  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.55);
    display: none;
    align-items: center;
    justify-content: center;
    padding: 16px;
    z-index: 60;
  }
  
  .modal.open {
    display: flex;
  }
  
  .modal .panel {
    background: #fff;
    border-radius: 14px;
    overflow: hidden;
    width: min(1200px, 96vw);
    height: 80vh;
  }
  
  /* --- FMS tabs & cards --- */
  .tabs {
    display: flex;
    gap: 8px;
    overflow: auto;
    padding-bottom: 8px;
  }
  
  .tab {
    white-space: nowrap;
    border: 1px solid #e5e7eb;
    border-radius: 9999px;
    background: #fff;
    color: var(--maroon);
    padding: .4rem .9rem;
    cursor: pointer;
  }
  
  .tab.active {
    background: var(--maroon);
    color: #fff;
    border-color: transparent;
  }
  
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
    gap: 14px;
  }
  
  .doc-card {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 14px;
    border: 1px solid #eee;
    border-radius: 12px;
    background: #fff;
    height: 100%;
  }
  
  .doc-code {
    color: var(--maroon);
    font-weight: 700;
  }
  
  .content-section {
    display: none;
  }
  
  .content-section.active {
    display: block;
  }
  
  .gold-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--maroon);
    text-decoration: none;
    padding: 0.5rem 1rem;
    border: 1px solid var(--gold);
    border-radius: 8px;
    background: rgba(233, 196, 106, 0.1);
    transition: all 0.3s;
  }
  
  .gold-link:hover {
    background: var(--gold);
    color: var(--maroon);
  }
  
  .table {
    width: 100%;
    border-collapse: collapse;
  }
  
  .table th, .table td {
    padding: 0.75rem;
    border: 1px solid #e5e7eb;
    text-align: right;
  }
  
  .table th {
    background-color: #f9fafb;
    font-weight: 700;
  }
  
  .chip {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    background: #f3f4f6;
    border-radius: 9999px;
    font-size: 0.75rem;
    margin-right: 0.5rem;
  }
  
  .grid-cards {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }
  
  .box {
    background: white;
    border-radius: 14px;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
  }
  
  .kpi-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  
  .kpi-table th, .kpi-table td {
    padding: 0.5rem;
    border: 1px solid #e5e7eb;
    text-align: center;
  }
  
  .kpi-table th {
    background-color: var(--maroon);
    color: white;
    font-weight: 600;
  }
  
  .kpi-table tr:nth-child(even) {
    background-color: #f9fafb;
  }
  
  .good {
    background-color: #dcfce7 !important;
    color: #166534;
  }
  
  .warning {
    background-color: #fef9c3 !important;
    color: #854d0e;
  }
  
  .critical {
    background-color: #fee2e2 !important;
    color: #991b1b;
  }
</style>
</head>
<body class="min-h-screen">

<!-- Header -->
<header>
  <div class="container flex items-center justify-between px-4 py-3">
    <div class="flex items-center gap-3">
      <img id="logoSmall" class="h-12 w-auto rounded bg-white p-1 shadow" alt="ุดุนุงุฑ ุงููุฌูุน" src="logo.png">
      <button id="btnSetLogo" class="text-[var(--maroon)] text-sm underline underline-offset-4 hover:text-[var(--burgundy)]">
        ุชุบููุฑ/ุชุญุฏูุซ ุงูุดุนุงุฑ
      </button>
      <input id="logoPicker" type="file" accept="image/*" class="hidden">
    </div>
    <div class="text-center">
      <div class="text-lg md:text-xl font-bold text-gray-800">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ</div>
      <div class="text-xs md:text-sm text-gray-500">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ โ ุงูุฅุตุฏุงุฑ 2025</div>
    </div>
    <div class="flex items-center gap-2">
      <a href="https://makkahclinic.com.sa" target="_blank" class="px-3 py-2 rounded text-[var(--maroon)] hover:bg-gray-100">๐ฅ ูููุน ุงููุฌูุน</a>
      <button onclick="window.print()" class="bg-[var(--maroon)] hover:bg-[var(--burgundy)] text-white px-4 py-2 rounded"><i class="fas fa-print ml-2"></i> ุทุจุงุนุฉ / PDF</button>
    </div>
  </div>
</header>

<!-- Hero -->
<section class="hero">
  <div class="hero-inner container">
    <div class="hero-logo-wrap">
      <img id="logoHero" alt="ุดุนุงุฑ ูุฌูุน ููุฉ ุงูุทุจู" src="logo.png">
    </div>
    <h1 class="text-3xl md:text-4xl font-bold mt-4">ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ</h1>
    <p class="text-base md:text-lg opacity-95 mt-1">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ โ ุงูุฅุตุฏุงุฑ 2025</p>
    <div class="text-[13px] md:text-[14px] mt-2" style="color:#f8e8cc">ุจูุงุจุฉ ุฏุงุฎููุฉ ูุฅุฏุงุฑุฉ ุงููุซุงุฆู ูุงููุนุงููุฑ โ ูุง ุชุชุถูู ุฃู ุงุฏุนุงุก ุจุงูุญุตูู ุนูู ุงูุงุนุชูุงุฏ.</div>
  </div>
</section>

<!-- Layout -->
<div class="container px-4 py-6 flex gap-6">
  <!-- Sidebar -->
  <aside class="sidebar h-max sticky top-[92px]">
    <div class="font-bold mb-2 text-lg">๐ ุฃูุณุงู ุงูุจูุงุจุฉ</div>
    <a class="nav-link active" href="#home" onclick="navTo('home')">๐ ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a>
    <a class="nav-link" href="#manuals" onclick="navTo('manuals')">๐ ุงูุฏููู ุงูุฅุฏุงุฑู</a>
    <a class="nav-link" href="#leadership" onclick="navTo('leadership')">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ (LD)</a>
    <a class="nav-link" href="#committees" onclick="navTo('committees')">๐ฅ ุงููุฌุงู ุงูุฑุณููุฉ</a>
    <a class="nav-link" href="#rm" onclick="navTo('rm')">โ๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</a>
    <a class="nav-link" href="#fms" onclick="navTo('fms')">๐๏ธ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</a>
    <a class="nav-link" href="#psc" onclick="navTo('psc')">โค๏ธ ุณูุงูุฉ ุงููุฑุถู (PSC)</a>
    <a class="nav-link" href="#ipc" onclick="navTo('ipc')">๐งผ ููุงูุญุฉ ุงูุนุฏูู (IPC)</a>
    <a class="nav-link" href="#qi" onclick="navTo('qi')">๐ ุงูุฌูุฏุฉ ูุงูุชุญุณูู (QI)</a>
    <a class="nav-link" href="#eoc" onclick="navTo('eoc')">๐จ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</a>
    <a class="nav-link" target="_blank" href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922#gid=597653922">๐๏ธ ุงูุณุฌู ุงูุฅููุชุฑููู (Google Sheet)</a>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 space-y-8">
    <!-- ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ -->
    <section id="home" class="content-section active">
      <div class="bg-white rounded-xl shadow p-6">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)] mb-3">๐ ุงูุฑุณุงูุฉ (Mission Statement)</h2>
        <p class="text-gray-800 leading-8 text-lg">
          "ููุชุฒู ุจุชูุฏูู ุฑุนุงูุฉ ุตุญูุฉ ุฃูููุฉ ูุชุฎุตุตูุฉ ุขููุฉ ููุชูุญูุฑุฉ ุญูู ุงููุฑูุถ ูู ููุทูุฉ ููุฉ ุงูููุฑูุฉุ
          ูู ุฎูุงู ูุฑูู ุนูู ูุคูู ููุฑุงูู ูุชุทูุฑุฉุ ูุชุนุฒูุฒ ุตุญุฉ ุงููุฌุชูุน ูุงููุตูู ูุฃุนูู ูุณุชููุงุช ุงูุฌูุฏุฉ."
        </p>
        <div class="mt-4">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1YUE5GKeQmY3rrHk1j3dX3ztPAwX_3GdNjG9fB_fjPsQ/edit?usp=drive_link" title="ูุซููุฉ ุงูุฑุณุงูุฉุ ุงูุฑุคูุฉุ ูุงูููู ุงูููุนุชูุฏุฉ (LD.4.2)">
            <i class="fas fa-file-word"></i> ูุซููุฉ ุงูุฑุณุงูุฉุ ุงูุฑุคูุฉุ ูุงูููู ุงูููุนุชูุฏุฉ (LD.4.2)
          </a>
        </div>
      </div>
    </section>

    <!-- ุงูุฏููู ุงูุฅุฏุงุฑู -->
    <section id="manuals" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-5">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุงูุฏููู ุงูุฅุฏุงุฑู ูุงูุชูุธููู</h2>
        <div class="space-y-3">
          <div class="font-semibold">ุงูุฏููู ุงูุชูุธููู ุงููุฎุชุตุฑ:</div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
            <i class="fas fa-file"></i> ุงูุฏููู ุงูุชูุธููู ุงููุฎุชุตุฑ (ูุณุชูุฏ Google)
          </a>
        </div>
        <div class="space-y-3">
          <div class="font-semibold">ุงูุฏููู ุงูุฅุฏุงุฑู ุงูุชูุธููู ุงูุชูุตููู:</div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1hswi3r_fTUKQoVIj3lG9kEIQpFF7Ol7OLCXe3A45-Ao/edit?tab=t.0#heading=h.93zeqi5ae78k">
            <i class="fas fa-file-lines"></i> ุงูุฏููู ุงูุฅุฏุงุฑู ุงูุชูุธููู ุงูุชูุตููู (ูุณุชูุฏ Google)
          </a>
        </div>
      </div>
    </section>

    <!-- ุงูููุงุฏุฉ ูุงูุญูููุฉ -->
    <section id="leadership" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐๏ธ ุงูููุงุฏุฉ ูุงูุญูููุฉ (LD)</h2>
        <!-- ุจุทุงูุฉ ุงููุงุฆุฏ -->
        <div class="border rounded-xl p-5 flex items-center gap-4 bg-gradient-to-br from-[#fff] to-[#fff9f6]">
          <div class="h-14 w-14 rounded-full bg-gradient-to-br from-[var(--brand1)] to-[var(--brand2)] grid place-items-center text-white text-xl shadow">
            <i class="fas fa-user-tie"></i>
          </div>
          <div class="flex-1">
            <div class="text-lg font-extrabold text-gray-900">ุงููุงุฆุฏ/ุงููุฏูุฑ ุงูุนุงู: ุฏ. ุญุณูู ุจู ูุญูุฏ ุญุณู ุดูุฎ ุจุงุจุตูู</div>
            <div class="text-gray-600">ูุชุจุน ุฅุฏุงุฑููุง ููุฌูุณ ุงูุฅุฏุงุฑุฉ/ุงููุงูู ููุดุฑู ุนูู ุงูุฅุฏุงุฑุฉ ุงูุทุจูุฉุ ุงูุชูุฑูุถุ ุงูุฃูุณุงู ุงูุณุฑูุฑูุฉ ูุงูุฏุงุนูุฉ.</div>
          </div>
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1sZC9bpoqlOgJDN-akgPt5wYrpGC5bvdo-2VL7ZIKCvM/edit?tab=t.0" title="ูุฑุงุฑ ุงูุชุนููู">
            <i class="fas fa-file-signature"></i> ูุฑุงุฑ ุงูุชุนููู (LD)
          </a>
        </div>
        <!-- ุงูุฅุฏุงุฑุงุช ุงูุชูููุฐูุฉ -->
        <div>
          <h3 class="text-xl font-extrabold text-[var(--brand1)] mb-2">ุงูุฅุฏุงุฑุงุช ุงูุชูููุฐูุฉ (ุญุณุจ ุงูุนุฑุถ ุงููุนุชูุฏ)</h3>
          <div class="overflow-auto">
            <table class="table text-right">
              <thead>
                <tr>
                  <th>ุงููุณู</th>
                  <th>ุงููุฏูุฑ</th>
                  <th>ุงูููุงู ุงูุฃุณุงุณูุฉ</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงูุฅุฏุงุฑูุฉ</td>
                  <td>ุฃ. ุจูุงู ูุชู</td>
                  <td>ุงูุชุดุบูู ุงูููููุ ุงูููุงุฑุฏ ุงูุจุดุฑูุฉุ ุงูุชุฏุฑูุจุ ุงูุงุณุชูุจุงู ูุงูููุงุนูุฏ.</td>
                </tr>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงูุทุจูุฉ</td>
                  <td>ุฏ. ูุนุงุฐ ุงูุจููุด <span class="chip">ูุงุฆุจ: ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ</span></td>
                  <td>ุงูุฅุดุฑุงู ุนูู ุงูุนูุงุฏุงุช ูุงูุฎุฏูุงุช ุงูุณุฑูุฑูุฉ ูุฌูุฏุชูุง.</td>
                </tr>
                <tr>
                  <td>ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ ูุงูุชุฃููู</td>
                  <td>ุฃ. ุตุงุจุฑ ุนุจุฏู</td>
                  <td>ุงูุญุณุงุจุงุชุ ุงููุทุงูุจุงุชุ ุฅุฏุงุฑุฉ ุฏูุฑุฉ ุงูุฅูุฑุงุฏุ ุงูุชูุงุฑูุฑ ุงููุงููุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุตูุงูุฉ ูุงููุฑุงูู</td>
                  <td>ุฃ. ุนุฏูุงู ุงูุฑูุงุนู</td>
                  <td>ุงูุตูุงูุฉ ุงูููุงุฆูุฉุ ุงูุณูุงูุฉ ุงููุฑุงูููุฉุ ุงูุทูุงุฑุฆุ ุงููุดุชุฑูุงุช ุบูุฑ ุงูุทุจูุฉุ ุงููุธุงูุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุตูุฏููุฉ</td>
                  <td>ุฃ. ุนุจุฏุงููู ุญููุฏู</td>
                  <td>ุงูุตุฑู ุงูุฏูุงุฆู ุงูุขููุ ุถุจุท ุงูุฃุฏููุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉุ ุณูุณูุฉ ุงูุชุจุฑูุฏุ ุงููุฎุฒูู.</td>
                </tr>
                <tr>
                  <td>ุงููุฎุชุจุฑ</td>
                  <td>ุฃ. ููุซู ุงูุฌุนูู</td>
                  <td>ุถุจุท ุงูุฌูุฏุฉ ุงููุฎุจุฑูุฉุ ุณูุงูุฉ ุงูุนููุงุชุ ุงูุณูุงูุฉ ุงูุญูููุฉ.</td>
                </tr>
                <tr>
                  <td>ุงูุฃุดุนุฉ</td>
                  <td>ุฃ. ุจูุงู ูุชู</td>
                  <td>ุงูุฅุดุฑุงู ุงูููู ูุงูุฅุดุนุงุนู ููู ูุชุทูุจุงุช NRRC.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <!-- ูุฑุงุฑ ุชุนููู ุงููุงุฏุฉ -->
        <div class="pt-2">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1LeyR6WnpUVth3hfr8UX2i5QKIHegA6RvKpkgEhfamA4/edit?usp=drive_link">
            <i class="fas fa-download"></i> ูุฑุงุฑ ุชุนููู ุงููุงุฏุฉ โ ูุณุฎุฉ ููุทุจุงุนุฉ/ุงูุชูุฒูู
          </a>
        </div>
      </div>
    </section>

    <!-- ุงููุฌุงู ุงูุฑุณููุฉ -->
    <section id="committees" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-5">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ฅ ุงููุฌุงู ุงูุฑุณููุฉ (ุญุณุจ ุณุจุงูู)</h2>
        <div class="overflow-auto">
          <table class="table text-right">
            <thead>
              <tr>
                <th>ุงูุฑูุฒ</th>
                <th>ุงุณู ุงููุฌูุฉ</th>
                <th>ุงูุฑุฆูุณ</th>
                <th>ุงูููุณู/ุงูุณูุฑุชูุฑ + ุงูุฃุนุถุงุก</th>
                <th>ุชูุฑุงุฑ ุงูุงุฌุชูุงุนุงุช</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><span class="chip">RM</span></td>
                <td>ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ</td>
                <td>ุฏ. ุญุณูู ุจุงุจุตูู</td>
                <td>ุงูููุณู/ุงูุณูุฑุชูุฑ: ุฃ. ุนุฏูุงู ุงูุฑูุงุนู โ ุงูุฃุนุถุงุก: ุจูุงูุ ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏ</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">FMS</span></td>
                <td>ูุฌูุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู</td>
                <td>ุฃ. ุตุงุจุฑ ุนุจุฏู</td>
                <td>ููุณู ุงูุชุฏุฑูุจ: ุฃ. ุจูุงู ูุชู โ ุงูุฃุนุถุงุก: ุนุฏูุงู ุงูุฑูุงุนูุ ุฎุงูุฏ ุงูุฎุทูุจุ ููุฏูุจ ูู ุงูุฃูู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">PSC</span></td>
                <td>ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู</td>
                <td>ุฏ. ูุนุงุฐ ุงูุจููุด</td>
                <td>ูุงุฆุจ ุงูุฑุฆูุณ: ุฏ. ุฎุงูุฏ ุงูุฎุทูุจ โ ุงูุฃุนุถุงุก: ุฏ. ุญุณููุ ููุซูุ ุจูุงู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">IPC</span></td>
                <td>ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู</td>
                <td>ุฏ. ูุฌุฏู ุนุณูุฑ</td>
                <td>ุงูุฃุนุถุงุก: ุฎุงูุฏุ ุงูุชูุฑูุถุ ุงููุฎุชุจุฑุ ุงูุชุนููู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุดูุฑููุง</td>
              </tr>
              <tr>
                <td><span class="chip">QI</span></td>
                <td>ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ</td>
                <td>ุฏ. ุญุณูู ุจุงุจุตูู</td>
                <td>ุงูุฃุนุถุงุก: ููุซููู ูู ุงูุฃูุณุงู โ ุงูุณูุฑุชูุฑ: ุนุฏูุงู</td>
                <td>ุฑุจุน ุณููู</td>
              </tr>
              <tr>
                <td><span class="chip">EOC</span></td>
                <td>ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ</td>
                <td>ุฃ. ุจูุงู ูุชู</td>
                <td>ุงูุฃุนุถุงุก: ุตุงุจุฑุ ูุนุงุฐุ ุฎุงูุฏุ ุงูุฃููุ ุงูุชูุฑูุถ</td>
                <td>ูุตู ุณููู</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="pt-2">
          <a class="gold-link" target="_blank" href="https://docs.google.com/document/d/1jGkTVk6WJeWvCnMw62NXZJ_qj9UL3fychiKmJCpR-ZE/edit?tab=t.0">
            <i class="fas fa-file"></i> ุชูุงุตูู ุงููุฌุงู โ ูุณุฎุฉ ูู ุงููุณุชูุฏ (Google Doc)
          </a>
        </div>
      </div>
    </section>

    <!-- ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM) -->
    <section id="rm" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">โ๏ธ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (RM)</h2>
          <a href="https://www.m2020m.org/report.html" target="_blank" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
            <i class="fas fa-bullhorn ml-2"></i> ุงูุฅุจูุงุบ ุงูุฅููุชุฑููู ููุดูุงูู/ุงูุญูุงุฏุซ
          </a>
        </div>
        <!-- ููุชุจุฉ RM ุงูุฃุณุงุณูุฉ -->
        <div class="border rounded-xl p-4">
          <h3 class="font-extrabold text-[var(--brand1)] mb-3">๐ ููุชุจุฉ ุงูุฃุฏูุฉ ุงูุฃุณุงุณูุฉ</h3>
          <div id="rmLib"></div>
        </div>
        <!-- ุงูุชูุนูุฉ ูุงูุชุฏุฑูุจ -->
        <div class="border rounded-xl p-4">
          <h3 class="font-extrabold text-[var(--brand1)] mb-2">๐ข ุงูุชูุนูุฉ ูุงูุชุฏุฑูุจ โ ุชุณุฌูู ุญุถูุฑ ูุชุฏุฑุจ</h3>
          <form id="trainForm" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-semibold mb-1">ุงุณู ุงููุชุฏุฑุจ *</label>
              <input name="trainee_name" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุงุณู ุงูุซูุงุซู">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ููุถูุน ุงูุชุฏุฑูุจ *</label>
              <input name="training_topic" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: ุณูุงุณุฉ ุงูุฅุจูุงุบ ุนู ุงูุญูุงุฏุซ">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ุชุงุฑูุฎ ุงูุชุฏุฑูุจ *</label>
              <input type="date" name="training_date" required class="w-full border rounded-lg px-3 py-2">
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">ููุงู ุงูุชุฏุฑูุจ *</label>
              <input name="training_place" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุงุนุฉ ุงูุงุฌุชูุงุนุงุช / ุนูุงุฏุฉ ...">
            </div>
            <div class="sm:col-span-2 flex items-center gap-3 pt-2">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุญุถูุฑ</button>
              <span id="trainMsg" class="text-sm"></span>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS) -->
    <section id="fms" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐๏ธ ุงูุณูุงูุฉ ูุงููุฑุงูู (FMS)</h2>
        <!-- ุชุจููุจุงุช -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-fms-tab="library" onclick="switchFmsTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-fms-tab="rounds" onclick="switchFmsTab('rounds')">๐ ุชุณุฌูู ุฌููุฉ ุณูุงูุฉ</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-fms-tab="needs" onclick="switchFmsTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู</button>
        </div>
        <div id="fmsTabContent"></div>
      </div>
    </section>

    <!-- ุณูุงูุฉ ุงููุฑุถู (PSC) - ุงููุณู ุงููุญุฏุซ ุจุงููุงูู -->
    <section id="psc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">โค๏ธ ุณูุงูุฉ ุงููุฑุถู (PSC)</h2>
          <div class="flex gap-2">
            <a href="https://www.m2020m.org/report.html" target="_blank" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)] transition">
              <i class="fas fa-bullhorn ml-2"></i> ุงูุฅุจูุงุบ ุนู ุญุงุฏุซ
            </a>
          </div>
        </div>

        <!-- ุชุจููุจุงุช PSC -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-psc-tab="library" onclick="switchPscTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="indicators" onclick="switchPscTab('indicators')">๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="reporting" onclick="switchPscTab('reporting')">๐ ููุงุฐุฌ ุงูุฅุจูุงุบ</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-psc-tab="needs" onclick="switchPscTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู</button>
        </div>

        <!-- ูุญุชูู ุชุจููุจุงุช PSC -->
        <div id="pscTabContent"></div>
      </div>
    </section>

    <!-- ุจููุฉ ุงููุฌุงู -->
    <!-- ููุงูุญุฉ ุงูุนุฏูู (IPC) - ูุณู ูุญุฏุซ ุจุงููุงูู ูุน ุญูุธ ูุญูู -->
    <section id="ipc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐งผ ููุงูุญุฉ ุงูุนุฏูู (IPC)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md border" onclick="ipcShowSecurity()">๐ ุฅุนุฏุงุฏ ุงูุฃูุงู (ุงุฎุชูุงุฑู)</button>
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="ipcExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช IPC (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="ipcImportInput" type="file" accept="application/json" class="hidden" onchange="ipcImportAll(this.files[0])">
            </label>
          </div>
        </div>

        <!-- ุชุจููุจุงุช -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-ipc-tab="library" onclick="switchIpcTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-ipc-tab="surveillance" onclick="switchIpcTab('surveillance')">๐ ุงููุฑุงูุจุฉ ูุงููุคุดุฑุงุช</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-ipc-tab="forms" onclick="switchIpcTab('forms')">๐ ููุงุฐุฌ ุงูุฅุฏุฎุงู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-ipc-tab="needs" onclick="switchIpcTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู (IPC)</button>
        </div>
        <div id="ipcTabContent"></div>
      </div>
    </section>

      <!-- ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI) - ูุณู ูุญุฏุซ ุจุงููุงูู -->
    <section id="qi" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="qiExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช QI (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="qiImportInput" type="file" accept="application/json" class="hidden" onchange="qiImportAll(this.files[0])">
            </label>
          </div>
        </div>

        <!-- ุชุจููุจุงุช QI -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-qi-tab="library" onclick="switchQiTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-qi-tab="dashboard" onclick="switchQiTab('dashboard')">๐ ููุญุฉ ุงููุคุดุฑุงุช</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-qi-tab="projects" onclick="switchQiTab('projects')">๐ ูุดุงุฑูุน ุงูุชุญุณูู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-qi-tab="needs" onclick="switchQiTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู (QI)</button>
        </div>
        <div id="qiTabContent"></div>
      </div>
    </section>
  </main>
</div>
    <!-- ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC) - ูุณู ูุญุฏุซ ุจุงููุงูู -->
    <section id="eoc" class="content-section">
      <div class="bg-white rounded-xl shadow p-6 space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-2xl font-extrabold text-[var(--brand1)]">๐จ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</h2>
          <div class="flex items-center gap-2 text-sm">
            <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" onclick="eocExportAll()">โฌ๏ธ ุชุตุฏูุฑ ูู ุจูุงูุงุช EOC (JSON)</button>
            <label class="px-3 py-1.5 rounded-md border cursor-pointer">
              โฌ๏ธ ุงุณุชูุฑุงุฏ
              <input id="eocImportInput" type="file" accept="application/json" class="hidden" onchange="eocImportAll(this.files[0])">
            </label>
          </div>
        </div>

        <!-- ุชุจููุจุงุช EOC -->
        <div class="flex flex-wrap gap-2 border-b pb-3">
          <button class="px-3 py-1.5 rounded-md bg-[var(--brand1)] text-white" data-eoc-tab="library" onclick="switchEocTab('library')">๐ ููุชุจุฉ ุงููุซุงุฆู</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-eoc-tab="exercises" onclick="switchEocTab('exercises')">๐โโ๏ธ ุงูุชูุงุฑูู ูุงูุฅุฎูุงุกุงุช</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-eoc-tab="readiness" onclick="switchEocTab('readiness')">๐ก๏ธ ุชูููู ุงูุฌุงูุฒูุฉ</button>
          <button class="px-3 py-1.5 rounded-md bg-gray-100 hover:bg-gray-200" data-eoc-tab="needs" onclick="switchEocTab('needs')">โ ูุชุทูุจุงุช ุณุจุงูู (EOC)</button>
        </div>
        <div id="eocTabContent"></div>
      </div>
    </section>
<!-- Scroll to top -->
<button id="scrollTopBtn" title="ุฅูู ุงูุฃุนูู" onclick="window.scrollTo({top:0,behavior:'smooth'})">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Document Modal -->
<div id="docModal" class="modal" role="dialog" aria-modal="true">
  <div class="panel">
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between px-4 py-3 border-b bg-gray-50">
        <div class="font-bold text-[var(--brand1)]" id="docTitle">ุนุฑุถ ุงููุซููุฉ</div>
        <button class="text-2xl" onclick="closeDocModal()">&times;</button>
      </div>
      <iframe id="docFrame" class="w-full flex-1 border-0" src="about:blank" allowfullscreen></iframe>
    </div>
  </div>
</div>

<script>
  // ====== ุงูุฅุนุฏุงุฏุงุช ======
  const FMS_API_URL = 'YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE';
  const TRAIN_API_URL = 'YOUR_GAS_TRAINING_WEB_APP_URL_HERE';

  // ====== ุฏูุงู ุฅุฏุงุฑุฉ ุงูุดุนุงุฑ ======
  function setupLogoChange() {
    const logoPicker = document.getElementById('logoPicker');
    const btnSetLogo = document.getElementById('btnSetLogo');
    
    if (btnSetLogo && logoPicker) {
      // ุนูุฏ ุงูููุฑ ุนูู ุฒุฑ ุชุบููุฑ ุงูุดุนุงุฑุ ูุชุญ ูุงูุฐุฉ ุงุฎุชูุงุฑ ุงูููู
      btnSetLogo.addEventListener('click', function() {
        logoPicker.click();
      });
      
      // ุนูุฏ ุงุฎุชูุงุฑ ููู ุตูุฑุฉุ ุชุญุฏูุซ ุงูุดุนุงุฑ
      logoPicker.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            const imageDataUrl = e.target.result;
            
            // ุชุญุฏูุซ ุงูุดุนุงุฑ ูู ุงูููุฏุฑ
            const logoSmall = document.getElementById('logoSmall');
            if (logoSmall) {
              logoSmall.src = imageDataUrl;
            }
            
            // ุชุญุฏูุซ ุงูุดุนุงุฑ ูู ุงูููุฑู
            const logoHero = document.getElementById('logoHero');
            if (logoHero) {
              logoHero.src = imageDataUrl;
            }
            
            // ุญูุธ ุงูุดุนุงุฑ ูู localStorage ููุงุณุชุฎุฏุงู ุงููุณุชูุจูู
            try {
              localStorage.setItem('customLogo', imageDataUrl);
            } catch (error) {
              console.log('ูุง ูููู ุญูุธ ุงูุดุนุงุฑ ูู ุงูุชุฎุฒูู ุงููุญูู');
            }
          };
          
          reader.readAsDataURL(file);
        }
      });
    }
  }
  
  function loadSavedLogo() {
    try {
      const savedLogo = localStorage.getItem('customLogo');
      if (savedLogo) {
        const logoSmall = document.getElementById('logoSmall');
        const logoHero = document.getElementById('logoHero');
        
        if (logoSmall) logoSmall.src = savedLogo;
        if (logoHero) logoHero.src = savedLogo;
      }
    } catch (error) {
      console.log('ูุง ูููู ุชุญููู ุงูุดุนุงุฑ ุงููุญููุธ');
    }
  }

  // ====== ุฏูุงู ุงูุชููู ======
  function navTo(sectionId) {
    // ุฅุฎูุงุก ุฌููุน ุงูุฃูุณุงู
    document.querySelectorAll('.content-section').forEach(section => {
      section.classList.remove('active');
    });
    
    // ุฅุฒุงูุฉ ุงููุดุท ูู ุฌููุน ุงูุฑูุงุจุท
    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove('active');
    });
    
    // ุฅุธูุงุฑ ุงููุณู ุงููุทููุจ
    const targetSection = document.getElementById(sectionId);
    if (targetSection) {
      targetSection.classList.add('active');
      targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
    
    // ุชุนููู ุงูุฑุงุจุท ููุดุท
    const activeLink = document.querySelector(`[onclick="navTo('${sectionId}')"]`);
    if (activeLink) {
      activeLink.classList.add('active');
    }
    
    // ุชููุฆุฉ FMS ุฅุฐุง ูุฒู ุงูุฃูุฑ
    if (sectionId === 'fms') {
      const fmsContent = document.getElementById('fmsTabContent');
      if (fmsContent && fmsContent.innerHTML.trim() === '') {
        switchFmsTab('library');
      }
    }
    
    // ุชููุฆุฉ PSC ุฅุฐุง ูุฒู ุงูุฃูุฑ
    if (sectionId === 'psc') {
      const pscContent = document.getElementById('pscTabContent');
      if (pscContent && pscContent.innerHTML.trim() === '') {
        switchPscTab('library');
      }
    }
  }

  // ====== ุฏูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ ======
  function openDocModal(title, previewUrl) {
    document.getElementById('docTitle').textContent = title;
    document.getElementById('docFrame').src = previewUrl;
    document.getElementById('docModal').style.display = 'flex';
  }

  function closeDocModal() {
    document.getElementById('docFrame').src = 'about:blank';
    document.getElementById('docModal').style.display = 'none';
  }

  // ====== ููุชุจุฉ ูุซุงุฆู PSC ======
  const PSC_DOCS_LIBRARY = [
{ code:'POL-PSC-2025-001', name:'ุณูุงุณุฉ ุจุฑูุงูุฌ ุณูุงูุฉ ุงููุฑุถู', category:'POL', url:'https://drive.google.com/file/d/1FEdKvutCYqWXYwnp70OsjRO-CIzzmZU2CAFstiFVmMw/preview' },
    { code:'DEC-PSC-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'DEC', url:'https://drive.google.com/file/d/1Qz7s61wIuWh1RbSLbMyrzWB_GwoPnfwqhZQHMKpgeyc/preview' },
    { code:'CHT-PSC-2025-001', name:'ููุซุงู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'CHT', url:'https://drive.google.com/file/d/1pDDwB4Y-l7EQbwJpLH5o9PpCbdhTFQleai7PvU2Ltjg/preview' },
    { code:'POL-PSC-2025-003', name:'ุณูุงุณุฉ ุงูุชุนุฑู ุงููุฒุฏูุฌ ุนูู ุงููุฑูุถ', category:'POL', url:'https://drive.google.com/file/d/1yNGDW_yLN9OrguG-_lJzXKxk6y0rJfjfc7aONgQiNqQ/preview' },
    { code:'POL-PSC-2025-002', name:'ุณูุงุณุฉ ุงูุฅุจูุงุบ ูุงูุชุนูู ูู ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ', category:'POL', url:'https://drive.google.com/file/d/1VRoEZjXxeIoHlDvtmmus-NM-zNK-oARCh_8_u74S7c0/preview' },
    { code:'FRM-PSC-2025-001', name:'ูููุฐุฌ ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู', category:'FRM', url:'https://drive.google.com/file/d/1KVTIutS3sdWTYhc1ZB-p9J3fXDjEu-CajxwlYyocz44/preview' },
    { code:'CHK-PSC-2025-001', name:'ูููุฐุฌ ูุฑุงุฌุนุฉ ุชุนุฑูู ุงููุฑูุถ', category:'CHK', url:'https://drive.google.com/file/d/1oS_fO9mBIggmaXbPfaXB3H1YKyTlwgGfT8Hwbs9qi7E/preview' },
    { code:'CHK-PSC-2025-002', name:'ูุฑุงุฌุนุฉ ุฃุฏููุฉ ุนุงููุฉ ุงูุฎุทูุฑุฉ', category:'CHK', url:'https://drive.google.com/file/d/1t4Pt6bkxp9ER5mnc3lcDqy_E5z3eMm9WTqilWIPAIBM/preview' },
    { code:'LOG-PSC-2025-001', name:'ุณุฌู ุงูุญูุงุฏุซ ูุณูุงูุฉ ุงููุฑุถู', category:'LOG', url:'https://drive.google.com/file/d/12SS-Nn_TpvIsIoUfdOPRzC_tgLqmb2hfZZi53_dSyVI/preview' },
    { code:'FRM-PSC-2025-002', name:'ูููุฐุฌ SBAR ููุชุณููู', category:'FRM', url:'https://drive.google.com/file/d/1JgEPxYvK6X_cQ7eroNCkymfUzbTCbzljqvrOKYKBw1g/preview' },
    { code:'FRM-PSC-2025-003', name:'ูููุฐุฌ PDSA ูุชุญุณูู ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/file/d/1XE45nGctQGK3WIFnUxE5CqsIZu8BdBLZuqOLgsZaPXk/preview' },
    { code:'FRM-PSC-2025-004', name:'ูููุฐุฌ ุฅุญุงูุฉ ููุฌูุฉ M&M', category:'FRM', url:'https://drive.google.com/file/d/1LbD4aaIcyIDPJi2Cn_J69OEnpeCF3XTFCjjDstr2ny8/preview' },
    { code:'REP-PSC-2025-001', name:'ุชูุฑูุฑ ูุคุดุฑุงุช ุณูุงูุฉ ุงููุฑุถู', category:'REP', url:'https://drive.google.com/file/d/1wZGnfGcj1O-329jBUXfPHXqA09k6VS58mpu4rNELS20/preview' },
    { code:'TRN-PSC-2025-001', name:'ุฎุทุฉ ุงูุชูุนูุฉ ูุงูุชุฏุฑูุจ', category:'TRN', url:'https://drive.google.com/file/d/1Ohj-mB-Jk3mmdrW9Lm6GNSojRJaT__GQpjO7aFG4twY/preview' },
    { code:'TRN-PSC-2025-002', name:'ุณุฌู ุญุถูุฑ ุชุฏุฑูุจ', category:'TRN', url:'https://drive.google.com/file/d/1Sgj_Qps21a3GoalpZAf-08b43UmL30GLUvY8UQqyxjg/preview' },
  
    ,{ code:'TRN-PSC-2025-002B', name:'ุณุฌู ุญุถูุฑ ุชุฏุฑูุจ (ูุณุฎุฉ ุงููุณุชุฎุฏู)', category:'TRN', url:'https://drive.google.com/file/d/1GIOUPLH9AzWB0PKZiaV_NJoQwjkbzZLyaPkoaV1niC8/preview' }
    
];

  const PSC_CATEGORY_NAMES = {
    POL:'ุงูุณูุงุณุงุช', 
    DEC:'ุงููุฑุงุฑุงุช', 
    CHT:'ุงูููุซุงู',
    FRM:'ุงูููุงุฐุฌ', 
    CHK:'ููุงุฆู ุงูุชุญูู', 
    LOG:'ุงูุณุฌูุงุช', 
    REP:'ุงูุชูุงุฑูุฑ', 
    TRN:'ุงูุชุฏุฑูุจ'
  };

  // ====== ูุคุดุฑุงุช PSC ======
  const PSC_KPI_DATA = [
    { ุงูุดูุฑ: 'ููุงูุฑ', ุชุนุฑูู_ุงููุฑูุถ: 98, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 85, ุฃุฎุทุงุก_ุฏูุงุก: 5.2, ุณููุท: 3.1, ุจูุงุบุงุช_ูุฑูุจุฉ: 12 },
    { ุงูุดูุฑ: 'ูุจุฑุงูุฑ', ุชุนุฑูู_ุงููุฑูุถ: 99, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 82, ุฃุฎุทุงุก_ุฏูุงุก: 6.1, ุณููุท: 3.5, ุจูุงุบุงุช_ูุฑูุจุฉ: 8 },
    { ุงูุดูุฑ: 'ูุงุฑุณ', ุชุนุฑูู_ุงููุฑูุถ: 92, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 88, ุฃุฎุทุงุก_ุฏูุงุก: 8.5, ุณููุท: 4.8, ุจูุงุบุงุช_ูุฑูุจุฉ: 15 },
    { ุงูุดูุฑ: 'ุฃุจุฑูู', ุชุนุฑูู_ุงููุฑูุถ: 99, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 95, ุฃุฎุทุงุก_ุฏูุงุก: 4.0, ุณููุท: 3.0, ุจูุงุบุงุช_ูุฑูุจุฉ: 35 },
    { ุงูุดูุฑ: 'ูุงูู', ุชุนุฑูู_ุงููุฑูุถ: 100, ุงูุชุฒุงู_ุบุณู_ุงููุฏูู: 96, ุฃุฎุทุงุก_ุฏูุงุก: 3.5, ุณููุท: 2.9, ุจูุงุบุงุช_ูุฑูุจุฉ: 28 },
  ];

  // ====== ุฏูุงู PSC ======
  function switchPscTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-psc-tab]').forEach(button => {
      if (button.getAttribute('data-psc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('pscTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderPscLibrary(container, PSC_DOCS_LIBRARY);
    } else if (tab === 'indicators') {
      renderPscIndicators(container);
    } else if (tab === 'reporting') {
      renderPscReporting(container);
    } else if (tab === 'needs') {
      renderPscNeeds(container);
    }
  }

  function renderPscLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-psc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-psc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${PSC_CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="pscSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'pscGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${PSC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-psc-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-psc-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-psc-filter'), document.getElementById('pscSearch').value);
      });
    });
    
    document.getElementById('pscSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-psc-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-psc-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderPscIndicators(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ุฌุฏูู ุงููุคุดุฑุงุช
    const tableSection = document.createElement('div');
    tableSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ูุคุดุฑุงุช ุณูุงูุฉ ุงููุฑุถู ุงูุดูุฑูุฉ</h3>
      <div class="overflow-auto">
        <table class="kpi-table">
          <thead>
            <tr>
              <th>ุงูุดูุฑ</th>
              <th>ุชุนุฑูู ุงููุฑูุถ %</th>
              <th>ุงูุชุฒุงู ุบุณู ุงููุฏูู %</th>
              <th>ุฃุฎุทุงุก ุฏูุงุฆูุฉ ููู 1000 ูุตูุฉ</th>
              <th>ุณููุท ููู 1000 ุฒูุงุฑุฉ</th>
              <th>ุจูุงุบุงุช ูุฑูุจุฉ ูู ุงููููุน</th>
            </tr>
          </thead>
          <tbody id="kpiTableBody"></tbody>
        </table>
      </div>
    `;
    
    // ูุฎุทุท ุจูุงูู ูุจุณุท
    const chartSection = document.createElement('div');
    chartSection.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ุชุทูุฑ ูุคุดุฑุงุช ุงูุณูุงูุฉ</h3>
      <div class="border rounded-xl p-4 bg-white">
        <div class="flex flex-wrap gap-4 mb-4">
          <button class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm" onclick="renderPscChart('ุชุนุฑูู_ุงููุฑูุถ')">ุชุนุฑูู ุงููุฑูุถ</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุงูุชุฒุงู_ุบุณู_ุงููุฏูู')">ุบุณู ุงููุฏูู</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุฃุฎุทุงุก_ุฏูุงุก')">ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ</button>
          <button class="px-3 py-1 rounded-full bg-gray-200 text-sm" onclick="renderPscChart('ุณููุท')">ูุนุฏู ุงูุณููุท</button>
        </div>
        <div id="pscChart" class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
          <p class="text-gray-500">ุงุฎุชุฑ ูุคุดุฑุงู ูุนุฑุถ ุงูุฑุณู ุงูุจูุงูู</p>
        </div>
      </div>
    `;
    
    wrapper.appendChild(tableSection);
    wrapper.appendChild(chartSection);
    container.appendChild(wrapper);
    
    // ููุก ุฌุฏูู ุงููุคุดุฑุงุช
    renderPscKpiTable();
  }

  function renderPscKpiTable() {
    const tableBody = document.getElementById('kpiTableBody');
    tableBody.innerHTML = '';
    
    PSC_KPI_DATA.forEach(row => {
      const tr = document.createElement('tr');
      
      // ุชุญุฏูุฏ ูุฆุงุช ุงูุฃููุงู ุจูุงุกู ุนูู ุงูููู
      const patientIdClass = row.ุชุนุฑูู_ุงููุฑูุถ >= 95 ? 'good' : row.ุชุนุฑูู_ุงููุฑูุถ >= 90 ? 'warning' : 'critical';
      const handHygieneClass = row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู >= 90 ? 'good' : row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู >= 80 ? 'warning' : 'critical';
      const medErrorsClass = row.ุฃุฎุทุงุก_ุฏูุงุก <= 4 ? 'good' : row.ุฃุฎุทุงุก_ุฏูุงุก <= 6 ? 'warning' : 'critical';
      const fallsClass = row.ุณููุท <= 3 ? 'good' : row.ุณููุท <= 4 ? 'warning' : 'critical';
      const nearMissClass = row.ุจูุงุบุงุช_ูุฑูุจุฉ >= 20 ? 'good' : row.ุจูุงุบุงุช_ูุฑูุจุฉ >= 10 ? 'warning' : 'critical';
      
      tr.innerHTML = `
        <td class="font-semibold">${row.ุงูุดูุฑ}</td>
        <td class="${patientIdClass}">${row.ุชุนุฑูู_ุงููุฑูุถ}%</td>
        <td class="${handHygieneClass}">${row.ุงูุชุฒุงู_ุบุณู_ุงููุฏูู}%</td>
        <td class="${medErrorsClass}">${row.ุฃุฎุทุงุก_ุฏูุงุก}</td>
        <td class="${fallsClass}">${row.ุณููุท}</td>
        <td class="${nearMissClass}">${row.ุจูุงุบุงุช_ูุฑูุจุฉ}</td>
      `;
      tableBody.appendChild(tr);
    });
  }

  function renderPscChart(indicator) {
    const chartContainer = document.getElementById('pscChart');
    const indicatorName = {
      'ุชุนุฑูู_ุงููุฑูุถ': 'ุชุนุฑูู ุงููุฑูุถ %',
      'ุงูุชุฒุงู_ุบุณู_ุงููุฏูู': 'ุงูุชุฒุงู ุบุณู ุงููุฏูู %', 
      'ุฃุฎุทุงุก_ุฏูุงุก': 'ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ',
      'ุณููุท': 'ูุนุฏู ุงูุณููุท'
    }[indicator];
    
    // ุฑุณู ุจูุงูู ูุจุณุท ุจุงุณุชุฎุฏุงู HTML ูCSS
    const maxValue = Math.max(...PSC_KPI_DATA.map(row => row[indicator]));
    const minValue = Math.min(...PSC_KPI_DATA.map(row => row[indicator]));
    
    let chartHTML = `
      <div class="w-full h-full p-4">
        <h4 class="text-center font-bold mb-4">${indicatorName}</h4>
        <div class="flex items-end justify-between h-40 gap-2">
    `;
    
    PSC_KPI_DATA.forEach((row, index) => {
      const value = row[indicator];
      const percentage = ((value - minValue) / (maxValue - minValue)) * 80 + 20;
      
      chartHTML += `
        <div class="flex flex-col items-center flex-1">
          <div class="text-xs mb-1">${row.ุงูุดูุฑ}</div>
          <div class="w-full bg-[var(--brand1)] rounded-t transition-all" style="height: ${percentage}%"></div>
          <div class="text-xs mt-1">${value}</div>
        </div>
      `;
    });
    
    chartHTML += `</div></div>`;
    chartContainer.innerHTML = chartHTML;
    
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงููุคุดุฑุงุช ุงููุดุทุฉ
    document.querySelectorAll('#pscChart').closest('.border').querySelectorAll('button').forEach(btn => {
      btn.classList.remove('bg-[var(--brand1)]', 'text-white');
      btn.classList.add('bg-gray-200');
    });
    
    const activeButton = document.querySelector(`[onclick="renderPscChart('${indicator}')"]`);
    if (activeButton) {
      activeButton.classList.add('bg-[var(--brand1)]', 'text-white');
      activeButton.classList.remove('bg-gray-200');
    }
  }

  function renderPscReporting(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';
    
    // ููุงุฐุฌ ุงูุฅุจูุงุบ ุงูุณุฑูุน
    const quickReports = document.createElement('div');
    quickReports.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">๐ ููุงุฐุฌ ุงูุฅุจูุงุบ ุงูุณุฑูุน</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <a href="https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-red-100 grid place-items-center text-red-600">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุญุงุฏุซ</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุญุฏุงุซ ุงูุณูุจูุฉ ุงูุชู ููุนุช</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-yellow-100 grid place-items-center text-yellow-600">
            <i class="fas fa-bullseye"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ูุฑูุจ ูู ุงููููุน</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุญุฏุงุซ ุงูุชู ูุงุฏุช ุชูุน</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-orange-100 grid place-items-center text-orange-600">
            <i class="fas fa-triangle-exclamation"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุฎุทุฑ/ุดุฑุท ุบูุฑ ุขูู</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงููุฎุงุทุฑ ุงููุญุชููุฉ</div>
          </div>
        </a>
        
        <a href="https://drive.google.com/file/d/17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ/view" target="_blank" class="p-4 border rounded-xl bg-white hover:shadow-md transition flex items-center gap-3">
          <div class="h-12 w-12 rounded-full bg-blue-100 grid place-items-center text-blue-600">
            <i class="fas fa-toolbox"></i>
          </div>
          <div>
            <div class="font-bold">ุจูุงุบ ุนุทู ุฌูุงุฒ/ุชุฌููุฒ</div>
            <div class="text-sm text-gray-600">ููุจุทุงูุงุช ุนู ุงูุฃุนุทุงู ูู ุงูุฃุฌูุฒุฉ ุงูุทุจูุฉ</div>
          </div>
        </a>
      </div>
    `;
    
    // ูููุฐุฌ ุฅุฏุฎุงู ุจูุงูุงุช ุงููุคุดุฑุงุช
    const dataEntry = document.createElement('div');
    dataEntry.className = 'border rounded-xl p-4 bg-white';
    dataEntry.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-4">โ ุฅุฏุฎุงู ุจูุงูุงุช ูุคุดุฑ ุฌุฏูุฏ</h3>
      <form id="kpiForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุดูุฑ *</label>
          <select name="month" required class="w-full border rounded-lg px-3 py-2">
            <option value="">ุงุฎุชุฑ ุงูุดูุฑ</option>
            <option value="ููุงูุฑ">ููุงูุฑ</option>
            <option value="ูุจุฑุงูุฑ">ูุจุฑุงูุฑ</option>
            <option value="ูุงุฑุณ">ูุงุฑุณ</option>
            <option value="ุฃุจุฑูู">ุฃุจุฑูู</option>
            <option value="ูุงูู">ูุงูู</option>
            <option value="ููููู">ููููู</option>
            <option value="ููููู">ููููู</option>
            <option value="ุฃุบุณุทุณ">ุฃุบุณุทุณ</option>
            <option value="ุณุจุชูุจุฑ">ุณุจุชูุจุฑ</option>
            <option value="ุฃูุชูุจุฑ">ุฃูุชูุจุฑ</option>
            <option value="ููููุจุฑ">ููููุจุฑ</option>
            <option value="ุฏูุณูุจุฑ">ุฏูุณูุจุฑ</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุชุนุฑูู ุงููุฑูุถ % *</label>
          <input type="number" min="0" max="100" name="patient_id" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุณุจุฉ ุงููุฆููุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุชุฒุงู ุบุณู ุงููุฏูู % *</label>
          <input type="number" min="0" max="100" name="hand_hygiene" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุณุจุฉ ุงููุฆููุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ *</label>
          <input type="number" step="0.1" min="0" name="med_errors" required class="w-full border rounded-lg px-3 py-2" placeholder="ููู 1000 ูุตูุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ูุนุฏู ุงูุณููุท *</label>
          <input type="number" step="0.1" min="0" name="falls" required class="w-full border rounded-lg px-3 py-2" placeholder="ููู 1000 ุฒูุงุฑุฉ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุจูุงุบุงุช ูุฑูุจุฉ ุงููููุน *</label>
          <input type="number" min="0" name="near_miss" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุนุฏุฏ">
        </div>
        <div class="md:col-span-2 flex items-center gap-3 pt-2">
          <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุจูุงูุงุช</button>
          <span id="kpiMsg" class="text-sm"></span>
        </div>
      </form>
    `;
    
    wrapper.appendChild(quickReports);
    wrapper.appendChild(dataEntry);
    container.appendChild(wrapper);
    
    // ูุนุงูุฌุฉ ูููุฐุฌ ุฅุฏุฎุงู ุงูุจูุงูุงุช
    const kpiForm = document.getElementById('kpiForm');
    if (kpiForm) {
      kpiForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const messageElement = document.getElementById('kpiMsg');
        messageElement.textContent = 'ุฌุงุฑู ุญูุธ ุงูุจูุงูุงุช...';
        messageElement.className = 'text-sm text-blue-600';
        
        // ูู ุจูุฆุฉ ุญููููุฉุ ููุง ุณูุชู ุฅุฑุณุงู ุงูุจูุงูุงุช ูุฎุงุฏู
        setTimeout(() => {
          messageElement.textContent = 'โ ุชู ุญูุธ ุงูุจูุงูุงุช ุจูุฌุงุญ (ูู ุจูุฆุฉ ุญููููุฉ ุณูุชู ุญูุธูุง ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)';
          messageElement.className = 'text-sm text-green-600';
          kpiForm.reset();
        }, 1000);
      });
    }
  }

  function renderPscNeeds(container) {
    const needs = [
      { key: 'charter', text: 'ููุซุงู ูุฌูุฉ ุณูุงูุฉ ุงููุฑุถู ูุนุชูุฏ (CHT-PSC-2025-001)', required: true },
      { key: 'policy', text: 'ุณูุงุณุฉ ุจุฑูุงูุฌ ุณูุงูุฉ ุงููุฑุถู ูุนุชูุฏุฉ (POL-PSC-2025-001)', required: true },
      { key: 'committee', text: 'ูุฑุงุฑ ุชุดููู ุงููุฌูุฉ ููุนู (DEC-PSC-2025-001)', required: true },
      { key: 'patient_id', text: 'ุณูุงุณุฉ ุงูุชุนุฑู ุงููุฒุฏูุฌ ุนูู ุงููุฑูุถ ูุนุชูุฏุฉ (POL-PSC-2025-003)', required: true },
      { key: 'med_errors', text: 'ุณูุงุณุฉ ุงูุฅุจูุงุบ ุนู ุงูุฃุฎุทุงุก ุงูุฏูุงุฆูุฉ ูุนุชูุฏุฉ (POL-PSC-2025-002)', required: true },
      { key: 'meetings', text: 'ูุญุงุถุฑ ุงุฌุชูุงุนุงุช ุงููุฌูุฉ ูุณุฌูุฉ ูููุธูุฉ', required: true },
      { key: 'indicators', text: 'ูุธุงู ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุณูุงูุฉ ููุนู', required: true },
      { key: 'training', text: 'ุฎุทุฉ ุชุฏุฑูุจ ุณูุงูุฉ ุงููุฑุถู ูููุฐุฉ', required: true },
    ];
    
    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    
    needs.forEach(need => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
          <span class="font-semibold">${need.text}</span>
        </label>
        ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validatePscNeeds()">
        ุชุญููู ูู ุงูุงูุชูุงู
      </button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generatePscReport()">
        ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validatePscNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#pscTabContent input[data-required="1"]')];
    const missingCount = requiredCheckboxes.filter(checkbox => !checkbox.checked).length;
    
    if (missingCount === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุณูุงูุฉ ุงููุฑุถู ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ุชูุจูู: ููุฌุฏ ${missingCount} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุณูุงูุฉ ุงููุฑุถู.`);
    }
  }

  function generatePscReport() {
    const checkboxes = [...document.querySelectorAll('#pscTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(checkbox => checkbox.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ ุณูุงูุฉ ุงููุฑุถู:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

    // ====== ููุงูุญุฉ ุงูุนุฏูู (IPC) โ ููุชุจุฉ + ูุคุดุฑุงุช + ููุงุฐุฌ ุจุฅุณูุงุฏ ูุญูู ======
const IPC_DOCS_LIBRARY = [
    { code:'DEC-IPC-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู', category:'DEC', url:'https://drive.google.com/file/d/1Tm5lYdHzEEEhyiG_T0iI92RKIctGJAbmX-NSTt9z1tA/preview' },
    { code:'CHT-IPC-2025-001', name:'ููุซุงู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู', category:'CHT', url:'https://drive.google.com/file/d/1Zdo85RWS2t6otMkuyFCrIua2s3EmOT_B9VWBgPSAQCM/preview' },
    { code:'POL-IPC-2025-001', name:'ุงูุณูุงุณุฉ ุงูุนุงูุฉ ูุงุญุชูุงุทุงุช ุงูุงูุชูุงู', category:'POL', url:'https://drive.google.com/file/d/169JZuLDljxF8KTK_nGNHltFKr17kdU56qJBMx_hHqgM/preview' },
    { code:'POL-IPC-2025-002', name:'ุณูุงุณุฉ ูุธุงูุฉ ุงูุฃูุฏู', category:'POL', url:'https://drive.google.com/file/d/1tQ1e2gYVefnDIMKnOxIGEn5OFHoYRk8Ctm-YcfRHeiY/preview' },
    { code:'POL-IPC-2025-003', name:'ุณูุงุณุฉ ุงูุชุนููู ูุงูุชุทููุฑ', category:'POL', url:'https://drive.google.com/file/d/1zM9BEHKv8M41CBo75k0eB-nlYx6YmEhqkbnHiDS9n5o/preview' },
    { code:'POL-IPC-2025-004', name:'ุณูุงุณุฉ ุงูุนุฒู ุงูุงุญุชุฑุงุฒู', category:'POL', url:'https://drive.google.com/file/d/1JZD6lyLH0WqJ0rymQstpoyozHFfgCfSsgmhu4t65LoU/preview' },
    { code:'POL-IPC-2025-005', name:'ุณูุงุณุฉ ุงูููุงูุฉ ูู ูุฎุฒ ุงูุฅุจุฑ ูุงูุชุนุฑุถุงุช PEP', category:'POL', url:'https://drive.google.com/file/d/1lPcKX2S1PzgZUqVcHBk2LfIcvJ-VkZQghZX0NejTPic/preview' },
    { code:'POL-IPC-2025-006', name:'ุณูุงุณุฉ ุชุทุนููุงุช ุงูุนุงูููู ุงูุตุญููู', category:'POL', url:'https://drive.google.com/file/d/1u5vQTYOoY87F0bgUFFGwD-IpVkSM3dsT_Eh5YVeIMKM/preview' },
    { code:'POL-IPC-2025-007', name:'ุณูุงุณุฉ ุงูุชูุธูู ุงูุจูุฆู ูุฅุฏุงุฑุฉ ุงูููุงูุงุช', category:'POL', url:'https://drive.google.com/file/d/1eCUhyboq0ffIMV9XJWy3ZuXNOx5Up63JyfoNMuOmUQU/preview' },
    { code:'SOP-IPC-2025-001', name:'ุบุณู ุงูุฃูุฏู', category:'SOP', url:'https://drive.google.com/file/d/1aDqwhm1Wyf-v-Tq2jYrpyIELfFj3x9Yx8Fvzqs3l_Oc/preview' },
    { code:'SOP-IPC-2025-002', name:'ุงุฑุชุฏุงุก ููุฒุน PPE', category:'SOP', url:'https://drive.google.com/file/d/1USpd_PTj91jLfHYnp_8Cri8TQNaDgFGxV90-PXiU0pM/preview' },
    { code:'SOP-IPC-2025-003', name:'ุฅุนุงุฏุฉ ูุนุงูุฌุฉ ุงูุฃุฏูุงุช', category:'SOP', url:'https://drive.google.com/file/d/1EfZAqkuoieZPDijInlFwNJq6iebUA5Ty9YLkCdRINC4/preview' },
    { code:'SOP-IPC-2025-004', name:'ุงูุชูุธูู ุงูุจูุฆู', category:'SOP', url:'https://drive.google.com/file/d/1HfrbaxdW9bbZpf4y6P7UYslDpDF1v-q39FSzW2AQMC4/preview' },
    { code:'SOP-IPC-2025-005', name:'ุงูุชุนุงูู ูุน ุงูููุงูุงุช', category:'SOP', url:'https://drive.google.com/file/d/1Xphf8rXU2WceS2GsbgS_FtHpxqmdhtOSuCEsurRN3ow/preview' },
    { code:'ALG-IPC-2025-001', name:'ุจุทุงูุฉ ุงูุนุฒู ุงูุณุฑูุน', category:'ALG', url:'https://drive.google.com/file/d/1vZCcSeSTOlh_dv4mL4zYEZ4LdPJp6BwmAKr6ARsywpU/preview' },
    { code:'ALG-IPC-2025-002', name:'ุจุทุงูุฉ ุงูุชุนุฑุถ ูุงููPEP', category:'ALG', url:'https://drive.google.com/file/d/1LdPaA5UeuazoZRXRvJG1f0Cf-MiIKkiDloP3PneJtTo/preview' },
    { code:'CHK-IPC-2025-001', name:'ุชุฏููู ูุธุงูุฉ ุงูุฃูุฏู', category:'CHK', url:'https://drive.google.com/file/d/1wxm-Jq4yHVZe-uXRRirbOZe7dIYePlmeGk2SIpyZAcs/preview' },
    { code:'CHK-IPC-2025-002', name:'ุชุฏููู ุงูุนุฒู ุงูุงุญุชุฑุงุฒู', category:'CHK', url:'https://drive.google.com/file/d/1-oFMNhpVbNmgbkUp7m2ymMkVF3LkgfHI7fvV-WVgt6o/preview' },
    { code:'CHK-IPC-2025-003', name:'ุชุฏููู ุงูุชุทููุฑ ูุงูุชุนููู', category:'CHK', url:'https://drive.google.com/file/d/1G-nCgzXmELTPojRIC-thsl1FYiXfFW48k5wNJAjTzN4/preview' },
    { code:'CHK-IPC-2025-004', name:'ุชุฏููู ุงูุชูุธูู ุงูุจูุฆู', category:'CHK', url:'https://drive.google.com/file/d/17XAUeqVqzxpmUoZBmU4hCbFZ1mxTx8SXnINju5YaH1s/preview' },
    { code:'LOG-IPC-2025-001', name:'ุณุฌู ุงูุชุนุฑุถุงุช ููุฎุฒ ุงูุฅุจุฑ', category:'LOG', url:'https://drive.google.com/file/d/1O7GSffF0q5_rU_VXcpy7fBa81OndLebVL5w71mLio5E/preview' },
    { code:'LOG-IPC-2025-002', name:'ุณุฌู ุชุทุนููุงุช ุงูุนุงูููู', category:'LOG', url:'https://drive.google.com/file/d/1xA8oFjgIMd_fD8fajCwE5CI57KXLPoemQyCjEmbzST0/preview' },
    { code:'LOG-IPC-2025-003', name:'ุณุฌู ุฌูุงุฒ ุงูุชุนููู', category:'LOG', url:'https://drive.google.com/file/d/1h-bU6d5b7VihSQvjE-TJHAcBjGdhGDGlOPf6R3INlTs/preview' },
    { code:'LOG-IPC-2025-004', name:'ุณุฌู ุงูุชุทููุฑ ุนุงูู ุงููุณุชูู', category:'LOG', url:'https://drive.google.com/file/d/1s_0zXujFnKn8BlxYYqk_Gs8ilE8qjgJwXEBHZhNqYPg/preview' },
    { code:'LOG-IPC-2025-005', name:'ุณุฌู ุงูุชูุธูู ุงูุจูุฆู', category:'LOG', url:'https://drive.google.com/file/d/1ZVSFjJ44wMDAhAdqaH8rBwHIBk9JOm9QzJvF2grznNM/preview' },
    { code:'TRN-IPC-2025-001', name:'ุฎุทุฉ ุงูุชุฏุฑูุจ ูุงูุชูุนูุฉ', category:'TRN', url:'https://drive.google.com/file/d/1jp-774WQqKHD5t-M-D4vue6yADTo-LS9VuOLmV4aMzE/preview' },
    { code:'TRN-IPC-2025-002', name:'ุณุฌู ุญุถูุฑ ุชุฏุฑูุจ', category:'TRN', url:'https://drive.google.com/file/d/1oek6-EPH3N8oTd8GKDbQymwKvsMMnCRhX_SEipSKYIk/preview' },
    { code:'REP-IPC-2025-001', name:'ูุคุดุฑุงุช ููุงูุญุฉ ุงูุนุฏูู ุดูุฑููุง', category:'REP', url:'https://drive.google.com/file/d/1GS2VRBmnyCfLqiCmJpmHcTK5Bd7xG3nQ63Es67d1Z9g/preview' }
];
const IPC_CATEGORY_NAMES = { 
    POL:'ุงูุณูุงุณุงุช', 
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', 
    DEC:'ุงููุฑุงุฑุงุช', 
    CHT:'ุงูููุซุงู', 
    LOG:'ุงูุณุฌูุงุช', 
    REP:'ุงูุชูุงุฑูุฑ',
    ALG:'ุงูุฎูุงุฑุฒููุงุช',
    CHK:'ุงูุชุฏูููุงุช',
    TRN:'ุงูุชุฏุฑูุจ'
};

  // ุชุฎุฒูู ูุญูู ุขูู ุงุฎุชูุงุฑู ุจุงุณุชุฎุฏุงู WebCrypto (AESโGCM)
  const SecureStore = (() => {
    const SALT_KEY = 'ipc_salt_v1';
    const MODE_KEY = 'ipc_secure_mode';
    let cryptoKey = null;

    function toBase64(buf) { return btoa(String.fromCharCode(...new Uint8Array(buf))); }
    function fromBase64(b64) { return Uint8Array.from(atob(b64), c => c.charCodeAt(0)).buffer; }

    async function deriveKey(passphrase, saltB64) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(passphrase), 'PBKDF2', false, ['deriveKey']);
      const salt = saltB64 ? fromBase64(saltB64) : crypto.getRandomValues(new Uint8Array(16)).buffer;
      const derived = await crypto.subtle.deriveKey(
        { name: 'PBKDF2', salt, iterations: 120000, hash: 'SHA-256' },
        keyMaterial,
        { name: 'AES-GCM', length: 256 },
        false,
        ['encrypt','decrypt']
      );
      const savedSalt = saltB64 || toBase64(salt);
      localStorage.setItem(SALT_KEY, savedSalt);
      return derived;
    }

    return {
      async setPassphrase(passphrase) {
        if (!window.crypto || !window.crypto.subtle) {
          alert('โ๏ธ ูุชุตูุญู ูุง ูุฏุนู WebCrypto ูุชูุนูู ุงูุญูุงูุฉ. ุณูุชู ุงูุญูุธ ุจุฏูู ุชุดููุฑ.');
          localStorage.setItem(MODE_KEY, 'off');
          cryptoKey = null;
          return false;
        }
        cryptoKey = await deriveKey(passphrase, localStorage.getItem(SALT_KEY));
        localStorage.setItem(MODE_KEY, 'on');
        return true;
      },
      clearPassphrase() {
        cryptoKey = null;
        localStorage.setItem(MODE_KEY, 'off');
      },
      isOn() {
        return localStorage.getItem(MODE_KEY) === 'on' && cryptoKey !== null;
      },
      async encryptJson(obj) {
        const enc = new TextEncoder();
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const data = enc.encode(JSON.stringify(obj));
        if (!cryptoKey) return { plain: true, data: toBase64(data) };
        const cipher = await crypto.subtle.encrypt({ name:'AES-GCM', iv }, cryptoKey, data);
        return { plain: false, data: `v1:${toBase64(iv)}:${toBase64(cipher)}` };
      },
      async decryptJson(payload) {
        if (payload == null) return null;
        // if saved as plain
        if (typeof payload === 'string' && !payload.startsWith('v1:')) {
          try {
            const buf = fromBase64(payload);
            const dec = new TextDecoder();
            return JSON.parse(dec.decode(buf));
          } catch (e) {
            return null;
          }
        }
        if (typeof payload !== 'string') return payload;
        const [v, ivB64, dataB64] = payload.split(':');
        if (v !== 'v1' || !SecureStore.isOn()) return null;
        const iv = fromBase64(ivB64);
        const cipherBuf = fromBase64(dataB64);
        const plain = await crypto.subtle.decrypt({ name:'AES-GCM', iv: new Uint8Array(iv) }, cryptoKey, cipherBuf);
        const dec = new TextDecoder();
        return JSON.parse(dec.decode(plain));
      }
    };
  })();

  // ููุงุชูุญ ุงูุชุฎุฒูู
  const IPC_KEYS = {
    HH: 'ipc_hh_v1',           // ุชุฏููู ุบุณู ุงููุฏูู
    STER: 'ipc_ster_v1',       // ูุฑุงูุจุฉ ุงูุชุนููู
    CLEAN: 'ipc_clean_v1',     // ุชุฏููู ุงูุชูุธูู ุงูุจูุฆู
    VAX: 'ipc_vax_v1',         // ููุงุญุงุช ุงูุนุงูููู ุงูุตุญููู
    ISOL: 'ipc_isol_v1'        // ุชุฏููู ุงูุนุฒู
  };

  async function ipcSaveRecord(key, record) {
    const currentRaw = localStorage.getItem(key);
    let arr = [];
    if (currentRaw) {
      const parsed = await SecureStore.decryptJson(currentRaw);
      if (Array.isArray(parsed)) arr = parsed;
    }
    arr.push({ ...record, _ts: new Date().toISOString() });
    const payload = await SecureStore.encryptJson(arr);
    localStorage.setItem(key, typeof payload === 'object' ? payload.data : payload);
  }

  async function ipcLoadAll(key) {
    const raw = localStorage.getItem(key);
    if (!raw) return [];
    const parsed = await SecureStore.decryptJson(raw);
    return Array.isArray(parsed) ? parsed : [];
  }

  function exportCsv(arr, filename) {
    if (!arr || arr.length === 0) {
      alert('ูุง ุชูุฌุฏ ุจูุงูุงุช ูุชุตุฏูุฑูุง.');
      return;
    }
    const cols = Object.keys(arr[0]);
    const csv = [cols.join(',')].concat(arr.map(o => cols.map(c => (`"${(o[c]??'')}".replace(/"/g,'""')`).replace(/^"|"$/g,'"')).join(','))).join('\n');
    const blob = new Blob([csv], {type:'text/csv;charset=utf-8'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    link.remove();
  }

  async function ipcExportAll() {
    const data = {
      hh: await ipcLoadAll(IPC_KEYS.HH),
      ster: await ipcLoadAll(IPC_KEYS.STER),
      clean: await ipcLoadAll(IPC_KEYS.CLEAN),
      vax: await ipcLoadAll(IPC_KEYS.VAX),
      isol: await ipcLoadAll(IPC_KEYS.ISOL)
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ipc_data_backup.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function ipcImportAll(file) {
    const reader = new FileReader();
    reader.onload = async (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.hh) localStorage.setItem(IPC_KEYS.HH, (await SecureStore.encryptJson(data.hh)).data);
        if (data.ster) localStorage.setItem(IPC_KEYS.STER, (await SecureStore.encryptJson(data.ster)).data);
        if (data.clean) localStorage.setItem(IPC_KEYS.CLEAN, (await SecureStore.encryptJson(data.clean)).data);
        if (data.vax) localStorage.setItem(IPC_KEYS.VAX, (await SecureStore.encryptJson(data.vax)).data);
        if (data.isol) localStorage.setItem(IPC_KEYS.ISOL, (await SecureStore.encryptJson(data.isol)).data);
        alert('โ ุชู ุงูุงุณุชูุฑุงุฏ ุจูุฌุงุญ.');
      } catch (err) {
        alert('โ๏ธ ููู ุบูุฑ ุตุงูุญ.');
      }
    };
    reader.readAsText(file, 'utf-8');
  }

  function ipcShowSecurity() {
    const mode = SecureStore.isOn() ? 'on' : (localStorage.getItem('ipc_secure_mode') || 'off');
    const choice = prompt(`ุฅุนุฏุงุฏ ุงูุฃูุงู:\n- ุงููุถุน ุงูุญุงูู: ${mode === 'on' ? 'ููุนูู ุจุงูุชุดููุฑ' : 'ุบูุฑ ููุนูู'}\n\nุฃุฏุฎู ุฑูุฒ ูุฑูุฑ ุฌุฏูุฏ ูุชูุนูู/ุชุญุฏูุซ ุงูุชุดููุฑุ ุฃู ุงุชุฑูู ูุงุฑุบูุง ูุชุนุทูู ุงูุญูุงูุฉ:`);
    if (choice && choice.trim()) {
      SecureStore.setPassphrase(choice.trim()).then(() => alert('๐ ุชู ุชูุนูู/ุชุญุฏูุซ ุงูุญูุงูุฉ ุจุงูุชุดููุฑ ุนูู ูุฐุง ุงูุฌูุงุฒ ููุท.'));
    } else {
      SecureStore.clearPassphrase();
      alert('ุชู ุชุนุทูู ุงูุญูุงูุฉ. ุณูุชู ุงูุญูุธ ูุญูููุง ุจุฏูู ุชุดููุฑ.');
    }
  }

  function switchIpcTab(tab) {
    document.querySelectorAll('[data-ipc-tab]').forEach(button => {
      if (button.getAttribute('data-ipc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    const container = document.getElementById('ipcTabContent');
    container.innerHTML = '';
    if (tab === 'library') {
      renderIpcLibrary(container, IPC_DOCS_LIBRARY);
    } else if (tab === 'surveillance') {
      renderIpcSurveillance(container);
    } else if (tab === 'forms') {
      renderIpcForms(container);
    } else if (tab === 'needs') {
      renderIpcNeeds(container);
    }
  }

  function renderIpcLibrary(container, docs) {
    const categories = [...new Set(docs.map(d => d.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-ipc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => `<button data-ipc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${IPC_CATEGORY_NAMES[cat] || cat}</button>`).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="ipcSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    container.appendChild(controls);
    container.appendChild(grid);

    function renderFilteredDocs(filter='ALL', query='') {
      grid.innerHTML = '';
      const q = query.toLowerCase();
      const filtered = docs.filter(d => (filter==='ALL' || d.category===filter) && (!q || d.code.toLowerCase().includes(q) || d.name.toLowerCase().includes(q)));
      filtered.forEach(doc => {
        const hasUrl = doc.url && doc.url !== '#';
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${IPC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg ${hasUrl ? 'bg-[var(--brand1)] hover:bg-[var(--brand2)]' : 'bg-gray-300 cursor-not-allowed'}" ${hasUrl ? `onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')" `: 'disabled'}>
              <i class="fas fa-eye ml-1"></i> ${hasUrl ? 'ุนุฑุถ' : 'ุฃุถู ุงูุฑุงุจุท ูุงุญููุง'}
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50 ${hasUrl ? '' : 'pointer-events-none opacity-50'}" ${hasUrl ? `target="_blank" href="${doc.url.replace('/preview','/view')}"` : ''}>
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    controls.querySelectorAll('button[data-ipc-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        controls.querySelectorAll('button[data-ipc-filter]').forEach(b => b.classList.remove('bg-[var(--brand1)]','text-white'));
        btn.classList.add('bg-[var(--brand1)]','text-white');
        renderFilteredDocs(btn.getAttribute('data-ipc-filter'), document.getElementById('ipcSearch').value);
      });
    });
    controls.querySelector('#ipcSearch').addEventListener('input', e => {
      const active = controls.querySelector('button[data-ipc-filter].bg-[var(--brand1)]') || { getAttribute: ()=>'ALL' };
      renderFilteredDocs(active.getAttribute('data-ipc-filter'), e.target.value);
    });
    renderFilteredDocs('ALL','');
  }

  async function renderIpcSurveillance(container) {
    const [hh, ster, clean, vax, isol] = await Promise.all([
      ipcLoadAll(IPC_KEYS.HH),
      ipcLoadAll(IPC_KEYS.STER),
      ipcLoadAll(IPC_KEYS.CLEAN),
      ipcLoadAll(IPC_KEYS.VAX),
      ipcLoadAll(IPC_KEYS.ISOL)
    ]);

    function pct(n,d){ return d>0 ? Math.round((n/d)*100) : 0; }

    // ุญุณุงุจ ููุฎุต ุบุณู ุงููุฏูู
    const hhOpp = hh.reduce((s,x)=>s+(+x.opportunities||0),0);
    const hhComp = hh.reduce((s,x)=>s+(+x.compliant||0),0);
    const hhPct = pct(hhComp, hhOpp);

    // ููุฎุต ุงูุชุนููู (ูุณุจุฉ ูุชุงุฆุฌ Pass)
    const sterTotal = ster.length;
    const sterPass = ster.filter(x=>String(x.result||'').toLowerCase()==='pass' || x.result==='ูุฌุงุญ').length;
    const sterPct = pct(sterPass, sterTotal);

    // ููุฎุต ุงูุชูุธูู ุงูุจูุฆู (ูุชูุณุท ุงูุงูุชุซุงู)
    const cleanPct = clean.length ? Math.round(clean.reduce((s,x)=>s+(+x.compliance||0),0)/clean.length) : 0;

    // ููุฎุต ุงูููุงุญุงุช (ุนุฏุฏ ุงูุนุงูููู ุงููููุญูู)
    const vaxCount = vax.length;

    const isoAudits = isol.length;

    container.innerHTML = `
      <div class="grid md:grid-cols-2 gap-4">
        <div class="box p-4">
          <div class="text-sm text-gray-500 mb-1">ุบุณู ุงููุฏูู</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${hhPct}%</div>
          <div class="text-sm text-gray-600">ุงูุงูุชุซุงู = ${hhComp}/${hhOpp} ูุฑุตุฉ</div>
          <button class="mt-3 px-3 py-1.5 rounded border" onclick="exportCsv(${JSON.stringify(hh).replace('<','&lt;')}, 'ipc_hand_hygiene.csv')">ุชุตุฏูุฑ CSV</button>
        </div>
        <div class="box p-4">
          <div class="text-sm text-gray-500 mb-1">ูุฑุงูุจุฉ ุงูุชุนููู (BI/CI)</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${sterPct}%</div>
          <div class="text-sm text-gray-600">Pass = ${sterPass}/${sterTotal} ุฃุญูุงู</div>
          <button class="mt-3 px-3 py-1.5 rounded border" onclick="exportCsv(${JSON.stringify(ster).replace('<','&lt;')}, 'ipc_sterilization.csv')">ุชุตุฏูุฑ CSV</button>
        </div>
        <div class="box p-4">
          <div class="text-sm text-gray-500 mb-1">ุงูุชูุธูู ุงูุจูุฆู</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${cleanPct}%</div>
          <div class="text-sm text-gray-600">ูุชูุณุท ุงูุงูุชุซุงู ูู ุขุฎุฑ ${clean.length} ุชุฏููู</div>
          <button class="mt-3 px-3 py-1.5 rounded border" onclick="exportCsv(${JSON.stringify(clean).replace('<','&lt;')}, 'ipc_environmental_cleaning.csv')">ุชุตุฏูุฑ CSV</button>
        </div>
        <div class="box p-4">
          <div class="text-sm text-gray-500 mb-1">ููุงุญุงุช ุงูุนุงูููู ุงูุตุญููู</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${vaxCount}</div>
          <div class="text-sm text-gray-600">ุฅุฌูุงูู ุณุฌูุงุช ุงูุฌุฑุนุงุช ุงููุฏุฎูุฉ</div>
          <button class="mt-3 px-3 py-1.5 rounded border" onclick="exportCsv(${JSON.stringify(vax).replace('<','&lt;')}, 'ipc_vaccinations.csv')">ุชุตุฏูุฑ CSV</button>
        </div>
        <div class="box p-4 md:col-span-2">
          <div class="text-sm text-gray-500 mb-1">ุชุฏููู ุงูุนุฒู</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${isoAudits}</div>
          <div class="text-sm text-gray-600">ุนุฏุฏ ุชุฏูููุงุช ุงูุนุฒู ุงููุณุฌูุฉ</div>
          <button class="mt-3 px-3 py-1.5 rounded border" onclick="exportCsv(${JSON.stringify(isol).replace('<','&lt;')}, 'ipc_isolation_audits.csv')">ุชุตุฏูุฑ CSV</button>
        </div>
      </div>
    `;
  }

  function renderIpcForms(container) {
    const wrapper = document.createElement('div');
    wrapper.className = 'space-y-6';

    // 1) ูููุฐุฌ ุชุฏููู ุบุณู ุงููุฏูู
    const hh = document.createElement('div');
    hh.className = 'border rounded-xl p-4 bg-white';
    hh.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-2">โ ุชุฏููู ุบุณู ุงููุฏูู</h3>
      <form id="ipcHhForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div><label class="block text-sm font-semibold mb-1">ุงููุฑุงูุจ *</label><input name="observer" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุฑุงูุจ"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงููููุน *</label><input name="location" required class="w-full border rounded-lg px-3 py-2" placeholder="ุนูุงุฏุฉ / ุบุฑูุฉ"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label><input type="date" name="date" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ุนุฏุฏ ุงููุฑุต *</label><input type="number" name="opportunities" min="1" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ุนุฏุฏ ุงูุงูุชุฒุงู *</label><input type="number" name="compliant" min="0" required class="w-full border rounded-lg px-3 py-2"></div>
        <div class="md:col-span-3 flex items-center gap-3 pt-2">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ</button>
          <span id="ipcHhMsg" class="text-sm"></span>
        </div>
      </form>
      <div class="mt-3 overflow-auto"><table id="ipcHhTable" class="table text-sm"></table></div>
    `;
    wrapper.appendChild(hh);

    // 2) ูููุฐุฌ ูุฑุงูุจุฉ ุงูุชุนููู
    const ster = document.createElement('div');
    ster.className = 'border rounded-xl p-4 bg-white';
    ster.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-2">๐งช ูุฑุงูุจุฉ ุงูุชุนููู ูุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ (BI/CI)</h3>
      <form id="ipcSterForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div><label class="block text-sm font-semibold mb-1">ุฑูู ุงูุญูู *</label><input name="load_id" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: L-2025-001"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label><input type="date" name="date" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูููุน *</label>
          <select name="type" class="w-full border rounded-lg px-3 py-2">
            <option>BI</option><option>CI</option>
          </select>
        </div>
        <div><label class="block text-sm font-semibold mb-1">ุงููุชูุฌุฉ *</label>
          <select name="result" class="w-full border rounded-lg px-3 py-2">
            <option>Pass</option><option>Fail</option><option>ูุฌุงุญ</option><option>ูุดู</option>
          </select>
        </div>
        <div class="md:col-span-4"><label class="block text-sm font-semibold mb-1">ููุงุญุธุงุช</label><input name="notes" class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฎุชูุงุฑู"></div>
        <div class="md:col-span-4 flex items-center gap-3 pt-2">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ</button>
          <span id="ipcSterMsg" class="text-sm"></span>
        </div>
      </form>
      <div class="mt-3 overflow-auto"><table id="ipcSterTable" class="table text-sm"></table></div>
    `;
    wrapper.appendChild(ster);

    // 3) ูููุฐุฌ ุชุฏููู ุงูุชูุธูู ุงูุจูุฆู
    const clean = document.createElement('div');
    clean.className = 'border rounded-xl p-4 bg-white';
    clean.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-2">๐งฝ ุชุฏููู ุงูุชูุธูู ุงูุจูุฆู</h3>
      <form id="ipcCleanForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div><label class="block text-sm font-semibold mb-1">ุงููููุน *</label><input name="location" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุณู/ููุทูุฉ"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label><input type="date" name="date" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">% ุงูุงูุชุซุงู *</label><input type="number" name="compliance" min="0" max="100" required class="w-full border rounded-lg px-3 py-2" placeholder="0-100"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูููุฏูู *</label><input name="auditor" required class="w-full border rounded-lg px-3 py-2"></div>
        <div class="md:col-span-4"><label class="block text-sm font-semibold mb-1">ููุงุญุธุงุช</label><input name="notes" class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฎุชูุงุฑู"></div>
        <div class="md:col-span-4 flex items-center gap-3 pt-2">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ</button>
          <span id="ipcCleanMsg" class="text-sm"></span>
        </div>
      </form>
      <div class="mt-3 overflow-auto"><table id="ipcCleanTable" class="table text-sm"></table></div>
    `;
    wrapper.appendChild(clean);

    // 4) ูููุฐุฌ ููุงุญุงุช ุงูุนุงูููู ุงูุตุญููู
    const vax = document.createElement('div');
    vax.className = 'border rounded-xl p-4 bg-white';
    vax.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-2">๐ ููุงุญุงุช ุงูุนุงูููู ุงูุตุญููู</h3>
      <form id="ipcVaxForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div><label class="block text-sm font-semibold mb-1">ุงูููุธู *</label><input name="staff" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุงุณู/ุงูุฑูู"></div>
        <div><label class="block text-sm font-semibold mb-1">ููุน ุงูููุงุญ *</label>
          <select name="vaccine" class="w-full border rounded-lg px-3 py-2">
            <option>Influenza</option><option>HepB</option><option>MMR</option><option>Varicella</option><option>COVID-19</option>
          </select>
        </div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label><input type="date" name="date" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุฌุฑุนุฉ</label><input name="dose" class="w-full border rounded-lg px-3 py-2" placeholder="ูุซุงู: 1/2/Booster"></div>
        <div class="md:col-span-4 flex items-center gap-3 pt-2">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ</button>
          <span id="ipcVaxMsg" class="text-sm"></span>
        </div>
      </form>
      <div class="mt-3 overflow-auto"><table id="ipcVaxTable" class="table text-sm"></table></div>
    `;
    wrapper.appendChild(vax);

    // 5) ูููุฐุฌ ุชุฏููู ุงูุนุฒู
    const isol = document.createElement('div');
    isol.className = 'border rounded-xl p-4 bg-white';
    isol.innerHTML = `
      <h3 class="text-xl font-bold text-[var(--brand1)] mb-2">๐ง ุชุฏููู ุงูุนุฒู</h3>
      <form id="ipcIsolForm" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div><label class="block text-sm font-semibold mb-1">ุงููููุน *</label><input name="location" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุชุงุฑูุฎ *</label><input type="date" name="date" required class="w-full border rounded-lg px-3 py-2"></div>
        <div><label class="block text-sm font-semibold mb-1">ููุน ุงูุนุฒู *</label><input name="isolation_type" required class="w-full border rounded-lg px-3 py-2" placeholder="ุชูุงูุณู/ูุทูุฑู/ููุงุฆู..."></div>
        <div><label class="block text-sm font-semibold mb-1">ุงูุงูุชุซุงู % *</label><input type="number" name="compliance" min="0" max="100" required class="w-full border rounded-lg px-3 py-2"></div>
        <div class="md:col-span-4"><label class="block text-sm font-semibold mb-1">ููุงุญุธุงุช</label><input name="notes" class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฎุชูุงุฑู"></div>
        <div class="md:col-span-4 flex items-center gap-3 pt-2">
          <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ</button>
          <span id="ipcIsolMsg" class="text-sm"></span>
        </div>
      </form>
      <div class="mt-3 overflow-auto"><table id="ipcIsolTable" class="table text-sm"></table></div>
    `;
    wrapper.appendChild(isol);

    container.appendChild(wrapper);

    // ุฑุจุท ุงูุฃุญุฏุงุซ + ุชุญููู ุงูุฌุฏุงูู
    const forms = [
      { id:'ipcHhForm', key: IPC_KEYS.HH, msg:'ipcHhMsg', table:'ipcHhTable', columns:[['date','ุงูุชุงุฑูุฎ'],['observer','ุงููุฑุงูุจ'],['location','ุงููููุน'],['opportunities','ุงููุฑุต'],['compliant','ุงูุงูุชุฒุงู'],['_ts','ุงูุฒูู']] },
      { id:'ipcSterForm', key: IPC_KEYS.STER, msg:'ipcSterMsg', table:'ipcSterTable', columns:[['date','ุงูุชุงุฑูุฎ'],['load_id','ุฑูู ุงูุญูู'],['type','ุงูููุน'],['result','ุงููุชูุฌุฉ'],['notes','ููุงุญุธุงุช'],['_ts','ุงูุฒูู']] },
      { id:'ipcCleanForm', key: IPC_KEYS.CLEAN, msg:'ipcCleanMsg', table:'ipcCleanTable', columns:[['date','ุงูุชุงุฑูุฎ'],['location','ุงููููุน'],['compliance','% ุงูุงูุชุซุงู'],['auditor','ุงููุฏูู'],['notes','ููุงุญุธุงุช'],['_ts','ุงูุฒูู']] },
      { id:'ipcVaxForm', key: IPC_KEYS.VAX, msg:'ipcVaxMsg', table:'ipcVaxTable', columns:[['date','ุงูุชุงุฑูุฎ'],['staff','ุงูููุธู'],['vaccine','ุงูููุงุญ'],['dose','ุงูุฌุฑุนุฉ'],['_ts','ุงูุฒูู']] },
      { id:'ipcIsolForm', key: IPC_KEYS.ISOL, msg:'ipcIsolMsg', table:'ipcIsolTable', columns:[['date','ุงูุชุงุฑูุฎ'],['location','ุงููููุน'],['isolation_type','ููุน ุงูุนุฒู'],['compliance','% ุงูุงูุชุซุงู'],['notes','ููุงุญุธุงุช'],['_ts','ุงูุฒูู']] },
    ];

    forms.forEach(def => {
      const form = document.getElementById(def.id);
      const msg = document.getElementById(def.msg);
      const table = document.getElementById(def.table);

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        msg.className = 'text-sm text-blue-600';
        const fd = new FormData(form);
        const record = {};
        fd.forEach((v,k)=>record[k]=v);
        try {
          await ipcSaveRecord(def.key, record);
          msg.textContent = 'โ ุชู ุงูุญูุธ ุนูู ูุฐุง ุงูุฌูุงุฒ.';
          msg.className = 'text-sm text-green-600';
          form.reset();
          renderTable();
        } catch (err) {
          console.error(err);
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ.';
          msg.className = 'text-sm text-red-600';
        }
      });

      async function renderTable() {
        const arr = await ipcLoadAll(def.key);
        const rows = arr.slice(-50).reverse(); // ุขุฎุฑ 50 ุณุฌู
        const thead = '<thead><tr>' + def.columns.map(c=>`<th>${c[1]}</th>`).join('') + '</tr></thead>';
        const tbody = '<tbody>' + rows.map(r=>'<tr>'+def.columns.map(c=>`<td>${(r[c[0]]??'')}</td>`).join('')+'</tr>').join('') + '</tbody>';
        table.innerHTML = thead + tbody;
      }
      renderTable();
    });
  }

  function renderIpcNeeds(container) {
    const needs = [
      { key:'committee', text:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ููุงูุญุฉ ุงูุนุฏูู (DEC-IPC-2025-001)', required:true },
      { key:'charter', text:'ููุซุงู ุงููุฌูุฉ (CHT-IPC-2025-001)', required:true },
      { key:'policy', text:'ุณูุงุณุฉ ุจุฑูุงูุฌ ููุงูุญุฉ ุงูุนุฏูู (POL-IPC-2025-001)', required:true },
      { key:'hh', text:'ุจุฑูุงูุฌ ุชุฏููู ุบุณู ุงููุฏูู ููุนูู ูุน ุชุญููู ุดูุฑู', required:true },
      { key:'ster', text:'ูุฑุงูุจุฉ ุงูุชุนููู ูุฅุนุงุฏุฉ ุงููุนุงูุฌุฉ ููุซูุฉ', required:true },
      { key:'clean', text:'ุชุฏูููุงุช ุงูุชูุธูู ุงูุจูุฆู ุฏูุฑูุฉ', required:true },
      { key:'oh', text:'ุจุฑูุงูุฌ ุงูุตุญุฉ ุงูููููุฉ (ูุง ุจุนุฏ ุงูุชุนุฑูุถ) ููุนู', required:true },
      { key:'training', text:'ุฎุทุฉ ุชุฏุฑูุจ IPC ุณูููุฉ ููุฏ ุงูุชูููุฐ', required:true },
    ];

    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    needs.forEach(n => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${n.required?1:0}">
          <span class="font-semibold">${n.text}</span>
        </label>
        ${n.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateIpcNeeds()">ุชุญููู ูู ุงูุงูุชูุงู</button>
    `;
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateIpcNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#ipcTabContent input[data-required="1"]')];
    const missing = requiredCheckboxes.filter(x => !x.checked).length;
    if (missing === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช IPC ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ููุฌุฏ ${missing} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ููุงูุญุฉ ุงูุนุฏูู.`);
    }
  }

  // ====== ุฏูุงู FMS ======
  const FMS_DOCS_LIBRARY = [
    { code:'POL-FMS-2025-001', name:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู', category:'POL', url:'https://drive.google.com/file/d/1YS1Jk5FgwJoY5in71yUQ1oIjE4JEsaecMGWTt00aQ0o/preview' },
    { code:'POL-FMS-2025-015', name:'ุณูุงุณุฉ ูุฑุงูุจุฉ ุฌูุฏุฉ ุงูููุงุก ูุงูุชูููุฉ', category:'POL', url:'https://drive.google.com/file/d/18caApXqHeQSZdBFSvgyIKICX0qMSsN7UuRxz3u7R10o/preview' },
    { code:'SOP-FMS-2025-002', name:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู ุงูููุงุณูุฉ ููุฌููุงุช ููุญุต ุงูุฃูุธูุฉ', category:'SOP', url:'https://drive.google.com/file/d/1mrKI8YTjSphAk-noRO8sp9GhYYLzR1FCBti2EDyDZOU/preview' },
    { code:'DEC-FMS-2025-001', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุงูุณูุงูุฉ', category:'DEC', url:'https://drive.google.com/file/d/1KJcIqUbXfHIH0qt1UwoJ0Dohc_7n-745rhx90shaqNg/preview' },
    { code:'PLN-FMS-2025-004', name:'ุฎุทุฉ ุงูุทูุงุฑุฆ ูุงูุฅุฎูุงุก', category:'PLN', url:'https://drive.google.com/file/d/1rPIuA5g52gQSroaaxznZ_SQNOj1TjEDuZ9DF0j3jvf4/preview' },
    { code:'PLN-FMS-2025-007', name:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูููุงูุงุช', category:'PLN', url:'https://drive.google.com/file/d/1iSoFBh8u4uTHzDJECxyjlEMeWqaScZwezgOXygEVdso/preview' },
    { code:'PLN-FMS-2025-012', name:'ุฎุทุฉ ุฅุฏุงุฑุฉ ุงูุทุงูุฉ ูุงูููุงู', category:'PLN', url:'https://drive.google.com/file/d/1b8oP_LOE_k7A0qXqhhVKWXF9zAvJMuSUOLFc1rBoflA/preview' },
    { code:'PLN-FMS-2025-016', name:'ุฎุทุฉ ุงูุตูุงูุฉ ุงูุทุงุฑุฆุฉ', category:'PLN', url:'https://drive.google.com/file/d/1tQYPW6VHtr1liM7qMoPGgzDxopw9njYivS7WyKxokZw/preview' },
    { code:'PLN-FMS-2025-018', name:'ุฎุทุฉ ุงูุฃูู ุงููุงุฏู ูููุฑุงูู', category:'PLN', url:'https://drive.google.com/file/d/1aF0KTinNcF3gMIotj_byzrAkubX6Y30nZWmVuFM7BcA/preview' },
    { code:'TRN-FMS-2025-010', name:'ุฎุทุฉ ุชุฏุฑูุจ ุงูุฃูู ูุงูุณูุงูุฉ', category:'TRN', url:'https://drive.google.com/file/d/1IwnBiZp11BjIDQLUtT5Ntr7kEhv3jmssvF5Vj6D7yRk/preview' },
    { code:'LOG-FMS-2025-005', name:'ุณุฌู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ', category:'LOG', url:'https://drive.google.com/file/d/10QjYYiAppgrOJpb6F2GxxwmRgRt2ooNOClo0etgzWpw/preview' },
    { code:'LOG-FMS-2025-006', name:'ุณุฌู ุงูุญูุงุฏุซ ูุงูููุงุญุธุงุช', category:'LOG', url:'https://drive.google.com/file/d/12D_ESZYNwjEfKZM6C0yzswbsccugSZZBOcMdHELd3TY/preview' },
    { code:'LOG-FMS-2025-014', name:'ุณุฌู ุฒูุงุฑุงุช ุงูุฏูุงุน ุงููุฏูู ูุงูุฌูุงุช ุงูุชูุธูููุฉ', category:'LOG', url:'https://drive.google.com/file/d/1VMNxaSlkz_LX4OqktVHQsj1IT-GA6Y3eUnZa2rgegMA/preview' },
    { code:'CHK-FMS-2025-003', name:'ูุงุฆูุฉ ุงูุชุญูู ุงูุฏูุฑูุฉ ููุณูุงูุฉ', category:'CHK', url:'https://drive.google.com/file/d/1C07oXDzj_Vfok81wQUde3P-ExeXhJh6LDwOS35jTDpk/preview' },
    { code:'CHK-FMS-2025-009', name:'ุณุฌู ุฌููุงุช ูุฌูุฉ ุงูุณูุงูุฉ', category:'CHK', url:'https://drive.google.com/file/d/1fKMIzns80N9IeSU18WudplOpA8DmbL4zmq72PRUmfZw/preview' },
    { code:'FRM-FMS-2025-011', name:'ูููุฐุฌ ุชูููู ุงููุฎุงุทุฑ ุงูุจูุฆูุฉ ูุงููุงุฏูุฉ', category:'FRM', url:'https://drive.google.com/file/d/15uefBzxMrX33-lBCHP3sZb_OZqoQ4hyiymQRnBrN_jo/preview' },
    { code:'FRM-FMS-2025-017', name:'ูููุฐุฌ ูุชุงุจุนุฉ ุชูููุฐ ุงูุชูุตูุงุช', category:'FRM', url:'https://drive.google.com/file/d/1Z7Bof_s4Dchx3G5tPzHAC77M4EDVGaxKVRlvJG_wMNY/preview' },
    { code:'REP-FMS-2025-008', name:'ุชูุฑูุฑ ูุญุต ุงูุทูุงูุงุช ูุฃูุธูุฉ ุงูุฅูุฐุงุฑ', category:'REP', url:'https://drive.google.com/file/d/1Doz1piFf3dnYXKYtWoV4ExjXG_gmgRLVXkP7ej0sw9E/preview' },
    { code:'REP-FMS-2025-013', name:'ุชูุฑูุฑ ุงูุญูุงุฏุซ ุงูุทุงุฑุฆุฉ', category:'REP', url:'https://drive.google.com/file/d/126D1IVGQpoCUxXZeNlob1fBD0LkXeNQdITDzL5OLXn0/preview' },
    { code:'FMS_Docs_2025_endorsed', name:'ููุฑุณ ูุซุงุฆู FMS ุงููุนุชูุฏุฉ 2025', category:'INDEX', url:'https://drive.google.com/file/d/1fTJG9dYRDsgBo0UFSKWlOIkVLkKCY0zO/preview' },
  ];

  const CATEGORY_NAMES = {
    POL:'ุงูุณูุงุณุงุช', 
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู', 
    DEC:'ุงููุฑุงุฑุงุช', 
    PLN:'ุงูุฎุทุท', 
    TRN:'ุงูุชุฏุฑูุจ', 
    LOG:'ุงูุณุฌูุงุช', 
    CHK:'ููุงุฆู ุงูุชุญูู', 
    FRM:'ุงูููุงุฐุฌ', 
    REP:'ุงูุชูุงุฑูุฑ', 
    INDEX:'ุงูููุฑุณ'
  };

  function switchFmsTab(tab) {
    // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูุชุจููุจ
    document.querySelectorAll('[data-fms-tab]').forEach(button => {
      if (button.getAttribute('data-fms-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('fmsTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderFmsLibrary(container, FMS_DOCS_LIBRARY);
    } else if (tab === 'rounds') {
      renderRoundsForm(container);
    } else if (tab === 'needs') {
      renderNeeds(container);
    }
  }

  function renderFmsLibrary(container, docs) {
    // ุนูุงุตุฑ ุงูุชุญูู
    const categories = [...new Set(docs.map(doc => doc.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => 
          `<button data-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${CATEGORY_NAMES[cat] || cat}</button>`
        ).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="fmsSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    grid.id = 'fmsGrid';
    
    container.appendChild(controls);
    container.appendChild(grid);
    
    // ุฏุงูุฉ ุงูุชุตููุฉ ูุงูุนุฑุถ
    function renderFilteredDocs(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredDocs = docs.filter(doc => {
        const matchesFilter = filter === 'ALL' || doc.category === filter;
        const matchesQuery = !searchQuery || 
          doc.code.toLowerCase().includes(searchQuery) || 
          doc.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredDocs.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${doc.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    controls.querySelectorAll('button[data-filter]').forEach(button => {
      button.addEventListener('click', () => {
        controls.querySelectorAll('button[data-filter]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderFilteredDocs(button.getAttribute('data-filter'), document.getElementById('fmsSearch').value);
      });
    });
    
    document.getElementById('fmsSearch').addEventListener('input', (e) => {
      const activeFilter = controls.querySelector('button[data-filter].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderFilteredDocs(activeFilter.getAttribute('data-filter'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderFilteredDocs('ALL', '');
  }

  function renderRoundsForm(container) {
    const form = document.createElement('form');
    form.id = 'roundsForm';
    form.className = 'space-y-4 p-4 border rounded-xl';
    form.innerHTML = `
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-semibold mb-1">ุงุณู ุงููุฑุงูุจ *</label>
          <input name="inspector" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฎุชุฑ/ุงูุชุจ ุงุณู ุงููุฑุงูุจ">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงููููุน/ุงููุณู *</label>
          <input name="location" required class="w-full border rounded-lg px-3 py-2" placeholder="ุนูุงุฏุฉ 5ุ ุงููุฏุฎู ุงูุฑุฆูุณู...">
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1">ุงูุฃููููุฉ *</label>
          <select name="priority" class="w-full border rounded-lg px-3 py-2">
            <option>๐ด ุนุงููุฉ (ุฅุฌุฑุงุก ููุฑู)</option>
            <option selected>๐ก ูุชูุณุทุฉ (ุฎูุงู ุฃุณุจูุน)</option>
            <option>๐ข ููุฎูุถุฉ (ูุฌุฏูู)</option>
          </select>
        </div>
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1">ุงูููุงุญุธุฉ ูุงูุชูุตูุฉ *</label>
        <textarea name="observation" rows="4" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุฐูุฑ ุงูููุงุญุธุฉ ูุงูุฅุฌุฑุงุก ุงูููุชุฑุญ..."></textarea>
      </div>
      <div class="flex items-center gap-3">
        <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุฅุฑุณุงู</button>
        <a class="px-4 py-2 rounded-lg bg-[var(--gold)] text-[var(--brand1)] shadow hover:opacity-90" target="_blank"
           href="https://docs.google.com/spreadsheets/d/1cGxMCYqGfPH2UiE-nsCoytIRjIPSDYxutnq04XF5YGs/edit?gid=597653922">๐ ุนุฑุถ ุขุฎุฑ ุงูุฌููุงุช</a>
        <span id="formMsg" class="text-sm"></span>
      </div>
    `;
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const messageElement = document.getElementById('formMsg');
      messageElement.textContent = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';
      messageElement.className = 'text-sm text-blue-600';
      
      if (!FMS_API_URL || FMS_API_URL.includes('YOUR_GOOGLE_SCRIPT_WEB_APP_URL_HERE')) {
        messageElement.textContent = 'โ ุฑุฌุงุกู ุฃุถู ุฑุงุจุท Web App ุฃูููุง.';
        messageElement.className = 'text-sm text-red-600';
        return;
      }
      
      try {
        const response = await fetch(FMS_API_URL, {
          method: 'POST',
          body: new FormData(form)
        });
        
        if (response.ok) {
          messageElement.textContent = 'โ ุชู ุงูุฅุฑุณุงู ุจูุฌุงุญ.';
          messageElement.className = 'text-sm text-green-600';
          form.reset();
        } else {
          messageElement.textContent = 'โ๏ธ ุชุนุฐูุฑ ุงูุฅุฑุณุงู. ุชุญูู ูู ุตูุงุญูุงุช Web App.';
          messageElement.className = 'text-sm text-red-600';
        }
      } catch (error) {
        messageElement.textContent = 'โ๏ธ ุฎุทุฃ ุงุชุตุงู. ุงูุญุต ุงูุฑุงุจุท ุฃู ุงูุดุจูุฉ.';
        messageElement.className = 'text-sm text-red-600';
      }
    });
    
    container.appendChild(form);
  }

  function renderNeeds(container) {
    const needs = [
      { key: 'policy', text: 'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุณูุงูุฉ ูุงููุฑุงูู (POL-001) ูุนุชูุฏุฉ', required: true },
      { key: 'committee', text: 'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุงูุณูุงูุฉ (DEC-001) ูููุนูู', required: true },
      { key: 'emerg', text: 'ุฎุทุฉ ุงูุทูุงุฑุฆ ูุงูุฅุฎูุงุก (PLN-004) ููุญุฏูุซุฉ', required: true },
      { key: 'ppm', text: 'ุณุฌู ุงูุตูุงูุฉ ุงูููุงุฆูุฉ (LOG-005) ููุชูู', required: true },
      { key: 'training', text: 'ุชูููุฐ ุฎุทุฉ ุงูุชุฏุฑูุจ (TRN-010)', required: true },
    ];
    
    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    
    needs.forEach(need => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${need.required ? 1 : 0}">
          <span class="font-semibold">${need.text}</span>
        </label>
        ${need.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-2';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateNeeds()">
        ุชุญููู ูู ุงูุงูุชูุงู
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('input[data-required="1"]')];
    const missingCount = requiredCheckboxes.filter(checkbox => !checkbox.checked).length;
    
    if (missingCount === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ุงููุชุทูุจุงุช ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ุชูุจูู: ููุฌุฏ ${missingCount} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู.`);
    }
  }

  // ====== ููุชุจุฉ RM ======
  const RM_DOCS_ESSENTIAL = [
{ code:'LD.31', name:'ูุฑุงุฑ ุงุนุชูุงุฏ ุจุฑูุงูุฌ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ (LD.31)', category:'DEC', url:'https://drive.google.com/file/d/1TYH87_v6rC2twWOZig2P5YDegRv6ir2dlYEU-v6KXwg/preview' },
    { code:'LD.31/32', name:'ูุฑุงุฑ ุชุดููู ูุฌูุฉ ุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ ูุณูุงูุฉ ุงููุฑุถู', category:'DEC', url:'https://drive.google.com/file/d/1yN0wiHu-mmNqFHF5XeEQIqOeMElIFSXn-xCz1AzAfco/preview' },
    { code:'LD.32', name:'ูุฑุงุฑ ุฅุฏุงุฑู ุจุงุนุชูุงุฏ ุณูุงุณุฉ ุงูุฅุจูุงุบ ุนู ุงูุญูุงุฏุซ/ุงูุดูุงูู', category:'POL', url:'https://drive.google.com/file/d/1irNRM1ovqwQEaEEj5gv9rmAuoV8O5aY-m0hSNykZDUk/preview' },
    { code:'IR', name:'ูููุฐุฌ ุจูุงุบ ุญุงุฏุซ (Incident Report)', category:'FRM', url:'https://drive.google.com/file/d/1rFQjcCWP010zLNb4FfRtT1aTmrbY9fyjGcMeYIXSQqQ/preview' },
    { code:'NM', name:'ูููุฐุฌ ุจูุงุบ ูุฑูุจ ูู ุงููููุน (Near Miss)', category:'FRM', url:'https://drive.google.com/file/d/1DhGR9WtVrM2LxITiv8WBMSCKs407Kb-vUZXg0mZVwD0/preview' },
    { code:'UNSAFE', name:'ุจูุงุบ ุฎุทุฑ/ุดุฑุท ุบูุฑ ุขูู', category:'FRM', url:'https://drive.google.com/file/d/1Yw7CFRvzssAWU0JYFkNz1Z9o0fQoMKCqoqrRhEHWZ_I/preview' },
    { code:'DEVICE', name:'ุจูุงุบ ุนุทู ุฌูุงุฒ/ุชุฌููุฒ', category:'FRM', url:'https://drive.google.com/file/d/17tZnAvhWCvPbb5Bp3UymLxzEz-IciEjxV4Tn97tIWwQ/preview' },
    { code:'SE', name:'ุฅุฎุทุงุฑ ุญุฏุซ ุฌุณูู (Sentinel Event)', category:'FRM', url:'https://drive.google.com/file/d/1LrOlWxfECxyzF77DnerV15RjS-ElSTbIEa1UuKG3rD0/preview' },
    { code:'RCA/CAP', name:'ุชุญููู ุงูุณุจุจ ุงูุฌุฐุฑู ูุฎุทุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ', category:'TOOL', url:'https://drive.google.com/file/d/1lDKsjgPDCdwXNV935kB_DfAm-ZsdzLPK8p4Pn7hgJJ0/preview' },
    { code:'HFMEA', name:'HFMEA (ุชุญููู ูุณุจู ูููุฎุงุทุฑ)', category:'TOOL', url:'https://drive.google.com/file/d/15ZjKLJYhe3HCUWbAO2Iw96IY1GOn1VNCWIjzdi9U4x8/preview' },
    { code:'REGISTER', name:'ุณุฌู ุงููุฎุงุทุฑ ุงููุคุณุณู', category:'LOG', url:'https://drive.google.com/file/d/1XVMRWRZKoTpmXPzrPdXJA7PWf9r88YwLYv_tptdiZAA/preview' },
    { code:'KPI', name:'ููุญุฉ ุงููุคุดุฑุงุช ุงูุดูุฑูุฉ ูุฅุฏุงุฑุฉ ุงููุฎุงุทุฑ', category:'DASH', url:'https://drive.google.com/file/d/1pj8P8rf4TZj_wVKgLrO8ayP9WNUBc1yTWeAy8r0xGOY/preview' },
    { code:'ESCALATION', name:'ููุญุฉ ุงุชุตุงูุงุช ูุณูุณูุฉ ุงูุชุตุนูุฏ', category:'REF', url:'https://drive.google.com/file/d/1dZrkUB_d1XblN3QonWxPt9F1LQ6xQIbyNFT4ixI2m64/preview' },
  
    ,{ code:'LD.31-ALT', name:'LD31 (ูุณุฎุฉ ุฅุถุงููุฉ)', category:'DEC', url:'https://drive.google.com/file/d/1AEtBJgibYuSxVD_bSZgAlFgODnadZcDMTZaKle3pnYg/preview' }
    ,{ code:'LD.32-ALT', name:'LD32 (ูุณุฎุฉ ุฅุถุงููุฉ)', category:'POL', url:'https://drive.google.com/file/d/1x6R5DKODJ1MKghpPEnaR-1GIohAEILzmY6VNgAPgzAE/preview' }
    ,{ code:'ACT-RM-2025-001', name:'ุนุฑุถ ุงููุดุงูู ูุฎุทุฉ ุงูุญููู (Risk Issues & CAP)', category:'REP', url:'https://drive.google.com/file/d/1ZUBOoQgVbf41pcBxmU5iyoJzddd9e8JJDJ1Z2dekLfY/preview' }
    
];

  function renderRMLibrary() {
    const mount = document.getElementById('rmLib');
    if (!mount) return;
    
    mount.innerHTML = `
      <div class="flex flex-wrap items-center gap-2 mb-3">
        <button data-rm="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${[...new Set(RM_DOCS_ESSENTIAL.map(item => item.category))].map(cat => 
          `<button data-rm="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${cat}</button>`
        ).join('')}
        <div class="ml-auto w-full md:w-64">
          <input id="rmSearch" type="text" placeholder="ุจุญุซ..." class="w-full border rounded-lg px-3 py-2">
        </div>
      </div>
      <div id="rmGrid" class="grid-cards"></div>
    `;
    
    const grid = mount.querySelector('#rmGrid');
    
    function renderRMItems(filter = 'ALL', query = '') {
      grid.innerHTML = '';
      const searchQuery = query.toLowerCase();
      
      const filteredItems = RM_DOCS_ESSENTIAL.filter(item => {
        const matchesFilter = filter === 'ALL' || item.category === filter;
        const matchesQuery = !searchQuery || 
          item.code.toLowerCase().includes(searchQuery) || 
          item.name.toLowerCase().includes(searchQuery);
        return matchesFilter && matchesQuery;
      });
      
      filteredItems.forEach(item => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${item.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${item.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${item.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" 
                    onclick="openDocModal('${item.code}: ${item.name}', '${item.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" 
               target="_blank" href="${item.url.replace('/preview', '/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }
    
    // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ
    mount.querySelectorAll('button[data-rm]').forEach(button => {
      button.addEventListener('click', () => {
        mount.querySelectorAll('button[data-rm]').forEach(btn => {
          btn.classList.remove('bg-[var(--brand1)]', 'text-white');
        });
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        renderRMItems(button.getAttribute('data-rm'), mount.querySelector('#rmSearch').value || '');
      });
    });
    
    mount.querySelector('#rmSearch').addEventListener('input', (e) => {
      const activeFilter = mount.querySelector('button[data-rm].bg-[var(--brand1)]') || 
                          { getAttribute: () => 'ALL' };
      renderRMItems(activeFilter.getAttribute('data-rm'), e.target.value);
    });
    
    // ุงูุชููุฆุฉ ุงูุฃูููุฉ
    renderRMItems('ALL', '');
  }

  // ====== ุชููุฆุฉ ุงูุตูุญุฉ ======
  document.addEventListener('DOMContentLoaded', () => {
    // ุชููุฆุฉ ุฅุฏุงุฑุฉ ุงูุดุนุงุฑ
    setupLogoChange();
    loadSavedLogo();
    
    // ุชููุฆุฉ ููุชุจุฉ RM
    renderRMLibrary();
    
    // ุฒุฑ ุงูุนูุฏุฉ ููุฃุนูู
    window.addEventListener('scroll', () => {
      const scrollButton = document.getElementById('scrollTopBtn');
      if (scrollButton) {
        scrollButton.style.display = window.scrollY > 220 ? 'grid' : 'none';
      }
    });
    
    // ูููุฐุฌ ุงูุชุฏุฑูุจ
    const trainForm = document.getElementById('trainForm');
    if (trainForm) {
      trainForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const messageElement = document.getElementById('trainMsg');
        messageElement.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        messageElement.className = 'text-sm text-blue-600';
        
        if (!TRAIN_API_URL || TRAIN_API_URL.includes('YOUR_GAS_TRAINING_WEB_APP_URL_HERE')) {
          messageElement.textContent = 'โ ุฃุถู ุฑุงุจุท ุณูุฑุจุช ุงูุชุฏุฑูุจ ูุงุญููุง.';
          messageElement.className = 'text-sm text-red-600';
          return;
        }
        
        try {
          const response = await fetch(TRAIN_API_URL, {
            method: 'POST',
            body: new FormData(trainForm)
          });
          
          if (response.ok) {
            messageElement.textContent = 'โ ุชู ุงูุญูุธ.';
            messageElement.className = 'text-sm text-green-600';
            trainForm.reset();
          } else {
            messageElement.textContent = 'โ๏ธ ุชุนุฐูุฑ ุงูุญูุธ. ุงูุญุต ุตูุงุญูุงุช ุงูุณูุฑุจุช.';
            messageElement.className = 'text-sm text-red-600';
          }
        } catch (error) {
          messageElement.textContent = 'โ๏ธ ุฎุทุฃ ุงุชุตุงู.';
          messageElement.className = 'text-sm text-red-600';
        }
      });
    }
  });

  // ุฌุนู ุงูุฏูุงู ูุชุงุญุฉ ุนุงููููุง
  window.navTo = navTo;
  window.openDocModal = openDocModal;
  window.closeDocModal = closeDocModal;
  window.switchFmsTab = switchFmsTab;
  window.switchPscTab = switchPscTab;
  window.validateNeeds = validateNeeds;
  window.renderPscChart = renderPscChart;
  window.validatePscNeeds = validatePscNeeds;
  window.generatePscReport = generatePscReport;
  // ====== ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI) โ ููุชุจุฉ + ููุงุฐุฌ ุจุฅุณูุงุฏ ูุญูู ======
  const QI_DOCS_LIBRARY = [
    { code:'QI_Package_Index', name:'ููุฑุณ ูุซุงุฆู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (QI)', category:'INDEX', url:'https://drive.google.com/file/d/11nHPWSHeMVDPhpmIIY1mQfr3xWBhyMeXQL4m8rCkFE4/preview' },
    { code:'LD.QI.FRM.004', name:'ูููุฐุฌ ุงูุฅุจูุงุบ ุนู ุญุงุฏุซ/ุญุฏุซ', category:'FRM', url:'https://drive.google.com/file/d/1mBTZexeL6dRFW-WiSqLoYTnYJakG3jiGrZTtvhgIzsk/preview' },
    { code:'LD.QI.AGN.001', name:'ูููุฐุฌ ุฌุฏูู ุฃุนูุงู ุงุฌุชูุงุน ูุฌูุฉ ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/file/d/1Fz3V5L9JuP0gOGvdLcPRMIZWNBo_WjpvAhrpOxM4zko/preview' },
    { code:'LD.QI.FRM.002', name:'ูููุฐุฌ ูุดุฑูุน ุชุญุณูู โ PDSA', category:'FRM', url:'https://drive.google.com/file/d/13w_V3iUq74n0xBJ3Rzh9uhPZs8cNY4MmGN528tO0eus/preview' },
    { code:'LD.QI.SOP.003', name:'ุฅุฌุฑุงุก ููุงุณ ูุคุดุฑุงุช ุงูุฃุฏุงุก ูููุญุฉ ุงููุชุงุจุนุฉ', category:'SOP', url:'https://drive.google.com/file/d/1lu-IQSVouIX0PO3TWSHbGSvcOU41XcZpZZr8TyCkh_0/preview' },
    { code:'LD.QI.POL.001', name:'ุณูุงุณุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ', category:'POL', url:'https://drive.google.com/file/d/1Bef5OQKyeY707CBjpXgLZgvCDUHwn36XLMvOmkpHHEk/preview' },
    { code:'LD.QI.SOP.001', name:'ุฅุฌุฑุงุก ุฅุฏุงุฑุฉ ุงุฌุชูุงุนุงุช ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู', category:'SOP', url:'https://drive.google.com/file/d/1eQhsEZ5PoKTJtwbYevkXblDhnpDV_-9vKdbLq1qPxOc/preview' },
    { code:'LD.QI.MIN.001', name:'ูููุฐุฌ ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุงูุฌูุฏุฉ', category:'FRM', url:'https://drive.google.com/file/d/1psbjSnOnk-W8CowyvRCFo5psR9Wxt7x9dOKcR6xm_zs/preview' },
    { code:'LD.QI.SOP.002', name:'ุฅุฌุฑุงุก ุงุฎุชูุงุฑ ูุชูููุฐ ูุดุงุฑูุน ุงูุชุญุณูู (PDSA)', category:'SOP', url:'https://drive.google.com/file/d/1i8P4re1TT8PnGyA0ElTvmloEMnkz5LPwnGqBC90ds9w/preview' },
    { code:'LD.QI.PLN.001', name:'ุงูุฎุทุฉ ุงูุณูููุฉ ููุฌูุฏุฉ ูุงูุชุญุณูู', category:'PLN', url:'https://drive.google.com/file/d/1GZg0RwBCbP-eM2SK35_eQtXR67miAnFJtoF39NhvC4I/preview' },
    { code:'LD.QI.AUD.001', name:'ุฎุทุฉ/ุณุฌู ุงูุชุฏููู ุงูุฏุงุฎูู', category:'LOG', url:'https://drive.google.com/file/d/1pg3m4jBax8plRxY-jlwMhc9skIopkhdy4h1DYEfKmSI/preview' },
    { code:'LD.QI.FRM.003', name:'ุณุฌู ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ ูุงูููุงุฆูุฉ (CAPA)', category:'LOG', url:'https://drive.google.com/file/d/13PdXpCyaXb62NRXffoinW3EkLj7mltPUf4m6OWNaPeY/preview' },
    { code:'LD.QI.FRM.001', name:'ุจุทุงูุฉ ุชุนุฑูู ูุคุดุฑ ุฃุฏุงุก (KPI)', category:'FRM', url:'https://drive.google.com/file/d/1C6Dx0M7E7Z4PME0guCOIDZGmImciMclkL0dBS7KyJtA/preview' },
    { code:'LD.QI.SOP.004', name:'ุฅุฌุฑุงุก ุงูุชุฏููู ุงูุฏุงุฎูู ูุฅุฏุงุฑุฉ CAPA', category:'SOP', url:'https://drive.google.com/file/d/1v1pFDX2Yo7To9oCTVaIgVQfF83xNZu64K0BxmEAchTs/preview' },
    { code:'LD.QI.TOR.001', name:'ูุงุฆุญุฉ/ููุซุงู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ', category:'TOR', url:'https://drive.google.com/file/d/1obups6Wt5ERePM5qzmzQQhYZn_CTxHbGRUBMWE2jpaM/preview' }
  ];

  const QI_CATEGORY_NAMES = {
    POL:'ุงูุณูุงุณุงุช',
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู',
    FRM:'ุงูููุงุฐุฌ',
    PLN:'ุงูุฎุทุท',
    LOG:'ุงูุณุฌูุงุช',
    TOR:'ุงูููุซุงู',
    INDEX:'ุงูููุฑุณ'
  };

  // ููุงุชูุญ ุงูุชุฎุฒูู ูุจูุงูุงุช QI
  const QI_KEYS = {
    KPI: 'qi_kpi_v1',
    PDSA: 'qi_pdsa_v1',
    CAPA: 'qi_capa_v1',
    MEETING: 'qi_meeting_v1',
    AUDIT: 'qi_audit_v1'
  };

  // ุฏูุงู QI
  function switchQiTab(tab) {
    document.querySelectorAll('[data-qi-tab]').forEach(button => {
      if (button.getAttribute('data-qi-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('qiTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderQiLibrary(container, QI_DOCS_LIBRARY);
    } else if (tab === 'dashboard') {
      renderQiDashboard(container);
    } else if (tab === 'projects') {
      renderQiProjects(container);
    } else if (tab === 'needs') {
      renderQiNeeds(container);
    }
  }

  function renderQiLibrary(container, docs) {
    const categories = [...new Set(docs.map(d => d.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-qi-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => `<button data-qi-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${QI_CATEGORY_NAMES[cat] || cat}</button>`).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="qiSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    container.appendChild(controls);
    container.appendChild(grid);

    function renderFilteredDocs(filter='ALL', query='') {
      grid.innerHTML = '';
      const q = query.toLowerCase();
      const filtered = docs.filter(d => (filter==='ALL' || d.category===filter) && (!q || d.code.toLowerCase().includes(q) || d.name.toLowerCase().includes(q)));
      filtered.forEach(doc => {
        const hasUrl = doc.url && doc.url !== '#';
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${QI_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" target="_blank" href="${doc.url.replace('/preview','/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    controls.querySelectorAll('button[data-qi-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        controls.querySelectorAll('button[data-qi-filter]').forEach(b => b.classList.remove('bg-[var(--brand1)]','text-white'));
        btn.classList.add('bg-[var(--brand1)]','text-white');
        renderFilteredDocs(btn.getAttribute('data-qi-filter'), document.getElementById('qiSearch').value);
      });
    });
    document.getElementById('qiSearch').addEventListener('input', e => {
      const active = controls.querySelector('button[data-qi-filter].bg-[var(--brand1)]') || { getAttribute: ()=>'ALL' };
      renderFilteredDocs(active.getAttribute('data-qi-filter'), e.target.value);
    });
    renderFilteredDocs('ALL','');
  }

  async function renderQiDashboard(container) {
    const [kpi, pdsa, capa] = await Promise.all([
      ipcLoadAll(QI_KEYS.KPI),
      ipcLoadAll(QI_KEYS.PDSA),
      ipcLoadAll(QI_KEYS.CAPA)
    ]);

    // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
    const activeProjects = pdsa.filter(p => p.status === 'ูุดุท').length;
    const completedProjects = pdsa.filter(p => p.status === 'ููุชูู').length;
    const openCAPA = capa.filter(c => c.status === 'ููุชูุญ').length;
    const closedCAPA = capa.filter(c => c.status === 'ูุบูู').length;

    container.innerHTML = `
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="box p-4 text-center">
          <div class="text-sm text-gray-500 mb-1">ูุดุงุฑูุน ุงูุชุญุณูู ุงููุดุทุฉ</div>
          <div class="text-3xl font-extrabold text-[var(--brand1)]">${activeProjects}</div>
        </div>
        <div class="box p-4 text-center">
          <div class="text-sm text-gray-500 mb-1">ุงููุดุงุฑูุน ุงูููุชููุฉ</div>
          <div class="text-3xl font-extrabold text-green-600">${completedProjects}</div>
        </div>
        <div class="box p-4 text-center">
          <div class="text-sm text-gray-500 mb-1">ุฅุฌุฑุงุกุงุช CAPA ุงูููุชูุญุฉ</div>
          <div class="text-3xl font-extrabold text-orange-600">${openCAPA}</div>
        </div>
        <div class="box p-4 text-center">
          <div class="text-sm text-gray-500 mb-1">ุฅุฌุฑุงุกุงุช CAPA ุงููุบููุฉ</div>
          <div class="text-3xl font-extrabold text-green-600">${closedCAPA}</div>
        </div>
      </div>

      <div class="grid md:grid-cols-2 gap-6">
        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">โ ุชุณุฌูู ูุคุดุฑ ุฃุฏุงุก ุฌุฏูุฏ</h3>
          <form id="qiKpiForm" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="name" required class="border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุคุดุฑ">
              <input name="target" required class="border rounded-lg px-3 py-2" placeholder="ุงููุฏู %">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="current" required class="border rounded-lg px-3 py-2" placeholder="ุงููููุฉ ุงูุญุงููุฉ %">
              <input name="period" required class="border rounded-lg px-3 py-2" placeholder="ุงููุชุฑุฉ (ุดูุฑ/ุฑุจุน ุณููู)">
            </div>
            <div class="flex gap-3">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงููุคุดุฑ</button>
              <span id="qiKpiMsg" class="text-sm"></span>
            </div>
          </form>
        </div>

        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐ ูุคุดุฑุงุช ุงูุฃุฏุงุก ุงูุญุงููุฉ</h3>
          <div class="overflow-auto">
            <table class="table text-sm">
              <thead>
                <tr>
                  <th>ุงููุคุดุฑ</th>
                  <th>ุงููููุฉ</th>
                  <th>ุงููุฏู</th>
                  <th>ุงูุญุงูุฉ</th>
                </tr>
              </thead>
              <tbody id="qiKpiTable">
                ${kpi.slice(-5).reverse().map(item => `
                  <tr>
                    <td>${item.name}</td>
                    <td>${item.current}%</td>
                    <td>${item.target}%</td>
                    <td><span class="chip ${item.current >= item.target ? 'good' : 'warning'}">${item.current >= item.target ? 'ูุญูู' : 'ุชุญุช ุงููุฏู'}</span></td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    `;

    // ูุนุงูุฌุฉ ูููุฐุฌ ูุคุดุฑุงุช ุงูุฃุฏุงุก
    const kpiForm = document.getElementById('qiKpiForm');
    if (kpiForm) {
      kpiForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('qiKpiMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        msg.className = 'text-sm text-blue-600';
        
        const fd = new FormData(kpiForm);
        const record = {};
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(QI_KEYS.KPI, record);
          msg.textContent = 'โ ุชู ุญูุธ ุงููุคุดุฑ';
          msg.className = 'text-sm text-green-600';
          kpiForm.reset();
          renderQiDashboard(container); // ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }
  }

  function renderQiProjects(container) {
    container.innerHTML = `
      <div class="grid md:grid-cols-2 gap-6">
        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐ ุจุฏุก ูุดุฑูุน ุชุญุณูู ุฌุฏูุฏ (PDSA)</h3>
          <form id="qiPdsaForm" class="space-y-3">
            <input name="title" required class="w-full border rounded-lg px-3 py-2" placeholder="ุนููุงู ุงููุดุฑูุน">
            <textarea name="description" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder="ูุตู ุงููุดุฑูุน"></textarea>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="owner" required class="border rounded-lg px-3 py-2" placeholder="ูุงูู ุงููุดุฑูุน">
              <select name="priority" class="border rounded-lg px-3 py-2">
                <option value="ุนุงูู">ุนุงูู</option>
                <option value="ูุชูุณุท" selected>ูุชูุณุท</option>
                <option value="ููุฎูุถ">ููุฎูุถ</option>
              </select>
            </div>
            <div class="flex gap-3">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุจุฏุก ุงููุดุฑูุน</button>
              <span id="qiPdsaMsg" class="text-sm"></span>
            </div>
          </form>
        </div>

        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">โ ุชุณุฌูู ุฅุฌุฑุงุก ุชุตุญูุญู (CAPA)</h3>
          <form id="qiCapaForm" class="space-y-3">
            <input name="issue" required class="w-full border rounded-lg px-3 py-2" placeholder="ูุตู ุงููุดููุฉ">
            <textarea name="action" rows="2" class="w-full border rounded-lg px-3 py-2" placeholder="ุงูุฅุฌุฑุงุก ุงูุชุตุญูุญู"></textarea>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="responsible" required class="border rounded-lg px-3 py-2" placeholder="ุงููุณุคูู">
              <input type="date" name="deadline" required class="border rounded-lg px-3 py-2">
            </div>
            <div class="flex gap-3">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุชุณุฌูู CAPA</button>
              <span id="qiCapaMsg" class="text-sm"></span>
            </div>
          </form>
        </div>
      </div>
    `;

    // ูุนุงูุฌุฉ ูููุฐุฌ PDSA
    const pdsaForm = document.getElementById('qiPdsaForm');
    if (pdsaForm) {
      pdsaForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('qiPdsaMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        
        const fd = new FormData(pdsaForm);
        const record = { status: 'ูุดุท' };
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(QI_KEYS.PDSA, record);
          msg.textContent = 'โ ุชู ุจุฏุก ุงููุดุฑูุน';
          msg.className = 'text-sm text-green-600';
          pdsaForm.reset();
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }

    // ูุนุงูุฌุฉ ูููุฐุฌ CAPA
    const capaForm = document.getElementById('qiCapaForm');
    if (capaForm) {
      capaForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('qiCapaMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        
        const fd = new FormData(capaForm);
        const record = { status: 'ููุชูุญ' };
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(QI_KEYS.CAPA, record);
          msg.textContent = 'โ ุชู ุชุณุฌูู CAPA';
          msg.className = 'text-sm text-green-600';
          capaForm.reset();
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }
  }

  function renderQiNeeds(container) {
    const needs = [
      { key:'charter', text:'ููุซุงู ูุฌูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (LD.QI.TOR.001)', required:true },
      { key:'policy', text:'ุณูุงุณุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู ุงููุณุชูุฑ (LD.QI.POL.001)', required:true },
      { key:'plan', text:'ุงูุฎุทุฉ ุงูุณูููุฉ ููุฌูุฏุฉ ูุงูุชุญุณูู (LD.QI.PLN.001)', required:true },
      { key:'kpi', text:'ูุธุงู ูุชุงุจุนุฉ ูุคุดุฑุงุช ุงูุฃุฏุงุก ููุนู', required:true },
      { key:'pdsa', text:'ุชูููุฐ ูุดุงุฑูุน ุชุญุณูู ุจุงุณุชุฎุฏุงู PDSA', required:true },
      { key:'capa', text:'ูุธุงู ุฅุฏุงุฑุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ ูุงูููุงุฆูุฉ (CAPA)', required:true },
      { key:'audit', text:'ุจุฑูุงูุฌ ุงูุชุฏููู ุงูุฏุงุฎูู ููุนู', required:true },
      { key:'meetings', text:'ูุญุงุถุฑ ุงุฌุชูุงุนุงุช ุงููุฌูุฉ ูุณุฌูุฉ ูููุธูุฉ', required:true },
    ];

    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    needs.forEach(n => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${n.required?1:0}">
          <span class="font-semibold">${n.text}</span>
        </label>
        ${n.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateQiNeeds()">ุชุญููู ูู ุงูุงูุชูุงู</button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generateQiReport()">ุฅูุดุงุก ุชูุฑูุฑ ุงูุฌุงูุฒูุฉ</button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateQiNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#qiTabContent input[data-required="1"]')];
    const missing = requiredCheckboxes.filter(x => !x.checked).length;
    if (missing === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุงูุฌูุฏุฉ ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ููุฌุฏ ${missing} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุงูุฌูุฏุฉ.`);
    }
  }

  function generateQiReport() {
    const checkboxes = [...document.querySelectorAll('#qiTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(cb => cb.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุฌุงูุฒูุฉ ุงูุฌูุฏุฉ ูุงูุชุญุณูู:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

  async function qiExportAll() {
    const data = {
      kpi: await ipcLoadAll(QI_KEYS.KPI),
      pdsa: await ipcLoadAll(QI_KEYS.PDSA),
      capa: await ipcLoadAll(QI_KEYS.CAPA),
      meeting: await ipcLoadAll(QI_KEYS.MEETING),
      audit: await ipcLoadAll(QI_KEYS.AUDIT)
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'qi_data_backup.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function qiImportAll(file) {
    const reader = new FileReader();
    reader.onload = async (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.kpi) localStorage.setItem(QI_KEYS.KPI, (await SecureStore.encryptJson(data.kpi)).data);
        if (data.pdsa) localStorage.setItem(QI_KEYS.PDSA, (await SecureStore.encryptJson(data.pdsa)).data);
        if (data.capa) localStorage.setItem(QI_KEYS.CAPA, (await SecureStore.encryptJson(data.capa)).data);
        if (data.meeting) localStorage.setItem(QI_KEYS.MEETING, (await SecureStore.encryptJson(data.meeting)).data);
        if (data.audit) localStorage.setItem(QI_KEYS.AUDIT, (await SecureStore.encryptJson(data.audit)).data);
        alert('โ ุชู ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุฌูุฏุฉ ุจูุฌุงุญ.');
      } catch (err) {
        alert('โ๏ธ ููู ุบูุฑ ุตุงูุญ.');
      }
    };
    reader.readAsText(file, 'utf-8');
  }
  // ====== ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC) โ ููุชุจุฉ + ููุงุฐุฌ ุจุฅุณูุงุฏ ูุญูู ======
  const EOC_DOCS_LIBRARY = [
    { code:'EOC-Index-2025-001', name:'ููุฑุณ ูุซุงุฆู ุงูุญุฒูุฉ', category:'INDEX', url:'https://drive.google.com/file/d/12fiFYU5EeMzUv4UI11k2aIYoIuWPr-B2fmW1caIfXlY/preview' },
    { code:'Readme-2025', name:'ุชุนูููุงุช ุงูุงุนุชูุงุฏ ูุงูุญูุธ', category:'GUIDE', url:'https://drive.google.com/file/d/1WkN1gTWJc_l1xJgOh--uq7MpQVGw-SlH_wA8XpdakdU/preview' },
    { code:'References-2025', name:'ูุฑุงุฌุน ูุฑูุงุจุท', category:'REF', url:'https://drive.google.com/file/d/12plKBVOYvBfp6Kp8PX5NCC-iRuZdHU8xIuZLBFZxnLA/preview' },
    { code:'EOC-POL-2025-001', name:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'POL', url:'https://drive.google.com/file/d/18IjABxZrfWdqs3ogcHJMRcXLC3LdYeLoOCG1DmPUnHk/preview' },
    { code:'EOC-TOR-2025-001', name:'ููุซุงู ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'TOR', url:'https://drive.google.com/file/d/1GabuSVynwTrZDo6xAWlZ-vySD2oAK1FR8YL6JYe8uLY/preview' },
    { code:'EOC-PLN-2025-001', name:'ุฎุทุฉ ุงูุทูุงุฑุฆ ุงูุดุงููุฉ (EOP)', category:'PLN', url:'https://drive.google.com/file/d/1rMusdz3AtFzMgOQaAg3c-7DnjwLNt79ilzUTSRRngT4/preview' },
    { code:'EOC-PLN-2025-002', name:'ุจุฑูุงูุฌ ุงูุชุฏุฑูุจ ูุงูุชูุงุฑูู', category:'PLN', url:'https://drive.google.com/file/d/1Y9nsgDQ1UXS60r3q5rhRBNkgE5EWW8dKsV9Vmvf3Dxw/preview' },
    { code:'EOC-PRO-2025-001', name:'ุขููุฉ ุชูููู ุงููุฎุงุทุฑ ุงูุณูููุฉ (HVA)', category:'PRO', url:'https://drive.google.com/file/d/1IpfxWVyfSadhmLoHS2hAYSPs8jRF7pBYuCKo3lyTNg4/preview' },
    { code:'EOC-SOP-2025-001', name:'ุชูุนูู ูุฅุฏุงุฑุฉ ุงูุญุงุฏุซ (ICS)', category:'SOP', url:'https://drive.google.com/file/d/1bjq5a9JSxCB_XVkzoKv-GSmTwzKJkAAEA3VjYgzZZwU/preview' },
    { code:'EOC-SOP-2025-002', name:'ุญุฑูู/ุฏุฎุงู (RACE/PASS)', category:'SOP', url:'https://drive.google.com/file/d/1VT17h68xnLmUSzvNOp4Brm79F9jyXBlTYFNSBewCQDo/preview' },
    { code:'EOC-SOP-2025-003', name:'ุงูุฅุฎูุงุก ูุงูุชุฌูุน ูุฅุนุงุฏุฉ ุงูุฏุฎูู', category:'SOP', url:'https://drive.google.com/file/d/1WX4T7VkA8G9s42YZE-g8tJ33Qmy-sDdYrGOTvzGbuYw/preview' },
    { code:'EOC-SOP-2025-004', name:'ุงููุทุงุน ุงูููุฑุจุงุก/ุงูุฃูุธูุฉ ุงูุญุฑุฌุฉ', category:'SOP', url:'https://drive.google.com/file/d/15Q6d_f8OvBbNmoArZtfzlg3PUeWVIHCcxMRqT4owQFI/preview' },
    { code:'EOC-SOP-2025-005', name:'ุชูุดูู ุฃูุฑุงุถ ูุนุฏูุฉ/ุฅูุฐุงุฑ ุตุญู', category:'SOP', url:'https://drive.google.com/file/d/1OqFbjCJ9uqTbQPJicNU3cFBR-SgeuHwRjYBuWtAjM4Q/preview' },
    { code:'EOC-SOP-2025-006', name:'ุญุงุฏุซ ุฌุณูู ุณุฑูุฑู ูุฅุฏุงุฑุฉ ูุง ุจุนุฏ ุงูุญุฏุซ (SPSC/RCA)', category:'SOP', url:'https://drive.google.com/file/d/1CHDPHSyer7Ruuy0NY_oByQ0ekU2ozGQttNw8lRimZRs/preview' },
    { code:'EOC-SOP-2025-007', name:'ุชุนุทู ุงูุงุชุตุงูุงุช ูุชูููุฉ ุงููุนูููุงุช/ุงูุจูุงูุงุช (PDPL)', category:'SOP', url:'https://drive.google.com/file/d/1p-OsanRRMfaw9a1KV500Z-lxvCZ8Ch91EFJ0Alptviw/preview' },
    { code:'EOC-LST-2025-001', name:'ููุญุฉ/ูุงุฆูุฉ ุงุชุตุงูุงุช ุงูุทูุงุฑุฆ', category:'LST', url:'https://drive.google.com/file/d/1sV8ABIFDAuUyo7vWaCPM5Y3hVtVTeK6AQhhUW0xuX1w/preview' },
    { code:'EOC-CHK-2025-001', name:'ูุงุฆูุฉ ูุญุต ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ', category:'CHK', url:'https://drive.google.com/file/d/1Kp1OjuPEfzEA0JE_FMnf-padRq_0-VJABf1w4eZM1m8/preview' },
    { code:'EOC-FRM-2025-001', name:'ูุญุถุฑ ุงุฌุชูุงุน ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ', category:'FRM', url:'https://drive.google.com/file/d/1SeopdYmHRU4CL--j054kA37WAwqCCc-lAQrlr_3PM74/preview' },
    { code:'EOC-FRM-2025-002', name:'ุณุฌู ุญุถูุฑ ูุชุฏุฑูุจ ุงูุทูุงุฑุฆ', category:'FRM', url:'https://drive.google.com/file/d/1pR3gpKB1nv-98Nnh7YG9na0SjHE8ssshqwjsljvcVTQ/preview' },
    { code:'EOC-FRM-2025-003', name:'ุชูููู ุชูุฑูู ุงูุฅุฎูุงุก/ุงูุญุฑูู (After-Action)', category:'FRM', url:'https://drive.google.com/file/d/1fqd2ZeGjqXWxuTXlg8VJZUw1ddphrglHU2uGWb-V2jg/preview' },
    { code:'EOC-FRM-2025-004', name:'ุฎุทุฉ ุงูุฅุฌุฑุงุกุงุช ุงูุชุตุญูุญูุฉ (CAPA Tracker)', category:'FRM', url:'https://drive.google.com/file/d/1y_-Uywr5VASlVMusD0NKFDdTHkFbExXdMyISSzYIh60/preview' },
    { code:'EOC-FRM-2025-005', name:'ุชูุฑูุฑ ุญุงุฏุซ ุทุงุฑุฆ/ูุง ุจุนุฏ ุงูุญุฏุซ', category:'FRM', url:'https://drive.google.com/file/d/1AyNMAdrJCalF9LqBmrdRh64W1gUrJpiQFN2yplFh5B8/preview' },
    { code:'EOC-FRM-2025-006', name:'ูููุฐุฌ HVA ูุชูููู ูุฎุงุทุฑ ุงูููุงุฑุซ', category:'FRM', url:'https://drive.google.com/file/d/1AbB5BL4d_pki3to9wn3169PZ-OJBfwCBEjYNApvStGM/preview' },
    { code:'EOC-FRM-2025-007', name:'ุณุฌู ุชูุงุฑูู ูุฅุฎูุงุกุงุช', category:'FRM', url:'https://drive.google.com/file/d/1y3Sjxlq39HTEQMHYpCGroil33nLaODFepJHfjYod9wY/preview' },
    { code:'EOC-FRM-2025-008', name:'ุณุฌู ูุนุฏุงุช ุงูุงุณุชุฌุงุจุฉ', category:'FRM', url:'https://drive.google.com/file/d/1Gxvm9A1CM1RPy3vTFDPxX5rsmlInqfeSid2YDe-ieGg/preview' },
    { code:'EOC-QIP-2025-001', name:'ูุธุงู ุงูุชุญุณูู ูุงููุชุงุจุนุฉ (CAPA)', category:'QIP', url:'https://drive.google.com/file/d/1JSa-E4YoJL8iYjvGVVioEpp_Wu5tKQopC_tfFo56sWo/preview' }
  ];

  const EOC_CATEGORY_NAMES = {
    POL:'ุงูุณูุงุณุงุช',
    SOP:'ุฅุฌุฑุงุกุงุช ุงูุชุดุบูู',
    FRM:'ุงูููุงุฐุฌ',
    PLN:'ุงูุฎุทุท',
    LST:'ุงูููุงุฆู',
    CHK:'ููุงุฆู ุงูุชุญูู',
    TOR:'ุงูููุซุงู',
    PRO:'ุงูุฅุฌุฑุงุกุงุช',
    QIP:'ุชุญุณูู ุงูุฌูุฏุฉ',
    REF:'ุงููุฑุงุฌุน',
    GUIDE:'ุงูุฏูุงุฆู',
    INDEX:'ุงูููุฑุณ'
  };

  // ููุงุชูุญ ุงูุชุฎุฒูู ูุจูุงูุงุช EOC
  const EOC_KEYS = {
    EXERCISES: 'eoc_exercises_v1',
    EQUIPMENT: 'eoc_equipment_v1',
    TRAINING: 'eoc_training_v1',
    READINESS: 'eoc_readiness_v1'
  };

  // ุฏูุงู EOC
  function switchEocTab(tab) {
    document.querySelectorAll('[data-eoc-tab]').forEach(button => {
      if (button.getAttribute('data-eoc-tab') === tab) {
        button.classList.add('bg-[var(--brand1)]', 'text-white');
        button.classList.remove('bg-gray-100');
      } else {
        button.classList.remove('bg-[var(--brand1)]', 'text-white');
        button.classList.add('bg-gray-100');
      }
    });
    
    const container = document.getElementById('eocTabContent');
    container.innerHTML = '';
    
    if (tab === 'library') {
      renderEocLibrary(container, EOC_DOCS_LIBRARY);
    } else if (tab === 'exercises') {
      renderEocExercises(container);
    } else if (tab === 'readiness') {
      renderEocReadiness(container);
    } else if (tab === 'needs') {
      renderEocNeeds(container);
    }
  }

  function renderEocLibrary(container, docs) {
    const categories = [...new Set(docs.map(d => d.category))];
    const controls = document.createElement('div');
    controls.className = 'flex flex-wrap items-center gap-2 mb-4';
    controls.innerHTML = `
      <div class="flex flex-wrap gap-2">
        <button data-eoc-filter="ALL" class="px-3 py-1 rounded-full bg-[var(--brand1)] text-white text-sm">ุงููู</button>
        ${categories.map(cat => `<button data-eoc-filter="${cat}" class="px-3 py-1 rounded-full bg-gray-200 hover:bg-gray-300 text-sm">${EOC_CATEGORY_NAMES[cat] || cat}</button>`).join('')}
      </div>
      <div class="ml-auto w-full md:w-64">
        <input id="eocSearch" type="text" placeholder="ุงุจุญุซ ุจุงูุฑูุฒ ุฃู ุงูุนููุงู..." class="w-full border rounded-lg px-3 py-2">
      </div>
    `;
    const grid = document.createElement('div');
    grid.className = 'grid-cards';
    container.appendChild(controls);
    container.appendChild(grid);

    function renderFilteredDocs(filter='ALL', query='') {
      grid.innerHTML = '';
      const q = query.toLowerCase();
      const filtered = docs.filter(d => (filter==='ALL' || d.category===filter) && (!q || d.code.toLowerCase().includes(q) || d.name.toLowerCase().includes(q)));
      filtered.forEach(doc => {
        const card = document.createElement('div');
        card.className = 'p-4 rounded-xl border bg-white shadow-sm hover:shadow-md transition flex flex-col';
        card.innerHTML = `
          <div class="text-xs text-gray-500 mb-1">${EOC_CATEGORY_NAMES[doc.category] || doc.category}</div>
          <div class="font-extrabold text-[var(--brand1)]">${doc.code}</div>
          <div class="text-gray-800 mt-1 flex-1">${doc.name}</div>
          <div class="mt-3 flex gap-2">
            <button class="px-3 py-2 text-sm text-white rounded-lg bg-[var(--brand1)] hover:bg-[var(--brand2)]" onclick="openDocModal('${doc.code}: ${doc.name}', '${doc.url}')">
              <i class="fas fa-eye ml-1"></i> ุนุฑุถ
            </button>
            <a class="px-3 py-2 text-sm rounded-lg border hover:bg-gray-50" target="_blank" href="${doc.url.replace('/preview','/view')}">
              <i class="fas fa-up-right-from-square ml-1"></i> ูุชุญ ูู ุชุจููุจ
            </a>
          </div>
        `;
        grid.appendChild(card);
      });
    }

    controls.querySelectorAll('button[data-eoc-filter]').forEach(btn => {
      btn.addEventListener('click', () => {
        controls.querySelectorAll('button[data-eoc-filter]').forEach(b => b.classList.remove('bg-[var(--brand1)]','text-white'));
        btn.classList.add('bg-[var(--brand1)]','text-white');
        renderFilteredDocs(btn.getAttribute('data-eoc-filter'), document.getElementById('eocSearch').value);
      });
    });
    document.getElementById('eocSearch').addEventListener('input', e => {
      const active = controls.querySelector('button[data-eoc-filter].bg-[var(--brand1)]') || { getAttribute: ()=>'ALL' };
      renderFilteredDocs(active.getAttribute('data-eoc-filter'), e.target.value);
    });
    renderFilteredDocs('ALL','');
  }

  function renderEocExercises(container) {
    container.innerHTML = `
      <div class="grid md:grid-cols-2 gap-6">
        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐โโ๏ธ ุชุณุฌูู ุชูุฑูู ุทูุงุฑุฆ</h3>
          <form id="eocExerciseForm" class="space-y-3">
            <input name="exercise_name" required class="w-full border rounded-lg px-3 py-2" placeholder="ุงุณู ุงูุชูุฑูู">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input type="date" name="exercise_date" required class="border rounded-lg px-3 py-2">
              <select name="exercise_type" required class="border rounded-lg px-3 py-2">
                <option value="">ููุน ุงูุชูุฑูู</option>
                <option value="ุฅุฎูุงุก">ุฅุฎูุงุก</option>
                <option value="ุญุฑูู">ุญุฑูู</option>
                <option value="ุชูุฑูุถ">ุชูุฑูุถ</option>
                <option value="ุงุชุตุงูุงุช">ุงุชุตุงูุงุช</option>
              </select>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="participants" type="number" required class="border rounded-lg px-3 py-2" placeholder="ุนุฏุฏ ุงููุดุงุฑููู">
              <input name="duration" required class="border rounded-lg px-3 py-2" placeholder="ุงููุฏุฉ (ุฏูุงุฆู)">
            </div>
            <textarea name="results" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder="ุงููุชุงุฆุฌ ูุงูููุงุญุธุงุช"></textarea>
            <div class="flex gap-3">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุชุณุฌูู ุงูุชูุฑูู</button>
              <span id="eocExerciseMsg" class="text-sm"></span>
            </div>
          </form>
        </div>

        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐ ุงูุชูุงุฑูู ุงููุณุฌูุฉ</h3>
          <div class="overflow-auto">
            <table class="table text-sm">
              <thead>
                <tr>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ุงูุชูุฑูู</th>
                  <th>ุงูููุน</th>
                  <th>ุงููุดุงุฑููู</th>
                </tr>
              </thead>
              <tbody id="eocExerciseTable">
                <!-- ุณูุชู ููุคูุง ุจุงูุจูุงูุงุช -->
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="box p-4 mt-6">
        <h3 class="text-lg font-bold mb-3">๐ ุณุฌู ูุนุฏุงุช ุงูุงุณุชุฌุงุจุฉ</h3>
        <form id="eocEquipmentForm" class="grid grid-cols-1 md:grid-cols-4 gap-3">
          <input name="equipment_name" required class="border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููุนุฏุฉ">
          <input name="location" required class="border rounded-lg px-3 py-2" placeholder="ุงููููุน">
          <input name="last_check" type="date" required class="border rounded-lg px-3 py-2">
          <select name="status" required class="border rounded-lg px-3 py-2">
            <option value="ุฌูุฏ">ุฌูุฏ</option>
            <option value="ูุญุชุงุฌ ุตูุงูุฉ">ูุญุชุงุฌ ุตูุงูุฉ</option>
            <option value="ูุนุทู">ูุนุทู</option>
          </select>
          <div class="md:col-span-4 flex gap-3">
            <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุชุณุฌูู ุงููุนุฏุฉ</button>
            <span id="eocEquipmentMsg" class="text-sm"></span>
          </div>
        </form>
        <div class="mt-3 overflow-auto">
          <table id="eocEquipmentTable" class="table text-sm"></table>
        </div>
      </div>
    `;

    // ูุนุงูุฌุฉ ูููุฐุฌ ุงูุชูุงุฑูู
    const exerciseForm = document.getElementById('eocExerciseForm');
    if (exerciseForm) {
      exerciseForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('eocExerciseMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        
        const fd = new FormData(exerciseForm);
        const record = {};
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(EOC_KEYS.EXERCISES, record);
          msg.textContent = 'โ ุชู ุชุณุฌูู ุงูุชูุฑูู';
          msg.className = 'text-sm text-green-600';
          exerciseForm.reset();
          loadExerciseTable();
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }

    // ูุนุงูุฌุฉ ูููุฐุฌ ุงููุนุฏุงุช
    const equipmentForm = document.getElementById('eocEquipmentForm');
    if (equipmentForm) {
      equipmentForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('eocEquipmentMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        
        const fd = new FormData(equipmentForm);
        const record = {};
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(EOC_KEYS.EQUIPMENT, record);
          msg.textContent = 'โ ุชู ุชุณุฌูู ุงููุนุฏุฉ';
          msg.className = 'text-sm text-green-600';
          equipmentForm.reset();
          loadEquipmentTable();
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }

    // ุชุญููู ุฌุฏูู ุงูุชูุงุฑูู
    async function loadExerciseTable() {
      const exercises = await ipcLoadAll(EOC_KEYS.EXERCISES);
      const table = document.getElementById('eocExerciseTable');
      table.innerHTML = exercises.slice(-10).reverse().map(item => `
        <tr>
          <td>${item.exercise_date}</td>
          <td>${item.exercise_name}</td>
          <td>${item.exercise_type}</td>
          <td>${item.participants}</td>
        </tr>
      `).join('');
    }

    // ุชุญููู ุฌุฏูู ุงููุนุฏุงุช
    async function loadEquipmentTable() {
      const equipment = await ipcLoadAll(EOC_KEYS.EQUIPMENT);
      const table = document.getElementById('eocEquipmentTable');
      const thead = '<thead><tr><th>ุงููุนุฏุฉ</th><th>ุงููููุน</th><th>ุขุฎุฑ ูุญุต</th><th>ุงูุญุงูุฉ</th></tr></thead>';
      const tbody = '<tbody>' + equipment.slice(-20).reverse().map(item => `
        <tr>
          <td>${item.equipment_name}</td>
          <td>${item.location}</td>
          <td>${item.last_check}</td>
          <td><span class="chip ${item.status === 'ุฌูุฏ' ? 'good' : item.status === 'ูุญุชุงุฌ ุตูุงูุฉ' ? 'warning' : 'critical'}">${item.status}</span></td>
        </tr>
      `).join('') + '</tbody>';
      table.innerHTML = thead + tbody;
    }

    loadExerciseTable();
    loadEquipmentTable();
  }

  function renderEocReadiness(container) {
    container.innerHTML = `
      <div class="grid md:grid-cols-2 gap-6">
        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐ก๏ธ ุชูููู ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ</h3>
          <form id="eocReadinessForm" class="space-y-3">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <input name="assessor" required class="border rounded-lg px-3 py-2" placeholder="ุงุณู ุงููููู">
              <input type="date" name="assessment_date" required class="border rounded-lg px-3 py-2">
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <select name="readiness_level" required class="border rounded-lg px-3 py-2">
                <option value="">ุงุฎุชุฑ ูุณุชูู ุงูุฌุงูุฒูุฉ</option>
                <option value="ููุชุงุฒ">ููุชุงุฒ (90-100%)</option>
                <option value="ุฌูุฏ">ุฌูุฏ (75-89%)</option>
                <option value="ููุจูู">ููุจูู (60-74%)</option>
                <option value="ุบูุฑ ูุงูู">ุบูุฑ ูุงูู (ุฃูู ูู 60%)</option>
              </select>
              <input name="score" type="number" min="0" max="100" required class="border rounded-lg px-3 py-2" placeholder="ุงููุณุจุฉ ุงููุฆููุฉ %">
            </div>
            <textarea name="notes" rows="3" class="w-full border rounded-lg px-3 py-2" placeholder="ููุงุญุธุงุช ุงูุชูููู"></textarea>
            <div class="flex gap-3">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]">ุญูุธ ุงูุชูููู</button>
              <span id="eocReadinessMsg" class="text-sm"></span>
            </div>
          </form>
        </div>

        <div class="box p-4">
          <h3 class="text-lg font-bold mb-3">๐ ุณุฌู ุงูุชููููุงุช</h3>
          <div class="overflow-auto">
            <table class="table text-sm">
              <thead>
                <tr>
                  <th>ุงูุชุงุฑูุฎ</th>
                  <th>ุงููููู</th>
                  <th>ุงููุณุชูู</th>
                  <th>ุงููุณุจุฉ</th>
                </tr>
              </thead>
              <tbody id="eocReadinessTable">
                <!-- ุณูุชู ููุคูุง ุจุงูุจูุงูุงุช -->
              </tbody>
            </table>
          </div>
          <button class="mt-3 px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700" onclick="generateEocCertificate()">
            ๐จ๏ธ ุฅูุดุงุก ุดูุงุฏุฉ ุงูุฌุงูุฒูุฉ
          </button>
        </div>
      </div>
    `;

    // ูุนุงูุฌุฉ ูููุฐุฌ ุงูุชูููู
    const readinessForm = document.getElementById('eocReadinessForm');
    if (readinessForm) {
      readinessForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const msg = document.getElementById('eocReadinessMsg');
        msg.textContent = 'ุฌุงุฑู ุงูุญูุธ...';
        
        const fd = new FormData(readinessForm);
        const record = {};
        fd.forEach((v,k) => record[k] = v);
        record._ts = new Date().toISOString();
        
        try {
          await ipcSaveRecord(EOC_KEYS.READINESS, record);
          msg.textContent = 'โ ุชู ุญูุธ ุงูุชูููู';
          msg.className = 'text-sm text-green-600';
          readinessForm.reset();
          loadReadinessTable();
        } catch (err) {
          msg.textContent = 'โ๏ธ ุชุนุฐุฑ ุงูุญูุธ';
          msg.className = 'text-sm text-red-600';
        }
      });
    }

    // ุชุญููู ุฌุฏูู ุงูุชููููุงุช
    async function loadReadinessTable() {
      const assessments = await ipcLoadAll(EOC_KEYS.READINESS);
      const table = document.getElementById('eocReadinessTable');
      table.innerHTML = assessments.slice(-10).reverse().map(item => `
        <tr>
          <td>${item.assessment_date}</td>
          <td>${item.assessor}</td>
          <td><span class="chip ${getReadinessClass(item.readiness_level)}">${item.readiness_level}</span></td>
          <td>${item.score}%</td>
        </tr>
      `).join('');
    }

    function getReadinessClass(level) {
      const classes = {
        'ููุชุงุฒ': 'good',
        'ุฌูุฏ': 'good',
        'ููุจูู': 'warning',
        'ุบูุฑ ูุงูู': 'critical'
      };
      return classes[level] || '';
    }

    loadReadinessTable();
  }

  function renderEocNeeds(container) {
    const needs = [
      { key:'policy', text:'ุณูุงุณุฉ ุฅุฏุงุฑุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC-POL-2025-001)', required:true },
      { key:'charter', text:'ููุซุงู ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC-TOR-2025-001)', required:true },
      { key:'plan', text:'ุฎุทุฉ ุงูุทูุงุฑุฆ ุงูุดุงููุฉ (EOC-PLN-2025-001)', required:true },
      { key:'hva', text:'ุชูููู ูุฎุงุทุฑ ุงูููุงุฑุซ ุงูุณููู (HVA) ูููุฐ', required:true },
      { key:'training', text:'ุจุฑูุงูุฌ ุงูุชุฏุฑูุจ ูุงูุชูุงุฑูู ููุนู (EOC-PLN-2025-002)', required:true },
      { key:'exercises', text:'ุชูุงุฑูู ุทูุงุฑุฆ ุฏูุฑูุฉ ูููุฐุฉ ููุคุฑุดูุฉ', required:true },
      { key:'equipment', text:'ูุนุฏุงุช ุงูุงุณุชุฌุงุจุฉ ููุทูุงุฑุฆ ูุชููุฑุฉ ูุตุงูุญุฉ', required:true },
      { key:'contacts', text:'ููุญุฉ ุงุชุตุงูุงุช ุงูุทูุงุฑุฆ ูุญุฏุซุฉ (EOC-LST-2025-001)', required:true },
    ];

    const wrapper = document.createElement('div');
    wrapper.className = 'grid-cards';
    needs.forEach(n => {
      const card = document.createElement('div');
      card.className = 'p-4 rounded-xl border bg-white shadow-sm';
      card.innerHTML = `
        <label class="flex items-start gap-3 cursor-pointer">
          <input type="checkbox" class="mt-1 h-5 w-5" data-required="${n.required?1:0}">
          <span class="font-semibold">${n.text}</span>
        </label>
        ${n.required ? '<div class="text-xs text-red-600 mt-1">ูุชุทูุจ ุฅูุฒุงูู</div>' : ''}
      `;
      wrapper.appendChild(card);
    });
    
    const actions = document.createElement('div');
    actions.className = 'pt-4 flex gap-3';
    actions.innerHTML = `
      <button class="px-4 py-2 rounded-lg bg-[var(--brand1)] text-white hover:bg-[var(--brand2)]" onclick="validateEocNeeds()">ุชุญููู ูู ุงูุงูุชูุงู</button>
      <button class="px-4 py-2 rounded-lg border hover:bg-gray-50" onclick="generateEocComplianceReport()">ุฅูุดุงุก ุชูุฑูุฑ ุงูุงูุชุฒุงู</button>
      <button class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700" onclick="generateSbahiCertificate()">
        ๐ ุดูุงุฏุฉ ุงุณุชููุงุก ุณุจุงูู
      </button>
    `;
    
    container.appendChild(wrapper);
    container.appendChild(actions);
  }

  function validateEocNeeds() {
    const requiredCheckboxes = [...document.querySelectorAll('#eocTabContent input[data-required="1"]')];
    const missing = requiredCheckboxes.filter(x => !x.checked).length;
    if (missing === 0) {
      alert('ููุชุงุฒ โ โ ุฌููุน ูุชุทูุจุงุช ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ุงูุฅูุฒุงููุฉ ููุชููุฉ.');
    } else {
      alert(`โ๏ธ ููุฌุฏ ${missing} ูุชุทูุจ(ุงุช) ุฅูุฒุงูู ุบูุฑ ููุชูู ูู ูุณู ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ.`);
    }
  }

  function generateEocComplianceReport() {
    const checkboxes = [...document.querySelectorAll('#eocTabContent input[type="checkbox"]')];
    const checkedCount = checkboxes.filter(cb => cb.checked).length;
    const totalCount = checkboxes.length;
    const percentage = Math.round((checkedCount / totalCount) * 100);
    
    alert(`๐ ุชูุฑูุฑ ุงูุงูุชุฒุงู ุจูุชุทูุจุงุช ุงูุทูุงุฑุฆ:\n\nโ ${checkedCount} ูู ${totalCount} ุจูุฏ ููุชูู\n๐ ูุณุจุฉ ุงูุฅููุงู: ${percentage}%\n\n${percentage >= 80 ? 'ูุณุชูู ุฌูุฏ โ' : 'ูุญุชุงุฌ ุฅูู ุชุญุณูู โ๏ธ'}`);
  }

  function generateEocCertificate() {
    const certificateContent = `
      <div style="padding: 40px; font-family: 'Tajawal', sans-serif; text-align: center; border: 3px solid #7B1E24; max-width: 800px; margin: 20px auto; background: linear-gradient(135deg, #fff, #f9f9f9);">
        <div style="border-bottom: 2px solid #E9C46A; padding-bottom: 20px; margin-bottom: 30px;">
          <h1 style="color: #7B1E24; font-size: 32px; margin: 0;">ุดูุงุฏุฉ ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ</h1>
          <h2 style="color: #C55A44; font-size: 24px; margin: 10px 0;">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</h2>
        </div>
        
        <div style="font-size: 18px; line-height: 2; text-align: right; margin: 30px 0;">
          <p>ููุดูุฏ ุจุฃู <strong>ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</strong> ูุฏ ุงุณุชููู ูุชุทูุจุงุช</p>
          <p>ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ููู ูุนุงููุฑ ุณุจุงูู</p>
          <p>ูุฐูู ุจูุงุกู ุนูู ุงูุชูููู ุงูุดุงูู ููุธุงู ุฅุฏุงุฑุฉ ุงูุทูุงุฑุฆ</p>
        </div>

        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 30px 0;">
          <h3 style="color: #7B1E24; margin-bottom: 15px;">ูุชุงุฆุฌ ุงูุชูููู</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; text-align: right;">
            <div>ูุณุชูู ุงูุฌุงูุฒูุฉ: <strong>ููุชุงุฒ</strong></div>
            <div>ูุณุจุฉ ุงูุงูุชุฒุงู: <strong>95%</strong></div>
            <div>ุชุงุฑูุฎ ุงูุชูููู: <strong>${new Date().toLocaleDateString('ar-SA')}</strong></div>
            <div>ุตูุงุญูุฉ ุงูุดูุงุฏุฉ: <strong>ููุฏุฉ ุณูุฉ</strong></div>
          </div>
        </div>

        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd;">
          <div style="text-align: center;">
            <div style="height: 80px; width: 150px; background: #f0f0f0; border: 1px dashed #999; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
              [ุฎุชู ุงููุฌูุน]
            </div>
            <div>ุฎุชู ุงููุฌูุน</div>
          </div>
          
          <div style="text-align: center;">
            <div style="height: 80px; width: 150px; background: #f0f0f0; border: 1px dashed #999; display: flex; align-items: center; justify-content: center; margin: 0 auto 10px;">
              [ุชูููุน ุงููุฏูุฑ]
            </div>
            <div>ุงููุฏูุฑ ุงูุนุงู</div>
          </div>
        </div>

        <div style="margin-top: 20px; color: #666; font-size: 14px;">
          <p>ูุฐู ุงูุดูุงุฏุฉ ุตุงุฏุฑุฉ ูู ูุธุงู ุจูุงุจุฉ ุณุจุงูู ุงูุฅููุชุฑูููุฉ - ุงูุฅุตุฏุงุฑ 2025</p>
        </div>
      </div>
    `;
    
    const newWindow = window.open('', '_blank', 'width=900,height=700');
    newWindow.document.write(`
      <html>
        <head>
          <title>ุดูุงุฏุฉ ุฌุงูุฒูุฉ ุงูุทูุงุฑุฆ - ูุฌูุน ููุฉ ุงูุทุจู</title>
          <style>
            @media print {
              body { margin: 0; }
              button { display: none; }
            }
          </style>
        </head>
        <body>
          ${certificateContent}
          <div style="text-align: center; margin: 20px;">
            <button onclick="window.print()" style="padding: 10px 20px; background: #7B1E24; color: white; border: none; border-radius: 5px; cursor: pointer;">๐จ๏ธ ุทุจุงุนุฉ ุงูุดูุงุฏุฉ</button>
          </div>
        </body>
      </html>
    `);
    newWindow.document.close();
  }

  function generateSbahiCertificate() {
    const certificateContent = `
      <div style="padding: 40px; font-family: 'Tajawal', sans-serif; text-align: center; border: 3px solid #7B1E24; max-width: 800px; margin: 20px auto; background: linear-gradient(135deg, #fff, #f9f9f9);">
        <div style="border-bottom: 2px solid #E9C46A; padding-bottom: 20px; margin-bottom: 30px;">
          <h1 style="color: #7B1E24; font-size: 36px; margin: 0;">ุดูุงุฏุฉ ุงุณุชููุงุก ูุชุทูุจุงุช ุณุจุงูู</h1>
          <h2 style="color: #C55A44; font-size: 28px; margin: 10px 0;">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</h2>
          <p style="color: #666; font-size: 18px;">ุงูุจูุงุจุฉ ุงูุฅููุชุฑูููุฉ - ุงูุฅุตุฏุงุฑ 2025</p>
        </div>
        
        <div style="font-size: 20px; line-height: 2; text-align: right; margin: 40px 0;">
          <p>ููุดูุฏ ุจุฃู <strong style="color: #7B1E24;">ูุฌูุน ููุฉ ุงูุทุจู ุจุงูุฒุงูุฑ</strong></p>
          <p>ูุฏ ุงุณุชููู ุฌููุน ูุชุทูุจุงุช ุงูุงุนุชูุงุฏ ุงูุฎุงุตุฉ ุจู</p>
          <p><strong style="color: #C55A44;">ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ (EOC)</strong> ููู ูุนุงููุฑ ุณุจุงูู</p>
          <p>ูุฐูู ุจูุงุกู ุนูู ุงููุฑุงุฌุนุฉ ุงูุดุงููุฉ ูููุซุงุฆู ูุงููุธู</p>
        </div>

        <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 40px 0; border-right: 4px solid #E9C46A;">
          <h3 style="color: #7B1E24; margin-bottom: 20px; font-size: 24px;">ููุฎุต ุงูุงูุชุฒุงู</h3>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: right; font-size: 18px;">
            <div>ูุณุจุฉ ุงูุงูุชุฒุงู ุงููููุฉ: <strong style="color: green;">98%</strong></div>
            <div>ุงููุชุทูุจุงุช ุงูููุชููุฉ: <strong>8/8</strong></div>
            <div>ุชุงุฑูุฎ ุงููุฑุงุฌุนุฉ: <strong>${new Date().toLocaleDateString('ar-SA')}</strong></div>
            <div>ุญุงูุฉ ุงูุงุนุชูุงุฏ: <strong style="color: green;">ูุณุชููู โ</strong></div>
          </div>
        </div>

        <div style="background: #fff9e6; padding: 20px; border-radius: 10px; margin: 30px 0; border: 1px solid #E9C46A;">
          <h4 style="color: #7B1E24; margin: 0;">โ๏ธ ุฌููุน ูุชุทูุจุงุช ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ ูุณุชููุงุฉ ุจุงููุงูู</h4>
        </div>

        <div style="display: flex; justify-content: space-around; align-items: center; margin-top: 50px; padding-top: 30px; border-top: 2px solid #ddd;">
          <div style="text-align: center;">
            <div style="height: 100px; width: 180px; background: #f0f0f0; border: 2px dashed #999; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 14px; color: #666;">
              [ุฎุชู ุงููุฌูุน ุงูุฑุณูู]
            </div>
            <div style="font-weight: bold;">ุฎุชู ุงููุฌูุน</div>
          </div>
          
          <div style="text-align: center;">
            <div style="height: 100px; width: 180px; background: #f0f0f0; border: 2px dashed #999; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 14px; color: #666;">
              [ุชูููุน ุงููุฏูุฑ ุงูุนุงู]
            </div>
            <div style="font-weight: bold;">ุฏ. ุญุณูู ุจุงุจุตูู</div>
            <div>ุงููุฏูุฑ ุงูุนุงู</div>
          </div>

          <div style="text-align: center;">
            <div style="height: 100px; width: 180px; background: #f0f0f0; border: 2px dashed #999; display: flex; align-items: center; justify-content: center; margin: 0 auto 15px; font-size: 14px; color: #666;">
              [ุฎุชู ุงููุฌูุฉ]
            </div>
            <div style="font-weight: bold;">ูุฌูุฉ ุงูุทูุงุฑุฆ ูุงูููุงุฑุซ</div>
          </div>
        </div>

        <div style="margin-top: 30px; color: #666; font-size: 14px; padding: 15px; background: #f5f5f5; border-radius: 5px;">
          <p>ูุฐู ุงูุดูุงุฏุฉ ุฅููุชุฑูููุฉ ูุนุชูุฏุฉ - ุฑูู ุงููุฑุฌุน: EOC-CERT-${new Date().getFullYear()}-${Math.random().toString(36).substr(2, 9).toUpperCase()}</p>
        </div>
      </div>
    `;
    
    const newWindow = window.open('', '_blank', 'width=1000,height=800');
    newWindow.document.write(`
      <html>
        <head>
          <title>ุดูุงุฏุฉ ุงุณุชููุงุก ุณุจุงูู - ูุฌูุน ููุฉ ุงูุทุจู</title>
          <style>
            @media print {
              body { margin: 0; }
              button { display: none; }
            }
          </style>
        </head>
        <body>
          ${certificateContent}
          <div style="text-align: center; margin: 30px;">
            <button onclick="window.print()" style="padding: 12px 25px; background: #7B1E24; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px;">๐จ๏ธ ุทุจุงุนุฉ ุงูุดูุงุฏุฉ</button>
            <button onclick="window.close()" style="padding: 12px 25px; background: #666; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px;">ุฅุบูุงู</button>
          </div>
        </body>
      </html>
    `);
    newWindow.document.close();
  }

  async function eocExportAll() {
    const data = {
      exercises: await ipcLoadAll(EOC_KEYS.EXERCISES),
      equipment: await ipcLoadAll(EOC_KEYS.EQUIPMENT),
      training: await ipcLoadAll(EOC_KEYS.TRAINING),
      readiness: await ipcLoadAll(EOC_KEYS.READINESS)
    };
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'eoc_data_backup.json';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }

  function eocImportAll(file) {
    const reader = new FileReader();
    reader.onload = async (e) => {
      try {
        const data = JSON.parse(e.target.result);
        if (data.exercises) localStorage.setItem(EOC_KEYS.EXERCISES, (await SecureStore.encryptJson(data.exercises)).data);
        if (data.equipment) localStorage.setItem(EOC_KEYS.EQUIPMENT, (await SecureStore.encryptJson(data.equipment)).data);
        if (data.training) localStorage.setItem(EOC_KEYS.TRAINING, (await SecureStore.encryptJson(data.training)).data);
        if (data.readiness) localStorage.setItem(EOC_KEYS.READINESS, (await SecureStore.encryptJson(data.readiness)).data);
        alert('โ ุชู ุงุณุชูุฑุงุฏ ุจูุงูุงุช ุงูุทูุงุฑุฆ ุจูุฌุงุญ.');
      } catch (err) {
        alert('โ๏ธ ููู ุบูุฑ ุตุงูุญ.');
      }
    };
    reader.readAsText(file, 'utf-8');
  }
</script>
</body>
</html>
